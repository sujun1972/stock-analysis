# Frontend 项目：选股推荐功能改造规划

**文档版本**: v1.0.0
**创建日期**: 2026-02-07
**规划阶段**: v2.0 - 功能扩展

---

## 📋 改造目的

### 问题分析

当前前端的三层架构回测页面（`/backtest/three-layer`）存在以下问题：

1. **用户体验问题**
   - 必须同时配置选股器、入场策略、退出策略
   - 无法直观看到"今日/本周推荐哪些股票"
   - 回测配置表单过于复杂（10+ 个字段）
   - 无法保存/导出推荐股票列表

2. **不符合实际使用流程**
   ```
   实际需求：
   1. 周末：查看推荐股票 → 了解评分和理由 → 保存列表
   2. 平时：基于推荐列表回测策略 → 调整参数 → 优化策略
   3. 实盘：参考推荐列表 + 交易信号决策

   当前页面：
   1. 必须配置完整的三层策略
   2. 看不到推荐股票的详细信息
   3. 无法独立使用选股功能
   ```

3. **功能缺失**
   - 无"选股推荐"页面
   - 无推荐股票的详情展示
   - 无推荐历史查询
   - 无推荐列表导出功能

### 改造目标

**核心目标**：新增选股推荐页面，简化回测页面，分离选股和回测功能

**具体目标**：
1. ✅ 新增"选股推荐"页面（独立功能）
2. ✅ 简化"策略回测"页面（去掉选股器配置）
3. ✅ 保留"三层架构回测"页面（研究用途）
4. ✅ 支持推荐列表的保存/导出/导入
5. ✅ 提升用户体验和工作效率

---

## 🎯 改造大纲

### 1. 新增选股推荐页面

#### 1.1 页面路由

```
/stock-selector          # 选股推荐主页面
```

#### 1.2 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  🔍 选股推荐系统                                                  │
│  通过多种选股策略，从全市场筛选优质股票                            │
└─────────────────────────────────────────────────────────────────┘

┌───────────────────────────┐  ┌────────────────────────────────┐
│  📋 选股配置               │  │  📊 推荐结果                    │
│                           │  │                                 │
│  选择选股器：              │  │  2024-02-07 推荐股票 (共50只)   │
│  ○ 动量选股               │  │                                 │
│  ○ 价值选股               │  │  排名 | 代码      | 名称  | 评分│
│  ○ ML选股                │  │  ────────────────────────────│
│  ○ 外部选股               │  │   1  | 600519.SH | 茅台  | 0.95│
│                           │  │   2  | 000858.SZ | 五粮液| 0.92│
│  参数配置：                │  │   3  | 600036.SH | 招商银| 0.90│
│  • 回溯周期: 20 天         │  │  ...                           │
│  • 选股数量: 50 只         │  │                                 │
│                           │  │  [查看详情] [导出CSV] [保存列表]│
│  候选池：                  │  │  [发送到回测]                  │
│  ○ 全市场                 │  │                                 │
│  ○ 沪深300                │  │  推荐理由：                     │
│  ○ 自定义                 │  │  600519.SH:                    │
│                           │  │  • 20日涨幅15.2%               │
│  [运行选股]  [历史记录]    │  │  • 成交量放大1.35倍            │
│                           │  │  • 动量评分:0.95               │
└───────────────────────────┘  └────────────────────────────────┘
```

#### 1.3 核心功能

| 功能 | 说明 | 实现难度 |
|------|------|---------|
| 选股器选择 | 4种选股器（动量/价值/ML/外部） | ⭐ |
| 参数配置 | 动态表单（根据选股器） | ⭐⭐ |
| 运行选股 | 调用 API 获取推荐列表 | ⭐ |
| 结果展示 | 表格+详情+可视化 | ⭐⭐ |
| 导出功能 | CSV/Excel/JSON | ⭐ |
| 保存列表 | 本地存储/数据库 | ⭐⭐ |
| 历史记录 | 查看历史选股结果 | ⭐⭐⭐ |
| 发送到回测 | 一键跳转到回测页面 | ⭐ |

---

### 2. 改造策略回测页面

#### 2.1 页面路由

```
/backtest/strategy       # 新增：简化的策略回测页面
/backtest/three-layer    # 保留：三层架构回测页面（研究用途）
/backtest                # 保留：传统回测页面（单股/多股）
```

#### 2.2 简化的策略回测页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│  📈 策略回测系统                                                  │
│  基于固定股票池测试入场和退出策略的效果                            │
└─────────────────────────────────────────────────────────────────┘

┌───────────────────────────┐  ┌────────────────────────────────┐
│  📋 回测配置               │  │  📊 回测结果                    │
│                           │  │                                 │
│  股票池来源：              │  │  策略收益曲线                   │
│  ○ 从选股推荐导入          │  │  ┌──────────────────────────┐│
│  ○ 手动输入               │  │  │  [收益曲线图]             ││
│  ○ 从历史记录加载          │  │  └──────────────────────────┘│
│                           │  │                                 │
│  股票列表：(50只)          │  │  绩效指标：                     │
│  600519.SH, 000858.SZ...  │  │  • 总收益率: 28.3%             │
│  [编辑] [清空]            │  │  • 夏普比率: 1.65              │
│                           │  │  • 最大回撤: -8.2%             │
│  入场策略：                │  │  • 胜率: 58.2%                 │
│  [选择策略]               │  │                                 │
│                           │  │  交易明细 [导出报告]            │
│  退出策略：                │  │                                 │
│  [选择策略]               │  │  vs 基准 (等权持有)             │
│                           │  │  • 基准收益: 15.2%             │
│  回测参数：                │  │  • Alpha: 13.1%                │
│  • 开始日期: 2023-01-01   │  │  • Beta: 0.85                  │
│  • 结束日期: 2023-12-31   │  │                                 │
│  • 初始资金: 100万         │  └────────────────────────────────┘
│                           │
│  [运行回测]               │
└───────────────────────────┘
```

#### 2.3 核心改进

| 改进点 | 改造前 | 改造后 |
|--------|--------|--------|
| **配置项** | 13个字段 | 6个字段 |
| **股票池** | 回测时动态选股 | 固定股票池（预先确定） |
| **导入方式** | 无 | 从选股推荐/手动/历史记录 |
| **基准对比** | 无 | 等权持有对比 |
| **用户体验** | 复杂 | 简单直观 |

---

### 3. 文件结构

#### 3.1 新增页面和组件

```
frontend/src/
├── app/
│   ├── stock-selector/              # 新增：选股推荐页面
│   │   └── page.tsx
│   │
│   ├── backtest/
│   │   ├── page.tsx                 # 保留：传统回测页面
│   │   ├── strategy/                # 新增：策略回测页面
│   │   │   └── page.tsx
│   │   └── three-layer/             # 保留：三层架构页面（研究用途）
│   │       └── page.tsx
│   │
│   └── recommendations/             # 新增：推荐历史页面（可选）
│       └── page.tsx
│
├── components/
│   ├── stock-selector/              # 新增：选股组件
│   │   ├── SelectorPanel.tsx        # 选股器配置面板
│   │   ├── RecommendationList.tsx   # 推荐列表
│   │   ├── StockDetailCard.tsx      # 股票详情卡片
│   │   └── HistoryBrowser.tsx       # 历史记录浏览
│   │
│   ├── backtest/
│   │   ├── StrategyPanel.tsx        # 新增：策略配置面板
│   │   ├── StockPoolInput.tsx       # 新增：股票池输入组件
│   │   └── ...
│   │
│   └── three-layer/                 # 保留：三层架构组件
│       └── ThreeLayerStrategyPanel.tsx
│
└── lib/
    ├── stock-selector-api.ts        # 新增：选股API调用
    ├── strategy-backtest-api.ts     # 新增：策略回测API调用
    └── ...
```

---

### 4. API 集成

#### 4.1 选股 API 调用

**文件**: `lib/stock-selector-api.ts`

```typescript
// 获取可用选股器列表
export async function getSelectors(): Promise<SelectorInfo[]>

// 运行选股
export interface SelectStocksRequest {
  selector_id: string
  selector_params: Record<string, any>
  date: string
  stock_pool?: string[]
}

export async function selectStocks(
  request: SelectStocksRequest
): Promise<SelectStocksResponse>

// 保存选股结果
export async function saveSelection(
  selection: SelectStocksResponse
): Promise<void>

// 加载历史选股记录
export async function getSelectionHistory(): Promise<SelectStocksResponse[]>
```

#### 4.2 策略回测 API 调用

**文件**: `lib/strategy-backtest-api.ts`

```typescript
export interface StrategyBacktestRequest {
  stock_pool: string[]
  entry_id: string
  entry_params: Record<string, any>
  exit_id: string
  exit_params: Record<string, any>
  start_date: string
  end_date: string
  initial_capital: number
  rebalance_freq: string
}

export async function runStrategyBacktest(
  request: StrategyBacktestRequest
): Promise<BacktestResult>
```

---

### 5. 用户流程

#### 5.1 完整工作流

```
步骤1: 选股推荐
┌────────────────────────────────────┐
│ /stock-selector                    │
│                                    │
│ 1. 选择选股器（如"动量选股"）       │
│ 2. 配置参数（回溯20天，Top 50）    │
│ 3. 点击"运行选股"                  │
│ 4. 查看推荐结果                    │
│ 5. [导出CSV] / [保存列表]         │
│ 6. [发送到回测] ───────┐          │
└────────────────────────────────────┘
                            │
                            ↓
步骤2: 策略回测
┌────────────────────────────────────┐
│ /backtest/strategy                 │
│                                    │
│ 1. 自动加载推荐股票列表（50只）     │
│ 2. 选择入场策略（立即入场）         │
│ 3. 选择退出策略（固定止损-5%）     │
│ 4. 配置回测参数                    │
│ 5. 点击"运行回测"                  │
│ 6. 查看回测结果和绩效分析           │
└────────────────────────────────────┘
                            │
                            ↓
步骤3: 实盘决策（手动）
根据推荐列表 + 回测结果决定买入
```

---

## 📊 页面对比

### 改造前（三层架构页面）

**路由**: `/backtest/three-layer`

**表单字段**:
1. 选股器选择
2. 选股器参数 (2-5个字段)
3. 入场策略选择
4. 入场策略参数 (1-3个字段)
5. 退出策略选择
6. 退出策略参数 (1-3个字段)
7. 调仓频率
8. 股票池（可选）
9. 开始日期
10. 结束日期
11. 初始资金

**总计**: 13+ 个配置项

**问题**:
- ❌ 配置过于复杂
- ❌ 看不到推荐股票
- ❌ 无法导出推荐列表

### 改造后（分离式页面）

**选股推荐页面** (`/stock-selector`):

**表单字段**:
1. 选股器选择
2. 选股器参数 (2-5个字段)
3. 选股日期
4. 候选池（可选）

**总计**: 4-7 个配置项

**输出**: 推荐股票列表（可导出/保存）

---

**策略回测页面** (`/backtest/strategy`):

**表单字段**:
1. 股票池（从推荐导入/手动）
2. 入场策略选择
3. 入场策略参数 (1-3个字段)
4. 退出策略选择
5. 退出策略参数 (1-3个字段)
6. 开始日期
7. 结束日期
8. 初始资金

**总计**: 8-11 个配置项

**优势**:
- ✅ 职责清晰（只关注策略）
- ✅ 配置简化
- ✅ 支持导入推荐列表

---

## 🔄 实施计划

### Phase 1: 选股推荐页面开发（1周）

**前端开发** (5天):
- [ ] 创建 `/app/stock-selector/page.tsx`
- [ ] 实现 `SelectorPanel` 组件
- [ ] 实现 `RecommendationList` 组件
- [ ] 实现 `StockDetailCard` 组件
- [ ] 实现导出功能（CSV/JSON）
- [ ] 实现保存/加载功能

**API 集成** (2天):
- [ ] 实现 `lib/stock-selector-api.ts`
- [ ] 调用 Backend 的 `/api/stock-selector/*` 端点
- [ ] 错误处理和加载状态

### Phase 2: 策略回测页面开发（5天）

**前端开发** (4天):
- [ ] 创建 `/app/backtest/strategy/page.tsx`
- [ ] 实现 `StrategyPanel` 组件
- [ ] 实现 `StockPoolInput` 组件（支持导入）
- [ ] 实现结果展示组件
- [ ] 实现基准对比功能

**API 集成** (1天):
- [ ] 实现 `lib/strategy-backtest-api.ts`
- [ ] 调用 Backend 的 `/api/backtest/strategy` 端点

### Phase 3: 导航和路由优化（2天）

- [ ] 更新主导航菜单
- [ ] 添加"选股推荐"入口
- [ ] 调整"回测"菜单结构
- [ ] 实现页面间跳转（选股→回测）

### Phase 4: 样式和UX优化（2天）

- [ ] 统一 UI 风格
- [ ] 响应式布局
- [ ] 加载动画和骨架屏
- [ ] 用户引导和提示

### Phase 5: 测试和文档（2天）

- [ ] 单元测试（组件测试）
- [ ] E2E 测试（用户流程）
- [ ] 编写使用文档
- [ ] 录制演示视频

---

## 📈 预期收益

### 用户体验提升

| 指标 | 改造前 | 改造后 | 提升 |
|------|--------|--------|------|
| 推荐股票可见性 | 无 | 完整列表 | ✨ 新功能 |
| 配置复杂度 | 13+ 字段 | 4-7 字段（选股） | ↓ 60% |
| 工作流清晰度 | 混乱 | 清晰（选股→回测） | ✨ 新流程 |
| 导出功能 | 无 | CSV/JSON | ✨ 新功能 |

### 功能扩展

1. ✅ 独立选股推荐功能
2. ✅ 推荐列表保存/加载
3. ✅ 推荐历史查询
4. ✅ 基准对比功能
5. ✅ 一键导入到回测

---

## ⚠️ 风险与挑战

### 技术挑战

1. **状态管理**
   - 挑战：选股结果如何在页面间传递
   - 方案：URL 参数 + localStorage + Zustand

2. **数据导入**
   - 挑战：CSV/JSON 文件解析
   - 方案：使用 `papaparse` 库

3. **性能优化**
   - 挑战：大量股票列表渲染
   - 方案：虚拟滚动（react-window）

### UX 挑战

1. **用户引导**
   - 新用户可能不理解分离式流程
   - 方案：首次访问引导动画

2. **向后兼容**
   - 老用户习惯三层架构页面
   - 方案：保留旧页面，标注"研究用途"

---

## ✅ 验收标准

1. **功能完整性**
   - ✅ 选股推荐页面正常工作
   - ✅ 策略回测页面正常工作
   - ✅ 页面间跳转流畅
   - ✅ 导出/导入功能正常

2. **性能达标**
   - ✅ 页面加载 <1s
   - ✅ API 调用响应 <3s
   - ✅ 列表渲染流畅（60fps）

3. **兼容性**
   - ✅ Chrome/Firefox/Safari 正常
   - ✅ 移动端基本可用
   - ✅ 三层架构页面不受影响

4. **用户体验**
   - ✅ 新用户可快速上手（<5分钟）
   - ✅ 用户反馈满意度 >= 90%

---

## 📚 相关文档

- [Core 改造规划](../../core/docs/planning/stock_selector_decoupling_plan.md)
- [Backend 改造规划](../../backend/docs/planning/stock_selector_api_refactoring_plan.md)
- [Frontend 实现计划](../frontend-implementation-plan.md)

---

**文档维护**: Frontend Team
**最后更新**: 2026-02-07
**状态**: 📋 待审批
