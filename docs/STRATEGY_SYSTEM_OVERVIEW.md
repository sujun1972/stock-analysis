# ç­–ç•¥ç³»ç»Ÿè®¾è®¡æ¦‚è§ˆ

**é¡¹ç›®**: Stock-Analysis
**ç‰ˆæœ¬**: v1.0.0
**æ—¥æœŸ**: 2026-02-08
**çŠ¶æ€**: ğŸ“‹ è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½

---

## ğŸ“‹ æ–‡æ¡£ç»“æ„

```
stock-analysis/
â”‚
â”œâ”€â”€ backend/docs/planning/
â”‚   â”œâ”€â”€ README.md â­ Backendè§„åˆ’æ€»è§ˆ
â”‚   â”œâ”€â”€ strategy_config_management.md (æ–¹æ¡ˆ1: å‚æ•°é…ç½®)
â”‚   â”œâ”€â”€ ai_strategy_generation.md (æ–¹æ¡ˆ2: AIä»£ç ç”Ÿæˆ)
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ core/docs/planning/
    â”œâ”€â”€ core_strategy_system_refactoring.md â­ Coreå±‚æ”¹é€ æ–¹æ¡ˆ
    â””â”€â”€ tech_debt.md
```

---

## ğŸ¯ åŒæ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ1: ç­–ç•¥å‚æ•°é…ç½®ç®¡ç†
**æ–‡æ¡£**: [backend/docs/planning/strategy_config_management.md](backend/docs/planning/strategy_config_management.md)

**æ ¸å¿ƒæ€è·¯**: é¢„å®šä¹‰ç­–ç•¥ç±»å‹ + å‚æ•°åŒ–é…ç½®

```
ç”¨æˆ·åœ¨Web UIé…ç½®å‚æ•°
    â†“
ä¿å­˜åˆ° strategy_configs è¡¨
    â†“
Core ä»æ•°æ®åº“åŠ è½½é…ç½®
    â†“
å®ä¾‹åŒ–ä¸ºé¢„å®šä¹‰ç­–ç•¥ç±» (MomentumStrategyç­‰)
```

**é€‚ç”¨åœºæ™¯**:
- âœ… æ ‡å‡†ç­–ç•¥ (åŠ¨é‡ã€å‡å€¼å›å½’ã€å¤šå› å­)
- âœ… æ–°æ‰‹ç”¨æˆ·
- âœ… å¿«é€Ÿè°ƒå‚

**ä¼˜åŠ¿**:
- ç®€å•å®‰å…¨
- å¿«é€Ÿå®æ–½
- ç¨³å®šå¯é 

---

### æ–¹æ¡ˆ2: AIé©±åŠ¨çš„ç­–ç•¥ä»£ç ç”Ÿæˆ
**æ–‡æ¡£**: [backend/docs/planning/ai_strategy_generation.md](backend/docs/planning/ai_strategy_generation.md)

**æ ¸å¿ƒæ€è·¯**: è‡ªç„¶è¯­è¨€æè¿° â†’ AIç”Ÿæˆå®Œæ•´ä»£ç  â†’ åŠ¨æ€åŠ è½½æ‰§è¡Œ

```
ç”¨æˆ·è¾“å…¥: "å°ç›˜è‚¡,å¸‚ç›ˆç‡<30,è‚¡ä»·<20æ—¥å‡çº¿"
    â†“
Backend è°ƒç”¨ DeepSeek API ç”Ÿæˆä»£ç 
    â†“
å¤šå±‚éªŒè¯ (è¯­æ³•ã€å®‰å…¨ã€æ¥å£)
    â†“
ä¿å­˜åˆ° ai_strategies è¡¨
    â†“
Core åŠ¨æ€åŠ è½½å¹¶å®‰å…¨æ‰§è¡Œ
```

**é€‚ç”¨åœºæ™¯**:
- âœ… åˆ›æ–°ç­–ç•¥
- âœ… é«˜çº§ç”¨æˆ·
- âœ… å¿«é€ŸåŸå‹

**ä¼˜åŠ¿**:
- æè‡´çµæ´»
- åˆ›æ–°å‹å¥½
- é™ä½å¼€å‘é—¨æ§›

---

### ä¸¤ä¸ªæ–¹æ¡ˆçš„å…³ç³»

**äº’è¡¥å…±å­˜**ï¼Œä¸æ˜¯äº’æ–¥ï¼š

| ç»´åº¦ | æ–¹æ¡ˆ1 (å‚æ•°é…ç½®) | æ–¹æ¡ˆ2 (AIä»£ç ç”Ÿæˆ) |
|------|-----------------|-------------------|
| **çµæ´»æ€§** | â­â­â­ å—é™äºé¢„å®šä¹‰ç­–ç•¥ | â­â­â­â­â­ å¯ç”Ÿæˆä»»æ„ç­–ç•¥ |
| **å®‰å…¨æ€§** | â­â­â­â­â­ éå¸¸å®‰å…¨ | â­â­â­â­ éœ€è¦å¤šå±‚é˜²æŠ¤ |
| **æ˜“ç”¨æ€§** | â­â­â­â­â­ è¡¨å•é…ç½® | â­â­â­â­ è‡ªç„¶è¯­è¨€è¾“å…¥ |
| **æˆç†Ÿåº¦** | â­â­â­â­â­ æˆç†Ÿæ–¹æ¡ˆ | â­â­â­ åˆ›æ–°æ–¹æ¡ˆ |
| **å®æ–½éš¾åº¦** | â­â­â­ è¾ƒå®¹æ˜“ | â­â­â­â­â­ å¤æ‚ |
| **ç”¨æˆ·ç¾¤ä½“** | æ–°æ‰‹ã€æ ‡å‡†éœ€æ±‚ | é«˜çº§ç”¨æˆ·ã€åˆ›æ–°éœ€æ±‚ |

**å»ºè®®**: ä¸¤ä¸ªéƒ½å®ç°ï¼Œä¼˜å…ˆçº§: æ–¹æ¡ˆ1 â†’ æ–¹æ¡ˆ2

---

## ğŸ—ï¸ Coreå±‚ç»Ÿä¸€æ¶æ„

**æ–‡æ¡£**: [core/docs/planning/core_strategy_system_refactoring.md](core/docs/planning/core_strategy_system_refactoring.md)

### ç»Ÿä¸€çš„ç­–ç•¥å·¥å‚

```python
from core.strategies import StrategyFactory

factory = StrategyFactory()

# æ–¹å¼1: é¢„å®šä¹‰ç­–ç•¥ (ç°æœ‰æ–¹å¼)
strategy = factory.create('momentum', {'lookback_period': 20})

# æ–¹å¼2: ä»é…ç½®åŠ è½½ (å‚æ•°é…ç½®æ–¹æ¡ˆ)
strategy = factory.create_from_config(config_id=123)

# æ–¹å¼3: ä»AIä»£ç åŠ è½½ (AIä»£ç ç”Ÿæˆæ–¹æ¡ˆ)
strategy = factory.create_from_code(strategy_id=456)

# ç»Ÿä¸€ä½¿ç”¨
signals = strategy.generate_signals(prices)
```

### æ ¸å¿ƒæ–°å¢æ¨¡å—

```
core/src/strategies/
â”‚
â”œâ”€â”€ loaders/ (åŠ è½½å™¨) â­æ–°å¢
â”‚   â”œâ”€â”€ config_loader.py          # æ–¹æ¡ˆ1ä¸“ç”¨
â”‚   â”œâ”€â”€ dynamic_loader.py         # æ–¹æ¡ˆ2ä¸“ç”¨
â”‚   â””â”€â”€ loader_factory.py         # ç»Ÿä¸€æ¥å£
â”‚
â”œâ”€â”€ security/ (å®‰å…¨æ¨¡å—) â­æ–°å¢
â”‚   â”œâ”€â”€ code_sanitizer.py         # ä»£ç å‡€åŒ–
â”‚   â”œâ”€â”€ permission_checker.py     # æƒé™æ£€æŸ¥
â”‚   â”œâ”€â”€ resource_limiter.py       # èµ„æºé™åˆ¶
â”‚   â””â”€â”€ audit_logger.py           # å®¡è®¡æ—¥å¿—
â”‚
â””â”€â”€ predefined/ (é¢„å®šä¹‰ç­–ç•¥) â­é‡ç»„
    â”œâ”€â”€ momentum_strategy.py
    â”œâ”€â”€ mean_reversion_strategy.py
    â””â”€â”€ multi_factor_strategy.py
```

---

## ğŸ” å¤šå±‚å®‰å…¨é˜²æŠ¤

### ä¸ºä»€ä¹ˆCoreéœ€è¦ç‹¬ç«‹å®‰å…¨éªŒè¯ï¼Ÿ

**é›¶ä¿¡ä»»åŸåˆ™**: ä¸ä¿¡ä»»Backendçš„éªŒè¯ç»“æœ

**é˜²æŠ¤åœºæ™¯**:
1. æ•°æ®åº“è¢«æ”»ç ´ â†’ æ¶æ„ä»£ç ç›´æ¥å†™å…¥
2. Backendè¢«ç»•è¿‡ â†’ æ”»å‡»è€…ç›´æ¥è°ƒç”¨Core
3. ä»£ç è¢«ç¯¡æ”¹ â†’ ä¼ è¾“è¿‡ç¨‹ä¸­ä¿®æ”¹

### å››å±‚é˜²å¾¡ä½“ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1å±‚: BackendéªŒè¯ (åˆæ¬¡æ£€æŸ¥)            â”‚
â”‚  - AIç”Ÿæˆæ—¶çš„Promptè¿‡æ»¤                  â”‚
â”‚  - ä»£ç ä¿å­˜å‰çš„ASTåˆ†æ                   â”‚
â”‚  - æ²™ç®±æµ‹è¯•                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2å±‚: CoreåŠ è½½æ—¶éªŒè¯ â­ (ç‹¬ç«‹éªŒè¯)      â”‚
â”‚  - ä»£ç ç­¾å/å“ˆå¸ŒéªŒè¯                     â”‚
â”‚  - å†æ¬¡ASTåˆ†æ                           â”‚
â”‚  - å¯¼å…¥ç™½åå•æ£€æŸ¥                        â”‚
â”‚  - å±é™©å‡½æ•°æ£€æµ‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬3å±‚: è¿è¡Œæ—¶éš”ç¦» â­ (æ²™ç®±æ‰§è¡Œ)          â”‚
â”‚  - å—é™å‘½åç©ºé—´ (åªèƒ½è®¿é—®å®‰å…¨å‡½æ•°)       â”‚
â”‚  - ç¦ç”¨å±é™©å†…ç½®å‡½æ•° (eval/exec/open)     â”‚
â”‚  - èµ„æºé™åˆ¶ (CPU 30s / å†…å­˜ 512MB)       â”‚
â”‚  - ç³»ç»Ÿè°ƒç”¨ç›‘æ§                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬4å±‚: å®¡è®¡ä¸ç›‘æ§ â­ (å®Œæ•´è¿½è¸ª)          â”‚
â”‚  - æ‰€æœ‰æ“ä½œå®Œæ•´æ—¥å¿—                      â”‚
â”‚  - å¼‚å¸¸è¡Œä¸ºå‘Šè­¦                          â”‚
â”‚  - æ€§èƒ½æŒ‡æ ‡æ”¶é›†                          â”‚
â”‚  - è‡ªåŠ¨å›æ»šæœºåˆ¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒå®‰å…¨æªæ–½

#### 1. ä»£ç å®Œæ•´æ€§éªŒè¯
```python
# éªŒè¯ä»£ç æœªè¢«ç¯¡æ”¹
if calculate_hash(code) != expected_hash:
    raise SecurityError("ä»£ç å“ˆå¸Œä¸åŒ¹é…ï¼Œå¯èƒ½è¢«ç¯¡æ”¹")
```

#### 2. å—é™å‘½åç©ºé—´
```python
# åªå…è®¸è®¿é—®å®‰å…¨çš„å‡½æ•°å’Œæ¨¡å—
safe_globals = {
    '__builtins__': {'abs', 'len', 'min', 'max'},  # å®‰å…¨å‡½æ•°
    'pd': pandas,
    'np': numpy,
}

exec(code, safe_globals)  # ä¸èƒ½è®¿é—® os, sys, evalç­‰
```

#### 3. èµ„æºé™åˆ¶
```python
with ResourceLimiter(max_memory=512MB, max_cpu=30s):
    strategy.generate_signals(prices)  # è‡ªåŠ¨ç»ˆæ­¢è¶…é™æ“ä½œ
```

#### 4. å®¡è®¡æ—¥å¿—
```json
{
  "event": "strategy_load",
  "strategy_id": 456,
  "code_hash": "abc123...",
  "validation": {"safe": true, "risk_level": "low"},
  "timestamp": "2026-02-08T10:00:00Z"
}
```

---

## ğŸ“Š èŒè´£åˆ’åˆ†

| èŒè´£ | Backend | Core |
|------|---------|------|
| **ç­–ç•¥é…ç½®ç®¡ç†** | âœ… CRUD API | âŒ |
| **AIä»£ç ç”Ÿæˆ** | âœ… DeepSeek API | âŒ |
| **åˆæ¬¡éªŒè¯** | âœ… è¯­æ³•æ£€æŸ¥ | âŒ |
| **ä»£ç å­˜å‚¨** | âœ… PostgreSQL | âŒ |
| **é…ç½®åŠ è½½** | âŒ | âœ… ConfigLoader |
| **ä»£ç åŠ¨æ€åŠ è½½** | âŒ | âœ… DynamicLoader |
| **ç‹¬ç«‹å®‰å…¨éªŒè¯** â­ | âŒ | âœ… Securityæ¨¡å— |
| **è¿è¡Œæ—¶éš”ç¦»** â­ | âŒ | âœ… å—é™å‘½åç©ºé—´ |
| **èµ„æºé™åˆ¶** â­ | âŒ | âœ… ResourceLimiter |
| **ç­–ç•¥æ‰§è¡Œ** | âŒ | âœ… BacktestEngine |
| **å®¡è®¡æ—¥å¿—** | âœ… | âœ… å„è‡ªè®°å½• |

**å…³é”®**: Coreæœ‰å®Œæ•´çš„ç‹¬ç«‹å®‰å…¨éªŒè¯èƒ½åŠ›ï¼Œä¸ä¾èµ–Backend

---

## ğŸš€ å®æ–½è®¡åˆ’

### æ€»ä½“æ—¶é—´çº¿: 7-10å‘¨

```
Phase 1: å‚æ•°é…ç½®æ–¹æ¡ˆ (2-3å‘¨)
â”œâ”€ Backend: ConfigService + API
â”œâ”€ Frontend: é…ç½®ç®¡ç†UI
â””â”€ Core: ConfigLoader

Phase 2: Coreå®‰å…¨åŸºç¡€è®¾æ–½ (3-4å‘¨) â­ å…³é”®
â”œâ”€ Securityæ¨¡å— (CodeSanitizerç­‰)
â”œâ”€ DynamicLoader
â”œâ”€ ResourceLimiter
â””â”€ AuditLogger

Phase 3: AIä»£ç ç”Ÿæˆæ–¹æ¡ˆ (4-6å‘¨)
â”œâ”€ Backend: DeepSeeké›†æˆ + AIService
â”œâ”€ Frontend: ä»£ç ç¼–è¾‘å™¨ (Monaco)
â””â”€ ç«¯åˆ°ç«¯æµ‹è¯•

Phase 4: ä¼˜åŒ–ä¸ä¸Šçº¿ (1-2å‘¨)
â”œâ”€ æ€§èƒ½ä¼˜åŒ–
â”œâ”€ å®‰å…¨å®¡è®¡
â””â”€ æ–‡æ¡£å®Œå–„
```

### å»ºè®®ä¼˜å…ˆçº§

**é«˜ä¼˜å…ˆçº§ (P0)**:
1. âœ… Coreå®‰å…¨æ¨¡å— (CodeSanitizer, PermissionChecker)
2. âœ… å‚æ•°é…ç½®æ–¹æ¡ˆå®Œæ•´å®ç°
3. âœ… å®¡è®¡æ—¥å¿—ç³»ç»Ÿ

**ä¸­ä¼˜å…ˆçº§ (P1)**:
4. âœ… DynamicLoader + èµ„æºé™åˆ¶
5. âœ… AIä»£ç ç”ŸæˆåŸºç¡€åŠŸèƒ½
6. âœ… æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜

**ä½ä¼˜å…ˆçº§ (P2)**:
7. AI Promptä¼˜åŒ–
8. é…ç½®å¸‚åœº/åˆ†äº«åŠŸèƒ½
9. é«˜çº§ç›‘æ§å’Œå‘Šè­¦

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### ç”¨æˆ·ä½“éªŒ
- ğŸ¯ **é™ä½é—¨æ§›**: è‡ªç„¶è¯­è¨€å³å¯åˆ›å»ºç­–ç•¥
- ğŸš€ **æå‡æ•ˆç‡**: ç§’çº§ç”Ÿæˆä»£ç ï¼Œåˆ†é’Ÿçº§éªŒè¯
- ğŸ¨ **å¢å¼ºåˆ›æ–°**: ä¸å—é¢„å®šä¹‰ç­–ç•¥é™åˆ¶

### æŠ€æœ¯ä»·å€¼
- ğŸ”’ **å®‰å…¨åŠ å›º**: å¤šå±‚é˜²æŠ¤ï¼Œå³ä½¿Backendè¢«æ”»ç ´ä¹Ÿèƒ½æ‹¦æˆª
- ğŸ“¦ **æ¶æ„ä¼˜åŒ–**: ç»Ÿä¸€æ¥å£ï¼Œæ˜“æ‰©å±•
- ğŸ” **å¯è¿½æº¯**: å®Œæ•´å®¡è®¡æ—¥å¿—

### ä¸šåŠ¡ä»·å€¼
- ğŸ’¡ **å·®å¼‚åŒ–**: AIè¾…åŠ©é‡åŒ–ç­–ç•¥å¼€å‘ï¼Œå¸‚åœºå°‘æœ‰
- ğŸ“Š **æé«˜ç•™å­˜**: æ»¡è¶³é«˜çº§ç”¨æˆ·éœ€æ±‚
- ğŸŒŸ **å“ç‰Œæå‡**: æŠ€æœ¯åˆ›æ–°æ ‡æ†

---

## âš ï¸ é£é™©ä¸æŒ‘æˆ˜

### æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| AIç”Ÿæˆä»£ç è´¨é‡ä¸ç¨³å®š | é«˜ | 1. ä¼˜åŒ–Promptå·¥ç¨‹<br>2. å¤šæ¬¡ç”Ÿæˆå–æœ€ä½³<br>3. äººå·¥å®¡æ ¸æœºåˆ¶ |
| åŠ¨æ€ä»£ç å®‰å…¨æ¼æ´ | é«˜ | 1. å¤šå±‚å®‰å…¨éªŒè¯<br>2. æ²™ç®±éš”ç¦»<br>3. å®šæœŸå®‰å…¨å®¡è®¡ |
| æ€§èƒ½é—®é¢˜ | ä¸­ | 1. å¤šçº§ç¼“å­˜<br>2. æ‡’åŠ è½½<br>3. èµ„æºé™åˆ¶ |

### ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| ç”¨æˆ·å­¦ä¹ æˆæœ¬ | ä¸­ | 1. è¯¦ç»†æ–‡æ¡£<br>2. è§†é¢‘æ•™ç¨‹<br>3. ç¤ºä¾‹æ¨¡æ¿ |
| AIæˆæœ¬æ§åˆ¶ | ä¸­ | 1. Tokenè®¡è´¹<br>2. è¯·æ±‚é™æµ<br>3. ç¼“å­˜ç­–ç•¥ |

---

## ğŸ“ è”ç³»æ–¹å¼

**ç»´æŠ¤å›¢é˜Ÿ**: Architecture Team
**é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/your-org/stock-analysis/issues)
**æ–‡æ¡£è´¡çŒ®**: æ¬¢è¿æäº¤PRå®Œå–„æ–‡æ¡£

---

## ğŸ“š æ¨èé˜…è¯»é¡ºåº

1. **å…ˆè¯»æ¦‚è§ˆ** (æœ¬æ–‡æ¡£) - ç†è§£æ•´ä½“è®¾è®¡
2. **Backendæ–¹æ¡ˆ**:
   - [backend/docs/planning/README.md](backend/docs/planning/README.md) - Backendæ€»è§ˆ
   - [strategy_config_management.md](backend/docs/planning/strategy_config_management.md) - å‚æ•°é…ç½®æ–¹æ¡ˆ
   - [ai_strategy_generation.md](backend/docs/planning/ai_strategy_generation.md) - AIä»£ç ç”Ÿæˆæ–¹æ¡ˆ
3. **Coreå®ç°**:
   - [core/docs/planning/core_strategy_system_refactoring.md](core/docs/planning/core_strategy_system_refactoring.md) â­ å…³é”®æ–‡æ¡£
4. **ç°æœ‰æ–‡æ¡£**:
   - [core/docs/strategies/README.md](core/docs/strategies/README.md) - ç°æœ‰ç­–ç•¥ç³»ç»Ÿæ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2026-02-08
**ä¸‹ä¸€æ­¥**: å›¢é˜Ÿè¯„å®¡ â†’ ç¡®å®šä¼˜å…ˆçº§ â†’ å¯åŠ¨å®æ–½
