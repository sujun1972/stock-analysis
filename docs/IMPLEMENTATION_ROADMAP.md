# ç­–ç•¥ç³»ç»Ÿå®æ–½è·¯çº¿å›¾

**é¡¹ç›®**: Stock-Analysis Strategy System
**ç‰ˆæœ¬**: v1.0.0
**æ—¥æœŸ**: 2026-02-08
**çŠ¶æ€**: âœ… è®¾è®¡å®Œæˆï¼Œå‡†å¤‡å®æ–½

---

## ğŸ“š æ–‡æ¡£ä½“ç³»æ€»è§ˆ

æ‰€æœ‰è§„åˆ’æ–‡æ¡£å·²å®Œæˆï¼Œç°åœ¨å¯ä»¥å¼€å§‹å®æ–½ã€‚

### æ ¸å¿ƒæ–‡æ¡£ï¼ˆæŒ‰é˜…è¯»é¡ºåºï¼‰

```
1. ğŸ“„ STRATEGY_SYSTEM_OVERVIEW.md (é¡¹ç›®æ ¹ç›®å½•)
   â”œâ”€ æ•´ä½“æ¶æ„è®¾è®¡
   â”œâ”€ åŒæ–¹æ¡ˆå¯¹æ¯”ï¼ˆå‚æ•°é…ç½® vs AIä»£ç ç”Ÿæˆï¼‰
   â”œâ”€ å®‰å…¨é˜²æŠ¤ä½“ç³»
   â””â”€ å®æ–½æ—¶é—´çº¿ï¼ˆ7-10å‘¨ï¼‰

2. ğŸ“„ backend/docs/planning/README.md
   â”œâ”€ BackendèŒè´£è¯´æ˜
   â””â”€ æŒ‡å‘å…·ä½“æ–¹æ¡ˆæ–‡æ¡£

3. ğŸ“„ backend/docs/planning/strategy_config_management.md (æ–¹æ¡ˆ1)
   â”œâ”€ å‚æ•°é…ç½®æ–¹æ¡ˆè¯¦ç»†è®¾è®¡
   â”œâ”€ æ•°æ®åº“è¡¨è®¾è®¡
   â”œâ”€ APIæ¥å£å®šä¹‰
   â””â”€ å‰ç«¯UIè®¾è®¡

4. ğŸ“„ backend/docs/planning/ai_strategy_generation.md (æ–¹æ¡ˆ2)
   â”œâ”€ AIä»£ç ç”Ÿæˆæ–¹æ¡ˆè¯¦ç»†è®¾è®¡
   â”œâ”€ DeepSeek APIé›†æˆ
   â”œâ”€ Promptå·¥ç¨‹
   â””â”€ ä»£ç éªŒè¯æµç¨‹

5. ğŸ“„ core/docs/planning/core_strategy_system_refactoring.md â­ å…³é”®
   â”œâ”€ Coreå±‚å®Œæ•´æ”¹é€ æ–¹æ¡ˆ
   â”œâ”€ å®‰å…¨æ¨¡å—å®ç°ï¼ˆ4å±‚é˜²å¾¡ï¼‰
   â”œâ”€ åŠ è½½å™¨å®ç°ï¼ˆConfigLoader + DynamicLoaderï¼‰
   â”œâ”€ å®Œæ•´ä»£ç ç¤ºä¾‹
   â””â”€ æµ‹è¯•ç­–ç•¥

6. ğŸ“„ core/docs/planning/implementation_checklist.md â­ å®æ–½æŒ‡å—
   â”œâ”€ å®æ–½å‰å‡†å¤‡æ¸…å•
   â”œâ”€ 5é˜¶æ®µå®æ–½è®¡åˆ’
   â”œâ”€ é£é™©ç‚¹è¯†åˆ«
   â”œâ”€ è´¨é‡æŒ‡æ ‡
   â””â”€ ç¼ºå¤±æŠ€æœ¯ç»†èŠ‚è¡¥å……
```

---

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

### Phase 1: Coreå®‰å…¨åŸºç¡€è®¾æ–½ï¼ˆ3-4å‘¨ï¼‰â­ æœ€é«˜ä¼˜å…ˆçº§

**ç›®æ ‡**: å»ºç«‹ç‹¬ç«‹çš„å®‰å…¨éªŒè¯èƒ½åŠ›

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `SecurityConfig` é…ç½®ç®¡ç†
- [ ] å®ç° `CodeSanitizer`ï¼ˆä»£ç å‡€åŒ–å™¨ï¼‰
- [ ] å®ç° `PermissionChecker`ï¼ˆæƒé™æ£€æŸ¥å™¨ï¼‰
- [ ] å®ç° `ResourceLimiter`ï¼ˆèµ„æºé™åˆ¶å™¨ï¼‰
- [ ] å®ç° `AuditLogger`ï¼ˆå®¡è®¡æ—¥å¿—ï¼‰
- [ ] ç¼–å†™å®‰å…¨æ¨¡å—å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ >90%ï¼‰
- [ ] ç¼–å†™å®‰å…¨æ¸—é€æµ‹è¯•ç”¨ä¾‹

**éªŒæ”¶æ ‡å‡†**:
- âœ… èƒ½å¤Ÿæ£€æµ‹å¹¶æ‹¦æˆªæ¶æ„ä»£ç ï¼ˆ10+æµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… èµ„æºé™åˆ¶èƒ½å¤Ÿç”Ÿæ•ˆï¼ˆå†…å­˜512MBã€CPU 30sï¼‰
- âœ… å®¡è®¡æ—¥å¿—å®Œæ•´è®°å½•æ‰€æœ‰æ“ä½œ

**å‚è€ƒæ–‡æ¡£**:
- [core_strategy_system_refactoring.md#å®‰å…¨æ¨¡å—](core/docs/planning/core_strategy_system_refactoring.md)
- [implementation_checklist.md#Phase2-æ ¸å¿ƒæ¨¡å—](core/docs/planning/implementation_checklist.md)

---

### Phase 2: å‚æ•°é…ç½®æ–¹æ¡ˆï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**: å¿«é€Ÿæ»¡è¶³æ ‡å‡†ç­–ç•¥éœ€æ±‚

#### Backendéƒ¨åˆ†
- [ ] åˆ›å»º `strategy_configs` æ•°æ®åº“è¡¨
- [ ] å®ç° `ConfigService`ï¼ˆCRUD + ç‰ˆæœ¬ç®¡ç†ï¼‰
- [ ] å®ç° `StrategyTemplateService`ï¼ˆæ¨¡æ¿ç®¡ç†ï¼‰
- [ ] å®ç° FastAPI ç«¯ç‚¹ï¼ˆ/api/v1/strategy-configsï¼‰
- [ ] ç¼–å†™APIé›†æˆæµ‹è¯•

#### Frontendéƒ¨åˆ†
- [ ] è®¾è®¡ç­–ç•¥é…ç½®ç®¡ç†UIï¼ˆAnt Designï¼‰
- [ ] å®ç°é…ç½®è¡¨å•ï¼ˆåŠ¨æ€è¡¨å•ç”Ÿæˆï¼‰
- [ ] å®ç°ç‰ˆæœ¬å†å²æŸ¥çœ‹
- [ ] å®ç°é…ç½®å¯¹æ¯”åŠŸèƒ½

#### Coreéƒ¨åˆ†
- [ ] å®ç° `ConfigLoader`
- [ ] å®ç° `BaseLoader`ï¼ˆæ•°æ®åº“è¿æ¥ç®¡ç†ï¼‰
- [ ] é‡æ„ `StrategyFactory`ï¼ˆæ”¯æŒ `create_from_config`ï¼‰
- [ ] ç¼–å†™é…ç½®åŠ è½½æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç”¨æˆ·èƒ½åœ¨Web UIåˆ›å»º/ä¿®æ”¹/åˆ é™¤ç­–ç•¥é…ç½®
- âœ… Coreèƒ½ä»æ•°æ®åº“åŠ è½½é…ç½®å¹¶å®ä¾‹åŒ–ç­–ç•¥
- âœ… é…ç½®å˜æ›´æœ‰å®Œæ•´å†å²è®°å½•

**å‚è€ƒæ–‡æ¡£**:
- [strategy_config_management.md](backend/docs/planning/strategy_config_management.md)
- [core_strategy_system_refactoring.md#ConfigLoader](core/docs/planning/core_strategy_system_refactoring.md)

---

### Phase 3: AIä»£ç ç”Ÿæˆæ–¹æ¡ˆï¼ˆ4-6å‘¨ï¼‰

**ç›®æ ‡**: æ”¯æŒåˆ›æ–°ç­–ç•¥å¿«é€Ÿå¼€å‘

#### Backendéƒ¨åˆ†
- [ ] DeepSeek APIé›†æˆ
  - [ ] ç”³è¯·APIå¯†é’¥
  - [ ] å®ç° `DeepSeekClient`
  - [ ] å®ç° Tokenè®¡è´¹å’Œé™æµ
- [ ] åˆ›å»º `ai_strategies` æ•°æ®åº“è¡¨
- [ ] å®ç° `AIStrategyService`
  - [ ] Promptå·¥ç¨‹ï¼ˆç­–ç•¥ä»£ç ç”Ÿæˆï¼‰
  - [ ] ä»£ç éªŒè¯ï¼ˆASTåˆ†æï¼‰
  - [ ] æ²™ç®±æµ‹è¯•
- [ ] å®ç° FastAPI ç«¯ç‚¹ï¼ˆ/api/v1/ai-strategiesï¼‰

#### Frontendéƒ¨åˆ†
- [ ] é›†æˆ Monaco Editorï¼ˆä»£ç ç¼–è¾‘å™¨ï¼‰
- [ ] å®ç°è‡ªç„¶è¯­è¨€è¾“å…¥ç•Œé¢
- [ ] å®ç°ä»£ç é¢„è§ˆå’Œç¼–è¾‘
- [ ] å®ç°æ²™ç®±æµ‹è¯•ç»“æœå±•ç¤º

#### Coreéƒ¨åˆ†
- [ ] å®ç° `DynamicCodeLoader`
  - [ ] ä»£ç å®Œæ•´æ€§éªŒè¯ï¼ˆå“ˆå¸Œï¼‰
  - [ ] åŠ¨æ€ç¼–è¯‘
  - [ ] å—é™å‘½åç©ºé—´
- [ ] å®ç° `FallbackHandler`ï¼ˆåŠ è½½å¤±è´¥é™çº§ï¼‰
- [ ] ç¼–å†™åŠ¨æ€åŠ è½½æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€èƒ½ç”Ÿæˆå¯ç”¨ç­–ç•¥ä»£ç 
- âœ… æ¶æ„ä»£ç èƒ½è¢«å¤šå±‚é˜²å¾¡æ‹¦æˆª
- âœ… ç”Ÿæˆçš„ç­–ç•¥èƒ½æ­£å¸¸å‚ä¸å›æµ‹

**å‚è€ƒæ–‡æ¡£**:
- [ai_strategy_generation.md](backend/docs/planning/ai_strategy_generation.md)
- [core_strategy_system_refactoring.md#DynamicCodeLoader](core/docs/planning/core_strategy_system_refactoring.md)

---

### Phase 4: æ€§èƒ½ä¼˜åŒ–ä¸ç›‘æ§ï¼ˆ1-2å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `CacheManager`ï¼ˆä¸‰çº§ç¼“å­˜ï¼šå†…å­˜â†’Redisâ†’DBï¼‰
- [ ] å®ç° `PerformanceMonitor`ï¼ˆåŠ è½½æ€§èƒ½ç›‘æ§ï¼‰
- [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- [ ] å‰ç«¯æ‡’åŠ è½½ä¼˜åŒ–
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

**æ€§èƒ½ç›®æ ‡**:
- é…ç½®åŠ è½½: <100ms (p95)
- AIä»£ç åŠ è½½: <500ms (p95)
- ç­–ç•¥åˆ—è¡¨æŸ¥è¯¢: <200ms (1000æ¡è®°å½•)

**å‚è€ƒæ–‡æ¡£**:
- [implementation_checklist.md#æ€§èƒ½ä¼˜åŒ–](core/docs/planning/implementation_checklist.md)

---

### Phase 5: ä¸Šçº¿å‡†å¤‡ï¼ˆ1å‘¨ï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] å®‰å…¨å®¡è®¡ï¼ˆç¬¬ä¸‰æ–¹ä»£ç å®¡æŸ¥ï¼‰
- [ ] å‹åŠ›æµ‹è¯•ï¼ˆå¹¶å‘ç­–ç•¥åŠ è½½ï¼‰
- [ ] æ–‡æ¡£å®Œå–„
  - [ ] APIæ–‡æ¡£ï¼ˆSwaggerï¼‰
  - [ ] ç”¨æˆ·æ‰‹å†Œ
  - [ ] å¼€å‘è€…æŒ‡å—
- [ ] ç°åº¦å‘å¸ƒè®¡åˆ’
- [ ] å›æ»šæ–¹æ¡ˆ

---

## ğŸ” å®‰å…¨æ£€æŸ¥æ¸…å•

åœ¨æ¯ä¸ªPhaseå®Œæˆåï¼Œå¿…é¡»é€šè¿‡ä»¥ä¸‹æ£€æŸ¥ï¼š

### ä»£ç å®‰å…¨
- [ ] æ‰€æœ‰åŠ¨æ€ä»£ç ç»è¿‡ASTåˆ†æ
- [ ] æ‰€æœ‰å±é™©å‡½æ•°è¢«ç¦ç”¨ï¼ˆ`eval`, `exec`, `open`, `__import__`ï¼‰
- [ ] æ‰€æœ‰å¯¼å…¥åœ¨ç™½åå•å†…
- [ ] æ‰€æœ‰å­—ç¬¦ä¸²å­—é¢é‡è¢«æ‰«æ

### è¿è¡Œæ—¶å®‰å…¨
- [ ] èµ„æºé™åˆ¶ç”Ÿæ•ˆï¼ˆå†…å­˜/CPU/æ—¶é—´ï¼‰
- [ ] å—é™å‘½åç©ºé—´æ­£ç¡®é…ç½®
- [ ] ç³»ç»Ÿè°ƒç”¨è¢«ç¦æ­¢
- [ ] ç½‘ç»œè®¿é—®è¢«ç¦æ­¢

### æ•°æ®å®‰å…¨
- [ ] ä»£ç å“ˆå¸ŒéªŒè¯
- [ ] SQLæ³¨å…¥é˜²æŠ¤
- [ ] XSSé˜²æŠ¤
- [ ] CSRFä¿æŠ¤

### å®¡è®¡ä¸ç›‘æ§
- [ ] æ‰€æœ‰ç­–ç•¥åŠ è½½è¢«è®°å½•
- [ ] æ‰€æœ‰éªŒè¯å¤±è´¥è¢«å‘Šè­¦
- [ ] å¼‚å¸¸è¡Œä¸ºè¢«ç›‘æ§
- [ ] æ—¥å¿—ä¿ç•™æ»¡è¶³åˆè§„è¦æ±‚

---

## ğŸ“Š è´¨é‡æŒ‡æ ‡

### æµ‹è¯•è¦†ç›–ç‡
- Coreå®‰å…¨æ¨¡å—: >90%
- CoreåŠ è½½å™¨: >85%
- BackendæœåŠ¡å±‚: >80%
- APIç«¯ç‚¹: >75%

### æ€§èƒ½åŸºå‡†
- é…ç½®åŠ è½½: <100ms (p95)
- AIä»£ç åŠ è½½: <500ms (p95)
- ç­–ç•¥æ‰§è¡Œ: <2s (10000æ¡æ•°æ®)

### å®‰å…¨æŒ‡æ ‡
- æ¶æ„ä»£ç æ‹¦æˆªç‡: 100% (10+æµ‹è¯•ç”¨ä¾‹)
- èµ„æºè¶…é™æ‹¦æˆªç‡: 100%
- é›¶å®‰å…¨æ¼æ´ï¼ˆé€šè¿‡ç¬¬ä¸‰æ–¹å®¡è®¡ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# 1. åˆ›å»ºæ•°æ®åº“è¡¨ï¼ˆBackendï¼‰
cd backend
alembic revision --autogenerate -m "Add strategy_configs and ai_strategies tables"
alembic upgrade head

# 2. åˆ›å»ºé…ç½®ç›®å½•ï¼ˆCoreï¼‰
mkdir -p core/config
cp core/config/security.example.yaml core/config/security.yaml

# 3. å®‰è£…ä¾èµ–
cd core
pip install -r requirements.txt
pip install loguru pyyaml redis  # æ–°å¢ä¾èµ–

# 4. ç”³è¯·DeepSeek APIå¯†é’¥ï¼ˆBackendï¼‰
# è®¿é—® https://platform.deepseek.com/
# å°†å¯†é’¥æ·»åŠ åˆ° backend/.env
```

### 2. å¼€å‘é¡ºåº

```bash
# Phase 1: ä»å®‰å…¨æ¨¡å—å¼€å§‹
cd core/src/strategies/security
touch code_sanitizer.py permission_checker.py resource_limiter.py audit_logger.py

# å…ˆå®ç° CodeSanitizer
# ç„¶åé€ä¸ªå®ç°å…¶ä»–å®‰å…¨æ¨¡å—
# æ¯ä¸ªæ¨¡å—å®ç°åç«‹å³ç¼–å†™æµ‹è¯•

# Phase 2: å®ç°åŠ è½½å™¨
cd core/src/strategies/loaders
touch base_loader.py config_loader.py dynamic_loader.py

# Phase 3: é‡æ„StrategyFactory
cd core/src/strategies
# ä¿®æ”¹ factory.py
```

### 3. æµ‹è¯•é©±åŠ¨å¼€å‘

```bash
# å…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°
cd core/tests/unit/strategies/security

# 1. ç¼–å†™æµ‹è¯•
cat > test_code_sanitizer.py << EOF
def test_detect_dangerous_imports():
    code = "import os"
    result = CodeSanitizer().sanitize(code, "hash123")
    assert not result['safe']
    assert 'os' in str(result['errors'])
EOF

# 2. è¿è¡Œæµ‹è¯•ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
pytest test_code_sanitizer.py

# 3. å®ç°åŠŸèƒ½ç›´åˆ°æµ‹è¯•é€šè¿‡
```

---

## ğŸ“ è”ç³»ä¸æ”¯æŒ

**ç»´æŠ¤å›¢é˜Ÿ**: Architecture Team
**é—®é¢˜åé¦ˆ**: GitHub Issues
**è®¾è®¡è¯„å®¡**: æ¯ä¸ªPhaseå¼€å§‹å‰è¿›è¡ŒæŠ€æœ¯è¯„å®¡
**ä»£ç è¯„å®¡**: æ‰€æœ‰ä»£ç åˆå¹¶å‰å¿…é¡»é€šè¿‡Review

---

## ğŸ“ˆ è¿›åº¦è·Ÿè¸ª

### ä½¿ç”¨å»ºè®®

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºè¿›åº¦æ–‡ä»¶
cp IMPLEMENTATION_ROADMAP.md IMPLEMENTATION_PROGRESS.md

# æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œåœ¨IMPLEMENTATION_PROGRESS.mdä¸­æ ‡è®°
# - [ ] ä»»åŠ¡ â†’ - [x] ä»»åŠ¡
```

### æ¯å‘¨æ£€æŸ¥

- **å‘¨ä¸€**: ç¡®å®šæœ¬å‘¨ç›®æ ‡ä»»åŠ¡
- **å‘¨äº”**: å›é¡¾å®Œæˆæƒ…å†µï¼Œæ›´æ–°è¿›åº¦æ–‡ä»¶
- **æ¯ä¸¤å‘¨**: ä¸å›¢é˜ŸåŒæ­¥ï¼Œè°ƒæ•´ä¼˜å…ˆçº§

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### Phase 1æˆåŠŸæ ‡å‡†
- âœ… å®‰å…¨æ¨¡å—èƒ½æ‹¦æˆªæ‰€æœ‰å·²çŸ¥æ”»å‡»å‘é‡
- âœ… é€šè¿‡ç¬¬ä¸‰æ–¹å®‰å…¨å®¡è®¡

### Phase 2æˆåŠŸæ ‡å‡†
- âœ… ç”¨æˆ·èƒ½é€šè¿‡Web UIç®¡ç†ç­–ç•¥é…ç½®
- âœ… é…ç½®èƒ½æ­£ç¡®é©±åŠ¨ç­–ç•¥æ‰§è¡Œ

### Phase 3æˆåŠŸæ ‡å‡†
- âœ… AIèƒ½ç”Ÿæˆç¬¦åˆè¦æ±‚çš„ç­–ç•¥ä»£ç 
- âœ… ç”Ÿæˆçš„ä»£ç é€šè¿‡æ‰€æœ‰å®‰å…¨æ£€æŸ¥

### æœ€ç»ˆæˆåŠŸæ ‡å‡†
- âœ… æ‰€æœ‰Phaseå®Œæˆ
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡
- âœ… æ€§èƒ½åŸºå‡†è¾¾æ ‡
- âœ… å®‰å…¨å®¡è®¡é€šè¿‡
- âœ… ç”¨æˆ·æ»¡æ„åº¦ >85%

---

**æœ€åæ›´æ–°**: 2026-02-08
**ä¸‹ä¸€æ­¥**: å¼€å§‹Phase 1 - Coreå®‰å…¨åŸºç¡€è®¾æ–½å¼€å‘

**æç¤º**: æ‰€æœ‰è¯¦ç»†æŠ€æœ¯å®ç°ç»†èŠ‚è¯·å‚è€ƒå¯¹åº”çš„è®¾è®¡æ–‡æ¡£ã€‚æœ¬è·¯çº¿å›¾åªæä¾›é«˜å±‚æ¬¡çš„å®æ–½æŒ‡å¯¼ã€‚
