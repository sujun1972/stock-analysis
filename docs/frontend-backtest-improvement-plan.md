# å‰ç«¯å›æµ‹æ¨¡å—æ”¹è¿›å®æ–½æ–¹æ¡ˆ

> ç‰ˆæœ¬: v3.1
> æ—¥æœŸ: 2026-02-07ï¼ˆæ›´æ–°ï¼‰
> ä½œè€…: Claude Code
> é¡¹ç›®: Stock Analysis Platform

---

## âš¡ é‡è¦æ›´æ–°è¯´æ˜ï¼ˆ2026-02-07ï¼‰

### ğŸ‰ Coreå’ŒBackendå·²å®Œæˆä¸‰å±‚æ¶æ„å‡çº§

**é‡å¤§å˜åŒ–**ï¼š
- âœ… **Core v3.1.0**ï¼šä¸‰å±‚æ¶æ„å·²å®Œæ•´å®ç°ï¼ˆ4ä¸ªé€‰è‚¡å™¨ + 3ä¸ªå…¥åœº + 4ä¸ªé€€å‡º + MLSelectorï¼‰
- âœ… **Backend v3.0.0**ï¼šThreeLayerAdapter + 5ä¸ªREST APIï¼ˆ129ä¸ªæµ‹è¯•100%é€šè¿‡ï¼‰
- âš ï¸ **Frontend**ï¼šå°šæœªé›†æˆï¼Œä»ä½¿ç”¨æ—§ç‰ˆä¼ ç»Ÿç­–ç•¥æ¨¡å¼

### ğŸ“Š å½“å‰çŠ¶æ€

| ç»„ä»¶ | æ¶æ„ç‰ˆæœ¬ | åŠŸèƒ½æ•°é‡ | å‰ç«¯å¯ç”¨æ€§ |
|------|---------|---------|-----------|
| Core | v3.1.0ï¼ˆä¸‰å±‚æ¶æ„ï¼‰ | 11ä¸ªç»„ä»¶ï¼Œ48ç§ç»„åˆ | âŒ ä¸å¯ç”¨ |
| Backend | v3.0.0ï¼ˆä¸‰å±‚APIï¼‰ | 5ä¸ªAPIç«¯ç‚¹ | âŒ æœªé›†æˆ |
| Frontend | v1.0ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰ | 2ä¸ªç­–ç•¥ | âœ… å¯ç”¨ |

### ğŸ¯ æ›´æ–°åçš„å®æ–½é‡ç‚¹

**åŸè®¡åˆ’**ï¼ˆv3.0ï¼‰ï¼š
- é˜¶æ®µé›¶ï¼šåç«¯å®ç°ä¸‰å±‚æ¶æ„ï¼ˆ17-25å¤©ï¼‰
- æ€»å·¥æœŸï¼š10-12å‘¨

**æ–°è®¡åˆ’**ï¼ˆv3.1ï¼‰ï¼š
- âœ… **é˜¶æ®µé›¶å·²å®Œæˆ**ï¼šCoreå’ŒBackendå·²å®ç°
- ğŸ¯ **å‰ç«¯é›†æˆä»»åŠ¡**ï¼šè°ƒç”¨ç°æœ‰APIï¼Œå¼€å‘UIï¼ˆ5-7å¤©ï¼‰
- ğŸ“‰ **æ€»å·¥æœŸç¼©çŸ­**ï¼š~~10-12å‘¨~~ â†’ **6-8å‘¨**

### ğŸ“‹ æ ¸å¿ƒä»»åŠ¡è°ƒæ•´

| ä»»åŠ¡ | åŸè®¡åˆ’ | æ–°è®¡åˆ’ | å·¥ä½œé‡å˜åŒ– |
|------|--------|--------|-----------|
| ä¸‰å±‚æ¶æ„å¼€å‘ | 17-25å¤©ï¼ˆåç«¯å¼€å‘ï¼‰ | âœ… å·²å®Œæˆ | â†“ 100% |
| å‰ç«¯APIé›†æˆ | æœªè§„åˆ’ | 2-3å¤©ï¼ˆè°ƒç”¨APIï¼‰ | â†‘ æ–°å¢ |
| UIç»„ä»¶å¼€å‘ | 3-5å¤© | 3-4å¤©ï¼ˆä¸‰å±‚é…ç½®UIï¼‰ | â†’ ç›¸åŒ |
| **æ€»è®¡** | 40.5-62å¤© | **25-35å¤©** | â†“ **38-44%** |

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ç°çŠ¶åˆ†æ](#ä¸€é¡¹ç›®èƒŒæ™¯ä¸ç°çŠ¶åˆ†æ)
- [äºŒã€æ ¸å¿ƒé—®é¢˜è¯Šæ–­](#äºŒæ ¸å¿ƒé—®é¢˜è¯Šæ–­)
- [ä¸‰ã€æ”¹è¿›æ–¹æ¡ˆæ€»è§ˆ](#ä¸‰æ”¹è¿›æ–¹æ¡ˆæ€»è§ˆ)
- [å››ã€ç­–ç•¥æ¶æ„å†³ç­–](#å››ç­–ç•¥æ¶æ„å†³ç­–)
- [äº”ã€è¯¦ç»†å®æ–½è®¡åˆ’](#äº”è¯¦ç»†å®æ–½è®¡åˆ’)
- [å…­ã€æŠ€æœ¯å®ç°ç»†èŠ‚](#å…­æŠ€æœ¯å®ç°ç»†èŠ‚)
- [ä¸ƒã€å·¥ä½œé‡è¯„ä¼°ä¸æ’æœŸ](#ä¸ƒå·¥ä½œé‡è¯„ä¼°ä¸æ’æœŸ)
- [å…«ã€é£é™©ä¸æ³¨æ„äº‹é¡¹](#å…«é£é™©ä¸æ³¨æ„äº‹é¡¹)

---

## ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸ç°çŠ¶åˆ†æ

### 1.1 ç°æœ‰æ¶æ„æ¦‚è§ˆ

#### å‰ç«¯é¡µé¢ç»“æ„

```
frontend/src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ backtest/page.tsx          # å›æµ‹æ‰§è¡Œé¡µé¢ï¼ˆå•ä¸€é¡µé¢ï¼‰
â”‚   â”œâ”€â”€ ai-lab/page.tsx            # AI å®éªŒèˆ±
â”‚   â”œâ”€â”€ stocks/page.tsx            # è‚¡ç¥¨åˆ—è¡¨
â”‚   â””â”€â”€ sync/page.tsx              # æ•°æ®åŒæ­¥
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ BacktestPanel.tsx          # å›æµ‹é…ç½®é¢æ¿
â”‚   â”œâ”€â”€ StrategyParamsPanel.tsx    # å‚æ•°ç¼–è¾‘
â”‚   â”œâ”€â”€ backtest/                  # å›æµ‹å­ç»„ä»¶
â”‚   â””â”€â”€ ...
```

#### ç­–ç•¥å®ç°æƒ…å†µ

**Core é¡¹ç›®ï¼ˆv3.1.0 - ä¸‰å±‚æ¶æ„ï¼‰ï¼š**

é‡‡ç”¨å…¨æ–°çš„ä¸‰å±‚åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒæ¨¡å—åŒ–ç»„åˆï¼š

**Layer 1: é€‰è‚¡å™¨ï¼ˆStockSelectorï¼‰- 4ä¸ªç»„ä»¶**
1. âœ… MomentumSelectorï¼ˆåŠ¨é‡é€‰è‚¡å™¨ï¼‰
2. âœ… ReversalSelectorï¼ˆåè½¬é€‰è‚¡å™¨ï¼‰
3. âœ… MLSelectorï¼ˆæœºå™¨å­¦ä¹ é€‰è‚¡å™¨ï¼‰â­ æ–°å¢
4. âœ… ExternalSelectorï¼ˆå¤–éƒ¨é€‰è‚¡å™¨ï¼‰

**Layer 2: å…¥åœºç­–ç•¥ï¼ˆEntryStrategyï¼‰- 3ä¸ªç»„ä»¶**
1. âœ… ImmediateEntryï¼ˆç«‹å³å…¥åœºï¼‰
2. âœ… MABreakoutEntryï¼ˆå‡çº¿çªç ´å…¥åœºï¼‰
3. âœ… RSIOversoldEntryï¼ˆRSIè¶…å–å…¥åœºï¼‰

**Layer 3: é€€å‡ºç­–ç•¥ï¼ˆExitStrategyï¼‰- 4ä¸ªç»„ä»¶**
1. âœ… FixedPeriodExitï¼ˆå›ºå®šå‘¨æœŸé€€å‡ºï¼‰
2. âœ… FixedStopLossExitï¼ˆå›ºå®šæ­¢æŸé€€å‡ºï¼‰
3. âœ… ATRStopLossExitï¼ˆATRåŠ¨æ€æ­¢æŸï¼‰
4. âœ… TrendBasedExitï¼ˆè¶‹åŠ¿é€€å‡ºï¼‰

**ç»„åˆèƒ½åŠ›**ï¼š4 Ã— 3 Ã— 4 = **48ç§åŸºç¡€ç­–ç•¥ç»„åˆ** â­

**Backend é¡¹ç›®ï¼ˆv3.0.0 - å·²ç”Ÿäº§åŒ–ï¼‰ï¼š**

**ä¸‰å±‚æ¶æ„APIï¼ˆThreeLayerAdapterï¼‰**ï¼š
- âœ… `/api/three-layer/selectors` - è·å–é€‰è‚¡å™¨åˆ—è¡¨
- âœ… `/api/three-layer/entries` - è·å–å…¥åœºç­–ç•¥åˆ—è¡¨
- âœ… `/api/three-layer/exits` - è·å–é€€å‡ºç­–ç•¥åˆ—è¡¨
- âœ… `/api/three-layer/validate` - éªŒè¯ç­–ç•¥ç»„åˆ
- âœ… `/api/three-layer/backtest` - æ‰§è¡Œä¸‰å±‚å›æµ‹

**ä¼ ç»Ÿç­–ç•¥APIï¼ˆä¿ç•™å…¼å®¹ï¼‰**ï¼š
1. âœ… ComplexIndicatorStrategyï¼ˆå¤åˆæŒ‡æ ‡ç­–ç•¥ï¼‰
2. âœ… MLModelStrategyï¼ˆæœºå™¨å­¦ä¹ æ¨¡å‹ç­–ç•¥ï¼‰

**å‰ç«¯å±•ç¤ºï¼ˆå½“å‰ï¼‰ï¼š**
- ä»…æ”¯æŒä¼ ç»Ÿ2ä¸ªç­–ç•¥ï¼Œ**å°šæœªé›†æˆä¸‰å±‚æ¶æ„**

---

### 1.2 ç”¨æˆ·æ—…ç¨‹åˆ†æ

#### å½“å‰æµç¨‹

```
ç”¨æˆ·æ‰“å¼€å›æµ‹é¡µé¢ â†’ é¢å¯¹å¤æ‚é…ç½®é¢æ¿ â†’ ä¸çŸ¥é“é€‰å“ªä¸ªç­–ç•¥
â†’ éšä¾¿è¯•è¯• â†’ æ•ˆæœä¸ç†æƒ³ â†’ æ”¾å¼ƒ
```

**ç—›ç‚¹ï¼š**
- âŒ æ²¡æœ‰ç­–ç•¥æµè§ˆå…¥å£ï¼Œç”¨æˆ·ä¸äº†è§£å¯ç”¨ç­–ç•¥
- âŒ ç¼ºå°‘ç­–ç•¥è¯¦æƒ…è¯´æ˜ï¼Œä¸çŸ¥é“ç­–ç•¥åŸç†å’Œé€‚ç”¨åœºæ™¯
- âŒ å†å²è®°å½•ä¼šè¯çº§åˆ«ï¼Œåˆ·æ–°é¡µé¢å°±ä¸¢å¤±
- âŒ **å‰ç«¯æœªé›†æˆä¸‰å±‚æ¶æ„**ï¼ˆBackendå·²å®ç°5ä¸ªAPIï¼Œå‰ç«¯ä»ç”¨æ—§æ¨¡å¼ï¼‰
- âŒ **æ— æ³•ä½¿ç”¨48ç§ç­–ç•¥ç»„åˆ**ï¼ˆCoreæ”¯æŒï¼Œä½†å‰ç«¯æ— UIï¼‰
- âŒ **æ— æ³•ä½¿ç”¨MLSelectoræœºå™¨å­¦ä¹ é€‰è‚¡**ï¼ˆCoreå·²å®ç°ï¼Œå‰ç«¯ä¸å¯ç”¨ï¼‰
- âŒ é…ç½®é¢æ¿ä¿¡æ¯å¯†åº¦é«˜ï¼Œæ–°æ‰‹å­¦ä¹ æˆæœ¬å¤§

---

## äºŒã€æ ¸å¿ƒé—®é¢˜è¯Šæ–­

### 2.1 é—®é¢˜æ¸…å•ï¼ˆ2026-02-07 æ›´æ–°ï¼‰

| é—®é¢˜ç¼–å· | é—®é¢˜æè¿° | ä¸¥é‡ç¨‹åº¦ | å½±å“èŒƒå›´ | çŠ¶æ€ |
|---------|---------|---------|---------|------|
| **P0** | **å‰ç«¯æœªé›†æˆä¸‰å±‚æ¶æ„API**ï¼ˆBackendå·²å®Œæˆï¼‰ | ğŸ”´ **æé«˜** | æ ¸å¿ƒåŠŸèƒ½ç¼ºå¤± | âš ï¸ **æ–°å¢** |
| **P1** | æ— æ³•ä½¿ç”¨48ç§ç­–ç•¥ç»„åˆèƒ½åŠ› | ğŸ”´ é«˜ | åŠŸèƒ½å®Œæ•´æ€§ | âš ï¸ å…³é”® |
| **P2** | æ— æ³•ä½¿ç”¨MLSelectoræœºå™¨å­¦ä¹ é€‰è‚¡ | ğŸ”´ é«˜ | ç«äº‰ä¼˜åŠ¿ | âš ï¸ å…³é”® |
| **P3** | ç¼ºå°‘ç­–ç•¥åˆ—è¡¨é¡µé¢ï¼Œç”¨æˆ·æ— æ³•æµè§ˆæ‰€æœ‰ç­–ç•¥ | ğŸŸ  ä¸­ | ç”¨æˆ·ä½“éªŒ | å¾…å¤„ç† |
| **P4** | å†å²è®°å½•æœªæŒä¹…åŒ–ï¼Œåˆ·æ–°é¡µé¢æ•°æ®ä¸¢å¤± | ğŸŸ  ä¸­ | ç”¨æˆ·ä½“éªŒ | å¾…å¤„ç† |
| **P5** | ç¼ºå°‘ç­–ç•¥è¯¦æƒ…é¡µé¢ï¼Œç”¨æˆ·ä¸äº†è§£ç­–ç•¥åŸç† | ğŸŸ¡ ä½ | å¯ç”¨æ€§ | å¾…å¤„ç† |
| **P6** | é…ç½®é¢æ¿è¿‡äºå¤æ‚ï¼Œç¼ºå°‘å‘å¯¼æ¨¡å¼ | ğŸŸ¡ ä½ | æ˜“ç”¨æ€§ | å¾…å¤„ç† |

### 2.2 æ•°æ®å·®å¼‚åˆ†æï¼ˆ2026-02-07 æ›´æ–°ï¼‰

#### æ¶æ„èƒ½åŠ›å¯¹æ¯”

| ç»´åº¦ | Core èƒ½åŠ› | Backend èƒ½åŠ› | Frontend èƒ½åŠ› | å·®è· |
|------|----------|-------------|--------------|------|
| **æ¶æ„æ¨¡å¼** | ä¸‰å±‚åˆ†ç¦»æ¶æ„ | ä¸‰å±‚æ¶æ„APIï¼ˆ5ä¸ªç«¯ç‚¹ï¼‰ | ä¼ ç»Ÿæ¨¡å¼ | âš ï¸ **æœªé›†æˆ** |
| **é€‰è‚¡å™¨** | 4ä¸ªï¼ˆå«MLSelectorï¼‰ | å®Œæ•´APIæ”¯æŒ | 0ä¸ª | âš ï¸ **å…¨éƒ¨ç¼ºå¤±** |
| **å…¥åœºç­–ç•¥** | 3ä¸ª | å®Œæ•´APIæ”¯æŒ | 0ä¸ª | âš ï¸ **å…¨éƒ¨ç¼ºå¤±** |
| **é€€å‡ºç­–ç•¥** | 4ä¸ª | å®Œæ•´APIæ”¯æŒ | 0ä¸ª | âš ï¸ **å…¨éƒ¨ç¼ºå¤±** |
| **ç­–ç•¥ç»„åˆ** | 48ç§åŸºç¡€ç»„åˆ | éªŒè¯+å›æµ‹API | 0ç§ | âš ï¸ **æ— æ³•ä½¿ç”¨** |
| **ä¼ ç»Ÿç­–ç•¥** | å·²åºŸå¼ƒ | 2ä¸ªï¼ˆå…¼å®¹ï¼‰ | 2ä¸ª | âœ… å¯¹é½ |

#### æŠ€æœ¯å€ºåŠ¡ç»Ÿè®¡

| å±‚çº§ | å·²å®ç°åŠŸèƒ½ | æœªä½¿ç”¨åŠŸèƒ½ | åˆ©ç”¨ç‡ |
|------|----------|----------|--------|
| Core æ¨¡å— | ä¸‰å±‚æ¶æ„ï¼ˆ11ä¸ªç»„ä»¶ï¼‰ | ä¸‰å±‚æ¶æ„ï¼ˆ11ä¸ªç»„ä»¶ï¼‰ | **0%** âš ï¸ |
| Backend æ¨¡å— | 5ä¸ªä¸‰å±‚API + 2ä¸ªä¼ ç»ŸAPI | 5ä¸ªä¸‰å±‚API | **28.6%** âš ï¸ |
| Frontend æ¨¡å— | 2ä¸ªä¼ ç»Ÿç­–ç•¥ | 48ç§ç»„åˆ + MLSelector | **4.2%** âš ï¸ |

**æ ¸å¿ƒé—®é¢˜**ï¼šåç«¯å·²å®Œæˆä¸‰å±‚æ¶æ„å‡çº§ï¼ˆv3.0.0+ï¼‰ï¼Œå‰ç«¯ä»åœç•™åœ¨v1.0ä¼ ç»Ÿæ¨¡å¼ï¼Œ**é€ æˆ95.8%çš„æ–°åŠŸèƒ½æ— æ³•ä½¿ç”¨**
| Frontend å±•ç¤º | 2ä¸ª | å¤åˆæŒ‡æ ‡ç­–ç•¥, MLæ¨¡å‹ç­–ç•¥ |

**å·®å¼‚åŸå› ï¼š** Backend åªå®ç°å’Œæ³¨å†Œäº† 2 ä¸ªç­–ç•¥ï¼ŒCore çš„å…¶ä»– 3 ä¸ªç­–ç•¥æœªè¿ç§»ã€‚

---

## ä¸‰ã€æ”¹è¿›æ–¹æ¡ˆæ€»è§ˆ

### 3.1 æ ¸å¿ƒæ”¹è¿›ç›®æ ‡

1. **è¡¥å…¨ç­–ç•¥åº“**ï¼šå°† Core çš„ 3 ä¸ªç­–ç•¥è¿ç§»åˆ° Backend
2. **æ–°å¢ç­–ç•¥ä¸­å¿ƒ**ï¼šç”¨æˆ·å¯ä»¥æµè§ˆã€äº†è§£æ‰€æœ‰ç­–ç•¥
3. **æŒä¹…åŒ–å†å²è®°å½•**ï¼šè·¨ä¼šè¯è®¿é—®å›æµ‹å†å²
4. **ä¼˜åŒ–ç”¨æˆ·æµç¨‹**ï¼šç­–ç•¥é©±åŠ¨çš„å›æµ‹æµç¨‹
5. **æ˜ç¡®æ¦‚å¿µè¾¹ç•Œ**ï¼šAI æ¨¡å‹ vs ç­–ç•¥çš„å…³ç³»
6. **ğŸš€ AI ç­–ç•¥ç”Ÿæˆ**ï¼šç”¨æˆ·è‡ªç„¶è¯­è¨€æè¿°ï¼ŒAI è‡ªåŠ¨ç”Ÿæˆç­–ç•¥ä»£ç 

### 3.2 æ¨èæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¼èˆªæ                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¦–é¡µ â”‚ ç­–ç•¥ä¸­å¿ƒ â”‚ AIç”Ÿæˆç­–ç•¥ â”‚ ç­–ç•¥å›æµ‹ â”‚ æˆ‘çš„å›æµ‹ â”‚ AIå®éªŒèˆ±â”‚
â”‚       â”‚  â†‘æ–°å¢   â”‚   â†‘æ–°å¢    â”‚          â”‚  â†‘æ–°å¢   â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç­–ç•¥ä¸­å¿ƒ (/strategies)
â”œâ”€â”€ ç­–ç•¥åˆ—è¡¨é¡µé¢
â”‚   â”œâ”€â”€ å†…ç½®ç­–ç•¥ï¼ˆ5ä¸ªå®˜æ–¹ç­–ç•¥ï¼‰
â”‚   â”‚   â”œâ”€â”€ å¤åˆæŒ‡æ ‡ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ MLæ¨¡å‹ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ åŠ¨é‡ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ å‡å€¼å›å½’ç­–ç•¥
â”‚   â”‚   â””â”€â”€ å¤šå› å­ç­–ç•¥
â”‚   â”œâ”€â”€ ç”¨æˆ·ç”Ÿæˆç­–ç•¥ï¼ˆAIç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ å¸¦"AIç”Ÿæˆ"æ ‡ç­¾
â”‚   â”‚   â”œâ”€â”€ æ˜¾ç¤ºç”Ÿæˆæ—¶é—´å’Œä½œè€…
â”‚   â”‚   â””â”€â”€ æ”¯æŒç¼–è¾‘/åˆ é™¤
â”‚   â”œâ”€â”€ æŒ‰ç±»å‹åˆ†ç±»å±•ç¤º
â”‚   â””â”€â”€ æ”¯æŒæœç´¢å’Œç­›é€‰
â”‚
â””â”€â”€ ç­–ç•¥è¯¦æƒ…é¡µ (/strategies/[id])
    â”œâ”€â”€ ç­–ç•¥åŸç†è¯´æ˜
    â”œâ”€â”€ å‚æ•°é…ç½®ä»‹ç»
    â”œâ”€â”€ ä»£ç é¢„è§ˆï¼ˆAIç”Ÿæˆç­–ç•¥å¯è§ï¼‰
    â”œâ”€â”€ å†å²è¡¨ç°ç»Ÿè®¡
    â”œâ”€â”€ ä½¿ç”¨æ¡ˆä¾‹
    â””â”€â”€ [ç«‹å³å›æµ‹] æŒ‰é’®

AI ç­–ç•¥ç”Ÿæˆå™¨ (/strategies/ai-create) ğŸš€ æ–°å¢
â”œâ”€â”€ è‡ªç„¶è¯­è¨€è¾“å…¥æ¡†
â”‚   â””â”€â”€ ç¤ºä¾‹ï¼šäº”æ—¥å¹³å‡çº¿ä¸Šç©¿20æ—¥å¹³å‡çº¿ä¹°å…¥
â”œâ”€â”€ [ç”Ÿæˆç­–ç•¥] æŒ‰é’®
â”œâ”€â”€ AI ç”Ÿæˆä»£ç é¢„è§ˆ
â”‚   â”œâ”€â”€ è¯­æ³•é«˜äº®
â”‚   â”œâ”€â”€ å®‰å…¨éªŒè¯çŠ¶æ€
â”‚   â””â”€â”€ æ²™ç®±æµ‹è¯•ç»“æœ
â”œâ”€â”€ ä»£ç ç¼–è¾‘å™¨ï¼ˆå¯é€‰ä¿®æ”¹ï¼‰
â””â”€â”€ æ“ä½œæŒ‰é’®
    â”œâ”€â”€ [ä¿å­˜ç­–ç•¥]
    â”œâ”€â”€ [ç«‹å³å›æµ‹]
    â””â”€â”€ [é‡æ–°ç”Ÿæˆ]

æˆ‘çš„å›æµ‹ (/my-backtests)
â”œâ”€â”€ å†å²è®°å½•åˆ—è¡¨ï¼ˆæŒä¹…åŒ–ï¼‰
â”œâ”€â”€ æ”¯æŒç­›é€‰ã€æ’åºã€æœç´¢
â”œâ”€â”€ å¤šç­–ç•¥å¯¹æ¯”åŠŸèƒ½
â””â”€â”€ ç»“æœåˆ†äº«åŠŸèƒ½

ç­–ç•¥å›æµ‹ (/backtest)
â”œâ”€â”€ ä¿æŒç°æœ‰åŠŸèƒ½
â”œâ”€â”€ æ”¯æŒä»ç­–ç•¥ä¸­å¿ƒè·³è½¬ï¼ˆé¢„å¡«å‚æ•°ï¼‰
â”œâ”€â”€ æ”¯æŒä» AI ç”Ÿæˆå™¨è·³è½¬ï¼ˆæ–°ç­–ç•¥ï¼‰
â””â”€â”€ æ”¯æŒä» AI å®éªŒèˆ±è·³è½¬ï¼ˆMLæ¨¡å‹ï¼‰
```

---

## å››ã€ç­–ç•¥æ¶æ„å†³ç­–ï¼ˆåŸºäºä¸»æµé‡åŒ–å¹³å°æœ€ä½³å®è·µï¼‰

### 4.1 æ ¸å¿ƒé—®é¢˜ï¼šå½“å‰æ¶æ„çš„è‡´å‘½ç¼ºé™·

**é—®é¢˜è¯Šæ–­ï¼š**

é€šè¿‡æ·±å…¥åˆ†æä»£ç å®ç°ï¼Œå‘ç°å½“å‰æ¶æ„å­˜åœ¨**è‡´å‘½ç¼ºé™·**ï¼š

1. **ç­–ç•¥ä¸è¿›è¡Œé€‰è‚¡**ï¼š
   - `BaseStrategy.calculate_scores()` åªè¿”å›æ‰€æœ‰è‚¡ç¥¨çš„è¯„åˆ†
   - å®é™…é€‰è‚¡åœ¨ `BacktestEngine` ä¸­é€šè¿‡ `signals.nlargest(top_n)` å®Œæˆ
   - **ç­–ç•¥æ— æ³•æ§åˆ¶è‚¡ç¥¨æ± **

2. **æ— æ³•åº”ç”¨å¤–éƒ¨é€‰è‚¡ç»“æœ**ï¼š
   ```python
   # âŒ å½“å‰æ— æ³•å®ç°
   starranker_stocks = ["600000.SH", "000001.SZ", ...]  # StarRankeré€‰å‡ºçš„10åªè‚¡ç¥¨
   my_strategy.backtest(stock_pool=starranker_stocks)   # ä¸æ”¯æŒï¼
   ```

3. **Backend ç­–ç•¥åªæ”¯æŒå•è‚¡ç¥¨**ï¼š
   - `ComplexIndicatorStrategy` å’Œ `MLModelStrategy` è®¾è®¡ä¸ºå•è‚¡ç¥¨å›æµ‹
   - æ— æ³•å¤„ç†è‚¡ç¥¨æ± é€‰æ‹©å’Œè½®åŠ¨

4. **ä¹°å–é€»è¾‘é«˜åº¦è€¦åˆ**ï¼š
   - ä¹°å…¥å’Œå–å‡ºä½¿ç”¨ç›¸åŒå‚æ•°ï¼ˆå¦‚ `ma_period`, `rsi_oversold/overbought`ï¼‰
   - æ— æ³•ç‹¬ç«‹è°ƒæ•´é€€å‡ºç­–ç•¥ï¼ˆæ­¢æŸã€æ­¢ç›ˆï¼‰

### 4.2 ä¸»æµé‡åŒ–å¹³å°æ¶æ„ç ”ç©¶

ç»è¿‡å¯¹ **Backtraderã€Ziplineã€vnpyã€èšå®½ã€ç±³ç­** ç­‰ä¸»æµå¹³å°çš„æ·±å…¥ç ”ç©¶ï¼Œå‘ç°ï¼š

**å®ƒä»¬éƒ½é‡‡ç”¨äº†æŸç§å½¢å¼çš„ä¸‰å±‚åˆ†ç¦»æ¶æ„**ï¼Œè¿™æ˜¯ç»è¿‡å¸‚åœºéªŒè¯çš„æœ€ä½³å®è·µã€‚

#### 4.2.1 Backtrader - å¤–éƒ¨è°ƒä»“è¡¨æ¶æ„

```
å› å­è®¡ç®—å’Œç»„åˆä¼˜åŒ– â†’ ç”Ÿæˆè°ƒä»“è¡¨æ–‡ä»¶ â†’ Backtraderæ‰§è¡Œäº¤æ˜“
     (å¤–éƒ¨ç‹¬ç«‹)                       (å›æµ‹å¼•æ“)
```

**æ ¸å¿ƒè®¾è®¡ç†å¿µ**ï¼ˆå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š
> "å°†å› å­ç ”ç©¶ä¸å›æµ‹æ‰§è¡Œè§£è€¦ï¼Œç ”ç©¶äººå‘˜ä¸“æ³¨å› å­ç ”ç©¶ï¼Œå›æµ‹æ•ˆç‡é«˜ï¼Œé¿å…é‡å¤è®¡ç®—å› å­ï¼Œç­–ç•¥å¯ç§»æ¤æ€§å¼º"

**è¿™ä¸ä½ çš„éœ€æ±‚å®Œå…¨å»åˆ**ï¼šStarRankeré€‰è‚¡ â†’ åº”ç”¨ä¹°å–ç­–ç•¥

#### 4.2.2 Zipline - Pipeline æ¶æ„ï¼ˆæœ€æ¸…æ™°çš„ä¸‰å±‚åˆ†ç¦»ï¼‰

```python
# Layer 1: è‚¡ç¥¨ç­›é€‰ (Pipeline)
pipe = Pipeline()
pipe.add(AverageDollarVolume(window_length=60), 'dollar_volume')
pipe.set_screen(dollar_volume.top(10))  # é€‰å‡ºå‰10åª

# Layer 2 & 3: äº¤æ˜“ç­–ç•¥ (Algorithm)
def handle_data(context, data):
    # åœ¨Pipelineé€‰å‡ºçš„è‚¡ç¥¨ä¸­æ‰§è¡Œä¹°å–é€»è¾‘
    for stock in context.pipeline_output:
        if buy_signal(stock):
            order(stock, 100)
        elif sell_signal(stock):
            order(stock, -100)
```

**å®˜æ–¹æ–‡æ¡£åŸè¯**ï¼š
> "Pipeline API ä½¿ alpha å› å­ç ”ç©¶æ¨¡å—åŒ–ï¼Œå› ä¸ºå®ƒ**å°† alpha å› å­è®¡ç®—ä¸ç®—æ³•çš„å…¶ä½™éƒ¨åˆ†ï¼ˆåŒ…æ‹¬äº¤æ˜“è®¢å•çš„ä¸‹è¾¾å’Œæ‰§è¡Œï¼‰åˆ†ç¦»å¼€æ¥**"

#### 4.2.3 èšå®½ï¼ˆJoinQuantï¼‰- é€‰è‚¡+æ‹©æ—¶åˆ†ç¦»

```python
# é€‰è‚¡ç­–ç•¥ï¼ˆå‘¨é¢‘ï¼‰
def select_stocks(context):
    stocks = get_fundamentals(query(...).filter(...))
    return stocks[:10]

# ä¹°å–ç­–ç•¥ï¼ˆæ—¥é¢‘ï¼‰
def handle_data(context, data):
    for stock in context.portfolio.positions:
        if MA5 > MA20:  # ä¹°å…¥ä¿¡å·
            order(stock, 100)
        elif MA5 < MA20:  # å–å‡ºä¿¡å·
            order(stock, -100)
```

**æ”¯æŒ**ï¼šå› å­é€‰è‚¡ + æŠ€æœ¯æŒ‡æ ‡æ‹©æ—¶çš„åˆ†ç¦»ç­–ç•¥

#### 4.2.4 ç±³ç­ï¼ˆRiceQuantï¼‰- ä¸‰é˜¶æ®µæ¶æ„

```python
def init(context):
    # é˜¶æ®µ1ï¼šé€‰è‚¡æ± è®¾ç½®
    context.stocks = select_stock_pool()

def before_trading(context):
    # é˜¶æ®µ2ï¼šç›˜å‰é€‰è‚¡ï¼ˆå¤šå› å­æ¨¡å‹ï¼‰
    context.today_stocks = factor_selection(context.stocks)

def handle_bar(context, bar_dict):
    # é˜¶æ®µ3ï¼šç›˜ä¸­äº¤æ˜“ä¿¡å·
    for stock in context.today_stocks:
        if entry_signal(stock): buy(stock)
        elif exit_signal(stock): sell(stock)
```

#### 4.2.5 vnpy 4.0 - AIé‡åŒ–æ¨¡å—ï¼ˆæœ€æ–°è¶‹åŠ¿ï¼‰

- **å› å­å·¥ç¨‹**ï¼šå†…ç½®ä¸°å¯Œçš„å› å­ç‰¹å¾è¡¨è¾¾å¼è®¡ç®—å¼•æ“
- **æ¨¡å‹è®­ç»ƒ**ï¼šæ ‡å‡†åŒ–MLæ¨¡å‹å¼€å‘æ¨¡æ¿
- **ä¿¡å·ç”Ÿæˆä¸æ‰§è¡Œè§£è€¦**ï¼šæ¨¡å—åŒ–ã€é¢å‘å¯¹è±¡çš„æ–¹å¼

### 4.3 ä¸ºä»€ä¹ˆä¸»æµå¹³å°éƒ½é€‰æ‹©ä¸‰å±‚åˆ†ç¦»ï¼Ÿ

#### 4.3.1 å®é™…ä½¿ç”¨åœºæ™¯éªŒè¯

| åœºæ™¯ | è¯´æ˜ | é¢‘ç‡éœ€æ±‚ |
|------|------|----------|
| **åœºæ™¯1ï¼šåŸºæœ¬é¢é€‰è‚¡ + æŠ€æœ¯æ‹©æ—¶** | è´¢æŠ¥å­£é€‰å‡ºä½PEè‚¡ç¥¨ï¼Œç­‰å¾…æŠ€æœ¯ä¿¡å·ä¹°å…¥ | é€‰è‚¡ï¼šå­£åº¦ / ä¹°å–ï¼šæ—¥é¢‘ |
| **åœºæ™¯2ï¼šå¤–éƒ¨ä¿¡å·æº** | StarRankeré€‰è‚¡ + è‡ªå®šä¹‰ä¹°å–ç­–ç•¥ | é€‰è‚¡ï¼šå¤–éƒ¨ / ä¹°å–ï¼šæ—¥é¢‘ |
| **åœºæ™¯3ï¼šè¡Œä¸šè½®åŠ¨** | åŠ¨æ€åˆ‡æ¢å¼ºåŠ¿è¡Œä¸šï¼ŒæŠ€æœ¯æŒ‡æ ‡è¿›å‡º | é€‰è‚¡ï¼šå‘¨é¢‘ / ä¹°å–ï¼šæ—¥é¢‘ |
| **åœºæ™¯4ï¼šç‹¬ç«‹é€€å‡ºç­–ç•¥** | ä»»æ„ä¹°å…¥ç­–ç•¥ + ATRåŠ¨æ€æ­¢æŸ | ä¹°å…¥ä¸å–å‡ºè§£è€¦ |

#### 4.3.2 ç ”ç©¶æ•ˆç‡æå‡

```
ä¼ ç»Ÿè€¦åˆæ¶æ„ï¼š
  ä¿®æ”¹æ­¢æŸç­–ç•¥ â†’ éœ€è¦é‡å†™æ•´ä¸ªç­–ç•¥ â†’ é‡æ–°æµ‹è¯•æ‰€æœ‰é€»è¾‘

ä¸‰å±‚åˆ†ç¦»æ¶æ„ï¼š
  ä¿®æ”¹æ­¢æŸç­–ç•¥ â†’ åªæ”¹ ExitStrategy â†’ ç‹¬ç«‹æµ‹è¯• â†’ ç»„åˆå¤ç”¨

  å› å­ç ”ç©¶äººå‘˜ â†’ ä¸“æ³¨é€‰è‚¡æ¨¡å‹
  äº¤æ˜“ç­–ç•¥å¸ˆ   â†’ ä¸“æ³¨æ‹©æ—¶ä¿¡å·
  é£æ§äººå‘˜     â†’ ä¸“æ³¨é€€å‡ºç­–ç•¥
```

#### 4.3.3 ç­–ç•¥ç»„åˆçµæ´»æ€§ï¼ˆç¬›å¡å°”ç§¯ï¼‰

```
3 ä¸ªé€‰è‚¡ç­–ç•¥ Ã— 3 ä¸ªä¹°å…¥ç­–ç•¥ Ã— 3 ä¸ªå–å‡ºç­–ç•¥ = 27 ç§ç»„åˆ

è€¦åˆæ¶æ„ï¼šéœ€è¦ç¼–å†™ 27 ä¸ªå®Œæ•´ç­–ç•¥
åˆ†ç¦»æ¶æ„ï¼šåªéœ€ç¼–å†™ 9 ä¸ªæ¨¡å—ï¼Œè‡ªç”±ç»„åˆ
```

### 4.4 æœ€ç»ˆå†³ç­–ï¼šé‡‡ç”¨ä¸‰å±‚åˆ†ç¦»æ¶æ„

**âœ… æ–¹æ¡ˆï¼šä¸‰å±‚åˆ†ç¦»æ¶æ„ï¼ˆå‚è€ƒ Zipline Pipeline è®¾è®¡ï¼‰**

```python
# ==================== Layer 1: è‚¡ç¥¨é€‰æ‹©å™¨ ====================
class StockSelector(ABC):
    """
    è‚¡ç¥¨é€‰æ‹©å™¨åŸºç±»

    åŠŸèƒ½ï¼šä»å…¨å¸‚åœºç­›é€‰å‡ºå€™é€‰è‚¡ç¥¨æ± 
    é¢‘ç‡ï¼šå‘¨é¢‘/æœˆé¢‘ï¼ˆé™ä½æ¢æ‰‹ç‡ï¼‰
    """
    @abstractmethod
    def select(self, date: pd.Timestamp, market_data: pd.DataFrame) -> List[str]:
        """
        è¿”å›ï¼šè‚¡ç¥¨ä»£ç åˆ—è¡¨ ['600000.SH', '000001.SZ', ...]
        """
        pass


# å®ç°ç¤ºä¾‹
class MomentumSelector(StockSelector):
    """åŠ¨é‡é€‰è‚¡å™¨ï¼šé€‰æ‹©è¿‘æœŸæ¶¨å¹…æœ€å¤§çš„è‚¡ç¥¨"""

    def __init__(self, lookback_period: int = 20, top_n: int = 50):
        self.lookback_period = lookback_period
        self.top_n = top_n

    def select(self, date, market_data):
        returns = market_data.pct_change(self.lookback_period)
        return returns.loc[date].nlargest(self.top_n).index.tolist()


class ExternalSelector(StockSelector):
    """å¤–éƒ¨é€‰è‚¡å™¨ï¼šæ”¯æŒæ¥å…¥ StarRanker ç­‰å¤–éƒ¨ç³»ç»Ÿ"""

    def __init__(self, stock_source: str = "starranker"):
        self.source = stock_source

    def select(self, date, market_data):
        # ä»å¤–éƒ¨ç³»ç»Ÿè·å–è‚¡ç¥¨åˆ—è¡¨
        return fetch_from_external(self.source, date)


# ==================== Layer 2: å…¥åœºç­–ç•¥ ====================
class EntryStrategy(ABC):
    """
    å…¥åœºç­–ç•¥åŸºç±»

    åŠŸèƒ½ï¼šå†³å®šä½•æ—¶ä¹°å…¥ï¼ˆåœ¨é€‰è‚¡å™¨é€‰å‡ºçš„è‚¡ç¥¨ä¸­ï¼‰
    é¢‘ç‡ï¼šæ—¥é¢‘/åˆ†é’Ÿé¢‘
    """
    @abstractmethod
    def generate_entry_signals(
        self,
        stocks: List[str],
        prices: pd.DataFrame,
        date: pd.Timestamp
    ) -> Dict[str, float]:
        """
        è¿”å›ï¼š{è‚¡ç¥¨ä»£ç : ä¹°å…¥æƒé‡}
        ä¾‹å¦‚ï¼š{'600000.SH': 0.3, '000001.SZ': 0.2}
        """
        pass


# å®ç°ç¤ºä¾‹
class MABreakoutEntry(EntryStrategy):
    """å‡çº¿çªç ´å…¥åœºç­–ç•¥"""

    def __init__(self, short_window: int = 5, long_window: int = 20):
        self.short = short_window
        self.long = long_window

    def generate_entry_signals(self, stocks, prices, date):
        signals = {}
        for stock in stocks:
            ma_short = prices[stock].rolling(self.short).mean()
            ma_long = prices[stock].rolling(self.long).mean()

            # çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿ â†’ ä¹°å…¥ä¿¡å·
            if ma_short.loc[date] > ma_long.loc[date] and \
               ma_short.shift(1).loc[date] <= ma_long.shift(1).loc[date]:
                signals[stock] = 1.0 / len(stocks)  # ç­‰æƒé‡

        return signals


class RSIOversoldEntry(EntryStrategy):
    """RSIè¶…å–å…¥åœºç­–ç•¥"""

    def __init__(self, rsi_period: int = 14, oversold_level: float = 30):
        self.period = rsi_period
        self.oversold = oversold_level

    def generate_entry_signals(self, stocks, prices, date):
        signals = {}
        for stock in stocks:
            rsi = calculate_rsi(prices[stock], self.period)

            # RSI < 30 â†’ è¶…å–ä¹°å…¥ä¿¡å·
            if rsi.loc[date] < self.oversold:
                signals[stock] = 1.0 / len(stocks)

        return signals


# ==================== Layer 3: é€€å‡ºç­–ç•¥ ====================
class ExitStrategy(ABC):
    """
    é€€å‡ºç­–ç•¥åŸºç±»

    åŠŸèƒ½ï¼šå†³å®šä½•æ—¶å–å‡ºï¼ˆæŒä»“ç®¡ç†ï¼‰
    é¢‘ç‡ï¼šæ—¥é¢‘/å®æ—¶
    """
    @abstractmethod
    def generate_exit_signals(
        self,
        positions: Dict[str, Position],  # å½“å‰æŒä»“
        prices: pd.DataFrame,
        date: pd.Timestamp
    ) -> List[str]:
        """
        è¿”å›ï¼šéœ€è¦å–å‡ºçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
        """
        pass


# å®ç°ç¤ºä¾‹
class ATRStopLossExit(ExitStrategy):
    """ATRåŠ¨æ€æ­¢æŸé€€å‡ºç­–ç•¥"""

    def __init__(self, atr_period: int = 14, atr_multiplier: float = 2.0):
        self.period = atr_period
        self.multiplier = atr_multiplier

    def generate_exit_signals(self, positions, prices, date):
        exit_stocks = []

        for stock, position in positions.items():
            atr = calculate_atr(prices[stock], self.period)
            stop_loss_price = position.entry_price - (atr.loc[date] * self.multiplier)

            # ä»·æ ¼è·Œç ´æ­¢æŸçº¿ â†’ å–å‡º
            if prices[stock].loc[date] < stop_loss_price:
                exit_stocks.append(stock)

        return exit_stocks


class TimeBasedExit(ExitStrategy):
    """æ—¶é—´æ­¢æŸé€€å‡ºç­–ç•¥"""

    def __init__(self, holding_period: int = 5):
        self.holding_period = holding_period

    def generate_exit_signals(self, positions, prices, date):
        exit_stocks = []

        for stock, position in positions.items():
            # æŒæœ‰è¶…è¿‡æŒ‡å®šå¤©æ•° â†’ å–å‡º
            if (date - position.entry_date).days >= self.holding_period:
                exit_stocks.append(stock)

        return exit_stocks


class CombinedExit(ExitStrategy):
    """ç»„åˆé€€å‡ºç­–ç•¥ï¼šå¤šç§æ¡ä»¶ORç»„åˆ"""

    def __init__(self, exit_strategies: List[ExitStrategy]):
        self.strategies = exit_strategies

    def generate_exit_signals(self, positions, prices, date):
        exit_stocks = set()

        # ä»»æ„ä¸€ä¸ªç­–ç•¥è§¦å‘ â†’ å–å‡º
        for strategy in self.strategies:
            exit_stocks.update(strategy.generate_exit_signals(positions, prices, date))

        return list(exit_stocks)


# ==================== ç­–ç•¥ç»„åˆå™¨ ====================
class StrategyComposer:
    """
    ä¸‰å±‚ç­–ç•¥ç»„åˆå™¨

    ç”¨æ³•ï¼š
        strategy = StrategyComposer(
            selector=MomentumSelector(top_n=50),
            entry=MABreakoutEntry(short=5, long=20),
            exit=CombinedExit([
                ATRStopLossExit(atr_multiplier=2.0),
                TimeBasedExit(holding_period=5)
            ])
        )

        strategy.backtest(prices, start_date, end_date)
    """

    def __init__(
        self,
        selector: StockSelector,
        entry: EntryStrategy,
        exit: ExitStrategy,
        rebalance_freq: str = 'W'  # é€‰è‚¡é¢‘ç‡ï¼šW=å‘¨, M=æœˆ
    ):
        self.selector = selector
        self.entry = entry
        self.exit = exit
        self.rebalance_freq = rebalance_freq

    def backtest(self, prices, start_date, end_date):
        """æ‰§è¡Œä¸‰å±‚åˆ†ç¦»çš„å›æµ‹"""
        portfolio = Portfolio()
        dates = pd.date_range(start_date, end_date, freq='D')
        rebalance_dates = pd.date_range(start_date, end_date, freq=self.rebalance_freq)

        for date in dates:
            # Layer 3: å…ˆæ£€æŸ¥é€€å‡ºä¿¡å·ï¼ˆæ¯æ—¥ï¼‰
            exit_stocks = self.exit.generate_exit_signals(
                portfolio.positions, prices, date
            )
            for stock in exit_stocks:
                portfolio.sell(stock, date, prices[stock].loc[date])

            # Layer 1: å®šæœŸé‡æ–°é€‰è‚¡ï¼ˆå‘¨é¢‘/æœˆé¢‘ï¼‰
            if date in rebalance_dates:
                candidate_stocks = self.selector.select(date, prices)

            # Layer 2: ç”Ÿæˆå…¥åœºä¿¡å·ï¼ˆæ¯æ—¥ï¼‰
            entry_signals = self.entry.generate_entry_signals(
                candidate_stocks, prices, date
            )
            for stock, weight in entry_signals.items():
                if stock not in portfolio.positions:
                    portfolio.buy(stock, date, prices[stock].loc[date], weight)

        return portfolio.get_performance()
```

### 4.5 ä¸‰å±‚æ¶æ„çš„æ ¸å¿ƒä¼˜åŠ¿

#### 4.5.1 è§£å†³å½“å‰æ¶æ„çš„æ‰€æœ‰ç—›ç‚¹

| ç—›ç‚¹ | ä¸‰å±‚æ¶æ„è§£å†³æ–¹æ¡ˆ |
|------|------------------|
| âŒ æ— æ³•åº”ç”¨å¤–éƒ¨é€‰è‚¡ | âœ… `ExternalSelector` æ”¯æŒ StarRanker ç­‰å¤–éƒ¨ç³»ç»Ÿ |
| âŒ ä¹°å–é€»è¾‘è€¦åˆ | âœ… `EntryStrategy` å’Œ `ExitStrategy` å®Œå…¨ç‹¬ç«‹ |
| âŒ æ­¢æŸç­–ç•¥æ— æ³•å¤ç”¨ | âœ… `ATRStopLossExit` å¯åº”ç”¨äºä»»æ„å…¥åœºç­–ç•¥ |
| âŒ ä¸æ”¯æŒä¸åŒé¢‘ç‡ | âœ… é€‰è‚¡å‘¨é¢‘ã€äº¤æ˜“æ—¥é¢‘ï¼Œå„è‡ªç‹¬ç«‹ |

#### 4.5.2 å®é™…ä½¿ç”¨æ¡ˆä¾‹

```python
# æ¡ˆä¾‹1ï¼šStarRankeré€‰è‚¡ + å‡çº¿çªç ´å…¥åœº + ATRæ­¢æŸ
strategy1 = StrategyComposer(
    selector=ExternalSelector(source="starranker"),
    entry=MABreakoutEntry(short=5, long=20),
    exit=ATRStopLossExit(atr_multiplier=2.0)
)

# æ¡ˆä¾‹2ï¼šåŠ¨é‡é€‰è‚¡ + RSIè¶…å–å…¥åœº + æ—¶é—´æ­¢æŸ
strategy2 = StrategyComposer(
    selector=MomentumSelector(lookback=20, top_n=50),
    entry=RSIOversoldEntry(rsi_period=14, oversold=30),
    exit=TimeBasedExit(holding_period=5)
)

# æ¡ˆä¾‹3ï¼šåŒä¸€é€‰è‚¡ï¼Œä¸åŒå…¥åœºç­–ç•¥å¯¹æ¯”
selector = MomentumSelector(top_n=50)
for entry_strategy in [MABreakoutEntry(), RSIOversoldEntry()]:
    strategy = StrategyComposer(selector, entry_strategy, exit_strategy)
    result = strategy.backtest(prices, start, end)
    print(f"{entry_strategy.name}: {result['total_return']}")
```

### 4.6 AI æ¨¡å‹ä¸ä¸‰å±‚æ¶æ„çš„å…³ç³»

**æ˜ç¡®å®šä½ï¼š**

| æ¦‚å¿µ | å®šä¹‰ | åœ¨ä¸‰å±‚æ¶æ„ä¸­çš„ä½ç½® |
|------|------|-------------------|
| **AI æ¨¡å‹** | é¢„æµ‹å·¥å…· | å¯ç”¨äºä»»æ„å±‚ï¼ˆé€‰è‚¡é¢„æµ‹ã€å…¥åœºæ—¶æœºé¢„æµ‹ã€é€€å‡ºæ—¶æœºé¢„æµ‹ï¼‰ |
| **ML é€‰è‚¡å™¨** | ä½¿ç”¨æ¨¡å‹é€‰è‚¡ | Layer 1: `MLStockSelector` |
| **ML å…¥åœºç­–ç•¥** | ä½¿ç”¨æ¨¡å‹æ‹©æ—¶ | Layer 2: `MLEntryStrategy` |
| **ML é€€å‡ºç­–ç•¥** | ä½¿ç”¨æ¨¡å‹æ­¢æŸ | Layer 3: `MLExitStrategy` |

**æ¶æ„è®¾è®¡ï¼š**

```
AI å®éªŒèˆ± (/ai-lab)
â”œâ”€â”€ ä¸“æ³¨ï¼šæ¨¡å‹è®­ç»ƒã€è¯„ä¼°ã€ç®¡ç†
â”œâ”€â”€ å±•ç¤ºï¼šRMSEã€RÂ²ã€IC ç­‰é¢„æµ‹æŒ‡æ ‡
â””â”€â”€ æ¨¡å‹åˆ—è¡¨ï¼ˆå…·ä½“çš„ LightGBMã€GRU æ¨¡å‹ï¼‰
        â†“
ç­–ç•¥ä¸­å¿ƒ (/strategies)
â”œâ”€â”€ æœºå™¨å­¦ä¹ é€‰è‚¡å™¨
â”‚   â”œâ”€â”€ ä½¿ç”¨æ¨¡å‹ï¼š600000.SH - LightGBM - 5æ—¥
â”‚   â”œâ”€â”€ é€‰è‚¡é€»è¾‘ï¼šé¢„æµ‹æ”¶ç›Šç‡ > 1% çš„è‚¡ç¥¨
â”‚   â””â”€â”€ å‚æ•°ï¼štop_n=50
â”‚
â”œâ”€â”€ æœºå™¨å­¦ä¹ å…¥åœºç­–ç•¥
â”‚   â”œâ”€â”€ ä½¿ç”¨æ¨¡å‹ï¼šåŒä¸Š
â”‚   â”œâ”€â”€ å…¥åœºæ¡ä»¶ï¼šé¢„æµ‹æ”¶ç›Šç‡ > 0.15%
â”‚   â””â”€â”€ å‚æ•°ï¼šbuy_threshold=0.15%
â”‚
â””â”€â”€ ç»„åˆç­–ç•¥
    â”œâ”€â”€ é€‰è‚¡ï¼šMLé€‰è‚¡å™¨ï¼ˆé¢„æµ‹æ¨¡å‹ï¼‰
    â”œâ”€â”€ å…¥åœºï¼šå‡çº¿çªç ´ï¼ˆæŠ€æœ¯æŒ‡æ ‡ï¼‰
    â””â”€â”€ é€€å‡ºï¼šATRæ­¢æŸï¼ˆé£æ§ç­–ç•¥ï¼‰
```

**ç»“è®ºï¼š** AI æ¨¡å‹æ˜¯å·¥å…·ï¼Œå¯åº”ç”¨äºä¸‰å±‚æ¶æ„çš„ä»»æ„å±‚ã€‚ä¸åŒå±‚ä½¿ç”¨æ¨¡å‹çš„ç›®çš„ä¸åŒï¼ˆé€‰è‚¡é¢„æµ‹ vs æ‹©æ—¶é¢„æµ‹ vs é£æ§é¢„æµ‹ï¼‰ã€‚

---

## äº”ã€è¯¦ç»†å®æ–½è®¡åˆ’

**é‡è¦å†³ç­–å˜æ›´ï¼š**

åŸºäºä¸»æµé‡åŒ–å¹³å°æœ€ä½³å®è·µç ”ç©¶ï¼ˆè¯¦è§ç¬¬å››ç« ï¼‰ï¼Œæœ¬é¡¹ç›®å†³å®šé‡‡ç”¨**ä¸‰å±‚åˆ†ç¦»æ¶æ„**æ›¿ä»£åŸæœ‰è€¦åˆæ¶æ„ã€‚è¿™æ˜¯ä¸€æ¬¡æ¶æ„é‡æ„ï¼Œå°†åˆ†å¤šä¸ªé˜¶æ®µå®æ–½ã€‚

### 5.0 é˜¶æ®µé›¶ï¼šä¸‰å±‚æ¶æ„é›†æˆï¼ˆP0 - æœ€é«˜ä¼˜å…ˆçº§ï¼‰â­ å·²å®Œæˆ

> **é‡è¦æ›´æ–°ï¼ˆ2026-02-07ï¼‰**ï¼šCoreï¼ˆv3.1.0ï¼‰å’ŒBackendï¼ˆv3.0.0ï¼‰å·²å®Œæˆä¸‰å±‚æ¶æ„å®ç°ï¼Œå‰ç«¯åªéœ€é›†æˆç°æœ‰APIå³å¯ã€‚

#### å½“å‰çŠ¶æ€

âœ… **Coreå·²å®Œæˆ**ï¼ˆv3.1.0ï¼‰ï¼š
- StockSelectoråŸºç±» + 4ä¸ªå®ç°ï¼ˆMomentum, Reversal, MLSelector, Externalï¼‰
- EntryStrategyåŸºç±» + 3ä¸ªå®ç°ï¼ˆImmediate, MABreakout, RSIOversoldï¼‰
- ExitStrategyåŸºç±» + 4ä¸ªå®ç°ï¼ˆFixedPeriod, StopLoss, ATRStop, TrendExitï¼‰
- StrategyComposerç»„åˆå™¨
- BacktestEngine.backtest_three_layer()æ–¹æ³•

âœ… **Backendå·²å®Œæˆ**ï¼ˆv3.0.0ï¼‰ï¼š
- ThreeLayerAdapteré€‚é…å™¨
- 5ä¸ªREST APIç«¯ç‚¹ï¼ˆå·²æµ‹è¯•ï¼Œ129ä¸ªç”¨ä¾‹100%é€šè¿‡ï¼‰
- Redisç¼“å­˜ + Prometheusç›‘æ§

âš ï¸ **Frontendå¾…å®Œæˆ**ï¼š
- é›†æˆ5ä¸ªä¸‰å±‚æ¶æ„API
- å¼€å‘ç­–ç•¥ç»„åˆé…ç½®UI
- å®ç°å›æµ‹ç»“æœå±•ç¤º

#### ä»»åŠ¡ 0.1ï¼šå‰ç«¯é›†æˆä¸‰å±‚æ¶æ„API â­ æ›´æ–°

**ç›®æ ‡ï¼š** å‰ç«¯è°ƒç”¨Backendç°æœ‰çš„5ä¸ªä¸‰å±‚æ¶æ„API

**å·¥ä½œé‡ï¼š** ~~3-5å¤©~~ â†’ **2-3å¤©**ï¼ˆåç«¯å·²å®Œæˆï¼Œæ— éœ€é‡å¤å¼€å‘ï¼‰

**å®æ–½æ­¥éª¤ï¼š**

1. **åˆ›å»ºå‰ç«¯APIæœåŠ¡å±‚**
   ```typescript
   // frontend/src/services/threeLayerApi.ts

   export interface SelectorInfo {
     id: string
     name: string
     description: string
     version: string
     parameters: ParameterDef[]
   }

   export interface ParameterDef {
     name: string
     label: string
     type: 'integer' | 'float' | 'boolean' | 'select' | 'string'
     default: any
     min_value?: number
     max_value?: number
     options?: Array<{value: string, label: string}>
   }

   // è°ƒç”¨Backendçš„5ä¸ªAPI
   export const threeLayerApi = {
     async getSelectors(): Promise<SelectorInfo[]> {
       const res = await fetch('/api/three-layer/selectors')
       const data = await res.json()
       return data.data
     },

     async getEntries(): Promise<SelectorInfo[]> {
       const res = await fetch('/api/three-layer/entries')
       const data = await res.json()
       return data.data
     },

     async getExits(): Promise<SelectorInfo[]> {
       const res = await fetch('/api/three-layer/exits')
       const data = await res.json()
       return data.data
     },

     async validateStrategy(config: StrategyConfig): Promise<ValidationResult> {
       const res = await fetch('/api/three-layer/validate', {
         method: 'POST',
         headers: {'Content-Type': 'application/json'},
         body: JSON.stringify(config)
       })
       return await res.json()
     },

     async runBacktest(config: BacktestConfig): Promise<BacktestResult> {
       const res = await fetch('/api/three-layer/backtest', {
         method: 'POST',
         headers: {'Content-Type': 'application/json'},
         body: JSON.stringify(config)
       })
       return await res.json()
     }
   }
   ```

2. **åˆ›å»ºç­–ç•¥ç»„åˆé…ç½®ç»„ä»¶**
   ```typescript
   // frontend/src/components/ThreeLayerStrategyPanel.tsx

   export const ThreeLayerStrategyPanel = () => {
     const [selectors, setSelectors] = useState<SelectorInfo[]>([])
     const [entries, setEntries] = useState<SelectorInfo[]>([])
     const [exits, setExits] = useState<SelectorInfo[]>([])

     const [selectedSelector, setSelectedSelector] = useState<string>('')
     const [selectedEntry, setSelectedEntry] = useState<string>('')
     const [selectedExit, setSelectedExit] = useState<string>('')

     useEffect(() => {
       // åŠ è½½æ‰€æœ‰å¯ç”¨ç»„ä»¶
       Promise.all([
         threeLayerApi.getSelectors(),
         threeLayerApi.getEntries(),
         threeLayerApi.getExits()
       ]).then(([s, e, x]) => {
         setSelectors(s)
         setEntries(e)
         setExits(x)
       })
     }, [])

     return (
       <div className="three-layer-config">
         <div className="layer-section">
           <h3>ç¬¬ä¸€å±‚ï¼šé€‰è‚¡å™¨</h3>
           <Select
             options={selectors.map(s => ({value: s.id, label: s.name}))}
             value={selectedSelector}
             onChange={setSelectedSelector}
           />
           {/* å‚æ•°é…ç½®UI */}
         </div>

         <div className="layer-section">
           <h3>ç¬¬äºŒå±‚ï¼šå…¥åœºç­–ç•¥</h3>
           <Select
             options={entries.map(e => ({value: e.id, label: e.name}))}
             value={selectedEntry}
             onChange={setSelectedEntry}
           />
         </div>

         <div className="layer-section">
           <h3>ç¬¬ä¸‰å±‚ï¼šé€€å‡ºç­–ç•¥</h3>
           <Select
             options={exits.map(x => ({value: x.id, label: x.name}))}
             value={selectedExit}
             onChange={setSelectedExit}
           />
         </div>

         <Button onClick={handleRunBacktest}>è¿è¡Œå›æµ‹</Button>
       </div>
     )
   }
   ```

3. **~~å®ç° StockSelector åŸºç±»~~**ï¼ˆåç«¯å·²å®Œæˆï¼Œè·³è¿‡ï¼‰
   ```python
   # backend/app/strategies/stock_selector.py
   from abc import ABC, abstractmethod
   from typing import List, Dict, Any
   from dataclasses import dataclass
   import pandas as pd

   @dataclass
   class SelectorParameter:
       """é€‰è‚¡å™¨å‚æ•°å®šä¹‰"""
       name: str
       label: str
       type: str  # 'integer', 'float', 'boolean', 'select'
       default: Any
       description: str = ""

   class StockSelector(ABC):
       """è‚¡ç¥¨é€‰æ‹©å™¨åŸºç±»"""

       def __init__(self, params: Dict[str, Any] = None):
           self.params = params or {}

       @property
       @abstractmethod
       def name(self) -> str:
           """é€‰è‚¡å™¨åç§°"""
           pass

       @classmethod
       @abstractmethod
       def get_parameters(cls) -> List[SelectorParameter]:
           """å‚æ•°å®šä¹‰"""
           pass

       @abstractmethod
       def select(
           self,
           date: pd.Timestamp,
           market_data: pd.DataFrame
       ) -> List[str]:
           """
           é€‰è‚¡é€»è¾‘

           Args:
               date: é€‰è‚¡æ—¥æœŸ
               market_data: å…¨å¸‚åœºæ•°æ®ï¼ˆå¤šè‚¡ç¥¨Ã—å¤šæ—¥æœŸï¼‰

           Returns:
               è‚¡ç¥¨ä»£ç åˆ—è¡¨ ['600000.SH', '000001.SZ', ...]
           """
           pass
   ```

3. **å®ç° EntryStrategy åŸºç±»**
   ```python
   # backend/app/strategies/entry_strategy.py
   from abc import ABC, abstractmethod
   from typing import List, Dict, Any
   import pandas as pd

   class EntryStrategy(ABC):
       """å…¥åœºç­–ç•¥åŸºç±»"""

       def __init__(self, params: Dict[str, Any] = None):
           self.params = params or {}

       @property
       @abstractmethod
       def name(self) -> str:
           """ç­–ç•¥åç§°"""
           pass

       @classmethod
       @abstractmethod
       def get_parameters(cls) -> List[Dict[str, Any]]:
           """å‚æ•°å®šä¹‰"""
           pass

       @abstractmethod
       def generate_entry_signals(
           self,
           stocks: List[str],
           prices: pd.DataFrame,
           date: pd.Timestamp
       ) -> Dict[str, float]:
           """
           ç”Ÿæˆå…¥åœºä¿¡å·

           Args:
               stocks: å€™é€‰è‚¡ç¥¨åˆ—è¡¨ï¼ˆæ¥è‡ªé€‰è‚¡å™¨ï¼‰
               prices: ä»·æ ¼æ•°æ®
               date: å½“å‰æ—¥æœŸ

           Returns:
               {è‚¡ç¥¨ä»£ç : ä¹°å…¥æƒé‡} å­—å…¸
           """
           pass
   ```

4. **å®ç° ExitStrategy åŸºç±»**
   ```python
   # backend/app/strategies/exit_strategy.py
   from abc import ABC, abstractmethod
   from typing import List, Dict, Any
   from dataclasses import dataclass
   import pandas as pd

   @dataclass
   class Position:
       """æŒä»“ä¿¡æ¯"""
       stock_code: str
       entry_date: pd.Timestamp
       entry_price: float
       shares: int

   class ExitStrategy(ABC):
       """é€€å‡ºç­–ç•¥åŸºç±»"""

       def __init__(self, params: Dict[str, Any] = None):
           self.params = params or {}

       @property
       @abstractmethod
       def name(self) -> str:
           """ç­–ç•¥åç§°"""
           pass

       @classmethod
       @abstractmethod
       def get_parameters(cls) -> List[Dict[str, Any]]:
           """å‚æ•°å®šä¹‰"""
           pass

       @abstractmethod
       def generate_exit_signals(
           self,
           positions: Dict[str, Position],
           prices: pd.DataFrame,
           date: pd.Timestamp
       ) -> List[str]:
           """
           ç”Ÿæˆé€€å‡ºä¿¡å·

           Args:
               positions: å½“å‰æŒä»“å­—å…¸
               prices: ä»·æ ¼æ•°æ®
               date: å½“å‰æ—¥æœŸ

           Returns:
               éœ€è¦å–å‡ºçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
           """
           pass
   ```

5. **å®ç° StrategyComposerï¼ˆæ ¸å¿ƒç»„åˆå™¨ï¼‰**
   ```python
   # backend/app/strategies/strategy_composer.py
   from typing import Dict, Any
   import pandas as pd
   from .stock_selector import StockSelector
   from .entry_strategy import EntryStrategy
   from .exit_strategy import ExitStrategy

   class StrategyComposer:
       """
       ä¸‰å±‚ç­–ç•¥ç»„åˆå™¨

       ç”¨æ³•ï¼š
           strategy = StrategyComposer(
               selector=MomentumSelector(params={...}),
               entry=MABreakoutEntry(params={...}),
               exit=ATRStopLossExit(params={...}),
               rebalance_freq='W'
           )

           results = strategy.backtest(
               prices=prices,
               start_date='2024-01-01',
               end_date='2024-12-31'
           )
       """

       def __init__(
           self,
           selector: StockSelector,
           entry: EntryStrategy,
           exit: ExitStrategy,
           rebalance_freq: str = 'W'
       ):
           self.selector = selector
           self.entry = entry
           self.exit = exit
           self.rebalance_freq = rebalance_freq

       def backtest(
           self,
           prices: pd.DataFrame,
           start_date: str,
           end_date: str
       ) -> Dict[str, Any]:
           """
           æ‰§è¡Œä¸‰å±‚åˆ†ç¦»å›æµ‹

           å›æµ‹æµç¨‹ï¼š
           1. æ¯å‘¨/æœˆæ‰§è¡Œé€‰è‚¡ï¼ˆLayer 1ï¼‰
           2. æ¯æ—¥æ£€æŸ¥é€€å‡ºä¿¡å·ï¼ˆLayer 3ï¼‰
           3. æ¯æ—¥æ£€æŸ¥å…¥åœºä¿¡å·ï¼ˆLayer 2ï¼‰
           4. æ‰§è¡Œäº¤æ˜“å¹¶æ›´æ–°æŒä»“
           """
           # è¯¦ç»†å®ç°è§ä¸‹ä¸€ä»»åŠ¡
           pass

       def get_metadata(self) -> Dict[str, Any]:
           """è·å–ç»„åˆç­–ç•¥å…ƒæ•°æ®"""
           return {
               'selector': {
                   'name': self.selector.name,
                   'parameters': self.selector.get_parameters()
               },
               'entry': {
                   'name': self.entry.name,
                   'parameters': self.entry.get_parameters()
               },
               'exit': {
                   'name': self.exit.name,
                   'parameters': self.exit.get_parameters()
               },
               'rebalance_freq': self.rebalance_freq
           }
   ```

#### ä»»åŠ¡ 0.2ï¼šå®ç°åŸºç¡€é€‰è‚¡å™¨

**ç›®æ ‡ï¼š** å®ç°3ä¸ªåŸºç¡€é€‰è‚¡å™¨

**å·¥ä½œé‡ï¼š** 3-4å¤©

**å®æ–½æ¸…å•ï¼š**

| é€‰è‚¡å™¨ | æ–‡ä»¶å | åŠŸèƒ½ | å‚æ•° |
|--------|--------|------|------|
| MomentumSelector | `selectors/momentum_selector.py` | åŠ¨é‡é€‰è‚¡ï¼ˆæ¶¨å¹…æœ€å¤§ï¼‰ | lookback_period, top_n |
| ValueSelector | `selectors/value_selector.py` | ä»·å€¼é€‰è‚¡ï¼ˆä½PE/PBï¼‰ | metric, top_n |
| ExternalSelector | `selectors/external_selector.py` | å¤–éƒ¨é€‰è‚¡ï¼ˆStarRankerï¼‰ | source, api_endpoint |

**æ ¸å¿ƒå®ç°ç¤ºä¾‹ï¼ˆMomentumSelectorï¼‰ï¼š**

```python
# backend/app/strategies/selectors/momentum_selector.py

from typing import List
import pandas as pd
import numpy as np
from ..stock_selector import StockSelector, SelectorParameter

class MomentumSelector(StockSelector):
    """åŠ¨é‡é€‰è‚¡å™¨ï¼šé€‰æ‹©è¿‘æœŸæ¶¨å¹…æœ€å¤§çš„è‚¡ç¥¨"""

    @property
    def name(self) -> str:
        return "åŠ¨é‡é€‰è‚¡å™¨"

    @classmethod
    def get_parameters(cls) -> List[SelectorParameter]:
        return [
            SelectorParameter(
                name="lookback_period",
                label="åŠ¨é‡è®¡ç®—å‘¨æœŸï¼ˆå¤©ï¼‰",
                type="integer",
                default=20,
                description="è®¡ç®—è¿‡å»Næ—¥æ”¶ç›Šç‡"
            ),
            SelectorParameter(
                name="top_n",
                label="é€‰è‚¡æ•°é‡",
                type="integer",
                default=50,
                description="é€‰æ‹©åŠ¨é‡æœ€é«˜çš„å‰Nåªè‚¡ç¥¨"
            ),
            SelectorParameter(
                name="use_log_return",
                label="ä½¿ç”¨å¯¹æ•°æ”¶ç›Šç‡",
                type="boolean",
                default=False,
                description="True=å¯¹æ•°æ”¶ç›Šç‡, False=ç®€å•æ”¶ç›Šç‡"
            ),
        ]

    def select(self, date: pd.Timestamp, market_data: pd.DataFrame) -> List[str]:
        """
        åŠ¨é‡é€‰è‚¡é€»è¾‘

        Args:
            date: é€‰è‚¡æ—¥æœŸ
            market_data: DataFrame(index=date, columns=stock_codes, values=close_price)

        Returns:
            é€‰å‡ºçš„è‚¡ç¥¨ä»£ç åˆ—è¡¨
        """
        lookback = self.params.get('lookback_period', 20)
        top_n = self.params.get('top_n', 50)
        use_log = self.params.get('use_log_return', False)

        # è®¡ç®—åŠ¨é‡ï¼ˆæ”¶ç›Šç‡ï¼‰
        if use_log:
            momentum = np.log(market_data / market_data.shift(lookback))
        else:
            momentum = market_data.pct_change(lookback)

        # è·å–å½“æ—¥åŠ¨é‡
        current_momentum = momentum.loc[date].dropna()

        # é€‰æ‹©åŠ¨é‡æœ€é«˜çš„ top_n åªè‚¡ç¥¨
        selected_stocks = current_momentum.nlargest(top_n).index.tolist()

        return selected_stocks
```

**ExternalSelector å®ç°ï¼ˆå…³é”®åŠŸèƒ½ï¼‰ï¼š**

```python
# backend/app/strategies/selectors/external_selector.py

from typing import List
import pandas as pd
import requests
from loguru import logger
from ..stock_selector import StockSelector, SelectorParameter

class ExternalSelector(StockSelector):
    """å¤–éƒ¨é€‰è‚¡å™¨ï¼šæ”¯æŒæ¥å…¥ StarRanker ç­‰å¤–éƒ¨ç³»ç»Ÿ"""

    @property
    def name(self) -> str:
        return "å¤–éƒ¨æ•°æ®æºé€‰è‚¡å™¨"

    @classmethod
    def get_parameters(cls) -> List[SelectorParameter]:
        return [
            SelectorParameter(
                name="source",
                label="æ•°æ®æº",
                type="select",
                default="starranker",
                description="å¤–éƒ¨é€‰è‚¡æ•°æ®æº",
                options=[
                    {"value": "starranker", "label": "StarRanker"},
                    {"value": "custom_api", "label": "è‡ªå®šä¹‰API"},
                    {"value": "manual", "label": "æ‰‹åŠ¨è¾“å…¥"}
                ]
            ),
            SelectorParameter(
                name="api_endpoint",
                label="APIåœ°å€ï¼ˆå¯é€‰ï¼‰",
                type="string",
                default="",
                description="è‡ªå®šä¹‰APIçš„URL"
            ),
            SelectorParameter(
                name="manual_stocks",
                label="æ‰‹åŠ¨è‚¡ç¥¨æ± ï¼ˆå¯é€‰ï¼‰",
                type="string",
                default="",
                description="é€—å·åˆ†éš”çš„è‚¡ç¥¨ä»£ç ï¼Œå¦‚ï¼š600000.SH,000001.SZ"
            ),
        ]

    def select(self, date: pd.Timestamp, market_data: pd.DataFrame) -> List[str]:
        """
        ä»å¤–éƒ¨ç³»ç»Ÿè·å–è‚¡ç¥¨åˆ—è¡¨
        """
        source = self.params.get('source', 'starranker')

        if source == 'starranker':
            return self._fetch_from_starranker(date)
        elif source == 'custom_api':
            api_endpoint = self.params.get('api_endpoint')
            return self._fetch_from_custom_api(date, api_endpoint)
        elif source == 'manual':
            manual_stocks = self.params.get('manual_stocks', '')
            return [s.strip() for s in manual_stocks.split(',') if s.strip()]
        else:
            logger.error(f"æœªçŸ¥çš„æ•°æ®æºï¼š{source}")
            return []

    def _fetch_from_starranker(self, date: pd.Timestamp) -> List[str]:
        """ä» StarRanker è·å–è‚¡ç¥¨åˆ—è¡¨"""
        try:
            # TODO: é›†æˆ StarRanker API
            response = requests.get(
                'http://localhost:8000/api/starranker/top-stocks',
                params={'date': date.strftime('%Y-%m-%d')}
            )
            response.raise_for_status()
            data = response.json()
            return data.get('stocks', [])
        except Exception as e:
            logger.error(f"ä» StarRanker è·å–æ•°æ®å¤±è´¥ï¼š{e}")
            return []

    def _fetch_from_custom_api(self, date: pd.Timestamp, api_endpoint: str) -> List[str]:
        """ä»è‡ªå®šä¹‰APIè·å–è‚¡ç¥¨åˆ—è¡¨"""
        try:
            response = requests.get(
                api_endpoint,
                params={'date': date.strftime('%Y-%m-%d')}
            )
            response.raise_for_status()
            data = response.json()
            return data.get('stocks', [])
        except Exception as e:
            logger.error(f"ä»è‡ªå®šä¹‰APIè·å–æ•°æ®å¤±è´¥ï¼š{e}")
            return []
```

#### ä»»åŠ¡ 0.3ï¼šå®ç°åŸºç¡€å…¥åœºç­–ç•¥

**ç›®æ ‡ï¼š** å®ç°3ä¸ªåŸºç¡€å…¥åœºç­–ç•¥

**å·¥ä½œé‡ï¼š** 3-4å¤©

**å®æ–½æ¸…å•ï¼š**

| ç­–ç•¥ | æ–‡ä»¶å | åŠŸèƒ½ | å…³é”®å‚æ•° |
|------|--------|------|----------|
| MABreakoutEntry | `entries/ma_breakout_entry.py` | å‡çº¿çªç ´å…¥åœº | short_window, long_window |
| RSIOversoldEntry | `entries/rsi_oversold_entry.py` | RSIè¶…å–å…¥åœº | rsi_period, oversold_level |
| ImmediateEntry | `entries/immediate_entry.py` | ç«‹å³å…¥åœºï¼ˆç”¨äºæµ‹è¯•ï¼‰ | weight_method |

#### ä»»åŠ¡ 0.4ï¼šå®ç°åŸºç¡€é€€å‡ºç­–ç•¥

**ç›®æ ‡ï¼š** å®ç°4ä¸ªåŸºç¡€é€€å‡ºç­–ç•¥

**å·¥ä½œé‡ï¼š** 3-4å¤©

**å®æ–½æ¸…å•ï¼š**

| ç­–ç•¥ | æ–‡ä»¶å | åŠŸèƒ½ | å…³é”®å‚æ•° |
|------|--------|------|----------|
| ATRStopLossExit | `exits/atr_stop_loss_exit.py` | ATRåŠ¨æ€æ­¢æŸ | atr_period, atr_multiplier |
| FixedStopLossExit | `exits/fixed_stop_loss_exit.py` | å›ºå®šæ­¢æŸ | stop_loss_pct, take_profit_pct |
| TimeBasedExit | `exits/time_based_exit.py` | æ—¶é—´æ­¢æŸ | holding_period |
| CombinedExit | `exits/combined_exit.py` | ç»„åˆé€€å‡ºï¼ˆORé€»è¾‘ï¼‰ | exit_strategies |

#### ä»»åŠ¡ 0.5ï¼šå®ç°å›æµ‹å¼•æ“é€‚é…

**ç›®æ ‡ï¼š** ä¿®æ”¹ BacktestEngine æ”¯æŒä¸‰å±‚æ¶æ„

**å·¥ä½œé‡ï¼š** 3-5å¤©

**å…³é”®ä¿®æ”¹ç‚¹ï¼š**

```python
# backend/app/services/backtest_engine.py

class BacktestEngine:
    def backtest_three_layer(
        self,
        selector: StockSelector,
        entry: EntryStrategy,
        exit: ExitStrategy,
        prices: pd.DataFrame,
        start_date: str,
        end_date: str,
        rebalance_freq: str = 'W'
    ) -> Dict[str, Any]:
        """
        ä¸‰å±‚æ¶æ„å›æµ‹æ–¹æ³•

        æµç¨‹ï¼š
        1. åˆå§‹åŒ–æŒä»“å’Œèµ„é‡‘
        2. éå†äº¤æ˜“æ—¥ï¼š
           - æ‰§è¡Œé€€å‡ºç­–ç•¥ï¼ˆæ¯æ—¥ï¼‰
           - æ‰§è¡Œé€‰è‚¡ï¼ˆæŒ‰ rebalance_freqï¼‰
           - æ‰§è¡Œå…¥åœºç­–ç•¥ï¼ˆæ¯æ—¥ï¼‰
           - è®°å½•äº¤æ˜“å’ŒæŒä»“
        3. è®¡ç®—ç»©æ•ˆæŒ‡æ ‡
        """
        pass
```

#### ä»»åŠ¡ 0.6ï¼šåˆ›å»º API ç«¯ç‚¹

**ç›®æ ‡ï¼š** æä¾›ä¸‰å±‚æ¶æ„çš„ REST API

**å·¥ä½œé‡ï¼š** 2-3å¤©

**æ–°å¢ç«¯ç‚¹ï¼š**

```python
# backend/app/api/endpoints/three_layer_strategy.py

@router.get("/selectors/list")
async def list_selectors():
    """è·å–æ‰€æœ‰å¯ç”¨é€‰è‚¡å™¨"""
    pass

@router.get("/entries/list")
async def list_entry_strategies():
    """è·å–æ‰€æœ‰å…¥åœºç­–ç•¥"""
    pass

@router.get("/exits/list")
async def list_exit_strategies():
    """è·å–æ‰€æœ‰é€€å‡ºç­–ç•¥"""
    pass

@router.post("/compose/metadata")
async def get_composed_strategy_metadata(
    selector_id: str,
    entry_id: str,
    exit_id: str
):
    """è·å–ç»„åˆç­–ç•¥çš„å®Œæ•´å…ƒæ•°æ®ï¼ˆåŒ…å«æ‰€æœ‰å‚æ•°å®šä¹‰ï¼‰"""
    pass

@router.post("/backtest")
async def backtest_composed_strategy(
    selector_id: str,
    selector_params: Dict[str, Any],
    entry_id: str,
    entry_params: Dict[str, Any],
    exit_id: str,
    exit_params: Dict[str, Any],
    stock_codes: List[str],
    start_date: str,
    end_date: str,
    rebalance_freq: str = 'W'
):
    """æ‰§è¡Œä¸‰å±‚ç»„åˆç­–ç•¥å›æµ‹"""
    pass
```

**é˜¶æ®µé›¶æ€»ç»“ï¼ˆ2026-02-07æ›´æ–°ï¼‰ï¼š**

| ä»»åŠ¡ | åŸè®¡åˆ’å·¥ä½œé‡ | å®é™…çŠ¶æ€ | è¯´æ˜ |
|------|------------|---------|------|
| 0.1 è®¾è®¡ä¸‰å±‚åŸºç±» | 3-5å¤© | âœ… Coreå·²å®Œæˆ | è·³è¿‡ |
| 0.2 åŸºç¡€é€‰è‚¡å™¨ | 3-4å¤© | âœ… Coreå·²å®Œæˆï¼ˆ4ä¸ªï¼‰ | è·³è¿‡ |
| 0.3 åŸºç¡€å…¥åœºç­–ç•¥ | 3-4å¤© | âœ… Coreå·²å®Œæˆï¼ˆ3ä¸ªï¼‰ | è·³è¿‡ |
| 0.4 åŸºç¡€é€€å‡ºç­–ç•¥ | 3-4å¤© | âœ… Coreå·²å®Œæˆï¼ˆ4ä¸ªï¼‰ | è·³è¿‡ |
| 0.5 å›æµ‹å¼•æ“é€‚é… | 3-5å¤© | âœ… Coreå·²å®Œæˆ | è·³è¿‡ |
| 0.6 API ç«¯ç‚¹ | 2-3å¤© | âœ… Backendå·²å®Œæˆï¼ˆ5ä¸ªï¼‰ | è·³è¿‡ |
| **0.7 å‰ç«¯APIé›†æˆ** | - | âš ï¸ **å¾…å®Œæˆ** | **2-3å¤©** |
| **0.8 å‰ç«¯UIå¼€å‘** | - | âš ï¸ **å¾…å®Œæˆ** | **3-4å¤©** |
| **åˆè®¡** | ~~17-25å¤©~~ | **5-7å¤©** | **èŠ‚çœ80%å·¥ä½œé‡** |

---


### 5.1 é˜¶æ®µä¸€ï¼š~~è¡¥å…¨ç­–ç•¥åº“~~ï¼ˆå·²åºŸå¼ƒï¼‰â­

> **çŠ¶æ€æ›´æ–°ï¼ˆ2026-02-07ï¼‰**ï¼šæœ¬é˜¶æ®µä»»åŠ¡å·²è¢«ä¸‰å±‚æ¶æ„æ›¿ä»£ï¼Œæ— éœ€æ‰§è¡Œã€‚

#### ~~ä»»åŠ¡ 1.1ï¼šè¿ç§» Core ç­–ç•¥åˆ° Backend~~ï¼ˆå·²åºŸå¼ƒï¼‰

**åŸç›®æ ‡ï¼š** å°† Core ä¸­çš„ 3 ä¸ªç­–ç•¥ç§»æ¤åˆ° Backend ç”Ÿäº§ç¯å¢ƒ

**åºŸå¼ƒåŸå› ï¼š**
- âŒ Core v3.1.0å·²é‡‡ç”¨ä¸‰å±‚æ¶æ„ï¼Œä¼ ç»Ÿç­–ç•¥å·²åºŸå¼ƒ
- âŒ MomentumStrategyã€MeanReversionStrategyã€MultiFactorStrategyä¸å†ä»¥ç‹¬ç«‹ç­–ç•¥å½¢å¼å­˜åœ¨
- âœ… å·²è¢«ä¸‰å±‚æ¶æ„ç»„ä»¶æ›¿ä»£ï¼š
  - MomentumStrategy â†’ MomentumSelectorï¼ˆé€‰è‚¡å™¨ï¼‰
  - MeanReversionStrategy â†’ å¯é€šè¿‡ç»„åˆå®ç°
  - MultiFactorStrategy â†’ MLSelectorï¼ˆæœºå™¨å­¦ä¹ é€‰è‚¡å™¨ï¼‰

**æ–°æ›¿ä»£æ–¹æ¡ˆï¼š**
ä½¿ç”¨ä¸‰å±‚æ¶æ„APIï¼Œå‰ç«¯å¯é€šè¿‡ç»„åˆå®ç°ç­‰æ•ˆåŠŸèƒ½ï¼š

```typescript
// åŸ MomentumStrategy çš„ä¸‰å±‚æ¶æ„ç­‰æ•ˆå®ç°
const momentumStrategy = {
  selector: {id: 'momentum', params: {lookback_period: 20, top_n: 50}},
  entry: {id: 'immediate', params: {}},
  exit: {id: 'fixed_stop_loss', params: {stop_loss_pct: -5.0}}
}
```

~~**åŸå®æ–½æ­¥éª¤**~~ï¼ˆå·²åºŸå¼ƒï¼Œä¸å†æ‰§è¡Œï¼‰ï¼š
```bash
# ä»¥ä¸‹ä»£ç æ— éœ€æ‰§è¡Œ
# touch backend/app/strategies/momentum_strategy.py
# ...
```

2. **å®ç°ç­–ç•¥ç±»**ï¼ˆä»¥åŠ¨é‡ç­–ç•¥ä¸ºä¾‹ï¼‰
   ```python
   # backend/app/strategies/momentum_strategy.py

   from typing import List
   import pandas as pd
   import numpy as np
   from loguru import logger

   from .base_strategy import BaseStrategy, ParameterType, StrategyParameter


   class MomentumStrategy(BaseStrategy):
       """
       åŠ¨é‡ç­–ç•¥

       æ ¸å¿ƒé€»è¾‘ï¼šä¹°å…¥è¿‘æœŸå¼ºåŠ¿è‚¡ï¼ŒæŒæœ‰ä¸€æ®µæ—¶é—´åå–å‡º
       """

       @property
       def name(self) -> str:
           return "åŠ¨é‡ç­–ç•¥"

       @property
       def description(self) -> str:
           return "åŸºäºä»·æ ¼åŠ¨é‡é€‰è‚¡ï¼Œä¹°å…¥è¿‘æœŸæ¶¨å¹…æœ€å¤§çš„è‚¡ç¥¨"

       @property
       def version(self) -> str:
           return "1.0.0"

       @classmethod
       def get_parameters(cls) -> List[StrategyParameter]:
           """å®šä¹‰ç­–ç•¥å‚æ•°"""
           return [
               StrategyParameter(
                   name="lookback_period",
                   label="åŠ¨é‡è®¡ç®—å‘¨æœŸï¼ˆå¤©ï¼‰",
                   type=ParameterType.INTEGER,
                   default=20,
                   min_value=5,
                   max_value=200,
                   step=5,
                   description="è®¡ç®—è¿‡å»Næ—¥æ”¶ç›Šç‡ä½œä¸ºåŠ¨é‡æŒ‡æ ‡",
                   category="æ ¸å¿ƒå‚æ•°",
               ),
               StrategyParameter(
                   name="top_n",
                   label="é€‰è‚¡æ•°é‡",
                   type=ParameterType.INTEGER,
                   default=50,
                   min_value=10,
                   max_value=200,
                   step=10,
                   description="æ¯æœŸé€‰æ‹©åŠ¨é‡æœ€é«˜çš„å‰Nåªè‚¡ç¥¨",
                   category="æ ¸å¿ƒå‚æ•°",
               ),
               StrategyParameter(
                   name="holding_period",
                   label="æŒä»“æœŸï¼ˆå¤©ï¼‰",
                   type=ParameterType.INTEGER,
                   default=5,
                   min_value=1,
                   max_value=60,
                   step=1,
                   description="æŒä»“å¤©æ•°",
                   category="æ ¸å¿ƒå‚æ•°",
               ),
               StrategyParameter(
                   name="use_log_return",
                   label="ä½¿ç”¨å¯¹æ•°æ”¶ç›Šç‡",
                   type=ParameterType.BOOLEAN,
                   default=False,
                   description="True=å¯¹æ•°æ”¶ç›Šç‡ï¼ˆé€‚åˆé•¿æœŸï¼‰ï¼ŒFalse=ç®€å•æ”¶ç›Šç‡ï¼ˆé€‚åˆçŸ­æœŸï¼‰",
                   category="é«˜çº§é€‰é¡¹",
               ),
               StrategyParameter(
                   name="filter_negative",
                   label="è¿‡æ»¤è´ŸåŠ¨é‡",
                   type=ParameterType.BOOLEAN,
                   default=True,
                   description="æ˜¯å¦è¿‡æ»¤æ‰è´ŸåŠ¨é‡ï¼ˆä¸‹è·Œï¼‰çš„è‚¡ç¥¨",
                   category="é«˜çº§é€‰é¡¹",
               ),
           ]

       def generate_signals(self, data: pd.DataFrame) -> pd.Series:
           """
           ç”Ÿæˆäº¤æ˜“ä¿¡å·

           å‚æ•°:
               data: OHLCVæ•°æ®

           è¿”å›:
               ä¿¡å·åºåˆ— (1=ä¹°å…¥, -1=å–å‡º, 0=æŒæœ‰)
           """
           logger.info(f"å¼€å§‹ç”ŸæˆåŠ¨é‡ç­–ç•¥ä¿¡å·ï¼Œæ•°æ®é•¿åº¦: {len(data)}")

           # 1. è®¡ç®—åŠ¨é‡
           lookback = self.params.get("lookback_period", 20)
           use_log = self.params.get("use_log_return", False)

           if use_log:
               momentum = np.log(data['close'] / data['close'].shift(lookback)) * 100
           else:
               momentum = data['close'].pct_change(lookback) * 100

           # 2. ç”Ÿæˆä¿¡å·
           filter_negative = self.params.get("filter_negative", True)

           signals = pd.Series(0, index=data.index)

           # ä¹°å…¥ä¿¡å·ï¼šåŠ¨é‡ > 0ï¼ˆæˆ–ä¸è¿‡æ»¤ï¼‰
           if filter_negative:
               buy_condition = momentum > 0
           else:
               buy_condition = momentum.notna()

           signals[buy_condition] = 1

           # å–å‡ºä¿¡å·ï¼šæŒä»“æœŸåè‡ªåŠ¨å–å‡ºï¼ˆè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
           holding_period = self.params.get("holding_period", 5)
           for i in range(len(signals)):
               if signals.iloc[i] == 1 and i + holding_period < len(signals):
                   signals.iloc[i + holding_period] = -1

           logger.info(f"ä¿¡å·ç”Ÿæˆå®Œæˆ: ä¹°å…¥={signals[signals == 1].count()}, å–å‡º={signals[signals == -1].count()}")

           return signals
   ```

3. **æ³¨å†Œç­–ç•¥åˆ° StrategyManager**
   ```python
   # backend/app/strategies/strategy_manager.py

   from .momentum_strategy import MomentumStrategy
   from .mean_reversion_strategy import MeanReversionStrategy
   from .multi_factor_strategy import MultiFactorStrategy

   class StrategyManager:
       _strategies: Dict[str, Type[BaseStrategy]] = {
           "complex_indicator": ComplexIndicatorStrategy,
           "ml_model": MLModelStrategy,
           "momentum": MomentumStrategy,              # æ–°å¢
           "mean_reversion": MeanReversionStrategy,   # æ–°å¢
           "multi_factor": MultiFactorStrategy,       # æ–°å¢
       }
   ```

4. **ç¼–å†™å•å…ƒæµ‹è¯•**
   ```python
   # backend/tests/test_momentum_strategy.py

   def test_momentum_strategy():
       # æµ‹è¯•ç­–ç•¥å®ä¾‹åŒ–
       # æµ‹è¯•å‚æ•°éªŒè¯
       # æµ‹è¯•ä¿¡å·ç”Ÿæˆ
       pass
   ```

5. **éªŒè¯ç­–ç•¥å¯ç”¨æ€§**
   ```bash
   # æµ‹è¯• API ç«¯ç‚¹
   curl http://localhost:8000/api/strategy/list
   # åº”è¯¥è¿”å› 5 ä¸ªç­–ç•¥

   curl http://localhost:8000/api/strategy/metadata?strategy_id=momentum
   # åº”è¯¥è¿”å›åŠ¨é‡ç­–ç•¥çš„å®Œæ•´å…ƒæ•°æ®
   ```

---

### 5.2 é˜¶æ®µäºŒï¼šæ–°å¢ç­–ç•¥ä¸­å¿ƒï¼ˆP1ï¼‰

#### ä»»åŠ¡ 2.1ï¼šåˆ›å»ºç­–ç•¥åˆ—è¡¨é¡µé¢

**æ–‡ä»¶ï¼š** `frontend/src/app/strategies/page.tsx`

```typescript
'use client'

import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import { apiClient } from '@/lib/api-client'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Input } from '@/components/ui/input'
import { Select } from '@/components/ui/select'

interface Strategy {
  id: string
  name: string
  description: string
  version: string
  category: string
  parameter_count: number
}

export default function StrategiesPage() {
  const router = useRouter()
  const [strategies, setStrategies] = useState<Strategy[]>([])
  const [filteredStrategies, setFilteredStrategies] = useState<Strategy[]>([])
  const [searchTerm, setSearchTerm] = useState('')
  const [categoryFilter, setCategoryFilter] = useState('all')
  const [loading, setLoading] = useState(true)

  // åŠ è½½ç­–ç•¥åˆ—è¡¨
  useEffect(() => {
    const fetchStrategies = async () => {
      try {
        const response = await apiClient.getStrategyList()
        const data = response.data || []

        // æ·»åŠ åˆ†ç±»ä¿¡æ¯ï¼ˆåŸºäºç­–ç•¥åç§°æ¨æ–­ï¼‰
        const strategiesWithCategory = data.map((s: any) => ({
          ...s,
          category: inferCategory(s.name, s.id),
        }))

        setStrategies(strategiesWithCategory)
        setFilteredStrategies(strategiesWithCategory)
      } catch (error) {
        console.error('åŠ è½½ç­–ç•¥åˆ—è¡¨å¤±è´¥:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchStrategies()
  }, [])

  // æ¨æ–­ç­–ç•¥åˆ†ç±»
  const inferCategory = (name: string, id: string): string => {
    if (name.includes('åŠ¨é‡') || id.includes('momentum')) return 'è¶‹åŠ¿è·Ÿè¸ª'
    if (name.includes('å›å½’') || id.includes('reversion')) return 'å‡å€¼å›å½’'
    if (name.includes('å› å­') || id.includes('factor')) return 'é‡åŒ–é€‰è‚¡'
    if (name.includes('æœºå™¨å­¦ä¹ ') || name.includes('ML') || id.includes('ml')) return 'AIæœºå™¨å­¦ä¹ '
    if (name.includes('æŒ‡æ ‡') || id.includes('indicator')) return 'æŠ€æœ¯æŒ‡æ ‡'
    return 'å…¶ä»–'
  }

  // æœç´¢å’Œç­›é€‰
  useEffect(() => {
    let filtered = strategies

    // æœç´¢è¿‡æ»¤
    if (searchTerm) {
      filtered = filtered.filter(
        (s) =>
          s.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          s.description.toLowerCase().includes(searchTerm.toLowerCase())
      )
    }

    // åˆ†ç±»è¿‡æ»¤
    if (categoryFilter !== 'all') {
      filtered = filtered.filter((s) => s.category === categoryFilter)
    }

    setFilteredStrategies(filtered)
  }, [searchTerm, categoryFilter, strategies])

  const handleViewDetails = (strategyId: string) => {
    router.push(`/strategies/${strategyId}`)
  }

  const handleQuickBacktest = (strategyId: string) => {
    router.push(`/backtest?strategy_id=${strategyId}`)
  }

  if (loading) {
    return <div className="flex justify-center items-center h-screen">åŠ è½½ä¸­...</div>
  }

  return (
    <div className="container mx-auto py-8 px-4">
      {/* é¡µé¢æ ‡é¢˜ */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold mb-2">ç­–ç•¥ä¸­å¿ƒ</h1>
        <p className="text-muted-foreground">
          æµè§ˆå’Œäº†è§£æ‰€æœ‰å¯ç”¨çš„é‡åŒ–äº¤æ˜“ç­–ç•¥ï¼Œé€‰æ‹©é€‚åˆæ‚¨çš„ç­–ç•¥è¿›è¡Œå›æµ‹
        </p>
      </div>

      {/* æœç´¢å’Œç­›é€‰ */}
      <div className="flex gap-4 mb-6">
        <Input
          placeholder="æœç´¢ç­–ç•¥åç§°æˆ–æè¿°..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="max-w-sm"
        />
        <Select
          value={categoryFilter}
          onValueChange={setCategoryFilter}
        >
          <option value="all">å…¨éƒ¨åˆ†ç±»</option>
          <option value="è¶‹åŠ¿è·Ÿè¸ª">è¶‹åŠ¿è·Ÿè¸ª</option>
          <option value="å‡å€¼å›å½’">å‡å€¼å›å½’</option>
          <option value="é‡åŒ–é€‰è‚¡">é‡åŒ–é€‰è‚¡</option>
          <option value="AIæœºå™¨å­¦ä¹ ">AIæœºå™¨å­¦ä¹ </option>
          <option value="æŠ€æœ¯æŒ‡æ ‡">æŠ€æœ¯æŒ‡æ ‡</option>
        </Select>
      </div>

      {/* ç­–ç•¥å¡ç‰‡ç½‘æ ¼ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredStrategies.map((strategy) => (
          <Card key={strategy.id} className="hover:shadow-lg transition-shadow">
            <CardHeader>
              <div className="flex justify-between items-start mb-2">
                <CardTitle className="text-xl">{strategy.name}</CardTitle>
                <Badge variant="outline">{strategy.version}</Badge>
              </div>
              <div className="flex gap-2">
                <Badge>{strategy.category}</Badge>
                <Badge variant="secondary">{strategy.parameter_count} ä¸ªå‚æ•°</Badge>
              </div>
            </CardHeader>
            <CardContent>
              <CardDescription className="mb-4 line-clamp-2">
                {strategy.description}
              </CardDescription>
              <div className="flex gap-2">
                <Button
                  variant="outline"
                  size="sm"
                  onClick={() => handleViewDetails(strategy.id)}
                  className="flex-1"
                >
                  æŸ¥çœ‹è¯¦æƒ…
                </Button>
                <Button
                  size="sm"
                  onClick={() => handleQuickBacktest(strategy.id)}
                  className="flex-1"
                >
                  ç«‹å³å›æµ‹ â†’
                </Button>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* ç©ºçŠ¶æ€ */}
      {filteredStrategies.length === 0 && (
        <div className="text-center py-12">
          <p className="text-muted-foreground">æœªæ‰¾åˆ°åŒ¹é…çš„ç­–ç•¥</p>
        </div>
      )}
    </div>
  )
}
```

#### ä»»åŠ¡ 2.2ï¼šåˆ›å»ºç­–ç•¥è¯¦æƒ…é¡µé¢

**æ–‡ä»¶ï¼š** `frontend/src/app/strategies/[id]/page.tsx`

```typescript
'use client'

import { useEffect, useState } from 'react'
import { useRouter, useParams } from 'next/navigation'
import { apiClient } from '@/lib/api-client'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'

interface StrategyMetadata {
  id: string
  name: string
  description: string
  version: string
  parameters: Array<{
    name: string
    label: string
    type: string
    default: any
    min_value?: number
    max_value?: number
    description: string
    category: string
  }>
}

export default function StrategyDetailPage() {
  const router = useRouter()
  const params = useParams()
  const strategyId = params.id as string

  const [metadata, setMetadata] = useState<StrategyMetadata | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    const fetchMetadata = async () => {
      try {
        const response = await apiClient.getStrategyMetadata(strategyId)
        setMetadata(response.data)
      } catch (error) {
        console.error('åŠ è½½ç­–ç•¥å…ƒæ•°æ®å¤±è´¥:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchMetadata()
  }, [strategyId])

  const handleBacktest = () => {
    router.push(`/backtest?strategy_id=${strategyId}`)
  }

  if (loading) {
    return <div className="flex justify-center items-center h-screen">åŠ è½½ä¸­...</div>
  }

  if (!metadata) {
    return <div className="text-center py-12">ç­–ç•¥ä¸å­˜åœ¨</div>
  }

  // æŒ‰åˆ†ç±»åˆ†ç»„å‚æ•°
  const parametersByCategory = metadata.parameters.reduce((acc, param) => {
    const category = param.category || 'å…¶ä»–'
    if (!acc[category]) acc[category] = []
    acc[category].push(param)
    return acc
  }, {} as Record<string, typeof metadata.parameters>)

  return (
    <div className="container mx-auto py-8 px-4 max-w-5xl">
      {/* è¿”å›æŒ‰é’® */}
      <Button variant="ghost" onClick={() => router.back()} className="mb-4">
        â† è¿”å›ç­–ç•¥åˆ—è¡¨
      </Button>

      {/* ç­–ç•¥æ ‡é¢˜ */}
      <div className="mb-8">
        <div className="flex justify-between items-start mb-4">
          <div>
            <h1 className="text-4xl font-bold mb-2">{metadata.name}</h1>
            <p className="text-muted-foreground text-lg">{metadata.description}</p>
          </div>
          <Badge variant="outline" className="text-lg px-4 py-2">
            {metadata.version}
          </Badge>
        </div>
        <Button size="lg" onClick={handleBacktest} className="mt-4">
          ç«‹å³å›æµ‹
        </Button>
      </div>

      {/* Tabs */}
      <Tabs defaultValue="overview" className="w-full">
        <TabsList>
          <TabsTrigger value="overview">ç­–ç•¥æ¦‚è§ˆ</TabsTrigger>
          <TabsTrigger value="parameters">å‚æ•°é…ç½®</TabsTrigger>
          <TabsTrigger value="usage">ä½¿ç”¨æŒ‡å—</TabsTrigger>
        </TabsList>

        {/* ç­–ç•¥æ¦‚è§ˆ */}
        <TabsContent value="overview" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>ç­–ç•¥è¯´æ˜</CardTitle>
            </CardHeader>
            <CardContent>
              <p>{metadata.description}</p>
              {/* è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„ç­–ç•¥è¯´æ˜ */}
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>é€‚ç”¨åœºæ™¯</CardTitle>
            </CardHeader>
            <CardContent>
              <ul className="list-disc list-inside space-y-2">
                {getUseCases(strategyId).map((useCase, index) => (
                  <li key={index}>{useCase}</li>
                ))}
              </ul>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>é£é™©æç¤º</CardTitle>
            </CardHeader>
            <CardContent>
              <ul className="list-disc list-inside space-y-2 text-amber-600">
                {getRiskWarnings(strategyId).map((warning, index) => (
                  <li key={index}>{warning}</li>
                ))}
              </ul>
            </CardContent>
          </Card>
        </TabsContent>

        {/* å‚æ•°é…ç½® */}
        <TabsContent value="parameters" className="space-y-4">
          {Object.entries(parametersByCategory).map(([category, params]) => (
            <Card key={category}>
              <CardHeader>
                <CardTitle>{category}</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  {params.map((param) => (
                    <div key={param.name} className="border-b pb-4 last:border-0">
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <h4 className="font-semibold">{param.label}</h4>
                          <p className="text-sm text-muted-foreground">{param.description}</p>
                        </div>
                        <Badge variant="secondary">{param.type}</Badge>
                      </div>
                      <div className="text-sm">
                        <span className="font-medium">é»˜è®¤å€¼: </span>
                        <span>{String(param.default)}</span>
                        {param.min_value !== undefined && param.max_value !== undefined && (
                          <span className="ml-4 text-muted-foreground">
                            èŒƒå›´: {param.min_value} - {param.max_value}
                          </span>
                        )}
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          ))}
        </TabsContent>

        {/* ä½¿ç”¨æŒ‡å— */}
        <TabsContent value="usage" className="space-y-4">
          <Card>
            <CardHeader>
              <CardTitle>å¿«é€Ÿå¼€å§‹</CardTitle>
            </CardHeader>
            <CardContent>
              <ol className="list-decimal list-inside space-y-2">
                <li>ç‚¹å‡»"ç«‹å³å›æµ‹"æŒ‰é’®</li>
                <li>è¾“å…¥è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ 600000ï¼‰</li>
                <li>é€‰æ‹©å›æµ‹æ—¶é—´èŒƒå›´</li>
                <li>è°ƒæ•´ç­–ç•¥å‚æ•°ï¼ˆå¯é€‰ï¼‰</li>
                <li>ç‚¹å‡»"è¿è¡Œå›æµ‹"æŸ¥çœ‹ç»“æœ</li>
              </ol>
            </CardContent>
          </Card>

          {strategyId === 'ml_model' && (
            <Card>
              <CardHeader>
                <CardTitle>ML ç­–ç•¥ç‰¹åˆ«è¯´æ˜</CardTitle>
              </CardHeader>
              <CardContent>
                <p className="mb-4">
                  æœºå™¨å­¦ä¹ ç­–ç•¥éœ€è¦å…ˆè®­ç»ƒæ¨¡å‹ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
                </p>
                <ol className="list-decimal list-inside space-y-2">
                  <li>å‰å¾€ AI å®éªŒèˆ±è®­ç»ƒæ¨¡å‹</li>
                  <li>è®­ç»ƒå®Œæˆåï¼Œåœ¨æ¨¡å‹åˆ—è¡¨ä¸­é€‰æ‹©æ¨¡å‹</li>
                  <li>ç‚¹å‡»"ç­–ç•¥å›æµ‹"è¿›å…¥å›æµ‹é¡µé¢</li>
                  <li>ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹© ML ç­–ç•¥å¹¶é¢„å¡«å‚æ•°</li>
                </ol>
                <Button
                  variant="outline"
                  className="mt-4"
                  onClick={() => router.push('/ai-lab')}
                >
                  å‰å¾€ AI å®éªŒèˆ± â†’
                </Button>
              </CardContent>
            </Card>
          )}
        </TabsContent>
      </Tabs>
    </div>
  )
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–ä½¿ç”¨æ¡ˆä¾‹
function getUseCases(strategyId: string): string[] {
  const useCases: Record<string, string[]> = {
    momentum: [
      'è¶‹åŠ¿æ€§è¡Œæƒ…ï¼Œå¸‚åœºæ•´ä½“ä¸Šæ¶¨æ—¶è¡¨ç°ä¼˜å¼‚',
      'ä¸­çŸ­æœŸäº¤æ˜“ï¼Œé€‚åˆ5-20å¤©æŒä»“å‘¨æœŸ',
      'ç‰›å¸‚ä¸­è¿½æ¶¨å¼ºåŠ¿è‚¡',
    ],
    mean_reversion: [
      'éœ‡è¡å¸‚åœºï¼Œä»·æ ¼å›´ç»•å‡å€¼æ³¢åŠ¨',
      'ä¸ªè‚¡çŸ­æœŸè¶…ä¹°è¶…å–è°ƒæ•´',
      'é€‚åˆé«˜é¢‘äº¤æ˜“',
    ],
    complex_indicator: [
      'é€‚ç”¨äºå„ç§å¸‚åœºç¯å¢ƒ',
      'å¤šç»´åº¦ä¿¡å·ç¡®è®¤ï¼Œé™ä½å‡ä¿¡å·',
      'é€‚åˆç¨³å¥æŠ•èµ„è€…',
    ],
    multi_factor: [
      'å¤šå› å­é€‰è‚¡ï¼Œé£é™©åˆ†æ•£',
      'é€‚åˆæ„å»ºè‚¡ç¥¨æŠ•èµ„ç»„åˆ',
      'é•¿æœŸæŒæœ‰æ•ˆæœæ›´ä½³',
    ],
    ml_model: [
      'åŸºäºå¤§æ•°æ®å’Œæœºå™¨å­¦ä¹ é¢„æµ‹',
      'é€‚åˆé‡åŒ–äº¤æ˜“å’Œç®—æ³•äº¤æ˜“',
      'éœ€è¦å®šæœŸé‡æ–°è®­ç»ƒæ¨¡å‹',
    ],
  }

  return useCases[strategyId] || ['æš‚æ— ä½¿ç”¨æ¡ˆä¾‹']
}

// è¾…åŠ©å‡½æ•°ï¼šè·å–é£é™©æç¤º
function getRiskWarnings(strategyId: string): string[] {
  const warnings: Record<string, string[]> = {
    momentum: [
      'éœ‡è¡å¸‚åœºå¯èƒ½é¢‘ç¹æ­¢æŸ',
      'è¿½é«˜é£é™©ï¼Œéœ€æ³¨æ„å›æ’¤',
      'è½¬åŠ¿æ—¶å¯èƒ½å‡ºç°è¾ƒå¤§äºæŸ',
    ],
    mean_reversion: [
      'è¶‹åŠ¿å¸‚åœºå¯èƒ½æŒç»­ä¸‹è·Œ',
      'å­˜åœ¨ä»·å€¼é™·é˜±é£é™©',
      'éœ€è¦è®¾ç½®ä¸¥æ ¼æ­¢æŸ',
    ],
    complex_indicator: [
      'å‚æ•°è¾ƒå¤šï¼Œéœ€è¦ä¼˜åŒ–è°ƒæ•´',
      'ä¿¡å·æ»åå¯èƒ½å¯¼è‡´å»¶è¿Ÿå…¥åœº',
    ],
    multi_factor: [
      'å› å­å¤±æ•ˆé£é™©',
      'éœ€è¦å®šæœŸè¯„ä¼°å› å­æœ‰æ•ˆæ€§',
    ],
    ml_model: [
      'æ¨¡å‹è¿‡æ‹Ÿåˆé£é™©',
      'å¸‚åœºç¯å¢ƒå˜åŒ–å¯èƒ½å¯¼è‡´æ¨¡å‹å¤±æ•ˆ',
      'éœ€è¦å®šæœŸé‡æ–°è®­ç»ƒ',
    ],
  }

  return warnings[strategyId] || ['è¯·è°¨æ…ä½¿ç”¨ï¼Œæ³¨æ„é£é™©æ§åˆ¶']
}
```

#### ä»»åŠ¡ 2.3ï¼šæ›´æ–°å¯¼èˆªæ 

**æ–‡ä»¶ï¼š** `frontend/src/components/desktop-nav.tsx`

```typescript
// æ·»åŠ æ–°çš„å¯¼èˆªé¡¹
const navItems = [
  { label: 'é¦–é¡µ', href: '/' },
  { label: 'ç­–ç•¥ä¸­å¿ƒ', href: '/strategies' },  // æ–°å¢
  { label: 'ç­–ç•¥å›æµ‹', href: '/backtest' },
  { label: 'æˆ‘çš„å›æµ‹', href: '/my-backtests' },  // æ–°å¢ï¼ˆä¸‹ä¸€é˜¶æ®µï¼‰
  { label: 'AIå®éªŒèˆ±', href: '/ai-lab' },
  { label: 'è‚¡ç¥¨åˆ—è¡¨', href: '/stocks' },
  { label: 'æ•°æ®åŒæ­¥', href: '/sync' },
]
```

---

### 5.3 é˜¶æ®µä¸‰ï¼šæŒä¹…åŒ–å†å²è®°å½•ï¼ˆP2ï¼‰

#### ä»»åŠ¡ 3.1ï¼šåç«¯ API å¼€å‘

**æ–‡ä»¶ï¼š** `backend/app/api/endpoints/backtest_history.py`

```python
from fastapi import APIRouter, Depends, HTTPException, Query
from typing import List, Optional
from datetime import datetime

from ...models.backtest_history import (
    BacktestHistoryCreate,
    BacktestHistoryResponse,
    BacktestHistoryList,
)
from ...services.backtest_history_service import BacktestHistoryService
from ...core.database import get_db

router = APIRouter()


@router.post("/save", response_model=BacktestHistoryResponse)
async def save_backtest_result(
    data: BacktestHistoryCreate,
    db=Depends(get_db),
):
    """
    ä¿å­˜å›æµ‹ç»“æœåˆ°æ•°æ®åº“

    å‚æ•°:
        - strategy_id: ç­–ç•¥ID
        - strategy_name: ç­–ç•¥åç§°
        - config: å›æµ‹é…ç½®ï¼ˆJSONï¼‰
        - result: å›æµ‹ç»“æœï¼ˆJSONï¼‰
        - user_id: ç”¨æˆ·IDï¼ˆå¯é€‰ï¼Œå½“å‰ç‰ˆæœ¬å¯çœç•¥ï¼‰
    """
    service = BacktestHistoryService(db)
    return await service.save_result(data)


@router.get("/list", response_model=BacktestHistoryList)
async def get_backtest_history(
    page: int = Query(1, ge=1),
    limit: int = Query(20, ge=1, le=100),
    strategy_id: Optional[str] = None,
    symbol: Optional[str] = None,
    sort_by: str = Query("created_at", regex="^(created_at|total_return|sharpe_ratio)$"),
    sort_order: str = Query("desc", regex="^(asc|desc)$"),
    db=Depends(get_db),
):
    """
    è·å–å›æµ‹å†å²è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰

    å‚æ•°:
        - page: é¡µç 
        - limit: æ¯é¡µæ•°é‡
        - strategy_id: ç­–ç•¥IDç­›é€‰ï¼ˆå¯é€‰ï¼‰
        - symbol: è‚¡ç¥¨ä»£ç ç­›é€‰ï¼ˆå¯é€‰ï¼‰
        - sort_by: æ’åºå­—æ®µ
        - sort_order: æ’åºæ–¹å‘
    """
    service = BacktestHistoryService(db)
    return await service.get_history(
        page=page,
        limit=limit,
        strategy_id=strategy_id,
        symbol=symbol,
        sort_by=sort_by,
        sort_order=sort_order,
    )


@router.get("/{history_id}", response_model=BacktestHistoryResponse)
async def get_backtest_detail(
    history_id: int,
    db=Depends(get_db),
):
    """è·å–å•æ¡å›æµ‹è®°å½•è¯¦æƒ…"""
    service = BacktestHistoryService(db)
    result = await service.get_by_id(history_id)

    if not result:
        raise HTTPException(status_code=404, detail="å›æµ‹è®°å½•ä¸å­˜åœ¨")

    return result


@router.delete("/{history_id}")
async def delete_backtest_result(
    history_id: int,
    db=Depends(get_db),
):
    """åˆ é™¤å›æµ‹è®°å½•"""
    service = BacktestHistoryService(db)
    success = await service.delete_result(history_id)

    if not success:
        raise HTTPException(status_code=404, detail="å›æµ‹è®°å½•ä¸å­˜åœ¨")

    return {"message": "åˆ é™¤æˆåŠŸ"}
```

**æ•°æ®åº“è¿ç§»è„šæœ¬ï¼š**

```sql
-- migrations/001_create_backtest_history_table.sql

CREATE TABLE IF NOT EXISTS backtest_history (
    id SERIAL PRIMARY KEY,
    strategy_id VARCHAR(50) NOT NULL,
    strategy_name VARCHAR(100) NOT NULL,
    symbol VARCHAR(20),
    symbols TEXT[],  -- å¤šè‚¡ç¥¨æ•°ç»„
    config JSONB NOT NULL,  -- å›æµ‹é…ç½®
    result JSONB NOT NULL,  -- å®Œæ•´å›æµ‹ç»“æœ

    -- æ€§èƒ½æŒ‡æ ‡ï¼ˆæ–¹ä¾¿æŸ¥è¯¢æ’åºï¼‰
    total_return DECIMAL(10, 4),
    annualized_return DECIMAL(10, 4),
    sharpe_ratio DECIMAL(10, 4),
    max_drawdown DECIMAL(10, 4),

    -- å…ƒæ•°æ®
    user_id INTEGER,  -- ç”¨æˆ·IDï¼ˆé¢„ç•™ï¼‰
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    -- ç´¢å¼•
    INDEX idx_strategy_id (strategy_id),
    INDEX idx_symbol (symbol),
    INDEX idx_created_at (created_at DESC),
    INDEX idx_total_return (total_return DESC)
);

-- è§¦å‘å™¨ï¼šè‡ªåŠ¨æ›´æ–° updated_at
CREATE TRIGGER update_backtest_history_updated_at
    BEFORE UPDATE ON backtest_history
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();
```

#### ä»»åŠ¡ 3.2ï¼šå‰ç«¯é›†æˆ

**æ–‡ä»¶ï¼š** `frontend/src/app/my-backtests/page.tsx`

```typescript
'use client'

import { useEffect, useState } from 'react'
import { useRouter } from 'next/navigation'
import { apiClient } from '@/lib/api-client'
import { Card, CardContent, CardHeader } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Input } from '@/components/ui/input'
import { Select } from '@/components/ui/select'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { formatDate, formatPercent } from '@/lib/utils'

interface BacktestHistory {
  id: number
  strategy_id: string
  strategy_name: string
  symbol?: string
  symbols?: string[]
  total_return: number
  sharpe_ratio: number
  max_drawdown: number
  created_at: string
}

export default function MyBacktestsPage() {
  const router = useRouter()
  const [history, setHistory] = useState<BacktestHistory[]>([])
  const [loading, setLoading] = useState(true)
  const [page, setPage] = useState(1)
  const [total, setTotal] = useState(0)
  const [filters, setFilters] = useState({
    strategy_id: '',
    symbol: '',
    sort_by: 'created_at',
    sort_order: 'desc',
  })

  // åŠ è½½å†å²è®°å½•
  useEffect(() => {
    const fetchHistory = async () => {
      try {
        setLoading(true)
        const response = await apiClient.getBacktestHistory({
          page,
          limit: 20,
          ...filters,
        })
        setHistory(response.data.items)
        setTotal(response.data.total)
      } catch (error) {
        console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error)
      } finally {
        setLoading(false)
      }
    }

    fetchHistory()
  }, [page, filters])

  const handleViewDetail = (id: number) => {
    router.push(`/my-backtests/${id}`)
  }

  const handleRerun = (item: BacktestHistory) => {
    // è·³è½¬åˆ°å›æµ‹é¡µé¢ï¼Œé¢„å¡«é…ç½®
    const config = {
      strategyId: item.strategy_id,
      symbols: item.symbol || item.symbols?.join(',') || '',
      // å…¶ä»–é…ç½®ä» result ä¸­æå–...
    }
    router.push(`/backtest?config=${encodeURIComponent(JSON.stringify(config))}`)
  }

  const handleDelete = async (id: number) => {
    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return

    try {
      await apiClient.deleteBacktestResult(id)
      // é‡æ–°åŠ è½½åˆ—è¡¨
      setHistory(history.filter((item) => item.id !== id))
    } catch (error) {
      console.error('åˆ é™¤å¤±è´¥:', error)
    }
  }

  return (
    <div className="container mx-auto py-8 px-4">
      {/* é¡µé¢æ ‡é¢˜ */}
      <div className="flex justify-between items-center mb-8">
        <div>
          <h1 className="text-3xl font-bold mb-2">æˆ‘çš„å›æµ‹</h1>
          <p className="text-muted-foreground">æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„å†å²å›æµ‹è®°å½•</p>
        </div>
        <Button onClick={() => router.push('/backtest')}>æ–°å»ºå›æµ‹</Button>
      </div>

      {/* ç­›é€‰å™¨ */}
      <Card className="mb-6">
        <CardContent className="pt-6">
          <div className="flex gap-4">
            <Input
              placeholder="è‚¡ç¥¨ä»£ç ..."
              value={filters.symbol}
              onChange={(e) => setFilters({ ...filters, symbol: e.target.value })}
              className="max-w-xs"
            />
            <Select
              value={filters.strategy_id}
              onValueChange={(value) => setFilters({ ...filters, strategy_id: value })}
            >
              <option value="">å…¨éƒ¨ç­–ï¿½ï¿½</option>
              <option value="complex_indicator">å¤åˆæŒ‡æ ‡</option>
              <option value="momentum">åŠ¨é‡ç­–ç•¥</option>
              <option value="mean_reversion">å‡å€¼å›å½’</option>
              <option value="multi_factor">å¤šå› å­</option>
              <option value="ml_model">MLæ¨¡å‹</option>
            </Select>
            <Select
              value={filters.sort_by}
              onValueChange={(value) => setFilters({ ...filters, sort_by: value })}
            >
              <option value="created_at">åˆ›å»ºæ—¶é—´</option>
              <option value="total_return">æ€»æ”¶ç›Šç‡</option>
              <option value="sharpe_ratio">å¤æ™®æ¯”ç‡</option>
            </Select>
          </div>
        </CardContent>
      </Card>

      {/* å†å²è®°å½•è¡¨æ ¼ */}
      <Card>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>ç­–ç•¥åç§°</TableHead>
              <TableHead>è‚¡ç¥¨ä»£ç </TableHead>
              <TableHead>æ€»æ”¶ç›Šç‡</TableHead>
              <TableHead>å¤æ™®æ¯”ç‡</TableHead>
              <TableHead>æœ€å¤§å›æ’¤</TableHead>
              <TableHead>åˆ›å»ºæ—¶é—´</TableHead>
              <TableHead>æ“ä½œ</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {history.map((item) => (
              <TableRow key={item.id}>
                <TableCell>{item.strategy_name}</TableCell>
                <TableCell>
                  {item.symbol || (
                    <Badge variant="secondary">
                      {item.symbols?.length || 0} åªè‚¡ç¥¨
                    </Badge>
                  )}
                </TableCell>
                <TableCell>
                  <span
                    className={
                      item.total_return > 0 ? 'text-green-600' : 'text-red-600'
                    }
                  >
                    {formatPercent(item.total_return)}
                  </span>
                </TableCell>
                <TableCell>{item.sharpe_ratio.toFixed(2)}</TableCell>
                <TableCell className="text-red-600">
                  {formatPercent(item.max_drawdown)}
                </TableCell>
                <TableCell>{formatDate(item.created_at)}</TableCell>
                <TableCell>
                  <div className="flex gap-2">
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleViewDetail(item.id)}
                    >
                      æŸ¥çœ‹
                    </Button>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleRerun(item)}
                    >
                      å†æ¬¡è¿è¡Œ
                    </Button>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleDelete(item.id)}
                      className="text-red-600"
                    >
                      åˆ é™¤
                    </Button>
                  </div>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>

        {/* åˆ†é¡µ */}
        {total > 20 && (
          <div className="flex justify-center gap-2 p-4">
            <Button
              variant="outline"
              disabled={page === 1}
              onClick={() => setPage(page - 1)}
            >
              ä¸Šä¸€é¡µ
            </Button>
            <span className="px-4 py-2">
              ç¬¬ {page} é¡µï¼Œå…± {Math.ceil(total / 20)} é¡µ
            </span>
            <Button
              variant="outline"
              disabled={page >= Math.ceil(total / 20)}
              onClick={() => setPage(page + 1)}
            >
              ä¸‹ä¸€é¡µ
            </Button>
          </div>
        )}
      </Card>

      {/* ç©ºçŠ¶æ€ */}
      {history.length === 0 && !loading && (
        <div className="text-center py-12">
          <p className="text-muted-foreground mb-4">æš‚æ— å›æµ‹è®°å½•</p>
          <Button onClick={() => router.push('/backtest')}>åˆ›å»ºç¬¬ä¸€ä¸ªå›æµ‹</Button>
        </div>
      )}
    </div>
  )
}
```

**æ›´æ–°å›æµ‹é¡µé¢ä¿å­˜é€»è¾‘ï¼š**

```typescript
// frontend/src/app/backtest/page.tsx

const handleBacktestComplete = async (result: any) => {
  setBacktestResult(result)

  // ä¿å­˜åˆ°æ•°æ®åº“
  try {
    await apiClient.saveBacktestResult({
      strategy_id: selectedStrategyId,
      strategy_name: result.strategy_name,
      symbol: result.symbol,
      symbols: result.symbols,
      config: {
        start_date: startDate,
        end_date: endDate,
        initial_capital: initialCash,
        strategy_params: strategyParams,
      },
      result: result,
      total_return: result.metrics.total_return,
      annualized_return: result.metrics.annualized_return,
      sharpe_ratio: result.metrics.sharpe_ratio,
      max_drawdown: result.metrics.max_drawdown,
    })

    toast({
      title: 'å›æµ‹å®Œæˆ',
      description: 'ç»“æœå·²ä¿å­˜åˆ°å†å²è®°å½•',
    })
  } catch (error) {
    console.error('ä¿å­˜å›æµ‹ç»“æœå¤±è´¥:', error)
  }
}
```

---

### 5.4 é˜¶æ®µå››ï¼šAI ç­–ç•¥ç”Ÿæˆå™¨ï¼ˆP1 - æ ¸å¿ƒåˆ›æ–°åŠŸèƒ½ï¼‰ğŸš€

#### æ¦‚è¿°

å…è®¸ç”¨æˆ·é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°äº¤æ˜“ç­–ç•¥ï¼ŒAI è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ Python ç­–ç•¥ä»£ç ã€‚è¿™æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒåˆ›æ–°åŠŸèƒ½ï¼Œæå¤§é™ä½ç­–ç•¥åˆ›å»ºé—¨æ§›ã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- é›¶ä»£ç é—¨æ§›ï¼šæ™®é€šç”¨æˆ·ä¹Ÿèƒ½åˆ›å»ºç­–ç•¥
- ç§’çº§ç”Ÿæˆï¼šè‡ªç„¶è¯­è¨€ â†’ å¯è¿è¡Œä»£ç 
- çµæ´»å¼ºå¤§ï¼šä¸å—é¢„å®šä¹‰è§„åˆ™é™åˆ¶
- æˆæœ¬æä½ï¼šÂ¥0.05-0.10/æ¬¡ç”Ÿæˆ

---

#### ä»»åŠ¡ 4.1ï¼šAI ç­–ç•¥ç”ŸæˆæœåŠ¡ï¼ˆåç«¯ï¼‰

**ç›®æ ‡ï¼š** é›†æˆ DeepSeek APIï¼Œå®ç°è‡ªç„¶è¯­è¨€åˆ°ç­–ç•¥ä»£ç çš„è½¬æ¢

##### 4.1.1 æ ¸å¿ƒæ¶æ„

```python
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           User Input (è‡ªç„¶è¯­è¨€)                â”‚
â”‚   "äº”æ—¥å¹³å‡çº¿ä¸Šç©¿20æ—¥å¹³å‡çº¿ä¹°å…¥"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AI Strategy Generator Service          â”‚
â”‚  - Prompt å·¥ç¨‹                                â”‚
â”‚  - DeepSeek API è°ƒç”¨                          â”‚
â”‚  - ä»£ç æå–å’Œæ¸…æ´—                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Strategy Code Validator               â”‚
â”‚  - AST è¯­æ³•æ£€æŸ¥                               â”‚
â”‚  - å®‰å…¨æ€§æ£€æŸ¥ï¼ˆç¦æ­¢å±é™©æ¨¡å—ï¼‰                  â”‚
â”‚  - ç»“æ„éªŒè¯ï¼ˆç»§æ‰¿BaseStrategyï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Strategy Sandbox Runner              â”‚
â”‚  - ä½¿ç”¨æµ‹è¯•æ•°æ®è¿è¡Œç­–ç•¥                        â”‚
â”‚  - éªŒè¯ä¿¡å·ç”Ÿæˆæ­£ç¡®æ€§                          â”‚
â”‚  - æ€§èƒ½å’Œèµ„æºç›‘æ§                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Dynamic Strategy Loader                 â”‚
â”‚  - åŠ¨æ€åŠ è½½ç­–ç•¥ç±»                             â”‚
â”‚  - æ³¨å†Œåˆ° StrategyManager                     â”‚
â”‚  - æŒä¹…åŒ–åˆ°æ•°æ®åº“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### 4.1.2 Prompt è®¾è®¡ï¼ˆå…³é”®ï¼‰

**æ–‡ä»¶ï¼š** `backend/app/services/prompts/strategy_generation.py`

```python
STRATEGY_GENERATION_PROMPT = """
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é‡åŒ–äº¤æ˜“ç­–ç•¥ä»£ç ç”ŸæˆåŠ©æ‰‹ã€‚

ç”¨æˆ·æè¿°: {user_description}

è¯·ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ Python ç­–ç•¥ç±»ï¼Œä¸¥æ ¼éµå¾ªä»¥ä¸‹è¦æ±‚ï¼š

## 1. åŸºç±»ç»§æ‰¿

å¿…é¡»ç»§æ‰¿ BaseStrategy å¹¶å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼š

```python
from abc import ABC, abstractmethod
from typing import List, Dict, Any
import pandas as pd

class BaseStrategy(ABC):
    def __init__(self, params: Dict[str, Any] = None):
        self.params = params or {{}}

    @property
    @abstractmethod
    def name(self) -> str:
        \"\"\"ç­–ç•¥åç§°\"\"\"
        pass

    @property
    @abstractmethod
    def description(self) -> str:
        \"\"\"ç­–ç•¥æè¿°\"\"\"
        pass

    @property
    @abstractmethod
    def version(self) -> str:
        \"\"\"ç‰ˆæœ¬å·\"\"\"
        pass

    @classmethod
    @abstractmethod
    def get_parameters(cls) -> List[StrategyParameter]:
        \"\"\"è¿”å›ç­–ç•¥å‚æ•°å®šä¹‰\"\"\"
        pass

    @abstractmethod
    def generate_signals(self, data: pd.DataFrame) -> pd.Series:
        \"\"\"
        ç”Ÿæˆäº¤æ˜“ä¿¡å·

        å‚æ•°:
            data: OHLCVæ•°æ®ï¼ŒåŒ…å«åˆ— [open, high, low, close, volume]

        è¿”å›:
            ä¿¡å·åºåˆ—: 1=ä¹°å…¥, -1=å–å‡º, 0=æŒæœ‰
        \"\"\"
        pass
```

## 2. å‚æ•°å®šä¹‰

ä½¿ç”¨ StrategyParameter å®šä¹‰æ‰€æœ‰å¯é…ç½®å‚æ•°ï¼š

```python
from dataclasses import dataclass
from enum import Enum

class ParameterType(str, Enum):
    INTEGER = "integer"
    FLOAT = "float"
    BOOLEAN = "boolean"
    SELECT = "select"

@dataclass
class StrategyParameter:
    name: str
    label: str
    type: ParameterType
    default: Any
    min_value: Optional[float] = None
    max_value: Optional[float] = None
    step: Optional[float] = None
    description: str = ""
    category: str = "general"
```

## 3. å¯ç”¨çš„æŠ€æœ¯æŒ‡æ ‡

ä½ å¯ä»¥ä½¿ç”¨ pandas å’Œ numpy è®¡ç®—å¸¸è§æŠ€æœ¯æŒ‡æ ‡ï¼š

- **ç§»åŠ¨å¹³å‡**: `data['close'].rolling(window=N).mean()`
- **RSI**: ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡
- **MACD**: æŒ‡æ•°å¹³æ»‘å¼‚åŒç§»åŠ¨å¹³å‡çº¿
- **å¸ƒæ—å¸¦**: æ ‡å‡†å·®é€šé“
- **æˆäº¤é‡**: `data['volume']`

## 4. å®‰å…¨çº¦æŸï¼ˆä¸¥æ ¼éµå®ˆï¼‰

ç¦æ­¢ä½¿ç”¨ä»¥ä¸‹æ¨¡å—å’Œå‡½æ•°ï¼š
- âŒ os, subprocess, sys
- âŒ eval, exec, compile
- âŒ open, file, __import__
- âŒ socket, urllib, requests, httpx
- âŒ pickle, shelve, marshal

åªå…è®¸ä½¿ç”¨ï¼š
- âœ… pandas, numpy
- âœ… typing, abc, dataclasses, enum
- âœ… datetime, math

## 5. ä»£ç è´¨é‡è¦æ±‚

- æ¸…æ™°çš„æ³¨é‡Š
- éµå¾ª PEP 8 è§„èŒƒ
- åˆç†çš„å‚æ•°é»˜è®¤å€¼
- å®Œæ•´çš„å‚æ•°éªŒè¯

## 6. è¾“å‡ºæ ¼å¼

åªè¿”å› Python ä»£ç ï¼Œç”¨ ```python å’Œ ``` åŒ…è£¹ï¼Œä¸è¦ä»»ä½•å…¶ä»–è§£é‡Šã€‚

## ç¤ºä¾‹è¾“å‡º

```python
from typing import List, Dict, Any
import pandas as pd
import numpy as np
from app.strategies.base_strategy import BaseStrategy, StrategyParameter, ParameterType

class AIGeneratedStrategy(BaseStrategy):
    \"\"\"AIç”Ÿæˆç­–ç•¥ - äº”æ—¥å‡çº¿ä¸Šç©¿äºŒåæ—¥å‡çº¿\"\"\"

    @property
    def name(self) -> str:
        return "äº”æ—¥å‡çº¿ä¸Šç©¿äºŒåæ—¥å‡çº¿ç­–ç•¥"

    @property
    def description(self) -> str:
        return "å½“5æ—¥ç§»åŠ¨å¹³å‡çº¿ä»ä¸‹æ–¹ä¸Šç©¿20æ—¥ç§»åŠ¨å¹³å‡çº¿æ—¶ä¹°å…¥ï¼Œä¸‹ç©¿æ—¶å–å‡º"

    @property
    def version(self) -> str:
        return "1.0.0"

    @classmethod
    def get_parameters(cls) -> List[StrategyParameter]:
        return [
            StrategyParameter(
                name="short_period",
                label="çŸ­æœŸå‡çº¿å‘¨æœŸ",
                type=ParameterType.INTEGER,
                default=5,
                min_value=2,
                max_value=50,
                step=1,
                description="çŸ­æœŸç§»åŠ¨å¹³å‡çº¿å‘¨æœŸï¼ˆå¤©ï¼‰",
                category="æ ¸å¿ƒå‚æ•°"
            ),
            StrategyParameter(
                name="long_period",
                label="é•¿æœŸå‡çº¿å‘¨æœŸ",
                type=ParameterType.INTEGER,
                default=20,
                min_value=10,
                max_value=200,
                step=5,
                description="é•¿æœŸç§»åŠ¨å¹³å‡çº¿å‘¨æœŸï¼ˆå¤©ï¼‰",
                category="æ ¸å¿ƒå‚æ•°"
            )
        ]

    def generate_signals(self, data: pd.DataFrame) -> pd.Series:
        \"\"\"ç”Ÿæˆäº¤æ˜“ä¿¡å·\"\"\"
        # è·å–å‚æ•°
        short_period = self.params.get("short_period", 5)
        long_period = self.params.get("long_period", 20)

        # è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        ma_short = data['close'].rolling(window=short_period).mean()
        ma_long = data['close'].rolling(window=long_period).mean()

        # åˆå§‹åŒ–ä¿¡å·åºåˆ—
        signals = pd.Series(0, index=data.index)

        # é‡‘å‰ï¼šçŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿ -> ä¹°å…¥ä¿¡å·
        golden_cross = (ma_short > ma_long) & (ma_short.shift(1) <= ma_long.shift(1))
        signals[golden_cross] = 1

        # æ­»å‰ï¼šçŸ­æœŸå‡çº¿ä¸‹ç©¿é•¿æœŸå‡çº¿ -> å–å‡ºä¿¡å·
        death_cross = (ma_short < ma_long) & (ma_short.shift(1) >= ma_long.shift(1))
        signals[death_cross] = -1

        return signals
```

ç°åœ¨ï¼Œè¯·æ ¹æ®ç”¨æˆ·æè¿°ç”Ÿæˆç­–ç•¥ä»£ç ï¼š
"""
```

##### 4.1.3 AI ç”ŸæˆæœåŠ¡å®ç°

**æ–‡ä»¶ï¼š** `backend/app/services/ai_strategy_generator.py`

```python
import re
from typing import Dict, Any, Optional
import httpx
from loguru import logger

from app.core.config import settings
from .prompts.strategy_generation import STRATEGY_GENERATION_PROMPT


class AIStrategyGenerator:
    """AI ç­–ç•¥ä»£ç ç”Ÿæˆå™¨"""

    def __init__(self):
        self.api_key = settings.DEEPSEEK_API_KEY
        self.api_url = settings.DEEPSEEK_API_URL or "https://api.deepseek.com/v1/chat/completions"
        self.model = settings.DEEPSEEK_MODEL or "deepseek-coder"

    async def generate_strategy_code(
        self,
        user_description: str,
        user_id: Optional[int] = None
    ) -> Dict[str, Any]:
        """
        ä»è‡ªç„¶è¯­è¨€æè¿°ç”Ÿæˆç­–ç•¥ä»£ç 

        å‚æ•°:
            user_description: ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æè¿°
            user_id: ç”¨æˆ·IDï¼ˆç”¨äºæ—¥å¿—å’Œç›‘æ§ï¼‰

        è¿”å›:
            {
                "code": "ç”Ÿæˆçš„ç­–ç•¥ä»£ç ",
                "class_name": "AIGeneratedStrategy",
                "tokens_used": 1234,
                "raw_response": "åŸå§‹AIå“åº”"
            }
        """
        try:
            logger.info(f"[User {user_id}] å¼€å§‹ç”Ÿæˆç­–ç•¥ï¼Œæè¿°: {user_description}")

            # æ„å»º prompt
            prompt = STRATEGY_GENERATION_PROMPT.format(
                user_description=user_description
            )

            # è°ƒç”¨ DeepSeek API
            async with httpx.AsyncClient(timeout=30.0) as client:
                response = await client.post(
                    self.api_url,
                    headers={
                        "Authorization": f"Bearer {self.api_key}",
                        "Content-Type": "application/json"
                    },
                    json={
                        "model": self.model,
                        "messages": [
                            {
                                "role": "system",
                                "content": "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é‡åŒ–äº¤æ˜“ç­–ç•¥ä»£ç ç”Ÿæˆä¸“å®¶ã€‚"
                            },
                            {
                                "role": "user",
                                "content": prompt
                            }
                        ],
                        "temperature": 0.2,  # ä½éšæœºæ€§ï¼Œæé«˜ä»£ç è´¨é‡
                        "max_tokens": 2500,
                        "stream": False
                    }
                )

            if response.status_code != 200:
                logger.error(f"DeepSeek API é”™è¯¯: {response.status_code} {response.text}")
                raise Exception(f"AI API è°ƒç”¨å¤±è´¥: {response.status_code}")

            result = response.json()

            # æå–ç”Ÿæˆçš„ä»£ç 
            generated_text = result["choices"][0]["message"]["content"]
            code = self._extract_code_block(generated_text)

            # æå–ç±»å
            class_name = self._extract_class_name(code)

            tokens_used = result.get("usage", {}).get("total_tokens", 0)

            logger.info(
                f"[User {user_id}] ç­–ç•¥ä»£ç ç”ŸæˆæˆåŠŸ - "
                f"ç±»å: {class_name}, Tokens: {tokens_used}"
            )

            return {
                "code": code,
                "class_name": class_name,
                "tokens_used": tokens_used,
                "raw_response": generated_text
            }

        except Exception as e:
            logger.error(f"[User {user_id}] AI ç­–ç•¥ç”Ÿæˆå¤±è´¥: {e}")
            raise

    def _extract_code_block(self, text: str) -> str:
        """ä» AI å“åº”ä¸­æå–ä»£ç å—"""
        # åŒ¹é… ```python ... ```
        pattern = r"```(?:python)?\s*(.*?)```"
        matches = re.findall(pattern, text, re.DOTALL)

        if matches:
            return matches[0].strip()

        # å¦‚æœæ²¡æœ‰ä»£ç å—æ ‡è®°ï¼Œè¿”å›åŸæ–‡
        logger.warning("æœªæ‰¾åˆ°ä»£ç å—æ ‡è®°ï¼Œè¿”å›åŸæ–‡")
        return text.strip()

    def _extract_class_name(self, code: str) -> str:
        """æå–ç­–ç•¥ç±»å"""
        pattern = r"class\s+(\w+)\s*\("
        match = re.search(pattern, code)

        if match:
            return match.group(1)

        raise ValueError("æ— æ³•ä»ä»£ç ä¸­æå–ç±»å")


# å…¨å±€å•ä¾‹
ai_strategy_generator = AIStrategyGenerator()
```

##### 4.1.4 ä»£ç éªŒè¯å™¨

**æ–‡ä»¶ï¼š** `backend/app/services/strategy_validator.py`

```python
import ast
import re
from typing import Dict, Any, List
from loguru import logger


class StrategyCodeValidator:
    """ç­–ç•¥ä»£ç å®‰å…¨éªŒè¯å™¨"""

    # å±é™©æ¨¡å—é»‘åå•
    DANGEROUS_MODULES = {
        'os', 'subprocess', 'sys', 'eval', 'exec', 'compile',
        'open', 'file', '__import__', 'importlib',
        'socket', 'urllib', 'requests', 'httpx',
        'pickle', 'shelve', 'marshal', 'ctypes'
    }

    # å…è®¸çš„æ¨¡å—ç™½åå•
    ALLOWED_MODULES = {
        'pandas', 'numpy', 'typing', 'abc', 'dataclasses',
        'enum', 'datetime', 'math', 'statistics'
    }

    def validate_code(self, code: str, class_name: str) -> Dict[str, Any]:
        """
        å…¨é¢éªŒè¯ç­–ç•¥ä»£ç 

        è¿”å›:
            {
                "valid": True/False,
                "errors": [],
                "warnings": [],
                "metadata": {}
            }
        """
        errors = []
        warnings = []

        try:
            # 1. è¯­æ³•æ£€æŸ¥
            syntax_errors = self._check_syntax(code)
            errors.extend(syntax_errors)

            if errors:
                return {
                    "valid": False,
                    "errors": errors,
                    "warnings": warnings
                }

            # 2. å®‰å…¨æ£€æŸ¥
            security_errors = self._check_security(code)
            errors.extend(security_errors)

            # 3. ç»“æ„éªŒè¯
            structure_errors = self._check_structure(code, class_name)
            errors.extend(structure_errors)

            # 4. æå–å…ƒæ•°æ®
            metadata = self._extract_metadata(code, class_name)

            valid = len(errors) == 0

            logger.info(
                f"ä»£ç éªŒè¯å®Œæˆ - æœ‰æ•ˆ: {valid}, "
                f"é”™è¯¯: {len(errors)}, è­¦å‘Š: {len(warnings)}"
            )

            return {
                "valid": valid,
                "errors": errors,
                "warnings": warnings,
                "metadata": metadata
            }

        except Exception as e:
            logger.error(f"ä»£ç éªŒè¯å¼‚å¸¸: {e}")
            return {
                "valid": False,
                "errors": [f"éªŒè¯è¿‡ç¨‹å‡ºé”™: {str(e)}"],
                "warnings": warnings
            }

    def _check_syntax(self, code: str) -> List[str]:
        """æ£€æŸ¥ Python è¯­æ³•"""
        errors = []
        try:
            ast.parse(code)
        except SyntaxError as e:
            errors.append(f"è¯­æ³•é”™è¯¯ (ç¬¬{e.lineno}è¡Œ): {e.msg}")
        return errors

    def _check_security(self, code: str) -> List[str]:
        """å®‰å…¨æ€§æ£€æŸ¥"""
        errors = []

        # æ£€æŸ¥å±é™©æ¨¡å—å¯¼å…¥
        for module in self.DANGEROUS_MODULES:
            if re.search(rf'\bimport\s+{module}\b', code):
                errors.append(f"ç¦æ­¢å¯¼å…¥å±é™©æ¨¡å—: {module}")
            if re.search(rf'\bfrom\s+{module}\s+import\b', code):
                errors.append(f"ç¦æ­¢ä»å±é™©æ¨¡å—å¯¼å…¥: {module}")

        # æ£€æŸ¥å±é™©å‡½æ•°è°ƒç”¨
        dangerous_patterns = [
            (r'\beval\s*\(', 'eval'),
            (r'\bexec\s*\(', 'exec'),
            (r'\bcompile\s*\(', 'compile'),
            (r'\b__import__\s*\(', '__import__'),
            (r'\bopen\s*\(', 'open'),
        ]

        for pattern, func_name in dangerous_patterns:
            if re.search(pattern, code):
                errors.append(f"ç¦æ­¢ä½¿ç”¨å±é™©å‡½æ•°: {func_name}")

        return errors

    def _check_structure(self, code: str, expected_class_name: str) -> List[str]:
        """æ£€æŸ¥ä»£ç ç»“æ„"""
        errors = []

        tree = ast.parse(code)

        # æŸ¥æ‰¾ç±»å®šä¹‰
        class_def = None
        for node in ast.walk(tree):
            if isinstance(node, ast.ClassDef) and node.name == expected_class_name:
                class_def = node
                break

        if not class_def:
            errors.append(f"æœªæ‰¾åˆ°ç±»å®šä¹‰: {expected_class_name}")
            return errors

        # æ£€æŸ¥ç»§æ‰¿
        inherits_base = any(
            isinstance(base, ast.Name) and base.id == "BaseStrategy"
            for base in class_def.bases
        )

        if not inherits_base:
            errors.append("ç­–ç•¥ç±»å¿…é¡»ç»§æ‰¿ BaseStrategy")

        # æ£€æŸ¥å¿…éœ€æ–¹æ³•
        required_methods = {
            'name', 'description', 'version',
            'get_parameters', 'generate_signals'
        }

        existing_methods = {
            node.name for node in class_def.body
            if isinstance(node, (ast.FunctionDef, ast.AsyncFunctionDef))
        }

        missing_methods = required_methods - existing_methods

        if missing_methods:
            errors.append(f"ç¼ºå°‘å¿…éœ€æ–¹æ³•: {', '.join(missing_methods)}")

        return errors

    def _extract_metadata(self, code: str, class_name: str) -> Dict[str, Any]:
        """æå–ç­–ç•¥å…ƒæ•°æ®"""
        tree = ast.parse(code)

        imports = []
        for node in ast.walk(tree):
            if isinstance(node, ast.Import):
                for alias in node.names:
                    imports.append(alias.name)
            elif isinstance(node, ast.ImportFrom):
                if node.module:
                    imports.append(node.module)

        return {
            "class_name": class_name,
            "imports": imports,
            "line_count": len(code.split('\n'))
        }


# å…¨å±€å•ä¾‹
strategy_validator = StrategyCodeValidator()
```

##### 4.1.5 æ²™ç®±æµ‹è¯•ç¯å¢ƒ

**æ–‡ä»¶ï¼š** `backend/app/services/strategy_sandbox.py`

```python
import pandas as pd
import numpy as np
import time
from typing import Dict, Any
from loguru import logger


class StrategySandbox:
    """ç­–ç•¥æ²™ç®±æµ‹è¯•ç¯å¢ƒ"""

    def test_strategy(
        self,
        code: str,
        class_name: str,
        timeout: int = 5
    ) -> Dict[str, Any]:
        """
        åœ¨æ²™ç®±ä¸­æµ‹è¯•ç­–ç•¥

        å‚æ•°:
            code: ç­–ç•¥ä»£ç 
            class_name: ç­–ç•¥ç±»å
            timeout: è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰

        è¿”å›:
            {
                "success": True/False,
                "error": None or error message,
                "test_results": {...}
            }
        """
        try:
            logger.info(f"å¼€å§‹æ²™ç®±æµ‹è¯•: {class_name}")

            # 1. åˆ›å»ºæµ‹è¯•æ•°æ®
            test_data = self._create_test_data()

            # 2. åŠ¨æ€åŠ è½½ç­–ç•¥
            strategy_instance = self._load_strategy(code, class_name)

            # 3. æµ‹è¯•ä¿¡å·ç”Ÿæˆ
            start_time = time.time()

            signals = strategy_instance.generate_signals(test_data)

            execution_time = time.time() - start_time

            # 4. éªŒè¯ç»“æœ
            if not isinstance(signals, pd.Series):
                return {
                    "success": False,
                    "error": "generate_signals å¿…é¡»è¿”å› pd.Series ç±»å‹"
                }

            if len(signals) != len(test_data):
                return {
                    "success": False,
                    "error": f"ä¿¡å·é•¿åº¦ä¸åŒ¹é…: æœŸæœ› {len(test_data)}, å®é™… {len(signals)}"
                }

            # 5. ç»Ÿè®¡ä¿¡å·
            buy_count = int((signals == 1).sum())
            sell_count = int((signals == -1).sum())
            hold_count = int((signals == 0).sum())

            logger.info(
                f"æ²™ç®±æµ‹è¯•æˆåŠŸ - ä¹°å…¥: {buy_count}, "
                f"å–å‡º: {sell_count}, æŒæœ‰: {hold_count}"
            )

            return {
                "success": True,
                "error": None,
                "test_results": {
                    "total_signals": len(signals),
                    "buy_signals": buy_count,
                    "sell_signals": sell_count,
                    "hold_signals": hold_count,
                    "execution_time_ms": round(execution_time * 1000, 2),
                    "signal_ratio": round(buy_count / len(signals), 4) if len(signals) > 0 else 0
                }
            }

        except Exception as e:
            logger.error(f"æ²™ç®±æµ‹è¯•å¤±è´¥: {e}")
            return {
                "success": False,
                "error": str(e),
                "test_results": None
            }

    def _create_test_data(self, days: int = 100) -> pd.DataFrame:
        """åˆ›å»ºæ¨¡æ‹Ÿæµ‹è¯•æ•°æ®"""
        dates = pd.date_range('2024-01-01', periods=days, freq='D')

        # ç”Ÿæˆæ¨¡æ‹Ÿä»·æ ¼ï¼ˆéšæœºæ¸¸èµ°ï¼‰
        np.random.seed(42)
        returns = np.random.randn(days) * 0.02
        close_prices = 100 * np.exp(np.cumsum(returns))

        data = pd.DataFrame({
            'open': close_prices * (1 + np.random.randn(days) * 0.005),
            'high': close_prices * (1 + np.abs(np.random.randn(days)) * 0.015),
            'low': close_prices * (1 - np.abs(np.random.randn(days)) * 0.015),
            'close': close_prices,
            'volume': np.random.randint(1000000, 10000000, days)
        }, index=dates)

        return data

    def _load_strategy(self, code: str, class_name: str):
        """åŠ¨æ€åŠ è½½ç­–ç•¥ç±»"""
        # åˆ›å»ºç‹¬ç«‹å‘½åç©ºé—´
        namespace = {}

        # å¯¼å…¥å¿…è¦æ¨¡å—
        exec("import pandas as pd", namespace)
        exec("import numpy as np", namespace)
        exec("from typing import List, Dict, Any, Optional", namespace)
        exec("from app.strategies.base_strategy import BaseStrategy, StrategyParameter, ParameterType", namespace)

        # æ‰§è¡Œç­–ç•¥ä»£ç 
        exec(code, namespace)

        # è·å–ç­–ç•¥ç±»
        strategy_class = namespace[class_name]

        # å®ä¾‹åŒ–ï¼ˆä½¿ç”¨é»˜è®¤å‚æ•°ï¼‰
        default_params = {}
        for param in strategy_class.get_parameters():
            default_params[param.name] = param.default

        return strategy_class(default_params)


# å…¨å±€å•ä¾‹
strategy_sandbox = StrategySandbox()
```

##### 4.1.6 æ•°æ®åº“æ¨¡å‹

**æ–‡ä»¶ï¼š** `backend/app/models/ai_generated_strategy.py`

```python
from sqlalchemy import Column, Integer, String, Text, Boolean, DateTime, JSON
from sqlalchemy.sql import func

from app.core.database import Base


class AIGeneratedStrategy(Base):
    """AI ç”Ÿæˆçš„ç”¨æˆ·ç­–ç•¥"""

    __tablename__ = "ai_generated_strategies"

    id = Column(Integer, primary_key=True, index=True)
    strategy_id = Column(String(100), unique=True, nullable=False, index=True)

    # ç­–ç•¥ä¿¡æ¯
    name = Column(String(200), nullable=False)
    description = Column(Text)
    code = Column(Text, nullable=False)
    class_name = Column(String(100), nullable=False)
    version = Column(String(20), default="1.0.0")

    # ç”Ÿæˆä¿¡æ¯
    user_description = Column(Text)  # ç”¨æˆ·è¾“å…¥çš„è‡ªç„¶è¯­è¨€
    tokens_used = Column(Integer)  # AI API ä½¿ç”¨çš„ token æ•°

    # éªŒè¯çŠ¶æ€
    validation_passed = Column(Boolean, default=False)
    validation_errors = Column(JSON)  # éªŒè¯é”™è¯¯åˆ—è¡¨
    sandbox_test_passed = Column(Boolean, default=False)
    sandbox_test_results = Column(JSON)  # æµ‹è¯•ç»“æœ

    # ç”¨æˆ·ä¿¡æ¯
    user_id = Column(Integer, index=True)
    is_public = Column(Boolean, default=False)  # æ˜¯å¦å…¬å¼€åˆ†äº«

    # çŠ¶æ€
    status = Column(String(20), default="draft")  # draft, published, archived
    is_active = Column(Boolean, default=True)

    # ç»Ÿè®¡
    usage_count = Column(Integer, default=0)  # ä½¿ç”¨æ¬¡æ•°
    backtest_count = Column(Integer, default=0)  # å›æµ‹æ¬¡æ•°

    # æ—¶é—´æˆ³
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
```

**è¿ç§»è„šæœ¬ï¼š**

```sql
-- migrations/003_create_ai_generated_strategies.sql

CREATE TABLE IF NOT EXISTS ai_generated_strategies (
    id SERIAL PRIMARY KEY,
    strategy_id VARCHAR(100) UNIQUE NOT NULL,

    -- ç­–ç•¥ä¿¡æ¯
    name VARCHAR(200) NOT NULL,
    description TEXT,
    code TEXT NOT NULL,
    class_name VARCHAR(100) NOT NULL,
    version VARCHAR(20) DEFAULT '1.0.0',

    -- ç”Ÿæˆä¿¡æ¯
    user_description TEXT,
    tokens_used INTEGER,

    -- éªŒè¯çŠ¶æ€
    validation_passed BOOLEAN DEFAULT FALSE,
    validation_errors JSONB,
    sandbox_test_passed BOOLEAN DEFAULT FALSE,
    sandbox_test_results JSONB,

    -- ç”¨æˆ·ä¿¡æ¯
    user_id INTEGER,
    is_public BOOLEAN DEFAULT FALSE,

    -- çŠ¶æ€
    status VARCHAR(20) DEFAULT 'draft',
    is_active BOOLEAN DEFAULT TRUE,

    -- ç»Ÿè®¡
    usage_count INTEGER DEFAULT 0,
    backtest_count INTEGER DEFAULT 0,

    -- æ—¶é—´æˆ³
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,

    -- ç´¢å¼•
    INDEX idx_strategy_id (strategy_id),
    INDEX idx_user_id (user_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at DESC)
);
```

##### 4.1.7 API ç«¯ç‚¹

**æ–‡ä»¶ï¼š** `backend/app/api/endpoints/ai_strategy.py`

```python
from fastapi import APIRouter, HTTPException, Depends
from pydantic import BaseModel, Field
from typing import Dict, Any, Optional
from loguru import logger

from app.services.ai_strategy_generator import ai_strategy_generator
from app.services.strategy_validator import strategy_validator
from app.services.strategy_sandbox import strategy_sandbox
from app.api.error_handler import handle_api_errors

router = APIRouter()


class GenerateStrategyRequest(BaseModel):
    """ç­–ç•¥ç”Ÿæˆè¯·æ±‚"""
    description: str = Field(..., min_length=10, max_length=500, description="ç­–ç•¥æè¿°")
    user_id: Optional[int] = None


class GenerateStrategyResponse(BaseModel):
    """ç­–ç•¥ç”Ÿæˆå“åº”"""
    code: str
    class_name: str
    validation: Dict[str, Any]
    sandbox_test: Dict[str, Any]
    strategy_id: str
    tokens_used: int


@router.post("/generate-from-text")
@handle_api_errors
async def generate_strategy_from_text(
    request: GenerateStrategyRequest
) -> Dict[str, Any]:
    """
    ä»è‡ªç„¶è¯­è¨€ç”Ÿæˆç­–ç•¥ä»£ç 

    è¯·æ±‚ä½“ç¤ºä¾‹:
    ```json
    {
        "description": "äº”æ—¥å¹³å‡çº¿ä¸Šç©¿20æ—¥å¹³å‡çº¿ä¹°å…¥ï¼Œä¸‹ç©¿å–å‡º",
        "user_id": 123
    }
    ```

    è¿”å›ç¤ºä¾‹:
    ```json
    {
        "status": "success",
        "data": {
            "code": "...",
            "class_name": "AIGeneratedStrategy",
            "validation": {
                "valid": true,
                "errors": [],
                "warnings": []
            },
            "sandbox_test": {
                "success": true,
                "test_results": {...}
            },
            "strategy_id": "ai_gen_123_1707123456",
            "tokens_used": 1234
        }
    }
    ```
    """
    try:
        logger.info(f"æ”¶åˆ°ç­–ç•¥ç”Ÿæˆè¯·æ±‚ - ç”¨æˆ·: {request.user_id}, æè¿°: {request.description}")

        # 1. è°ƒç”¨ AI ç”Ÿæˆä»£ç 
        generation_result = await ai_strategy_generator.generate_strategy_code(
            user_description=request.description,
            user_id=request.user_id
        )

        code = generation_result["code"]
        class_name = generation_result["class_name"]
        tokens_used = generation_result["tokens_used"]

        # 2. éªŒè¯ä»£ç 
        validation_result = strategy_validator.validate_code(code, class_name)

        if not validation_result["valid"]:
            logger.warning(f"ä»£ç éªŒè¯å¤±è´¥: {validation_result['errors']}")
            return {
                "status": "error",
                "message": "ç”Ÿæˆçš„ä»£ç ä¸ç¬¦åˆè§„èŒƒï¼Œè¯·é‡æ–°ç”Ÿæˆæˆ–è°ƒæ•´æè¿°",
                "data": {
                    "code": code,
                    "class_name": class_name,
                    "validation": validation_result,
                    "tokens_used": tokens_used
                }
            }

        # 3. æ²™ç®±æµ‹è¯•
        sandbox_result = strategy_sandbox.test_strategy(code, class_name)

        if not sandbox_result["success"]:
            logger.warning(f"æ²™ç®±æµ‹è¯•å¤±è´¥: {sandbox_result['error']}")
            return {
                "status": "error",
                "message": "ç­–ç•¥è¿è¡Œæµ‹è¯•å¤±è´¥ï¼Œè¯·é‡æ–°ç”Ÿæˆ",
                "data": {
                    "code": code,
                    "class_name": class_name,
                    "validation": validation_result,
                    "sandbox_test": sandbox_result,
                    "tokens_used": tokens_used
                }
            }

        # 4. ç”Ÿæˆç­–ç•¥ ID
        import time
        strategy_id = f"ai_gen_{request.user_id or 0}_{int(time.time())}"

        # 5. ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆTODO: å®ç°æ•°æ®åº“ä¿å­˜ï¼‰
        # await save_ai_strategy_to_db(...)

        logger.info(f"ç­–ç•¥ç”ŸæˆæˆåŠŸ: {strategy_id}")

        return {
            "status": "success",
            "message": "ç­–ç•¥ç”ŸæˆæˆåŠŸ",
            "data": {
                "code": code,
                "class_name": class_name,
                "validation": validation_result,
                "sandbox_test": sandbox_result,
                "strategy_id": strategy_id,
                "tokens_used": tokens_used
            }
        }

    except Exception as e:
        logger.error(f"ç­–ç•¥ç”Ÿæˆå¤±è´¥: {e}", exc_info=True)
        raise HTTPException(status_code=500, detail=f"ç­–ç•¥ç”Ÿæˆå¤±è´¥: {str(e)}")


@router.post("/save-generated-strategy")
@handle_api_errors
async def save_generated_strategy(
    strategy_id: str,
    code: str,
    user_id: int,
    name: Optional[str] = None
) -> Dict[str, Any]:
    """
    ä¿å­˜ç”Ÿæˆçš„ç­–ç•¥åˆ°æ•°æ®åº“
    """
    # TODO: å®ç°ä¿å­˜é€»è¾‘
    pass


@router.get("/my-ai-strategies")
@handle_api_errors
async def get_my_ai_strategies(user_id: int) -> Dict[str, Any]:
    """
    è·å–ç”¨æˆ·ç”Ÿæˆçš„ç­–ç•¥åˆ—è¡¨
    """
    # TODO: ä»æ•°æ®åº“æŸ¥è¯¢
    pass


@router.delete("/ai-strategy/{strategy_id}")
@handle_api_errors
async def delete_ai_strategy(strategy_id: str) -> Dict[str, Any]:
    """
    åˆ é™¤AIç”Ÿæˆçš„ç­–ç•¥
    """
    # TODO: è½¯åˆ é™¤
    pass
```

---

#### ä»»åŠ¡ 4.2ï¼šå‰ç«¯ AI ç­–ç•¥ç”Ÿæˆå™¨ UI

**ç›®æ ‡ï¼š** åˆ›å»ºç”¨æˆ·å‹å¥½çš„ç­–ç•¥ç”Ÿæˆç•Œé¢

##### 4.2.1 ç­–ç•¥ç”Ÿæˆé¡µé¢

**æ–‡ä»¶ï¼š** `frontend/src/app/strategies/ai-create/page.tsx`

```typescript
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { Loader2, Sparkles, CheckCircle, XCircle, AlertTriangle } from 'lucide-react'

import { apiClient } from '@/lib/api-client'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Textarea } from '@/components/ui/textarea'
import { Badge } from '@/components/ui/badge'
import { Alert, AlertDescription } from '@/components/ui/alert'
import { useToast } from '@/hooks/use-toast'

interface GenerationResult {
  code: string
  class_name: string
  validation: {
    valid: boolean
    errors: string[]
    warnings: string[]
  }
  sandbox_test: {
    success: boolean
    error?: string
    test_results?: any
  }
  strategy_id: string
  tokens_used: number
}

export default function AICreateStrategyPage() {
  const router = useRouter()
  const { toast } = useToast()

  const [description, setDescription] = useState('')
  const [generating, setGenerating] = useState(false)
  const [result, setResult] = useState<GenerationResult | null>(null)

  // ç¤ºä¾‹ç­–ç•¥æè¿°
  const examples = [
    "äº”æ—¥å¹³å‡çº¿ä¸Šç©¿20æ—¥å¹³å‡çº¿ä¹°å…¥ï¼Œä¸‹ç©¿å–å‡º",
    "RSIä½äº30è¶…å–ä¹°å…¥ï¼Œé«˜äº70è¶…ä¹°å–å‡º",
    "MACDé‡‘å‰ä¸”æˆäº¤é‡æ”¾å¤§ä¸¤å€ä»¥ä¸Šä¹°å…¥",
    "æ”¶ç›˜ä»·çªç ´20æ—¥å¸ƒæ—å¸¦ä¸Šè½¨ä¹°å…¥ï¼Œè·Œç ´ä¸‹è½¨å–å‡º",
    "è¿ç»­3å¤©æ”¶ç›˜ä»·åˆ›æ–°é«˜ä¹°å…¥ï¼ŒæŒæœ‰5å¤©åå–å‡º"
  ]

  const handleGenerate = async () => {
    if (!description.trim()) {
      toast({
        title: "è¯·è¾“å…¥ç­–ç•¥æè¿°",
        variant: "destructive"
      })
      return
    }

    setGenerating(true)
    setResult(null)

    try {
      const response = await apiClient.post('/api/strategy/generate-from-text', {
        description: description.trim()
      })

      if (response.data.status === 'success') {
        setResult(response.data.data)
        toast({
          title: "ç­–ç•¥ç”ŸæˆæˆåŠŸï¼",
          description: `ä½¿ç”¨äº† ${response.data.data.tokens_used} tokens`
        })
      } else {
        // ç”Ÿæˆå¤±è´¥ä½†æœ‰éƒ¨åˆ†ç»“æœ
        setResult(response.data.data)
        toast({
          title: response.data.message,
          variant: "destructive"
        })
      }

    } catch (error: any) {
      console.error('ç­–ç•¥ç”Ÿæˆå¤±è´¥:', error)
      toast({
        title: "ç”Ÿæˆå¤±è´¥",
        description: error.response?.data?.detail || error.message,
        variant: "destructive"
      })
    } finally {
      setGenerating(false)
    }
  }

  const handleSave = async () => {
    if (!result) return

    try {
      await apiClient.post('/api/strategy/save-generated-strategy', {
        strategy_id: result.strategy_id,
        code: result.code,
        name: description.slice(0, 50)
      })

      toast({
        title: "ç­–ç•¥å·²ä¿å­˜",
        description: "å¯ä»¥åœ¨ç­–ç•¥ä¸­å¿ƒæŸ¥çœ‹"
      })

      // è·³è½¬åˆ°ç­–ç•¥åˆ—è¡¨
      router.push('/strategies')

    } catch (error) {
      toast({
        title: "ä¿å­˜å¤±è´¥",
        variant: "destructive"
      })
    }
  }

  const handleBacktest = () => {
    if (!result) return
    router.push(`/backtest?strategy_id=${result.strategy_id}`)
  }

  return (
    <div className="container mx-auto py-8 px-4 max-w-6xl">
      {/* é¡µé¢æ ‡é¢˜ */}
      <div className="mb-8">
        <div className="flex items-center gap-3 mb-2">
          <Sparkles className="h-8 w-8 text-purple-500" />
          <h1 className="text-4xl font-bold">AI ç­–ç•¥ç”Ÿæˆå™¨</h1>
        </div>
        <p className="text-muted-foreground text-lg">
          ç”¨è‡ªç„¶è¯­è¨€æè¿°æ‚¨çš„äº¤æ˜“ç­–ç•¥ï¼ŒAI å°†è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ Python ä»£ç 
        </p>
      </div>

      {/* è¾“å…¥åŒºåŸŸ */}
      <Card className="mb-6">
        <CardHeader>
          <CardTitle>æè¿°æ‚¨çš„ç­–ç•¥</CardTitle>
          <CardDescription>
            è¯·æ¸…æ™°æè¿°ä¹°å…¥å’Œå–å‡ºæ¡ä»¶ï¼Œä¾‹å¦‚ä½¿ç”¨å“ªäº›æŠ€æœ¯æŒ‡æ ‡ã€é˜ˆå€¼ç­‰
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Textarea
            placeholder="ä¾‹å¦‚ï¼šäº”æ—¥å¹³å‡çº¿ä¸Šç©¿20æ—¥å¹³å‡çº¿ä¹°å…¥ï¼Œä¸‹ç©¿å–å‡º"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            rows={4}
            className="mb-4 text-base"
          />

          {/* ç¤ºä¾‹æ ‡ç­¾ */}
          <div className="mb-4">
            <p className="text-sm text-muted-foreground mb-2">ç‚¹å‡»ç¤ºä¾‹å¿«é€Ÿå¡«å……ï¼š</p>
            <div className="flex flex-wrap gap-2">
              {examples.map((example, index) => (
                <Badge
                  key={index}
                  variant="outline"
                  className="cursor-pointer hover:bg-accent"
                  onClick={() => setDescription(example)}
                >
                  {example}
                </Badge>
              ))}
            </div>
          </div>

          <Button
            onClick={handleGenerate}
            disabled={!description.trim() || generating}
            size="lg"
            className="w-full sm:w-auto"
          >
            {generating ? (
              <>
                <Loader2 className="mr-2 h-5 w-5 animate-spin" />
                AI æ­£åœ¨ç”Ÿæˆä»£ç ...
              </>
            ) : (
              <>
                <Sparkles className="mr-2 h-5 w-5" />
                ç”Ÿæˆç­–ç•¥
              </>
            )}
          </Button>
        </CardContent>
      </Card>

      {/* ç”Ÿæˆç»“æœ */}
      {result && (
        <div className="space-y-6">
          {/* éªŒè¯çŠ¶æ€ */}
          <Card>
            <CardHeader>
              <CardTitle>ä»£ç éªŒè¯</CardTitle>
            </CardHeader>
            <CardContent>
              {result.validation.valid ? (
                <div className="flex items-center text-green-600">
                  <CheckCircle className="mr-2 h-5 w-5" />
                  <span className="font-medium">ä»£ç éªŒè¯é€šè¿‡ï¼Œå¯ä»¥å®‰å…¨ä½¿ç”¨</span>
                </div>
              ) : (
                <div>
                  <div className="flex items-center text-red-600 mb-3">
                    <XCircle className="mr-2 h-5 w-5" />
                    <span className="font-medium">ä»£ç å­˜åœ¨é—®é¢˜</span>
                  </div>
                  <ul className="space-y-1">
                    {result.validation.errors.map((error, index) => (
                      <li key={index} className="text-sm text-red-600 flex items-start">
                        <span className="mr-2">â€¢</span>
                        <span>{error}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}

              {result.validation.warnings.length > 0 && (
                <Alert className="mt-4">
                  <AlertTriangle className="h-4 w-4" />
                  <AlertDescription>
                    <ul className="space-y-1">
                      {result.validation.warnings.map((warning, index) => (
                        <li key={index} className="text-sm">â€¢ {warning}</li>
                      ))}
                    </ul>
                  </AlertDescription>
                </Alert>
              )}
            </CardContent>
          </Card>

          {/* æ²™ç®±æµ‹è¯• */}
          {result.sandbox_test && (
            <Card>
              <CardHeader>
                <CardTitle>æ²™ç®±æµ‹è¯•</CardTitle>
              </CardHeader>
              <CardContent>
                {result.sandbox_test.success ? (
                  <div>
                    <div className="flex items-center text-green-600 mb-4">
                      <CheckCircle className="mr-2 h-5 w-5" />
                      <span className="font-medium">æµ‹è¯•é€šè¿‡</span>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                      <div>
                        <div className="text-muted-foreground">æ€»ä¿¡å·</div>
                        <div className="text-2xl font-bold">
                          {result.sandbox_test.test_results.total_signals}
                        </div>
                      </div>
                      <div>
                        <div className="text-muted-foreground">ä¹°å…¥</div>
                        <div className="text-2xl font-bold text-green-600">
                          {result.sandbox_test.test_results.buy_signals}
                        </div>
                      </div>
                      <div>
                        <div className="text-muted-foreground">å–å‡º</div>
                        <div className="text-2xl font-bold text-red-600">
                          {result.sandbox_test.test_results.sell_signals}
                        </div>
                      </div>
                      <div>
                        <div className="text-muted-foreground">æ‰§è¡Œæ—¶é—´</div>
                        <div className="text-2xl font-bold">
                          {result.sandbox_test.test_results.execution_time_ms}ms
                        </div>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="flex items-center text-red-600">
                    <XCircle className="mr-2 h-5 w-5" />
                    <span>{result.sandbox_test.error}</span>
                  </div>
                )}
              </CardContent>
            </Card>
          )}

          {/* ä»£ç é¢„è§ˆ */}
          <Card>
            <CardHeader>
              <div className="flex justify-between items-center">
                <CardTitle>ç”Ÿæˆçš„ç­–ç•¥ä»£ç </CardTitle>
                <Button
                  variant="outline"
                  size="sm"
                  onClick={() => {
                    navigator.clipboard.writeText(result.code)
                    toast({ title: "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿" })
                  }}
                >
                  å¤åˆ¶ä»£ç 
                </Button>
              </div>
            </CardHeader>
            <CardContent>
              <pre className="bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto text-sm">
                <code>{result.code}</code>
              </pre>
            </CardContent>
          </Card>

          {/* æ“ä½œæŒ‰é’® */}
          {result.validation.valid && result.sandbox_test.success && (
            <div className="flex gap-4">
              <Button onClick={handleSave} size="lg">
                ä¿å­˜ç­–ç•¥
              </Button>
              <Button onClick={handleBacktest} variant="outline" size="lg">
                ç«‹å³å›æµ‹
              </Button>
              <Button
                onClick={() => setResult(null)}
                variant="ghost"
                size="lg"
              >
                é‡æ–°ç”Ÿæˆ
              </Button>
            </div>
          )}
        </div>
      )}
    </div>
  )
}
```

---

#### ä»»åŠ¡ 4.3ï¼šé…ç½®å’Œç¯å¢ƒå˜é‡

**æ–‡ä»¶ï¼š** `backend/app/core/config.py`

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    # ... ç°æœ‰é…ç½® ...

    # DeepSeek API é…ç½®
    DEEPSEEK_API_KEY: str
    DEEPSEEK_API_URL: str = "https://api.deepseek.com/v1/chat/completions"
    DEEPSEEK_MODEL: str = "deepseek-coder"

    # AI ç­–ç•¥ç”Ÿæˆé™åˆ¶
    MAX_STRATEGY_GENERATIONS_PER_DAY: int = 10  # æ¯æ—¥ç”Ÿæˆæ¬¡æ•°é™åˆ¶
    MAX_CODE_LENGTH: int = 5000  # æœ€å¤§ä»£ç é•¿åº¦

    class Config:
        env_file = ".env"

settings = Settings()
```

**ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š** `backend/.env`

```bash
# DeepSeek API
DEEPSEEK_API_KEY=your_deepseek_api_key_here
DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions
DEEPSEEK_MODEL=deepseek-coder
```

---

#### ä»»åŠ¡ 4.4ï¼šé›†æˆåˆ°ç­–ç•¥ç®¡ç†å™¨

**æ–‡ä»¶ï¼š** `backend/app/strategies/strategy_manager.py`

```python
class StrategyManager:
    def __init__(self):
        # å†…ç½®ç­–ç•¥ï¼ˆç¡¬ç¼–ç ï¼‰
        self._builtin_strategies = {
            "complex_indicator": ComplexIndicatorStrategy,
            "ml_model": MLModelStrategy,
            "momentum": MomentumStrategy,
            "mean_reversion": MeanReversionStrategy,
            "multi_factor": MultiFactorStrategy,
        }

        # AI ç”Ÿæˆç­–ç•¥ï¼ˆä»æ•°æ®åº“åŠ è½½ï¼‰
        self._ai_strategies = {}
        self._load_ai_strategies()

    def _load_ai_strategies(self):
        """ä»æ•°æ®åº“åŠ è½½ AI ç”Ÿæˆçš„ç­–ç•¥"""
        # TODO: ä» ai_generated_strategies è¡¨åŠ è½½
        pass

    def get_strategy(self, strategy_id: str, params=None):
        """è·å–ç­–ç•¥å®ä¾‹ï¼ˆæ”¯æŒ AI ç”Ÿæˆç­–ç•¥ï¼‰"""
        if strategy_id in self._builtin_strategies:
            return self._builtin_strategies[strategy_id](params)
        elif strategy_id in self._ai_strategies:
            # åŠ¨æ€åŠ è½½ AI ç­–ç•¥
            return self._load_ai_strategy_instance(strategy_id, params)
        else:
            raise ValueError(f"æœªçŸ¥ç­–ç•¥: {strategy_id}")
```

---

### 5.5 é˜¶æ®µäº”ï¼šå¢å¼ºç­–ç•¥ç»„åˆèƒ½åŠ›ï¼ˆP3ï¼‰

#### ä»»åŠ¡ 4.1ï¼šå®Œå–„ StrategyCombiner

**æ–‡ä»¶ï¼š** `backend/app/strategies/strategy_combiner.py`

```python
from typing import List, Dict, Any, Optional
import pandas as pd
import numpy as np
from loguru import logger

from .base_strategy import BaseStrategy


class StrategyCombiner:
    """
    ç­–ç•¥ç»„åˆå™¨ - ç»„åˆå¤šä¸ªå®Œæ•´ç­–ç•¥çš„ä¿¡å·

    æ”¯æŒçš„ç»„åˆæ–¹æ³•:
    - vote: æŠ•ç¥¨æ³•ï¼ˆå¤šæ•°ç­–ç•¥åŒæ„æ‰ä¹°å…¥ï¼‰
    - weighted: åŠ æƒæ³•ï¼ˆæŒ‰æƒé‡ç»„åˆä¿¡å·ï¼‰
    - and: ANDæ³•ï¼ˆæ‰€æœ‰ç­–ç•¥éƒ½åŒæ„æ‰ä¹°å…¥ï¼‰
    - or: ORæ³•ï¼ˆä»»æ„ç­–ç•¥åŒæ„å°±ä¹°å…¥ï¼‰
    """

    @staticmethod
    def combine_strategies(
        strategies: List[BaseStrategy],
        data: pd.DataFrame,
        method: str = 'vote',
        weights: Optional[List[float]] = None,
        vote_threshold: float = 0.5,
    ) -> pd.DataFrame:
        """
        ç»„åˆå¤šä¸ªç­–ç•¥çš„ä¿¡å·

        å‚æ•°:
            strategies: ç­–ç•¥åˆ—è¡¨
            data: OHLCVæ•°æ®
            method: ç»„åˆæ–¹æ³• ('vote', 'weighted', 'and', 'or')
            weights: æƒé‡åˆ—è¡¨ï¼ˆä»…ç”¨äºweightedæ–¹æ³•ï¼‰
            vote_threshold: æŠ•ç¥¨é˜ˆå€¼ï¼ˆä»…ç”¨äºvoteæ–¹æ³•ï¼‰

        è¿”å›:
            ç»„åˆåçš„ä¿¡å·åºåˆ—
        """
        if not strategies:
            raise ValueError("ç­–ç•¥åˆ—è¡¨ä¸èƒ½ä¸ºç©º")

        # ç”Ÿæˆæ¯ä¸ªç­–ç•¥çš„ä¿¡å·
        all_signals = []
        for strategy in strategies:
            try:
                signals = strategy.generate_signals(data)
                all_signals.append(signals)
                logger.info(f"ç­–ç•¥ {strategy.name} ä¿¡å·ç”Ÿæˆå®Œæˆ")
            except Exception as e:
                logger.error(f"ç­–ç•¥ {strategy.name} ä¿¡å·ç”Ÿæˆå¤±è´¥: {e}")
                continue

        if not all_signals:
            raise RuntimeError("æ‰€æœ‰ç­–ç•¥ä¿¡å·ç”Ÿæˆå¤±è´¥")

        # ç»„åˆä¿¡å·
        if method == 'vote':
            combined = StrategyCombiner._combine_by_vote(all_signals, vote_threshold)
        elif method == 'weighted':
            combined = StrategyCombiner._combine_by_weight(all_signals, weights)
        elif method == 'and':
            combined = StrategyCombiner._combine_by_and(all_signals)
        elif method == 'or':
            combined = StrategyCombiner._combine_by_or(all_signals)
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„ç»„åˆæ–¹æ³•: {method}")

        logger.info(f"ç­–ç•¥ç»„åˆå®Œæˆï¼ˆ{method}æ–¹æ³•ï¼‰ï¼Œä¹°å…¥ä¿¡å·: {(combined == 1).sum()}")

        return combined

    @staticmethod
    def _combine_by_vote(
        signals_list: List[pd.Series],
        threshold: float = 0.5,
    ) -> pd.Series:
        """
        æŠ•ç¥¨æ³•ï¼šè¶…è¿‡é˜ˆå€¼æ¯”ä¾‹çš„ç­–ç•¥åŒæ„æ‰ä¹°å…¥

        ä¾‹å¦‚ï¼š3ä¸ªç­–ç•¥ï¼Œthreshold=0.5ï¼Œè‡³å°‘2ä¸ªç­–ç•¥åŒæ„æ‰ä¹°å…¥
        """
        # å°†æ‰€æœ‰ä¿¡å·å †å æˆçŸ©é˜µ
        signals_matrix = pd.concat(signals_list, axis=1)

        # è®¡ç®—ä¹°å…¥ä¿¡å·çš„æ¯”ä¾‹
        buy_votes = (signals_matrix == 1).sum(axis=1) / len(signals_list)
        sell_votes = (signals_matrix == -1).sum(axis=1) / len(signals_list)

        # ç”Ÿæˆç»„åˆä¿¡å·
        combined = pd.Series(0, index=signals_matrix.index)
        combined[buy_votes >= threshold] = 1
        combined[sell_votes >= threshold] = -1

        return combined

    @staticmethod
    def _combine_by_weight(
        signals_list: List[pd.Series],
        weights: Optional[List[float]] = None,
    ) -> pd.Series:
        """
        åŠ æƒæ³•ï¼šæŒ‰æƒé‡åŠ æƒå¹³å‡ä¿¡å·

        æƒé‡å½’ä¸€åŒ–åï¼ŒåŠ æƒå’Œ > 0.5 è§†ä¸ºä¹°å…¥ï¼Œ< -0.5 è§†ä¸ºå–å‡º
        """
        if weights is None:
            # ç­‰æƒé‡
            weights = [1.0 / len(signals_list)] * len(signals_list)
        else:
            # å½’ä¸€åŒ–æƒé‡
            total = sum(weights)
            weights = [w / total for w in weights]

        # åŠ æƒæ±‚å’Œ
        signals_matrix = pd.concat(signals_list, axis=1)
        weighted_sum = sum(
            signals_matrix.iloc[:, i] * weights[i]
            for i in range(len(signals_list))
        )

        # ç”Ÿæˆä¿¡å·
        combined = pd.Series(0, index=signals_matrix.index)
        combined[weighted_sum > 0.5] = 1
        combined[weighted_sum < -0.5] = -1

        return combined

    @staticmethod
    def _combine_by_and(signals_list: List[pd.Series]) -> pd.Series:
        """
        ANDæ³•ï¼šæ‰€æœ‰ç­–ç•¥éƒ½åŒæ„æ‰äº§ç”Ÿä¿¡å·
        """
        signals_matrix = pd.concat(signals_list, axis=1)

        combined = pd.Series(0, index=signals_matrix.index)

        # æ‰€æœ‰ç­–ç•¥éƒ½ä¹°å…¥
        all_buy = (signals_matrix == 1).all(axis=1)
        combined[all_buy] = 1

        # æ‰€æœ‰ç­–ç•¥éƒ½å–å‡º
        all_sell = (signals_matrix == -1).all(axis=1)
        combined[all_sell] = -1

        return combined

    @staticmethod
    def _combine_by_or(signals_list: List[pd.Series]) -> pd.Series:
        """
        ORæ³•ï¼šä»»æ„ç­–ç•¥åŒæ„å°±äº§ç”Ÿä¿¡å·
        """
        signals_matrix = pd.concat(signals_list, axis=1)

        combined = pd.Series(0, index=signals_matrix.index)

        # ä»»æ„ç­–ç•¥ä¹°å…¥
        any_buy = (signals_matrix == 1).any(axis=1)
        combined[any_buy] = 1

        # ä»»æ„ç­–ç•¥å–å‡º
        any_sell = (signals_matrix == -1).any(axis=1)
        combined[any_sell] = -1

        return combined

    @staticmethod
    def analyze_consistency(
        strategies: List[BaseStrategy],
        data: pd.DataFrame,
    ) -> Dict[str, Any]:
        """
        åˆ†æå¤šä¸ªç­–ç•¥çš„ä¸€è‡´æ€§

        è¿”å›:
            - agreement_rate: ä¸€è‡´ç‡ï¼ˆä¹°å…¥/å–å‡ºä¿¡å·ä¸€è‡´çš„æ¯”ä¾‹ï¼‰
            - correlation_matrix: ä¿¡å·ç›¸å…³ç³»æ•°çŸ©é˜µ
        """
        # ç”Ÿæˆæ‰€æœ‰ç­–ç•¥çš„ä¿¡å·
        all_signals = {}
        for strategy in strategies:
            try:
                signals = strategy.generate_signals(data)
                all_signals[strategy.name] = signals
            except Exception as e:
                logger.error(f"ç­–ç•¥ {strategy.name} ä¿¡å·ç”Ÿæˆå¤±è´¥: {e}")
                continue

        if len(all_signals) < 2:
            return {"error": "è‡³å°‘éœ€è¦2ä¸ªç­–ç•¥æ‰èƒ½åˆ†æä¸€è‡´æ€§"}

        # è®¡ç®—ä¸€è‡´ç‡
        signals_df = pd.DataFrame(all_signals)

        # ä¹°å…¥ä¸€è‡´ç‡
        buy_signals = (signals_df == 1)
        buy_agreement = (buy_signals.sum(axis=1) == len(all_signals)).mean()

        # å–å‡ºä¸€è‡´ç‡
        sell_signals = (signals_df == -1)
        sell_agreement = (sell_signals.sum(axis=1) == len(all_signals)).mean()

        # ç›¸å…³ç³»æ•°çŸ©é˜µ
        correlation = signals_df.corr()

        return {
            "buy_agreement_rate": float(buy_agreement),
            "sell_agreement_rate": float(sell_agreement),
            "correlation_matrix": correlation.to_dict(),
        }
```

#### ä»»åŠ¡ 4.2ï¼šæ–°å¢ä¿¡å·è¿‡æ»¤å±‚

**æ–‡ä»¶ï¼š** `backend/app/strategies/signal_filter.py`

```python
import pandas as pd
import numpy as np
from loguru import logger


class SignalFilter:
    """
    ä¿¡å·è¿‡æ»¤å™¨ - åœ¨ç­–ç•¥ä¹‹åã€äº¤æ˜“ä¹‹å‰è¿‡æ»¤ä¿¡å·

    è§£è€¦ä¹°å–é€»è¾‘å’Œé£æ§é€»è¾‘
    """

    @staticmethod
    def trend_filter(
        signals: pd.Series,
        data: pd.DataFrame,
        trend_indicator: str = 'MA200',
        ma_period: int = 200,
    ) -> pd.Series:
        """
        è¶‹åŠ¿è¿‡æ»¤ï¼šåªåœ¨è¶‹åŠ¿å‘ä¸Šæ—¶åšå¤š

        å‚æ•°:
            signals: åŸå§‹ä¿¡å·
            data: OHLCVæ•°æ®
            trend_indicator: è¶‹åŠ¿æŒ‡æ ‡ï¼ˆ'MA200', 'EMA', etc.ï¼‰
            ma_period: å‡çº¿å‘¨æœŸ

        è¿”å›:
            è¿‡æ»¤åçš„ä¿¡å·
        """
        logger.info(f"åº”ç”¨è¶‹åŠ¿è¿‡æ»¤ï¼ˆ{trend_indicator}ï¼‰")

        # è®¡ç®—è¶‹åŠ¿æŒ‡æ ‡
        if trend_indicator.startswith('MA'):
            ma = data['close'].rolling(window=ma_period).mean()
            in_uptrend = data['close'] > ma
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„è¶‹åŠ¿æŒ‡æ ‡: {trend_indicator}")

        # è¿‡æ»¤ä¿¡å·
        filtered = signals.copy()

        # è¶‹åŠ¿å‘ä¸‹æ—¶ï¼š
        # - å–æ¶ˆæ‰€æœ‰ä¹°å…¥ä¿¡å·
        # - ä¿ç•™å–å‡ºä¿¡å·ï¼ˆå¼ºåˆ¶å¹³ä»“ï¼‰
        filtered[~in_uptrend & (signals == 1)] = 0

        logger.info(f"è¶‹åŠ¿è¿‡æ»¤å®Œæˆï¼Œä¿ç•™ä¹°å…¥ä¿¡å·: {(filtered == 1).sum()} / {(signals == 1).sum()}")

        return filtered

    @staticmethod
    def volatility_filter(
        signals: pd.Series,
        data: pd.DataFrame,
        threshold: float = 0.3,
        window: int = 20,
    ) -> pd.Series:
        """
        æ³¢åŠ¨è¿‡æ»¤ï¼šé«˜æ³¢åŠ¨æ—¶é™ä½ä»“ä½æˆ–ä¸å¼€ä»“

        å‚æ•°:
            signals: åŸå§‹ä¿¡å·
            data: OHLCVæ•°æ®
            threshold: æ³¢åŠ¨ç‡é˜ˆå€¼ï¼ˆå¹´åŒ–ï¼‰
            window: è®¡ç®—çª—å£

        è¿”å›:
            è¿‡æ»¤åçš„ä¿¡å·
        """
        logger.info(f"åº”ç”¨æ³¢åŠ¨è¿‡æ»¤ï¼ˆé˜ˆå€¼={threshold}ï¼‰")

        # è®¡ç®—æ»šåŠ¨æ³¢åŠ¨ç‡ï¼ˆå¹´åŒ–ï¼‰
        returns = data['close'].pct_change()
        volatility = returns.rolling(window=window).std() * np.sqrt(252)

        # è¿‡æ»¤ä¿¡å·
        filtered = signals.copy()

        # é«˜æ³¢åŠ¨æ—¶å–æ¶ˆä¹°å…¥ä¿¡å·
        high_volatility = volatility > threshold
        filtered[high_volatility & (signals == 1)] = 0

        logger.info(f"æ³¢åŠ¨è¿‡æ»¤å®Œæˆï¼Œä¿ç•™ä¹°å…¥ä¿¡å·: {(filtered == 1).sum()} / {(signals == 1).sum()}")

        return filtered

    @staticmethod
    def liquidity_filter(
        signals: pd.Series,
        data: pd.DataFrame,
        min_volume: float = 1e6,
        min_amount: float = 1e7,
    ) -> pd.Series:
        """
        æµåŠ¨æ€§è¿‡æ»¤ï¼šè¿‡æ»¤æˆäº¤é‡æˆ–æˆäº¤é¢ä¸è¶³çš„è‚¡ç¥¨

        å‚æ•°:
            signals: åŸå§‹ä¿¡å·
            data: OHLCVæ•°æ®
            min_volume: æœ€å°æˆäº¤é‡
            min_amount: æœ€å°æˆäº¤é¢

        è¿”å›:
            è¿‡æ»¤åçš„ä¿¡å·
        """
        logger.info(f"åº”ç”¨æµåŠ¨æ€§è¿‡æ»¤ï¼ˆæœ€å°æˆäº¤é‡={min_volume}ï¼‰")

        # è®¡ç®—æˆäº¤é¢
        if 'amount' in data.columns:
            amount = data['amount']
        else:
            amount = data['volume'] * data['close']

        # æµåŠ¨æ€§ä¸è¶³
        low_liquidity = (data['volume'] < min_volume) | (amount < min_amount)

        # è¿‡æ»¤ä¿¡å·
        filtered = signals.copy()
        filtered[low_liquidity & (signals == 1)] = 0

        logger.info(f"æµåŠ¨æ€§è¿‡æ»¤å®Œæˆï¼Œä¿ç•™ä¹°å…¥ä¿¡å·: {(filtered == 1).sum()} / {(signals == 1).sum()}")

        return filtered

    @staticmethod
    def apply_filters(
        signals: pd.Series,
        data: pd.DataFrame,
        filters: Dict[str, Any],
    ) -> pd.Series:
        """
        æ‰¹é‡åº”ç”¨å¤šä¸ªè¿‡æ»¤å™¨

        å‚æ•°:
            signals: åŸå§‹ä¿¡å·
            data: OHLCVæ•°æ®
            filters: è¿‡æ»¤å™¨é…ç½®å­—å…¸
                {
                    'trend': {'enabled': True, 'ma_period': 200},
                    'volatility': {'enabled': True, 'threshold': 0.3},
                    'liquidity': {'enabled': True, 'min_volume': 1e6},
                }

        è¿”å›:
            è¿‡æ»¤åçš„ä¿¡å·
        """
        filtered = signals.copy()

        # è¶‹åŠ¿è¿‡æ»¤
        if filters.get('trend', {}).get('enabled'):
            filtered = SignalFilter.trend_filter(
                filtered,
                data,
                ma_period=filters['trend'].get('ma_period', 200),
            )

        # æ³¢åŠ¨è¿‡æ»¤
        if filters.get('volatility', {}).get('enabled'):
            filtered = SignalFilter.volatility_filter(
                filtered,
                data,
                threshold=filters['volatility'].get('threshold', 0.3),
            )

        # æµåŠ¨æ€§è¿‡æ»¤
        if filters.get('liquidity', {}).get('enabled'):
            filtered = SignalFilter.liquidity_filter(
                filtered,
                data,
                min_volume=filters['liquidity'].get('min_volume', 1e6),
            )

        return filtered
```

---

## å…­ã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 6.1 æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·æµè§ˆç­–ç•¥åˆ—è¡¨
    â†“
GET /api/strategy/list
    â†“
Frontend å±•ç¤ºç­–ç•¥å¡ç‰‡
    â†“
ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"
    â†“
GET /api/strategy/metadata?strategy_id=momentum
    â†“
Frontend å±•ç¤ºç­–ç•¥è¯¦æƒ…é¡µ
    â†“
ç”¨æˆ·ç‚¹å‡»"ç«‹å³å›æµ‹"
    â†“
è·³è½¬åˆ° /backtest?strategy_id=momentum
    â†“
BacktestPanel è‡ªåŠ¨é€‰æ‹©ç­–ç•¥
    â†“
ç”¨æˆ·é…ç½®å‚æ•°å¹¶è¿è¡Œ
    â†“
POST /api/backtest/run
    â†“
å›æµ‹å®Œæˆï¼Œå±•ç¤ºç»“æœ
    â†“
POST /api/backtest/save (åå°è‡ªåŠ¨ä¿å­˜)
    â†“
ç”¨æˆ·å¯åœ¨"æˆ‘çš„å›æµ‹"æŸ¥çœ‹å†å²
```

### 6.2 API ç«¯ç‚¹æ±‡æ€»ï¼ˆ2026-02-07æ›´æ–°ï¼‰

#### ä¸‰å±‚æ¶æ„APIï¼ˆBackend v3.0.0å·²å®Œæˆï¼‰â­

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ | ç¼“å­˜ |
|------|------|------|------|------|
| `/api/three-layer/selectors` | GET | è·å–é€‰è‚¡å™¨åˆ—è¡¨ï¼ˆ4ä¸ªï¼‰ | âœ… Backendå·²å®Œæˆ | Redis 1å¤© |
| `/api/three-layer/entries` | GET | è·å–å…¥åœºç­–ç•¥åˆ—è¡¨ï¼ˆ3ä¸ªï¼‰ | âœ… Backendå·²å®Œæˆ | Redis 1å¤© |
| `/api/three-layer/exits` | GET | è·å–é€€å‡ºç­–ç•¥åˆ—è¡¨ï¼ˆ4ä¸ªï¼‰ | âœ… Backendå·²å®Œæˆ | Redis 1å¤© |
| `/api/three-layer/validate` | POST | éªŒè¯ç­–ç•¥ç»„åˆ | âœ… Backendå·²å®Œæˆ | æ—  |
| `/api/three-layer/backtest` | POST | æ‰§è¡Œä¸‰å±‚å›æµ‹ | âœ… Backendå·²å®Œæˆ | Redis 1å°æ—¶ |

**å“åº”ç¤ºä¾‹**ï¼ˆ/api/three-layer/selectorsï¼‰ï¼š
```json
{
  "success": true,
  "data": [
    {
      "id": "momentum",
      "name": "åŠ¨é‡é€‰è‚¡å™¨",
      "description": "é€‰æ‹©è¿‘æœŸæ¶¨å¹…æœ€å¤§çš„è‚¡ç¥¨",
      "version": "1.0.0",
      "parameters": [
        {"name": "lookback_period", "type": "integer", "default": 20, "min_value": 5, "max_value": 200},
        {"name": "top_n", "type": "integer", "default": 50, "min_value": 10, "max_value": 200}
      ]
    },
    {
      "id": "ml_selector",
      "name": "æœºå™¨å­¦ä¹ é€‰è‚¡å™¨",
      "description": "åŸºäºLightGBM Rankingçš„æ™ºèƒ½é€‰è‚¡",
      "version": "1.0.0",
      "parameters": [
        {"name": "mode", "type": "select", "default": "lightgbm_ranker", "options": ["factor_weighted", "lightgbm_ranker"]},
        {"name": "model_path", "type": "string", "default": ""},
        {"name": "top_n", "type": "integer", "default": 50}
      ]
    }
  ]
}
```

#### ä¼ ç»ŸAPIï¼ˆä¿æŒå…¼å®¹ï¼‰

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/api/strategy/list` | GET | è·å–ä¼ ç»Ÿç­–ç•¥åˆ—è¡¨ï¼ˆ2ä¸ªï¼‰ | âœ… å·²æœ‰ |
| `/api/strategy/metadata` | GET | è·å–ç­–ç•¥å…ƒæ•°æ® | âœ… å·²æœ‰ |
| `/api/backtest/run` | POST | è¿è¡Œä¼ ç»Ÿå›æµ‹ | âœ… å·²æœ‰ |
| `/api/backtest/result/{task_id}` | GET | è·å–å›æµ‹ç»“æœ | âœ… å·²æœ‰ |

#### å†å²è®°å½•APIï¼ˆå¾…å¼€å‘ï¼‰

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/api/backtest/save` | POST | ä¿å­˜å›æµ‹ç»“æœ | â­• æ–°å¢ |
| `/api/backtest/history` | GET | è·å–å†å²è®°å½•åˆ—è¡¨ | â­• æ–°å¢ |
| `/api/backtest/history/{id}` | GET | è·å–å•æ¡è®°å½•è¯¦æƒ… | â­• æ–°å¢ |
| `/api/backtest/history/{id}` | DELETE | åˆ é™¤å†å²è®°å½• | â­• æ–°å¢ |

### 6.3 å‰ç«¯è·¯ç”±æ±‡æ€»ï¼ˆ2026-02-07æ›´æ–°ï¼‰

| è·¯ç”± | é¡µé¢ | åŠŸèƒ½ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|------|------|--------|
| `/backtest` | å›æµ‹æ‰§è¡Œé¡µ | ~~ä¼ ç»Ÿæ¨¡å¼~~ | âœ… å·²æœ‰ | - |
| `/backtest/three-layer` | **ä¸‰å±‚å›æµ‹é¡µ** | **ä¸‰å±‚æ¶æ„å›æµ‹é…ç½®** | â­• **æ–°å¢** | **P0 â­** |
| `/strategies` | ç­–ç•¥åˆ—è¡¨é¡µ | æµè§ˆ11ä¸ªä¸‰å±‚ç»„ä»¶ | â­• æ–°å¢ | P1 |
| `/strategies/[id]` | ç­–ç•¥è¯¦æƒ…é¡µ | æŸ¥çœ‹ç»„ä»¶è¯¦æƒ… | â­• æ–°å¢ | P1 |
| `/my-backtests` | å†å²è®°å½•é¡µ | æŸ¥çœ‹å›æµ‹å†å² | â­• æ–°å¢ | P2 |
| `/my-backtests/[id]` | å›æµ‹è¯¦æƒ…é¡µ | æŸ¥çœ‹å•æ¡è®°å½•è¯¦æƒ… | â­• æ–°å¢ | P2 |
| `/ai-lab` | AIå®éªŒèˆ± | è®­ç»ƒå’Œç®¡ç†æ¨¡å‹ | âœ… å·²æœ‰ | - |

**æ ¸å¿ƒé¡µé¢è¯´æ˜**ï¼š

**`/backtest/three-layer`ï¼ˆä¸‰å±‚å›æµ‹é¡µï¼‰**ï¼š
- ç¬¬ä¸€å±‚é€‰æ‹©å™¨ï¼šä¸‹æ‹‰èœå•ï¼ˆ4ä¸ªé€‰è‚¡å™¨ï¼‰+ åŠ¨æ€å‚æ•°è¡¨å•
- ç¬¬äºŒå±‚é€‰æ‹©å™¨ï¼šä¸‹æ‹‰èœå•ï¼ˆ3ä¸ªå…¥åœºç­–ç•¥ï¼‰+ åŠ¨æ€å‚æ•°è¡¨å•
- ç¬¬ä¸‰å±‚é€‰æ‹©å™¨ï¼šä¸‹æ‹‰èœå•ï¼ˆ4ä¸ªé€€å‡ºç­–ç•¥ï¼‰+ åŠ¨æ€å‚æ•°è¡¨å•
- è°ƒä»“é¢‘ç‡ï¼šå‘¨é¢‘/æœˆé¢‘/å­£é¢‘é€‰æ‹©
- å›æµ‹é…ç½®ï¼šè‚¡ç¥¨æ± ã€æ—¥æœŸèŒƒå›´ã€åˆå§‹èµ„é‡‘
- å®æ—¶éªŒè¯ï¼šè°ƒç”¨ `/api/three-layer/validate`
- è¿è¡Œå›æµ‹ï¼šè°ƒç”¨ `/api/three-layer/backtest`
- ç»“æœå±•ç¤ºï¼šç»©æ•ˆæŒ‡æ ‡ + æŒä»“æ˜ç»† + å‡€å€¼æ›²çº¿

---

## ä¸ƒã€å·¥ä½œé‡è¯„ä¼°ä¸æ’æœŸ

### 7.1 å·¥ä½œé‡ç»Ÿè®¡ï¼ˆ2026-02-07æ›´æ–°ï¼‰

#### åŸè®¡åˆ’ vs æ–°è®¡åˆ’å¯¹æ¯”

| é˜¶æ®µ | ä»»åŠ¡ | åŸè®¡åˆ’ | æ–°è®¡åˆ’ | èŠ‚çœ | çŠ¶æ€ |
|------|------|--------|--------|------|------|
| **é˜¶æ®µé›¶** | ~~ä¸‰å±‚æ¶æ„åç«¯å¼€å‘~~ | 17-25å¤© | âœ… å·²å®Œæˆ | 100% | Core+Backendå·²å®Œæˆ |
| | **å‰ç«¯APIé›†æˆ** | - | **2-3å¤©** | - | âš ï¸ æ–°å¢ |
| | **å‰ç«¯UIå¼€å‘ï¼ˆä¸‰å±‚é…ç½®ï¼‰** | - | **3-4å¤©** | - | âš ï¸ æ–°å¢ |
| **å°è®¡** | | **17-25å¤©** | **5-7å¤©** | **â†“ 72-80%** | |
| **é˜¶æ®µä¸€** | ~~è¿ç§»3ä¸ªç­–ç•¥~~ | 3.5-6.5å¤© | âœ… å·²åºŸå¼ƒ | 100% | ä¸‰å±‚æ¶æ„æ›¿ä»£ |
| **é˜¶æ®µäºŒ** | ç­–ç•¥ä¸­å¿ƒé¡µé¢ | 3-5å¤© | **3-5å¤©** | 0% | ä¿æŒä¸å˜ |
| **é˜¶æ®µä¸‰** | å†å²è®°å½•æŒä¹…åŒ– | 5-7å¤© | **5-7å¤©** | 0% | ä¿æŒä¸å˜ |
| **é˜¶æ®µå››** | AIç­–ç•¥ç”Ÿæˆå™¨ | 8.5-13.5å¤© | **8.5-13.5å¤©** | 0% | ä¿æŒä¸å˜ |
| **é˜¶æ®µäº”** | ç­–ç•¥ç»„åˆå¢å¼º | 3-5å¤© | **3-5å¤©** | 0% | ä¿æŒä¸å˜ |
| **æ€»è®¡** | | **40.5-62å¤©** | **25-37.5å¤©** | **â†“ 38-40%** | **çº¦ 5-7.5å‘¨** |

#### è¯¦ç»†å·¥ä½œé‡ç»Ÿè®¡ï¼ˆæ–°è®¡åˆ’ï¼‰

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ | å¤‡æ³¨ |
|------|------|--------|--------|------|
| **é˜¶æ®µé›¶ï¼ˆå‰ç«¯é›†æˆï¼‰** | åˆ›å»ºAPIæœåŠ¡å±‚ | 1å¤© | P0 â­ | TypeScriptå°è£…5ä¸ªAPI |
| | ä¸‰å±‚ç­–ç•¥é…ç½®UIç»„ä»¶ | 2-3å¤© | P0 | é€‰æ‹©å™¨+å‚æ•°è¡¨å• |
| | å›æµ‹ç»“æœå±•ç¤ºä¼˜åŒ– | 1å¤© | P0 | æ”¯æŒä¸‰å±‚æ¶æ„ç»“æœ |
| | é›†æˆæµ‹è¯• | 1å¤© | P0 | E2Eæµ‹è¯• |
| **å°è®¡** | | **5-7å¤©** | **æœ€é«˜ä¼˜å…ˆçº§** | |
| **é˜¶æ®µä¸€** | ~~å·²åºŸå¼ƒ~~ | ~~3.5-6.5å¤©~~ | - | ä¸‰å±‚æ¶æ„æ›¿ä»£ |
| **é˜¶æ®µäºŒ** | ç­–ç•¥åˆ—è¡¨é¡µé¢ | 1-2å¤© | P1 | å±•ç¤º11ä¸ªç»„ä»¶ |
| | ç­–ç•¥è¯¦æƒ…é¡µé¢ | 1-2å¤© | P1 | å‚æ•°è¯´æ˜+ä½¿ç”¨ç¤ºä¾‹ |
| | å¯¼èˆªæ æ›´æ–° | 0.5å¤© | P1 | æ–°å¢è·¯ç”± |
| | é›†æˆæµ‹è¯• | 0.5å¤© | P1 | |
| **å°è®¡** | | **3-5å¤©** | | |
| **é˜¶æ®µä¸‰** | åç«¯APIå¼€å‘ | 1-2å¤© | P2 | å†å²è®°å½•CRUD |
| | æ•°æ®åº“è¿ç§» | 0.5å¤© | P2 | PostgreSQLè¡¨ |
| | å‰ç«¯å†å²é¡µé¢ | 2-3å¤© | P2 | åˆ—è¡¨+ç­›é€‰+æœç´¢ |
| | å‰ç«¯è¯¦æƒ…é¡µé¢ | 1å¤© | P2 | å•æ¡è®°å½•å±•ç¤º |
| | ä¿å­˜é€»è¾‘é›†æˆ | 0.5å¤© | P2 | |
| **å°è®¡** | | **5-7å¤©** | | |
| **é˜¶æ®µå››** | AIç”ŸæˆæœåŠ¡ | 2-3å¤© | P1 ğŸš€ | DeepSeek API |
| | ä»£ç éªŒè¯+æ²™ç®± | 2-3å¤© | P1 | å®‰å…¨æ£€æŸ¥ |
| | æ•°æ®åº“è®¾è®¡ | 0.5å¤© | P1 | ç”¨æˆ·ç­–ç•¥è¡¨ |
| | APIç«¯ç‚¹ | 1-2å¤© | P1 | ç”Ÿæˆ+ä¿å­˜+åˆ é™¤ |
| | å‰ç«¯UI | 2-3å¤© | P1 | äº¤äº’å¼ç”Ÿæˆå™¨ |
| | Promptè°ƒä¼˜ | 1-2å¤© | P1 | æå‡è´¨é‡ |
| **å°è®¡** | | **8.5-13.5å¤©** | | |
| **é˜¶æ®µäº”** | å®Œå–„Combiner | 1-2å¤© | P3 | æŠ•ç¥¨æ³•+åŠ æƒæ³• |
| | SignalFilter | 1-2å¤© | P3 | è¶‹åŠ¿+æ³¢åŠ¨è¿‡æ»¤ |
| | æµ‹è¯•ä¼˜åŒ– | 1å¤© | P3 | |
| **å°è®¡** | | **3-5å¤©** | | |
| **æ€»è®¡** | | **25-37.5å¤©** | **çº¦ 5-7.5å‘¨** | **èŠ‚çœ38-40%** |

### 7.2 æ¨èæ’æœŸï¼ˆ2026-02-07æ›´æ–°ï¼š5-7.5å‘¨ï¼‰

**é‡è¦è¯´æ˜ï¼š** Coreå’ŒBackendå·²å®Œæˆä¸‰å±‚æ¶æ„ï¼Œæ€»å·¥æœŸä»åŸè®¡åˆ’çš„ 10-12å‘¨ **ç¼©çŸ­è‡³ 5-7.5å‘¨**ï¼š

âœ… Core v3.1.0 å·²å®ç°ä¸‰å±‚æ¶æ„ï¼ˆ11ä¸ªç»„ä»¶ï¼‰
âœ… Backend v3.0.0 å·²å®ç°5ä¸ªREST APIï¼ˆ129æµ‹è¯•100%é€šè¿‡ï¼‰
âœ… å‰ç«¯åªéœ€é›†æˆç°æœ‰API + å¼€å‘UI
âœ… å·¥ä½œé‡å‡å°‘38-40%

---

**ç¬¬1å‘¨ï¼šå‰ç«¯ä¸‰å±‚æ¶æ„é›†æˆï¼ˆP0 â­ æœ€é«˜ä¼˜å…ˆçº§ï¼‰**

**Day 1: APIæœåŠ¡å±‚**
- åˆ›å»º `threeLayerApi.ts`
- å°è£…5ä¸ªBackend APIï¼ˆselectors, entries, exits, validate, backtestï¼‰
- ç±»å‹å®šä¹‰ï¼ˆSelectorInfo, EntryInfo, ExitInfo, BacktestConfigï¼‰

**Day 2-4: ä¸‰å±‚ç­–ç•¥é…ç½®UI**
- åˆ›å»º `ThreeLayerStrategyPanel.tsx`
- å®ç°ä¸‰å±‚é€‰æ‹©å™¨ï¼ˆä¸‹æ‹‰èœå• + å‚æ•°è¡¨å•ï¼‰
- åŠ¨æ€å‚æ•°æ¸²æŸ“ï¼ˆæ ¹æ®ç»„ä»¶å‚æ•°å®šä¹‰ï¼‰
- ç­–ç•¥éªŒè¯æç¤º

**Day 5: å›æµ‹ç»“æœå±•ç¤ºä¼˜åŒ–**
- é€‚é…ä¸‰å±‚æ¶æ„å›æµ‹ç»“æœæ ¼å¼
- å±•ç¤ºç»„åˆä¿¡æ¯ï¼ˆé€‰è‚¡å™¨+å…¥åœº+é€€å‡ºï¼‰

**Day 6-7: é›†æˆæµ‹è¯•**
- E2Eæµ‹è¯•ï¼ˆé€‰æ‹©ç»„åˆâ†’é…ç½®å‚æ•°â†’è¿è¡Œå›æµ‹â†’æŸ¥çœ‹ç»“æœï¼‰
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

**ç¬¬2å‘¨ï¼šç­–ç•¥ä¸­å¿ƒé¡µé¢ï¼ˆP1ï¼‰**

**Day 1-2: ç­–ç•¥åˆ—è¡¨é¡µé¢**
- å±•ç¤º11ä¸ªä¸‰å±‚ç»„ä»¶ï¼ˆ4é€‰è‚¡ + 3å…¥åœº + 4é€€å‡ºï¼‰
- åˆ†ç±»æ ‡ç­¾ï¼ˆé€‰è‚¡å™¨/å…¥åœº/é€€å‡ºï¼‰
- æœç´¢å’Œç­›é€‰åŠŸèƒ½

**Day 3-4: ç­–ç•¥è¯¦æƒ…é¡µé¢**
- ç»„ä»¶è¯¦ç»†è¯´æ˜ï¼ˆåŸç†ã€é€‚ç”¨åœºæ™¯ã€é£é™©æç¤ºï¼‰
- å‚æ•°è¯´æ˜å’Œæ¨èå€¼
- ä½¿ç”¨ç¤ºä¾‹ä»£ç 

**Day 5-7: å¯¼èˆªæ  + æµ‹è¯•**
- æ›´æ–°å¯¼èˆªæ å’Œè·¯ç”±
- é›†æˆæµ‹è¯•å’Œä¼˜åŒ–

**ç¬¬3å‘¨ï¼šå†å²è®°å½•æŒä¹…åŒ–ï¼ˆP2ï¼‰**

**Day 1-2: åç«¯APIå¼€å‘**
- å†å²è®°å½•CRUD API
- æ•°æ®åº“è¿ç§»ï¼ˆPostgreSQLï¼‰

**Day 3-5: å‰ç«¯å†å²é¡µé¢**
- å†å²è®°å½•åˆ—è¡¨ï¼ˆåˆ†é¡µ+ç­›é€‰+æœç´¢ï¼‰
- é«˜çº§ç­›é€‰ï¼ˆæŒ‰ç­–ç•¥ç±»å‹ã€æ—¥æœŸã€æ”¶ç›Šç‡ï¼‰

**Day 6-7: è¯¦æƒ…é¡µ + é›†æˆ**
- å•æ¡è®°å½•è¯¦æƒ…å±•ç¤º
- å†æ¬¡è¿è¡Œã€åˆ é™¤åŠŸèƒ½

**ç¬¬4-5å‘¨ï¼šAIç­–ç•¥ç”Ÿæˆå™¨ï¼ˆP1 ğŸš€ æ ¸å¿ƒåˆ›æ–°ï¼‰**

**Week 4: åç«¯å¼€å‘**
- Day 1: é…ç½® DeepSeek API + Prompt è®¾è®¡
- Day 2-3: AI ç”ŸæˆæœåŠ¡å¼€å‘
- Day 4-5: ä»£ç éªŒè¯å™¨ + å®‰å…¨æ£€æŸ¥
- Day 6-7: æ²™ç®±æµ‹è¯•ç¯å¢ƒ + API ç«¯ç‚¹

**Week 9: å‰ç«¯å¼€å‘**
- Day 1-3: å‰ç«¯ AI ç”Ÿæˆå™¨ UI
- Day 4-5: æ•°æ®åº“é›†æˆ + ç­–ç•¥æŒä¹…åŒ–
- Day 6-7: Prompt è°ƒä¼˜ + é›†æˆæµ‹è¯•

**ç¬¬10å‘¨ï¼ˆå¯é€‰ï¼‰ï¼šç­–ç•¥ç»„åˆå¢å¼ºï¼ˆP3ï¼‰**
- Day 1-3: å®Œå–„ StrategyCombiner
- Day 4-5: æ–°å¢ SignalFilter
- Day 6-7: å…¨é¢æµ‹è¯•å’Œæ–‡æ¡£

**ç¬¬11-12å‘¨ï¼ˆå¯é€‰ï¼‰ï¼šä¼˜åŒ–ä¸ä¸Šçº¿å‡†å¤‡**
- Week 11: æ€§èƒ½ä¼˜åŒ–ã€Bugä¿®å¤ã€æ–‡æ¡£å®Œå–„
- Week 12: ç”¨æˆ·æµ‹è¯•ã€åé¦ˆæ”¶é›†ã€è¿­ä»£ä¼˜åŒ–

---

## å…«ã€é£é™©ä¸æ³¨æ„äº‹é¡¹

### 8.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| **AI ç”Ÿæˆä»£ç å®‰å…¨æ€§** | ğŸ”´ æé«˜ | ASTéªŒè¯ + æ²™ç®±éš”ç¦» + æ¨¡å—ç™½åå• |
| **AI ç”Ÿæˆä»£ç è´¨é‡ä¸ç¨³å®š** | ğŸŸ  é«˜ | Prompt å·¥ç¨‹è°ƒä¼˜ + å¤šæ¬¡ç”Ÿæˆé€‰é¡¹ |
| **DeepSeek API ä¾èµ–** | ğŸŸ  ä¸­ | ç›‘æ§ API å¯ç”¨æ€§ + é™çº§æ–¹æ¡ˆ |
| Core ç­–ç•¥è¿ç§»å…¼å®¹æ€§é—®é¢˜ | ğŸŸ  ä¸­ | é€ä¸ªè¿ç§»å¹¶å……åˆ†æµ‹è¯• |
| æ•°æ®åº“æ€§èƒ½ï¼ˆå†å²è®°å½•è¡¨å¢é•¿ï¼‰ | ğŸŸ¡ ä¸­ | å»ºç«‹ç´¢å¼•ï¼Œå®šæœŸå½’æ¡£æ—§æ•°æ® |
| **AI API æˆæœ¬å¤±æ§** | ğŸŸ¡ ä½ | ç”¨æˆ·é…é¢é™åˆ¶ + æˆæœ¬ç›‘æ§ |
| å‰ç«¯çŠ¶æ€ç®¡ç†å¤æ‚åŒ– | ğŸŸ¢ ä½ | ä½¿ç”¨ Zustand ç®¡ç†å…¨å±€çŠ¶æ€ |

### 8.2 ç”¨æˆ·ä½“éªŒé£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|---------|
| ç­–ç•¥è¿‡å¤šå¯¼è‡´é€‰æ‹©å›°éš¾ | ä¸­ | æä¾›åˆ†ç±»ã€æœç´¢ã€æ¨èåŠŸèƒ½ |
| å‚æ•°é…ç½®å¤æ‚åº¦å¢åŠ  | ä¸­ | æä¾›é¢„è®¾æ¨¡æ¿å’Œé»˜è®¤å€¼ |
| å†å²è®°å½•è¿‡å¤šæŸ¥æ‰¾å›°éš¾ | ä½ | æä¾›ç­›é€‰ã€æ’åºã€æœç´¢åŠŸèƒ½ |

### 8.3 æ³¨æ„äº‹é¡¹

**ä»£ç å±‚é¢ï¼š**
1. æ‰€æœ‰ç­–ç•¥å¿…é¡»ç»§æ‰¿ `BaseStrategy` å¹¶å®ç°å®Œæ•´æ¥å£
2. å‚æ•°éªŒè¯è¦ä¸¥æ ¼ï¼Œé¿å…æ— æ•ˆé…ç½®
3. é”™è¯¯å¤„ç†è¦å®Œå–„ï¼Œé¿å…æœåŠ¡å´©æºƒ
4. æ—¥å¿—è®°å½•è¦è¯¦ç»†ï¼Œæ–¹ä¾¿è°ƒè¯•
5. **AI ç”Ÿæˆä»£ç å¿…é¡»ç»è¿‡ä¸‰é‡éªŒè¯**ï¼šè¯­æ³•æ£€æŸ¥ â†’ å®‰å…¨æ£€æŸ¥ â†’ æ²™ç®±æµ‹è¯•

**æ•°æ®å±‚é¢ï¼š**
1. å›æµ‹ç»“æœ JSON å¯èƒ½å¾ˆå¤§ï¼Œè€ƒè™‘å‹ç¼©å­˜å‚¨
2. å»ºç«‹åˆç†çš„æ•°æ®åº“ç´¢å¼•
3. å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®
4. **AI ç”Ÿæˆç­–ç•¥å•ç‹¬å­˜è¡¨**ï¼Œä¾¿äºç®¡ç†å’Œå®¡æ ¸

**ç”¨æˆ·å±‚é¢ï¼š**
1. æä¾›æ¸…æ™°çš„ç­–ç•¥è¯´æ˜æ–‡æ¡£
2. å‚æ•°é…ç½®è¦æœ‰åˆç†çš„é»˜è®¤å€¼
3. é”™è¯¯æç¤ºè¦å‹å¥½ä¸”å¯æ“ä½œ
4. åŠ è½½çŠ¶æ€è¦æ˜ç¡®
5. **AI ç”Ÿæˆå¤±è´¥æ—¶æä¾›å…·ä½“å»ºè®®**ï¼Œå¼•å¯¼ç”¨æˆ·ä¼˜åŒ–æè¿°

**å®‰å…¨å±‚é¢ï¼ˆAI ç‰¹æœ‰ï¼‰ï¼š**
1. **ç¦æ­¢å±é™©æ¨¡å—**ï¼šos, subprocess, eval, exec ç­‰
2. **æ²™ç®±éš”ç¦»**ï¼šç‹¬ç«‹è¿›ç¨‹æˆ– Docker å®¹å™¨è¿è¡Œ
3. **ä»£ç å®¡æ ¸**ï¼šé«˜é£é™©ç­–ç•¥éœ€äººå·¥å®¡æ ¸åå‘å¸ƒ
4. **ç”¨æˆ·é…é¢**ï¼šé™åˆ¶æ¯æ—¥ç”Ÿæˆæ¬¡æ•°ï¼Œé˜²æ­¢æ»¥ç”¨
5. **ç›‘æ§å‘Šè­¦**ï¼šå¼‚å¸¸ä»£ç ç”Ÿæˆç«‹å³å‘Šè­¦

---

### 8.4 AI æˆæœ¬åˆ†æä¸æ§åˆ¶ ğŸ’°

#### DeepSeek API å®šä»·ï¼ˆ2024å¹´å‚è€ƒï¼‰

| æ¨¡å‹ | è¾“å…¥ä»·æ ¼ | è¾“å‡ºä»·æ ¼ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| deepseek-coder | Â¥0.001/1K tokens | Â¥0.002/1K tokens | ä»£ç ç”Ÿæˆï¼ˆæ¨èï¼‰ |
| deepseek-chat | Â¥0.001/1K tokens | Â¥0.002/1K tokens | é€šç”¨å¯¹è¯ |

#### å•æ¬¡ç”Ÿæˆæˆæœ¬ä¼°ç®—

**å…¸å‹ç­–ç•¥ç”Ÿæˆï¼š**
- Prompt é•¿åº¦ï¼š~1500 tokens
- ç”Ÿæˆä»£ç ï¼š~800 tokens
- **å•æ¬¡æˆæœ¬ï¼šÂ¥0.05-0.10**

**å¤æ‚ç­–ç•¥ç”Ÿæˆï¼š**
- Prompt é•¿åº¦ï¼š~2000 tokens
- ç”Ÿæˆä»£ç ï¼š~1200 tokens
- **å•æ¬¡æˆæœ¬ï¼šÂ¥0.10-0.15**

#### æœˆåº¦æˆæœ¬é¢„æµ‹

| ç”¨æˆ·è§„æ¨¡ | äººå‡ç”Ÿæˆæ¬¡æ•° | æ€»ç”Ÿæˆæ¬¡æ•° | æœˆæˆæœ¬ |
|---------|-------------|-----------|--------|
| 100 ç”¨æˆ· | 5æ¬¡/æœˆ | 500æ¬¡ | Â¥25-50 |
| 1000 ç”¨æˆ· | 5æ¬¡/æœˆ | 5000æ¬¡ | Â¥250-500 |
| 5000 ç”¨æˆ· | 3æ¬¡/æœˆ | 15000æ¬¡ | Â¥750-1500 |
| 10000 ç”¨æˆ· | 3æ¬¡/æœˆ | 30000æ¬¡ | Â¥1500-3000 |

#### æˆæœ¬æ§åˆ¶ç­–ç•¥

**1. ç”¨æˆ·é…é¢ç®¡ç†**
```python
# ä¸åŒç”¨æˆ·ç­‰çº§çš„é…é¢
USER_QUOTAS = {
    "free": 3,        # å…è´¹ç”¨æˆ·ï¼š3æ¬¡/å¤©
    "basic": 10,      # åŸºç¡€ä¼šå‘˜ï¼š10æ¬¡/å¤©
    "pro": 30,        # ä¸“ä¸šä¼šå‘˜ï¼š30æ¬¡/å¤©
    "unlimited": -1   # æ— é™åˆ¶
}
```

**2. ç¼“å­˜ç›¸ä¼¼è¯·æ±‚**
- å¯¹ç›¸åŒæˆ–ç›¸ä¼¼çš„æè¿°ï¼Œè¿”å›ç¼“å­˜ç»“æœ
- ä½¿ç”¨è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é…
- ç¼“å­˜æœ‰æ•ˆæœŸï¼š7å¤©

**3. Prompt ä¼˜åŒ–**
- å‹ç¼© Prompt é•¿åº¦ï¼Œå‡å°‘ä¸å¿…è¦çš„è¯´æ˜
- ä½¿ç”¨æ›´ç®€æ´çš„ç¤ºä¾‹
- é¢„ä¼°å¯èŠ‚çœï¼š20-30% tokens

**4. åˆ†çº§å®šä»·**
```
å…è´¹ç‰ˆï¼š3æ¬¡/å¤©ï¼Œå«å¹¿å‘Š
åŸºç¡€ç‰ˆï¼šÂ¥19/æœˆï¼Œ10æ¬¡/å¤©
ä¸“ä¸šç‰ˆï¼šÂ¥99/æœˆï¼Œæ— é™æ¬¡
ä¼ä¸šç‰ˆï¼šæŒ‰éœ€å®šåˆ¶
```

**5. æˆæœ¬ç›‘æ§**
```python
# å®æ—¶ç›‘æ§ API è°ƒç”¨
async def monitor_ai_costs():
    daily_cost = await get_daily_ai_cost()
    if daily_cost > DAILY_BUDGET:
        alert_admin("AI æˆæœ¬è¶…é¢„ç®—ï¼")
        enable_rate_limit()
```

#### ROI åˆ†æ

**æŠ•å…¥ï¼š**
- AI API æˆæœ¬ï¼šÂ¥500/æœˆï¼ˆ1000ç”¨æˆ·è§„æ¨¡ï¼‰
- å¼€å‘æˆæœ¬ï¼š2å‘¨ Ã— 2äºº = 4äººå‘¨
- ç»´æŠ¤æˆæœ¬ï¼š0.5äººå¤©/æœˆ

**äº§å‡ºï¼š**
- ç”¨æˆ·å¢é•¿ï¼šé¢„è®¡ +30%ï¼ˆç‹¬ç‰¹åŠŸèƒ½å¸å¼•ï¼‰
- ç”¨æˆ·ç•™å­˜ï¼š+40%ï¼ˆä¸ªæ€§åŒ–ç­–ç•¥ï¼‰
- ä»˜è´¹è½¬åŒ–ï¼š+25%ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
- å“ç‰Œä»·å€¼ï¼šè¡Œä¸šé¦–åˆ›ï¼Œåª’ä½“æ›å…‰

**ç»“è®ºï¼š**
- **æé«˜æ€§ä»·æ¯”**ï¼ŒAPI æˆæœ¬ä»…æ•°ç™¾å…ƒ/æœˆ
- ç”¨æˆ·ä»·å€¼å’Œå“ç‰Œä»·å€¼è¿œè¶…æˆæœ¬
- **å¼ºçƒˆæ¨èå®æ–½ï¼**

---

## ä¹ã€åç»­ä¼˜åŒ–æ–¹å‘

### 9.1 çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰

1. **ç­–ç•¥å›æµ‹æŠ¥å‘Šä¼˜åŒ–**
   - å¢åŠ æ›´å¤šå¯è§†åŒ–å›¾è¡¨
   - æ”¯æŒå¯¼å‡º PDF æŠ¥å‘Š
   - å¢åŠ ç­–ç•¥å¯¹æ¯”åˆ†æ

2. **å‚æ•°ä¼˜åŒ–åŠŸèƒ½**
   - ç½‘æ ¼æœç´¢æœ€ä¼˜å‚æ•°
   - å‚æ•°æ•æ„Ÿæ€§åˆ†æ
   - å‚æ•°æ¨è

3. **å®ç›˜æ¨¡æ‹Ÿ**
   - çº¸é¢äº¤æ˜“æ¨¡æ‹Ÿ
   - å®æ—¶ä¿¡å·æ¨é€
   - äº¤æ˜“æ—¥å¿—è®°å½•

### 9.2 ä¸­æœŸä¼˜åŒ–ï¼ˆ3-6æœˆï¼‰

1. **ç¤¾åŒºåŠŸèƒ½**
   - ç­–ç•¥åˆ†äº«å’Œè®¨è®º
   - ç­–ç•¥è¯„åˆ†å’Œè¯„è®º
   - ç­–ç•¥æ’è¡Œæ¦œ

2. **é«˜çº§ç»„åˆåŠŸèƒ½**
   - å¯è§†åŒ–ç­–ç•¥ç¼–æ’
   - è‡ªå®šä¹‰ç»„åˆè§„åˆ™
   - åŠ¨æ€æƒé‡è°ƒæ•´

3. **æ€§èƒ½ä¼˜åŒ–**
   - å›æµ‹åŠ é€Ÿï¼ˆå¹¶è¡Œè®¡ç®—ï¼‰
   - ç¼“å­˜ä¼˜åŒ–
   - å¢é‡å›æµ‹

### 9.3 é•¿æœŸè§„åˆ’ï¼ˆ6-12æœˆï¼‰

1. **ç­–ç•¥å¸‚åœº**
   - ç­–ç•¥ä»˜è´¹è®¢é˜…
   - ç­–ç•¥ä½œè€…æ¿€åŠ±
   - ç­–ç•¥å®¡æ ¸æœºåˆ¶

2. **AI è¾…åŠ©å¢å¼º**
   - âœ… ç­–ç•¥è‡ªåŠ¨ç”Ÿæˆï¼ˆå·²å®ç°ï¼‰
   - ç­–ç•¥ä»£ç ä¼˜åŒ–å»ºè®®
   - å‚æ•°æ™ºèƒ½ä¼˜åŒ–
   - é£é™©æ™ºèƒ½é¢„è­¦
   - å¤šæ¨¡å‹æ”¯æŒï¼ˆClaudeã€GPT-4ï¼‰

3. **å¤šå¸‚åœºæ”¯æŒ**
   - ç¾è‚¡ã€æ¸¯è‚¡æ”¯æŒ
   - æœŸè´§ã€æœŸæƒæ”¯æŒ
   - åŠ å¯†è´§å¸æ”¯æŒ

---

## åã€æ€»ç»“

æœ¬æ–¹æ¡ˆåŸºäºå¯¹ç°æœ‰ç³»ç»Ÿçš„æ·±å…¥åˆ†æå’Œä¸»æµé‡åŒ–å¹³å°æœ€ä½³å®è·µçš„ç ”ç©¶ï¼Œæå‡ºäº†ä¸€å¥—å®Œæ•´çš„å‰ç«¯å›æµ‹æ¨¡å—æ”¹è¿›è®¡åˆ’ã€‚

**æ ¸å¿ƒæ¶æ„å†³ç­–ï¼ˆv3.0 é‡å¤§å˜æ›´ï¼‰ï¼š**

1. ğŸ—ï¸ **é‡‡ç”¨ä¸‰å±‚åˆ†ç¦»æ¶æ„**ï¼ˆæœ€é‡è¦å†³ç­–ï¼‰
   - Layer 1: è‚¡ç¥¨é€‰æ‹©å™¨ï¼ˆStockSelectorï¼‰- å‘¨é¢‘/æœˆé¢‘é€‰è‚¡
   - Layer 2: å…¥åœºç­–ç•¥ï¼ˆEntryStrategyï¼‰- æ—¥é¢‘ä¹°å…¥ä¿¡å·
   - Layer 3: é€€å‡ºç­–ç•¥ï¼ˆExitStrategyï¼‰- æ—¥é¢‘å–å‡ºä¿¡å·
   - **å‚è€ƒ**ï¼šZipline Pipelineã€Backtraderã€èšå®½ã€ç±³ç­ç­‰ä¸»æµå¹³å°

2. âœ… è¡¥å…¨ç­–ç•¥åº“ï¼ˆä»2ä¸ªå¢åŠ åˆ°5ä¸ªå†…ç½®ç­–ç•¥ï¼‰

3. âœ… æ–°å¢ç­–ç•¥ä¸­å¿ƒå’Œå†å²è®°å½•ç®¡ç†

4. ğŸš€ **AI ç­–ç•¥ç”Ÿæˆå™¨ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰**
   - è‡ªç„¶è¯­è¨€ â†’ ç­–ç•¥ä»£ç 
   - ä½¿ç”¨ DeepSeek API (deepseek-coder)
   - AST éªŒè¯ + æ²™ç®±æµ‹è¯•

5. âœ… æ”¯æŒå¤–éƒ¨é€‰è‚¡é›†æˆï¼ˆExternalSelectorï¼‰
   - StarRanker é€‰è‚¡ç»“æœ
   - è‡ªå®šä¹‰ API æ•°æ®æº
   - æ‰‹åŠ¨è‚¡ç¥¨æ± 

**æ¶æ„å˜æ›´å¸¦æ¥çš„æ ¸å¿ƒä»·å€¼ï¼š**

| å¯¹æ¯”é¡¹ | åŸæ¶æ„ï¼ˆè€¦åˆï¼‰ | æ–°æ¶æ„ï¼ˆä¸‰å±‚åˆ†ç¦»ï¼‰ |
|--------|--------------|------------------|
| å¤–éƒ¨é€‰è‚¡æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… ExternalSelector |
| ç­–ç•¥ç»„åˆçµæ´»æ€§ | âŒ Nä¸ªç­–ç•¥ | âœ… NÂ³ä¸ªç»„åˆï¼ˆç¬›å¡å°”ç§¯ï¼‰ |
| é€€å‡ºç­–ç•¥å¤ç”¨ | âŒ æ¯æ¬¡é‡å†™ | âœ… è·¨ç­–ç•¥å¤ç”¨ |
| ä¸åŒé¢‘ç‡æ”¯æŒ | âŒ åŒä¸€é¢‘ç‡ | âœ… é€‰è‚¡å‘¨é¢‘+äº¤æ˜“æ—¥é¢‘ |
| ç ”ç©¶æ•ˆç‡ | ğŸŸ¡ ä¸­ | âœ… å›¢é˜Ÿåˆ†å·¥åä½œ |
| å¯¹é½è¡Œä¸šæ ‡å‡† | âŒ å¦ | âœ… æ˜¯ï¼ˆZipline/èšå®½/ç±³ç­ï¼‰ |

**è§£å†³çš„æ ¸å¿ƒç—›ç‚¹ï¼š**

1. âœ… **æ— æ³•åº”ç”¨ StarRanker é€‰è‚¡**ï¼ˆåŸæ¶æ„æœ€å¤§ç—›ç‚¹ï¼‰
   ```python
   # ç°åœ¨å¯ä»¥å®ç°
   strategy = StrategyComposer(
       selector=ExternalSelector(source="starranker"),
       entry=MABreakoutEntry(),
       exit=ATRStopLossExit()
   )
   ```

2. âœ… **ç­–ç•¥å¤ç”¨ç‡ä½**
   - åŸæ¥ï¼šä¿®æ”¹æ­¢æŸéœ€è¦é‡å†™æ•´ä¸ªç­–ç•¥
   - ç°åœ¨ï¼šç‹¬ç«‹çš„ ExitStrategy å¯åº”ç”¨äºä»»æ„å…¥åœºç­–ç•¥

3. âœ… **æ— æ³•çµæ´»ç»„åˆ**
   - åŸæ¥ï¼šNä¸ªç­–ç•¥
   - ç°åœ¨ï¼š3ä¸ªé€‰è‚¡å™¨ Ã— 3ä¸ªå…¥åœº Ã— 3ä¸ªé€€å‡º = 27ç§ç»„åˆ

**é¢„æœŸæ”¶ç›Šï¼š**

- **ç­–ç•¥æ•°é‡**ï¼š
  - å†…ç½®ï¼š3ä¸ªé€‰è‚¡å™¨ + 3ä¸ªå…¥åœºç­–ç•¥ + 4ä¸ªé€€å‡ºç­–ç•¥
  - ç»„åˆï¼š3 Ã— 3 Ã— 4 = 36 ç§åŸºç¡€ç»„åˆ
  - AIç”Ÿæˆï¼šç”¨æˆ·æ— é™æ‰©å±•

- **ç”¨æˆ·èƒ½åŠ›æå‡**ï¼š
  - ä»"åªèƒ½ç”¨2ä¸ªå›ºå®šç­–ç•¥"
  - åˆ°"36ç§ç»„åˆ + å¤–éƒ¨é€‰è‚¡ + AIç”Ÿæˆ"

- **åˆ›æ–°æ€§**ï¼š
  - âœ… å›½å†…é¦–ä¸ªä¸‰å±‚åˆ†ç¦»æ¶æ„çš„ä¸ªäººé‡åŒ–å¹³å°
  - âœ… è¡Œä¸šé¢†å…ˆçš„ AI è¾…åŠ©é‡åŒ–äº¤æ˜“
  - âœ… æ— ç¼é›†æˆ StarRanker ç­‰å¤–éƒ¨ä¿¡å·æº

- **ç”¨æˆ·ç²˜æ€§**ï¼š
  - ä¸ªæ€§åŒ–ç­–ç•¥å¤§å¹…æå‡ç•™å­˜ç‡
  - æ”¯æŒä»æ–°æ‰‹åˆ°ä¸“å®¶çš„æˆé•¿è·¯å¾„

**å®æ–½å‘¨æœŸï¼ˆv3.0 æ›´æ–°ï¼‰ï¼š**

- **æ€»å·¥ä½œé‡**ï¼š40.5-62å¤©ï¼ˆçº¦ 8-12å‘¨ï¼‰
- **æ¨èæ’æœŸ**ï¼š10-12å‘¨
- **å…³é”®è·¯å¾„**ï¼š
  - Week 1-4: ä¸‰å±‚æ¶æ„é‡æ„ï¼ˆP0 â­ï¼‰
  - Week 5-6: ç­–ç•¥åº“å’Œå‰ç«¯
  - Week 7: å†å²è®°å½•
  - Week 8-9: AI ç”Ÿæˆå™¨ ğŸš€
  - Week 10-12: ä¼˜åŒ–ä¸Šçº¿ï¼ˆå¯é€‰ï¼‰

- **åˆ†é˜¶æ®µäº¤ä»˜**ï¼š
  1. ç¬¬4å‘¨ï¼šä¸‰å±‚æ¶æ„ MVPï¼ˆæ”¯æŒåŸºç¡€ç»„åˆï¼‰
  2. ç¬¬6å‘¨ï¼šå®Œæ•´ç­–ç•¥ä¸­å¿ƒ
  3. ç¬¬9å‘¨ï¼šAI ç”Ÿæˆå™¨ä¸Šçº¿
  4. ç¬¬12å‘¨ï¼šå…¨é¢ä¼˜åŒ–

**æŠ€æœ¯æ ˆï¼š**

- **å‰ç«¯**ï¼šNext.js 14 + React + TypeScript
- **åç«¯**ï¼šFastAPI + Python
- **æ•°æ®åº“**ï¼šPostgreSQL (TimescaleDB)
- **Core**ï¼šPython é‡åŒ–ç­–ç•¥åº“
- **AI æœåŠ¡**ï¼šDeepSeek API (deepseek-coder)
- **å®‰å…¨**ï¼šAST åˆ†æ + æ²™ç®±éš”ç¦»
- **å¤–éƒ¨é›†æˆ**ï¼šStarRanker API

**æˆæœ¬åˆ†æï¼ˆAI éƒ¨åˆ†ï¼‰ï¼š**

| é¡¹ç›® | å•ä»· | æœˆé¢„ä¼° |
|------|------|--------|
| DeepSeek API | Â¥1/ç™¾ä¸‡tokens | Â¥0.05-0.10/æ¬¡ç”Ÿæˆ |
| é¢„ä¼°ç”¨é‡ | 1000ç”¨æˆ· Ã— 5æ¬¡/æœˆ | Â¥250-500/æœˆ |
| ROI | ç”¨æˆ·ç•™å­˜æå‡ > æˆæœ¬ | **éå¸¸å€¼å¾—** |

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²ï¼š**

- **v1.0** (2026-02-05): åˆå§‹ç‰ˆæœ¬
- **v2.0** (2026-02-05): åŠ å…¥ AI ç­–ç•¥ç”Ÿæˆå™¨
- **v3.0** (2026-02-06): **æ¶æ„é‡å¤§å˜æ›´** - ä¸‰å±‚åˆ†ç¦»æ¶æ„

**æœ¬æ¬¡æ›´æ–°å†…å®¹ï¼ˆv3.0ï¼‰ï¼š**

1. ğŸ—ï¸ **å®Œå…¨é‡å†™ç¬¬å››ç« **ï¼šç­–ç•¥æ¶æ„å†³ç­–
   - æ·»åŠ å½“å‰æ¶æ„é—®é¢˜è¯Šæ–­
   - æ·»åŠ ä¸»æµå¹³å°æ¶æ„ç ”ç©¶ï¼ˆBacktrader/Zipline/vnpy/èšå®½/ç±³ç­ï¼‰
   - æä¾›å®Œæ•´çš„ä¸‰å±‚æ¶æ„è®¾è®¡å’Œä»£ç ç¤ºä¾‹

2. â­ **æ–°å¢ç¬¬äº”ç«  5.0 èŠ‚**ï¼šä¸‰å±‚æ¶æ„é‡æ„å®æ–½è®¡åˆ’
   - 6ä¸ªè¯¦ç»†ä»»åŠ¡ï¼ˆè®¾è®¡åŸºç±»ã€å®ç°é€‰è‚¡å™¨/å…¥åœº/é€€å‡ºç­–ç•¥ã€å¼•æ“é€‚é…ã€APIï¼‰
   - å®Œæ•´ä»£ç ç¤ºä¾‹å’Œå®æ–½æ­¥éª¤
   - å·¥ä½œé‡ï¼š17-25å¤©

3. ğŸ“Š **æ›´æ–°ç¬¬ä¸ƒç« **ï¼šå·¥ä½œé‡è¯„ä¼°
   - æ€»å·¥æœŸï¼šä» 23-37.5å¤© å¢è‡³ 40.5-62å¤©
   - æ’æœŸï¼šä» 5-6å‘¨ å¢è‡³ 10-12å‘¨
   - æ·»åŠ è¯¦ç»†çš„å‘¨è®¡åˆ’

4. ğŸ“ **æ›´æ–°ç¬¬åç« **ï¼šæ€»ç»“
   - å¼ºè°ƒä¸‰å±‚æ¶æ„å¸¦æ¥çš„æ ¸å¿ƒä»·å€¼
   - æ·»åŠ æ¶æ„å¯¹æ¯”è¡¨
   - æ›´æ–°é¢„æœŸæ”¶ç›Šå’ŒæŠ€æœ¯æ ˆ

**å…³é”®å†³ç­–å˜æ›´ï¼š**

| ç‰ˆæœ¬ | æ¶æ„å†³ç­– | ç†ç”± |
|------|---------|------|
| v1.0 | å®Œæ•´ç­–ç•¥æ¨¡å¼ | ç®€å•æ˜“å®ç° |
| v2.0 | å®Œæ•´ç­–ç•¥ + AIç”Ÿæˆ | å¢åŠ åˆ›æ–°æ€§ |
| v3.0 | **ä¸‰å±‚åˆ†ç¦»æ¶æ„** | **å¯¹é½è¡Œä¸šæœ€ä½³å®è·µï¼Œè§£å†³æ ¸å¿ƒç—›ç‚¹** |

**æ¶æ„æ¼”è¿›åŸå› ï¼š**

1. **ç”¨æˆ·éœ€æ±‚é©±åŠ¨**ï¼š
   - éœ€è¦åº”ç”¨ StarRanker é€‰è‚¡åˆ°è‡ªå®šä¹‰äº¤æ˜“ç­–ç•¥
   - éœ€è¦ç‹¬ç«‹è°ƒæ•´æ­¢æŸç­–ç•¥è€Œä¸é‡å†™æ•´ä¸ªç­–ç•¥
   - éœ€è¦å¿«é€Ÿç»„åˆæµ‹è¯•ä¸åŒç­–ç•¥æ¨¡å—

2. **è¡Œä¸šå¯¹æ ‡**ï¼š
   - Ziplineã€Backtraderã€èšå®½ã€ç±³ç­ç­‰ä¸»æµå¹³å°å‡é‡‡ç”¨ç±»ä¼¼æ¶æ„
   - è¿™æ˜¯ç»è¿‡å¸‚åœºéªŒè¯çš„æœ€ä½³å®è·µï¼Œä¸æ˜¯å®ƒä»¬çš„ä¸è¶³

3. **æŠ€æœ¯å€ºåŠ¡æ¸…ç†**ï¼š
   - åŸæ¶æ„çš„ `calculate_scores()` è®¾è®¡å­˜åœ¨ç¼ºé™·
   - å›æµ‹å¼•æ“å¼ºè€¦åˆé€‰è‚¡é€»è¾‘
   - Backend ç­–ç•¥æ— æ³•å¤„ç†è‚¡ç¥¨æ± 

**é£é™©ä¸å¯¹ç­–ï¼š**

| é£é™© | ç¼“è§£æªæ–½ |
|------|---------|
| å·¥æœŸå»¶é•¿ï¼ˆ5å‘¨â†’12å‘¨ï¼‰ | åˆ†é˜¶æ®µäº¤ä»˜ï¼Œç¬¬4å‘¨å³å¯å‘å¸ƒMVP |
| å­¦ä¹ æ›²çº¿é™¡å³­ | æä¾›è¯¦ç»†æ–‡æ¡£å’Œä»£ç ç¤ºä¾‹ |
| å‘åå…¼å®¹æ€§ | ä¿ç•™åŸæœ‰å®Œæ•´ç­–ç•¥æ¥å£ï¼Œå¹³æ»‘è¿ç§» |

**å‚è€ƒèµ„æ–™ï¼š**

- [Zipline Pipeline å®˜æ–¹æ–‡æ¡£](https://zipline.ml4trading.io/)
- [Backtrader ç­–ç•¥æ–‡æ¡£](https://www.backtrader.com/docu/strategy/)
- [èšå®½ API æ–‡æ¡£](https://www.joinquant.com/help/api/doc)
- [ç±³ç­é‡åŒ–æ–‡æ¡£](https://www.ricequant.com/doc/quant/)
- [DeepSeek API æ–‡æ¡£](https://platform.deepseek.com/docs)
- [AST å®‰å…¨æ£€æŸ¥](https://docs.python.org/3/library/ast.html)
- [é¡¹ç›® GitHub](https://github.com/your-repo/stock-analysis)

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼ˆ2026-02-07æ›´æ–°ï¼‰ï¼š**

~~åŸè®¡åˆ’ï¼ˆv3.0ï¼‰~~ï¼š
1. ~~å¼€å§‹ç¬¬1å‘¨å¼€å‘ï¼šä¸‰å±‚åŸºç±»è®¾è®¡~~
2. ~~ç¬¬4å‘¨å‘å¸ƒ MVP~~
3. ~~ç¬¬12å‘¨æ­£å¼ä¸Šçº¿~~

**æ–°è®¡åˆ’ï¼ˆv3.1ï¼‰**ï¼š
1. âœ… Core v3.1.0 å·²å®Œæˆä¸‰å±‚æ¶æ„ï¼ˆå·²å®Œæˆï¼‰
2. âœ… Backend v3.0.0 å·²å®Œæˆ5ä¸ªAPIï¼ˆå·²å®Œæˆï¼‰
3. ğŸš€ **ç«‹å³å¼€å§‹å‰ç«¯é›†æˆ**ï¼ˆç¬¬1å‘¨ï¼šAPIæœåŠ¡å±‚ + UIç»„ä»¶ï¼‰
4. ğŸ“‹ ç¬¬2å‘¨å‘å¸ƒä¸‰å±‚å›æµ‹MVP
5. ğŸ¯ ç¬¬5-7å‘¨å®Œæ•´åŠŸèƒ½ä¸Šçº¿ï¼ˆæ¯”åŸè®¡åˆ’æå‰5å‘¨ï¼‰

**ç»“è¯­ï¼ˆ2026-02-07æ›´æ–°ï¼‰ï¼š**

æœ¬æ¬¡æ–‡æ¡£æ›´æ–°åæ˜ äº†é‡å¤§è¿›å±•ï¼š

- âœ… **Coreå’ŒBackendæå‰å®Œæˆ**ä¸‰å±‚æ¶æ„å¼€å‘
- âœ… **å·¥æœŸç¼©çŸ­38-40%**ï¼ˆä»10-12å‘¨é™è‡³5-7.5å‘¨ï¼‰
- âœ… **å‰ç«¯å·¥ä½œé‡å¤§å¹…å‡å°‘**ï¼ˆæ— éœ€åç«¯å¼€å‘ï¼Œä¸“æ³¨UIé›†æˆï¼‰
- âœ… **æŠ€æœ¯å€ºåŠ¡å·²æ¸…é›¶**ï¼ˆ129ä¸ªæµ‹è¯•100%é€šè¿‡ï¼‰

è¿™ä¸ºå‰ç«¯å›¢é˜Ÿæä¾›äº†**ç”Ÿäº§å°±ç»ªçš„API**ï¼Œå¯ä»¥ç«‹å³å¼€å§‹é›†æˆå·¥ä½œï¼Œé¢„è®¡**2ä¸ªæœˆå†…å®Œæˆå…¨éƒ¨åŠŸèƒ½**ã€‚

---

## ğŸ“‹ é™„å½•ï¼šæ–‡æ¡£æ›´æ–°æ—¥å¿—

### v3.1 (2026-02-07) - é‡å¤§æ›´æ–°

**æ›´æ–°åŸå› **ï¼šCore v3.1.0å’ŒBackend v3.0.0å·²å®Œæˆä¸‰å±‚æ¶æ„å®ç°

**ä¸»è¦å˜æ›´**ï¼š

1. **ç­–ç•¥å®ç°æƒ…å†µï¼ˆÂ§1.1.4ï¼‰**ï¼š
   - âŒ åˆ é™¤ï¼š5ä¸ªä¼ ç»Ÿç­–ç•¥æè¿°
   - âœ… æ–°å¢ï¼šä¸‰å±‚æ¶æ„11ä¸ªç»„ä»¶è¯¦ç»†ä¿¡æ¯
   - âœ… æ–°å¢ï¼šBackend 5ä¸ªAPIç«¯ç‚¹è¯´æ˜

2. **æ ¸å¿ƒé—®é¢˜è¯Šæ–­ï¼ˆÂ§2ï¼‰**ï¼š
   - âœ… æ–°å¢P0é—®é¢˜ï¼šå‰ç«¯æœªé›†æˆä¸‰å±‚æ¶æ„API
   - âœ… æ–°å¢æ•°æ®å·®å¼‚åˆ†æï¼šæ¶æ„èƒ½åŠ›å¯¹æ¯”è¡¨
   - âœ… æ–°å¢æŠ€æœ¯å€ºåŠ¡ç»Ÿè®¡ï¼šåˆ©ç”¨ç‡ä»…4.2%

3. **é˜¶æ®µé›¶ä»»åŠ¡ï¼ˆÂ§5.0ï¼‰**ï¼š
   - âŒ åˆ é™¤ï¼š17-25å¤©åç«¯å¼€å‘ä»»åŠ¡
   - âœ… æ–°å¢ï¼š2-3å¤©APIé›†æˆ + 3-4å¤©UIå¼€å‘
   - âœ… èŠ‚çœå·¥ä½œé‡ï¼š72-80%

4. **é˜¶æ®µä¸€ä»»åŠ¡ï¼ˆÂ§5.1ï¼‰**ï¼š
   - âŒ æ ‡è®°ä¸ºå·²åºŸå¼ƒï¼šè¿ç§»3ä¸ªç­–ç•¥ï¼ˆ3.5-6.5å¤©ï¼‰
   - âœ… è¯´æ˜ï¼šä¸‰å±‚æ¶æ„å·²æ›¿ä»£ä¼ ç»Ÿç­–ç•¥

5. **å·¥ä½œé‡è¯„ä¼°ï¼ˆÂ§7.1ï¼‰**ï¼š
   - åŸè®¡åˆ’ï¼š40.5-62å¤©ï¼ˆ10-12å‘¨ï¼‰
   - æ–°è®¡åˆ’ï¼š25-37.5å¤©ï¼ˆ5-7.5å‘¨ï¼‰
   - èŠ‚çœï¼š38-40%

6. **APIç«¯ç‚¹æ±‡æ€»ï¼ˆÂ§6.2ï¼‰**ï¼š
   - âœ… æ–°å¢ï¼šä¸‰å±‚æ¶æ„5ä¸ªAPIè¯¦ç»†è¯´æ˜
   - âœ… æ–°å¢ï¼šå“åº”ç¤ºä¾‹ï¼ˆJSONæ ¼å¼ï¼‰
   - âœ… æ–°å¢ï¼šç¼“å­˜ç­–ç•¥è¯´æ˜

7. **å‰ç«¯è·¯ç”±æ±‡æ€»ï¼ˆÂ§6.3ï¼‰**ï¼š
   - âœ… æ–°å¢ï¼š`/backtest/three-layer` æ ¸å¿ƒé¡µé¢ï¼ˆP0ä¼˜å…ˆçº§ï¼‰
   - âœ… æ›´æ–°ï¼šé¡µé¢åŠŸèƒ½è¯¦ç»†è¯´æ˜

8. **æ¨èæ’æœŸï¼ˆÂ§7.2ï¼‰**ï¼š
   - ~~åŸè®¡åˆ’ï¼š10-12å‘¨~~
   - æ–°è®¡åˆ’ï¼š5-7.5å‘¨
   - âœ… è¯¦ç»†å‘¨åº¦è®¡åˆ’æ›´æ–°

**å½±å“èŒƒå›´**ï¼š
- æ¶‰åŠç« èŠ‚ï¼šÂ§1.1, Â§2, Â§5.0, Â§5.1, Â§6.2, Â§6.3, Â§7
- æ–‡æ¡£è¡Œæ•°å˜åŒ–ï¼š+200è¡Œï¼ˆæ–°å¢è¯´æ˜å’Œå¯¹æ¯”è¡¨ï¼‰
- ä»£ç ç¤ºä¾‹ï¼š+3ä¸ªï¼ˆå‰ç«¯APIé›†æˆï¼‰

**ä¸‹ä¸€æ­¥**ï¼š
- å‰ç«¯å›¢é˜Ÿå¯ç«‹å³å¼€å§‹APIé›†æˆ
- é¢„è®¡2026å¹´3æœˆä¸­æ—¬å®Œæˆå…¨éƒ¨åŠŸèƒ½

---

### v3.0 (2026-02-06) - åˆå§‹ç‰ˆæœ¬

**æ ¸å¿ƒå†³ç­–**ï¼šé‡‡ç”¨ä¸‰å±‚åˆ†ç¦»æ¶æ„

**ä¸»è¦å†…å®¹**ï¼š
- ä¸‰å±‚æ¶æ„è®¾è®¡æ–¹æ¡ˆ
- 5ä¸ªé˜¶æ®µè¯¦ç»†å®æ–½è®¡åˆ’
- AIç­–ç•¥ç”Ÿæˆå™¨è®¾è®¡
- 10-12å‘¨å·¥æœŸä¼°ç®—

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Claude Code
**æœ€åæ›´æ–°**: 2026-02-07
**æ–‡æ¡£ç‰ˆæœ¬**: v3.1
**é¡¹ç›®ç‰ˆæœ¬**: Core v3.1.0, Backend v3.0.0, Frontend v1.0

