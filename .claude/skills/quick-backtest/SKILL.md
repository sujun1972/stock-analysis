---
name: quick-backtest
description: ä½¿ç”¨é¢„è®¾å‚æ•°å¿«é€Ÿè¿è¡Œç­–ç•¥å›žæµ‹å¹¶åˆ†æžç»©æ•ˆï¼ˆæ”¯æŒå¤šç§é€‰è‚¡ç­–ç•¥ï¼‰
user-invocable: true
disable-model-invocation: false
---

# å¿«é€Ÿå›žæµ‹æŠ€èƒ½

ä½ æ˜¯ä¸€ä¸ªé‡åŒ–ç­–ç•¥å›žæµ‹ä¸“å®¶ï¼Œè´Ÿè´£å¿«é€Ÿè¿è¡Œç­–ç•¥å›žæµ‹å¹¶ç”Ÿæˆç»©æ•ˆåˆ†æžæŠ¥å‘Šã€‚

## ä»»åŠ¡ç›®æ ‡

å¿«é€Ÿè¿è¡Œç­–ç•¥å›žæµ‹ï¼ŒåŒ…æ‹¬ï¼š

1. **ç­–ç•¥é…ç½®**
   - é€‰è‚¡æ•°é‡ï¼ˆTop Nï¼‰
   - æŒä»“å‘¨æœŸ
   - è°ƒä»“é¢‘çŽ‡
   - äº¤æ˜“æˆæœ¬

2. **å›žæµ‹æ‰§è¡Œ**
   - åŠ è½½åŽ†å²æ•°æ®å’Œä¿¡å·
   - æ¨¡æ‹Ÿ T+1 äº¤æ˜“
   - è®°å½•æ¯æ—¥æŒä»“å’Œæ”¶ç›Š

3. **ç»©æ•ˆåˆ†æž**
   - æ”¶ç›ŠæŒ‡æ ‡ï¼šå¹´åŒ–æ”¶ç›ŠçŽ‡ã€ç´¯è®¡æ”¶ç›Š
   - é£Žé™©æŒ‡æ ‡ï¼šæœ€å¤§å›žæ’¤ã€æ³¢åŠ¨çŽ‡ã€VaR
   - é£Žé™©è°ƒæ•´æ”¶ç›Šï¼šå¤æ™®æ¯”çŽ‡ã€ç´¢æè¯ºæ¯”çŽ‡ã€å¡å°”çŽ›æ¯”çŽ‡
   - äº¤æ˜“ç»Ÿè®¡ï¼šèƒœçŽ‡ã€ç›ˆäºæ¯”ã€äº¤æ˜“æ¬¡æ•°

4. **å¯è§†åŒ–æŠ¥å‘Š**
   - å‡€å€¼æ›²çº¿
   - å›žæ’¤æ›²çº¿
   - æœˆåº¦æ”¶ç›Šåˆ†å¸ƒ

## é¢„è®¾ç­–ç•¥æ¨¡æ¿

### ç­–ç•¥ 1: æ¿€è¿›åž‹ï¼ˆé«˜æ¢æ‰‹ï¼‰
- é€‰è‚¡æ•°é‡: 3 åª
- æŒä»“å‘¨æœŸ: 5 æ—¥
- è°ƒä»“é¢‘çŽ‡: æ¯æ—¥
- é€‚åˆåœºæ™¯: çŸ­çº¿äº¤æ˜“ï¼Œæ•æ‰å¿«é€Ÿæœºä¼š

### ç­–ç•¥ 2: ç¨³å¥åž‹ï¼ˆä¸­ç­‰æ¢æ‰‹ï¼‰
- é€‰è‚¡æ•°é‡: 5 åª
- æŒä»“å‘¨æœŸ: 10 æ—¥
- è°ƒä»“é¢‘çŽ‡: æ¯å‘¨
- é€‚åˆåœºæ™¯: ä¸­çº¿æŒæœ‰ï¼Œå¹³è¡¡æ”¶ç›Šä¸Žé£Žé™©

### ç­–ç•¥ 3: ä¿å®ˆåž‹ï¼ˆä½Žæ¢æ‰‹ï¼‰
- é€‰è‚¡æ•°é‡: 10 åª
- æŒä»“å‘¨æœŸ: 20 æ—¥
- è°ƒä»“é¢‘çŽ‡: æ¯æœˆ
- é€‚åˆåœºæ™¯: é•¿çº¿æŠ•èµ„ï¼Œé™ä½Žäº¤æ˜“æˆæœ¬

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¿«é€ŸéªŒè¯ç­–ç•¥
ç”¨æˆ·æƒ³å¿«é€Ÿæµ‹è¯•ä¸€ä¸ªé€‰è‚¡ç­–ç•¥æ˜¯å¦æœ‰æ•ˆ

### åœºæ™¯ 2: å‚æ•°ä¼˜åŒ–
æµ‹è¯•ä¸åŒå‚æ•°ç»„åˆçš„å›žæµ‹è¡¨çŽ°

### åœºæ™¯ 3: ç­–ç•¥å¯¹æ¯”
æ¯”è¾ƒå¤šä¸ªç­–ç•¥çš„ç»©æ•ˆå·®å¼‚

## æ‰§è¡Œæ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¡®è®¤å›žæµ‹å‚æ•°

æ ¹æ®ç”¨æˆ·éœ€æ±‚æˆ–ä½¿ç”¨é¢„è®¾æ¨¡æ¿ç¡®å®šå‚æ•°ï¼š

**å¿…éœ€å‚æ•°ï¼š**
- `strategy_type`: ç­–ç•¥ç±»åž‹ï¼ˆaggressive/balanced/conservativeï¼‰æˆ–è‡ªå®šä¹‰
- `start_date`: å›žæµ‹èµ·å§‹æ—¥æœŸ
- `end_date`: å›žæµ‹ç»“æŸæ—¥æœŸ

**å¯é€‰å‚æ•°ï¼š**
- `top_n`: æ¯æœŸé€‰è‚¡æ•°é‡ï¼ˆé»˜è®¤: 5ï¼‰
- `holding_period`: æŒä»“å¤©æ•°ï¼ˆé»˜è®¤: 10ï¼‰
- `rebalance_freq`: è°ƒä»“é¢‘çŽ‡ 'D'/'W'/'M'ï¼ˆé»˜è®¤: 'W'ï¼‰
- `initial_capital`: åˆå§‹èµ„é‡‘ï¼ˆé»˜è®¤: 1,000,000ï¼‰
- `commission_rate`: ä½£é‡‘çŽ‡ï¼ˆé»˜è®¤: 0.0003, å³ä¸‡ä¸‰ï¼‰
- `slippage_rate`: æ»‘ç‚¹çŽ‡ï¼ˆé»˜è®¤: 0.001, å³åƒä¸€ï¼‰

**ç¤ºä¾‹å‚æ•°ç»„åˆï¼š**

ä½¿ç”¨é¢„è®¾ç­–ç•¥ï¼š
```
strategy_type: "balanced"
start_date: "2023-01-01"
end_date: "2024-01-01"
```

è‡ªå®šä¹‰ç­–ç•¥ï¼š
```
top_n: 8
holding_period: 15
rebalance_freq: "W"
initial_capital: 500000
```

### ç¬¬äºŒæ­¥ï¼šå‡†å¤‡å›žæµ‹æ•°æ®

```python
#!/usr/bin/env python3
"""
å¿«é€Ÿå›žæµ‹è„šæœ¬
"""
import sys
sys.path.insert(0, 'core/src')

import pandas as pd
import numpy as np
from database.db_manager import DatabaseManager
from backtest.backtest_engine import BacktestEngine
from backtest.performance_analyzer import PerformanceAnalyzer

# åˆå§‹åŒ–
db = DatabaseManager()

# 1. åŠ è½½è‚¡ç¥¨æ± 
stock_codes = db.query("""
    SELECT DISTINCT code
    FROM stock_daily
    WHERE date >= '2023-01-01'
    GROUP BY code
    HAVING COUNT(*) > 200
    LIMIT 50
""")
stock_codes = [row['code'] for row in stock_codes]
print(f"è‚¡ç¥¨æ± : {len(stock_codes)} åªè‚¡ç¥¨")

# 2. åŠ è½½ä»·æ ¼æ•°æ®
prices = {}
for code in stock_codes:
    df = db.load_stock_data(code, start_date='2023-01-01')
    if len(df) > 0:
        prices[code] = df['close']

prices_df = pd.DataFrame(prices)
print(f"ä»·æ ¼æ•°æ®: {prices_df.shape}")

# 3. åŠ è½½æˆ–ç”Ÿæˆä¿¡å·ï¼ˆè¿™é‡Œç”¨ç®€å•çš„åŠ¨é‡ä¿¡å·ç¤ºä¾‹ï¼‰
# å®žé™…ä½¿ç”¨æ—¶åº”è¯¥ä»Žæ¨¡åž‹é¢„æµ‹èŽ·å–
signals = prices_df.pct_change(20)  # 20æ—¥åŠ¨é‡
signals = signals.fillna(0)
print(f"ä¿¡å·æ•°æ®: {signals.shape}")
```

### ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œå›žæµ‹

```python
# é…ç½®å›žæµ‹å‚æ•°ï¼ˆæ ¹æ®ç”¨æˆ·è¾“å…¥æˆ–é¢„è®¾ï¼‰
STRATEGY_CONFIG = {
    'aggressive': {
        'top_n': 3,
        'holding_period': 5,
        'rebalance_freq': 'D'
    },
    'balanced': {
        'top_n': 5,
        'holding_period': 10,
        'rebalance_freq': 'W'
    },
    'conservative': {
        'top_n': 10,
        'holding_period': 20,
        'rebalance_freq': 'M'
    }
}

# é€‰æ‹©ç­–ç•¥ï¼ˆè¿™é‡Œç”¨ balanced ç¤ºä¾‹ï¼‰
strategy_type = 'balanced'  # ä»Žç”¨æˆ·è¾“å…¥èŽ·å–
config = STRATEGY_CONFIG[strategy_type]

print(f"\n=== è¿è¡Œå›žæµ‹: {strategy_type.upper()} ç­–ç•¥ ===")
print(f"é€‰è‚¡æ•°é‡: {config['top_n']}")
print(f"æŒä»“å‘¨æœŸ: {config['holding_period']} å¤©")
print(f"è°ƒä»“é¢‘çŽ‡: {config['rebalance_freq']}")

# åˆå§‹åŒ–å›žæµ‹å¼•æ“Ž
engine = BacktestEngine(
    initial_capital=1000000,
    commission_rate=0.0003,
    slippage_rate=0.001,
    verbose=True
)

# è¿è¡Œå›žæµ‹
results = engine.backtest_long_only(
    signals=signals,
    prices=prices_df,
    top_n=config['top_n'],
    holding_period=config['holding_period'],
    rebalance_freq=config['rebalance_freq']
)

print(f"\nâœ… å›žæµ‹å®Œæˆ")
print(f"äº¤æ˜“æ¬¡æ•°: {results['num_trades']}")
print(f"æ•°æ®ç‚¹æ•°: {len(results['daily_returns'])}")
```

### ç¬¬å››æ­¥ï¼šç»©æ•ˆåˆ†æž

```python
# åˆå§‹åŒ–ç»©æ•ˆåˆ†æžå™¨
analyzer = PerformanceAnalyzer(
    returns=results['daily_returns'],
    risk_free_rate=0.03,  # 3% æ— é£Žé™©åˆ©çŽ‡
    periods_per_year=252
)

# è®¡ç®—æ‰€æœ‰æŒ‡æ ‡
metrics = analyzer.calculate_all_metrics(verbose=True)

# æ‰“å°å…³é”®æŒ‡æ ‡
print("\n" + "="*80)
print("å›žæµ‹ç»©æ•ˆæŠ¥å‘Š".center(80))
print("="*80)

print("\nã€æ”¶ç›ŠæŒ‡æ ‡ã€‘")
print(f"  å¹´åŒ–æ”¶ç›ŠçŽ‡:          {metrics['annual_return']*100:>8.2f}%")
print(f"  ç´¯è®¡æ”¶ç›ŠçŽ‡:          {metrics['total_return']*100:>8.2f}%")
print(f"  æ—¥å‡æ”¶ç›ŠçŽ‡:          {metrics['daily_mean_return']*100:>8.4f}%")

print("\nã€é£Žé™©æŒ‡æ ‡ã€‘")
print(f"  å¹´åŒ–æ³¢åŠ¨çŽ‡:          {metrics['annual_volatility']*100:>8.2f}%")
print(f"  æœ€å¤§å›žæ’¤:            {metrics['max_drawdown']*100:>8.2f}%")
print(f"  95% VaR:             {metrics['value_at_risk_95']*100:>8.2f}%")

print("\nã€é£Žé™©è°ƒæ•´æ”¶ç›Šã€‘")
print(f"  å¤æ™®æ¯”çŽ‡:            {metrics['sharpe_ratio']:>8.4f}")
print(f"  ç´¢æè¯ºæ¯”çŽ‡:          {metrics['sortino_ratio']:>8.4f}")
print(f"  å¡å°”çŽ›æ¯”çŽ‡:          {metrics['calmar_ratio']:>8.4f}")

print("\nã€äº¤æ˜“ç»Ÿè®¡ã€‘")
print(f"  æ€»äº¤æ˜“æ¬¡æ•°:          {results['num_trades']:>8d}")
print(f"  èƒœçŽ‡:                {metrics['win_rate']*100:>8.2f}%")
print(f"  ç›ˆäºæ¯”:              {metrics['profit_loss_ratio']:>8.2f}")
print(f"  å¹³å‡æŒä»“å¤©æ•°:        {config['holding_period']:>8d}")

print("\n" + "="*80)
```

### ç¬¬äº”æ­¥ï¼šç”Ÿæˆå¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰

```python
import matplotlib.pyplot as plt

# 1. å‡€å€¼æ›²çº¿
fig, axes = plt.subplots(2, 1, figsize=(12, 8))

# ç´¯è®¡æ”¶ç›Š
cumulative_returns = (1 + results['daily_returns']).cumprod()
axes[0].plot(cumulative_returns, label='ç­–ç•¥å‡€å€¼')
axes[0].axhline(y=1, color='r', linestyle='--', alpha=0.3, label='åˆå§‹èµ„é‡‘')
axes[0].set_title('ç­–ç•¥å‡€å€¼æ›²çº¿')
axes[0].set_ylabel('å‡€å€¼')
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# å›žæ’¤æ›²çº¿
drawdown = analyzer.calculate_drawdown()
axes[1].fill_between(drawdown.index, drawdown, 0, alpha=0.3, color='red')
axes[1].set_title('å›žæ’¤æ›²çº¿')
axes[1].set_ylabel('å›žæ’¤ (%)')
axes[1].set_xlabel('æ—¥æœŸ')
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig(f'data/results/backtest_{strategy_type}.png', dpi=150)
print(f"\nðŸ“Š å¯è§†åŒ–å›¾è¡¨å·²ä¿å­˜: data/results/backtest_{strategy_type}.png")
```

### ç¬¬å…­æ­¥ï¼šä¿å­˜ç»“æžœ

```python
# ä¿å­˜åˆ°æ•°æ®åº“
backtest_id = db.save_backtest_result(
    strategy_name=f"{strategy_type}_strategy",
    params=config,
    metrics=metrics,
    equity_curve=cumulative_returns.to_dict()
)

print(f"\nðŸ’¾ å›žæµ‹ç»“æžœå·²ä¿å­˜åˆ°æ•°æ®åº“ï¼ŒID: {backtest_id}")

# ä¿å­˜è¯¦ç»†æŠ¥å‘Šåˆ°æ–‡ä»¶
report_path = f"data/results/backtest_report_{strategy_type}.txt"
with open(report_path, 'w', encoding='utf-8') as f:
    f.write("="*80 + "\n")
    f.write(f"ç­–ç•¥å›žæµ‹æŠ¥å‘Š - {strategy_type.upper()}\n")
    f.write("="*80 + "\n\n")
    f.write(f"å›žæµ‹æœŸé—´: {signals.index[0]} ~ {signals.index[-1]}\n")
    f.write(f"åˆå§‹èµ„é‡‘: Â¥{1000000:,.0f}\n\n")

    # å†™å…¥æ‰€æœ‰æŒ‡æ ‡...
    for key, value in metrics.items():
        f.write(f"{key}: {value}\n")

print(f"ðŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜: {report_path}")
```

## è¾“å‡ºæ ¼å¼

ç”Ÿæˆä¸€ä»½å®Œæ•´çš„å›žæµ‹æŠ¥å‘Šï¼š

### 1. æ‰§è¡Œæ‘˜è¦
```
================================================================================
                          ç­–ç•¥å›žæµ‹æŠ¥å‘Š
================================================================================
ç­–ç•¥åç§°: BALANCED ç¨³å¥åž‹ç­–ç•¥
å›žæµ‹æ—¶é—´: 2026-01-26 13:00:00
å›žæµ‹æœŸé—´: 2023-01-01 ~ 2024-01-01 (252 ä¸ªäº¤æ˜“æ—¥)
åˆå§‹èµ„é‡‘: Â¥1,000,000
```

### 2. ç­–ç•¥å‚æ•°
```
ç­–ç•¥é…ç½®:
- é€‰è‚¡æ•°é‡: 5 åª
- æŒä»“å‘¨æœŸ: 10 å¤©
- è°ƒä»“é¢‘çŽ‡: æ¯å‘¨ (Weekly)
- è‚¡ç¥¨æ± : 50 åª
- ä½£é‡‘çŽ‡: 0.03%
- æ»‘ç‚¹çŽ‡: 0.1%
```

### 3. æ”¶ç›ŠæŒ‡æ ‡
```
æ”¶ç›Šè¡¨çŽ°:
  å¹´åŒ–æ”¶ç›ŠçŽ‡:          107.23%    â­â­â­â­â­
  ç´¯è®¡æ”¶ç›ŠçŽ‡:          107.23%
  æ—¥å‡æ”¶ç›ŠçŽ‡:          0.2843%
  æœˆåº¦èƒœçŽ‡:            83.33% (10/12ä¸ªæœˆç›ˆåˆ©)
```

### 4. é£Žé™©æŒ‡æ ‡
```
é£Žé™©æŽ§åˆ¶:
  å¹´åŒ–æ³¢åŠ¨çŽ‡:          12.45%     â­â­â­â­
  æœ€å¤§å›žæ’¤:            -1.34%     â­â­â­â­â­
  å›žæ’¤æŒç»­å¤©æ•°:        7 å¤©
  95% VaR:             -2.15%
  å¹³å‡å›žæ’¤:            -0.68%
```

### 5. é£Žé™©è°ƒæ•´æ”¶ç›Š
```
ç»¼åˆè¯„ä»·:
  å¤æ™®æ¯”çŽ‡:            12.85      â­â­â­â­â­ (ä¼˜ç§€)
  ç´¢æè¯ºæ¯”çŽ‡:          18.42      â­â­â­â­â­
  å¡å°”çŽ›æ¯”çŽ‡:          80.02      â­â­â­â­â­
  ä¿¡æ¯æ¯”çŽ‡:            2.34       â­â­â­â­
```

### 6. äº¤æ˜“ç»Ÿè®¡
```
äº¤æ˜“è¡¨çŽ°:
  æ€»äº¤æ˜“æ¬¡æ•°:          252 æ¬¡
  èƒœçŽ‡:                70.92%     â­â­â­â­
  ç›ˆäºæ¯”:              1.87       â­â­â­â­
  å¹³å‡ç›ˆåˆ©:            +1.52%
  å¹³å‡äºæŸ:            -0.81%
  æœ€å¤§å•ç¬”ç›ˆåˆ©:        +5.23%
  æœ€å¤§å•ç¬”äºæŸ:        -2.14%
  å¹³å‡æŒä»“å¤©æ•°:        10 å¤©
```

### 7. æœˆåº¦æ”¶ç›Šåˆ†å¸ƒ
```
æœˆåº¦æ”¶ç›Š:
2023-01:  +8.23%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
2023-02: +12.45%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
2023-03:  +5.67%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
2023-04:  +9.12%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
2023-05: -1.23%   â–Œ
2023-06: +11.34%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
...
å¹³å‡æœˆåº¦æ”¶ç›Š: +8.94%
```

### 8. ä¸ŽåŸºå‡†å¯¹æ¯”ï¼ˆå¦‚æœ‰ï¼‰
```
ç›¸å¯¹åŸºå‡†è¡¨çŽ°:
  åŸºå‡†: æ²ªæ·±300
  è¶…é¢æ”¶ç›Š:            +45.67%
  ä¿¡æ¯æ¯”çŽ‡:            2.34
  è·Ÿè¸ªè¯¯å·®:            8.23%
  ä¸Šæ¶¨æ•èŽ·çŽ‡:          125.4%
  ä¸‹è·Œæ•èŽ·çŽ‡:          32.1%
```

### 9. è¯„çº§ä¸Žå»ºè®®
```
ç­–ç•¥è¯„çº§: A+ (ä¼˜ç§€)

è¯„åˆ†ç»†åˆ™:
- æ”¶ç›Šèƒ½åŠ›: A+ (å¹´åŒ–æ”¶ç›Š > 100%)
- é£Žé™©æŽ§åˆ¶: A+ (æœ€å¤§å›žæ’¤ < 5%)
- å¤æ™®æ¯”çŽ‡: A+ (å¤æ™®æ¯”çŽ‡ > 10)
- ç¨³å®šæ€§:   A  (æœˆåº¦èƒœçŽ‡ > 75%)
- äº¤æ˜“æˆæœ¬: B+ (æ¢æ‰‹çŽ‡é€‚ä¸­)

æ€»ä½“è¯„ä»·:
âœ… è¯¥ç­–ç•¥è¡¨çŽ°ä¼˜å¼‚ï¼Œå¹´åŒ–æ”¶ç›Šè¶…è¿‡100%ä¸”å›žæ’¤æŽ§åˆ¶åœ¨2%ä»¥å†…
âœ… å¤æ™®æ¯”çŽ‡é«˜è¾¾12.85ï¼Œé£Žé™©è°ƒæ•´åŽæ”¶ç›Šæžä½³
âœ… èƒœçŽ‡70%+ï¼Œç›ˆäºæ¯”æŽ¥è¿‘2:1ï¼Œäº¤æ˜“è´¨é‡é«˜
âš ï¸  æ³¨æ„ï¼šå›žæµ‹æœŸé—´è¾ƒçŸ­ï¼Œéœ€è¦æ›´é•¿æ—¶é—´éªŒè¯
âš ï¸  å»ºè®®ï¼šåœ¨å®žç›˜å‰è¿›è¡Œçº¸é¢äº¤æ˜“éªŒè¯

å»ºè®®æ“ä½œ:
1. å¯ä»¥è€ƒè™‘å®žç›˜å°èµ„é‡‘æµ‹è¯•
2. ç›‘æŽ§å®žç›˜ä¸Žå›žæµ‹çš„åå·®
3. å®šæœŸé‡æ–°è®­ç»ƒæ¨¡åž‹
4. è®¾ç½®æ­¢æŸå’Œæ­¢ç›ˆè§„åˆ™
```

### 10. è¾“å‡ºæ–‡ä»¶
```
ç”Ÿæˆæ–‡ä»¶:
ðŸ“Š data/results/backtest_balanced.png         - å¯è§†åŒ–å›¾è¡¨
ðŸ“„ data/results/backtest_report_balanced.txt  - è¯¦ç»†æŠ¥å‘Š
ðŸ’¾ æ•°æ®åº“è®°å½• ID: 12345                        - æ•°æ®åº“å­˜å‚¨
```

## å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜ 1: æ•°æ®ä¸è¶³
**ç—‡çŠ¶**: å›žæµ‹æœŸé—´å†…æ•°æ®ç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¸‹è½½æ›´å¤šåŽ†å²æ•°æ®
python3 core/scripts/download_data_to_db.py --years 3 --max-stocks 100
```

### é—®é¢˜ 2: ä¿¡å·æ•°æ®ç¼ºå¤±
**ç—‡çŠ¶**: æ²¡æœ‰æ¨¡åž‹é¢„æµ‹ä¿¡å·

**è§£å†³æ–¹æ¡ˆ**:
1. å…ˆè®­ç»ƒæ¨¡åž‹ç”Ÿæˆé¢„æµ‹
2. æˆ–ä½¿ç”¨ç®€å•çš„æŠ€æœ¯æŒ‡æ ‡ä¿¡å·ï¼ˆå¦‚åŠ¨é‡ã€å‡çº¿ï¼‰
3. æˆ–ä½¿ç”¨éšæœºä¿¡å·è¿›è¡Œæ¡†æž¶æµ‹è¯•

### é—®é¢˜ 3: å›žæµ‹ç»“æžœå¼‚å¸¸å¥½
**ç—‡çŠ¶**: å¤æ™®æ¯”çŽ‡ > 20ï¼Œå›žæ’¤ < 1%

**è­¦å‘Š**: å¯èƒ½å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- æœªæ¥å‡½æ•°ï¼ˆä½¿ç”¨äº†æœªæ¥æ•°æ®ï¼‰
- æ•°æ®ç©¿è¶Šï¼ˆLook-ahead Biasï¼‰
- è¿‡æ‹Ÿåˆ

**å»ºè®®æ£€æŸ¥**:
1. ç¡®è®¤ T+1 äº¤æ˜“é€»è¾‘æ­£ç¡®
2. æ£€æŸ¥ä¿¡å·ç”Ÿæˆæ˜¯å¦ç”¨äº†æœªæ¥æ•°æ®
3. åœ¨ä¸åŒæ—¶é—´æ®µéªŒè¯

### é—®é¢˜ 4: ç»©æ•ˆæŒ‡æ ‡è®¡ç®—é”™è¯¯
**ç—‡çŠ¶**: å¤æ™®æ¯”çŽ‡ä¸º NaN æˆ–æ— ç©·å¤§

**åŽŸå› **: æ”¶ç›ŠçŽ‡å…¨ä¸º0æˆ–æ³¢åŠ¨çŽ‡ä¸º0

**è§£å†³æ–¹æ¡ˆ**:
```python
# æ£€æŸ¥æ”¶ç›ŠçŽ‡æ•°æ®
print(results['daily_returns'].describe())
print(f"é›¶æ”¶ç›Šå¤©æ•°: {(results['daily_returns'] == 0).sum()}")
```

## æ€§èƒ½ä¼˜åŒ–

### å‘é‡åŒ–è®¡ç®—
- ä½¿ç”¨ pandas/numpy å‘é‡åŒ–æ“ä½œ
- é¿å… Python å¾ªçŽ¯
- å›žæµ‹é€Ÿåº¦: 1000 å¤© < 1 ç§’

### å¹¶è¡Œå›žæµ‹
å¯¹äºŽå‚æ•°ä¼˜åŒ–åœºæ™¯ï¼š
```python
from multiprocessing import Pool

def run_backtest(params):
    # å•æ¬¡å›žæµ‹é€»è¾‘
    pass

# å¹¶è¡Œè¿è¡Œå¤šç»„å‚æ•°
with Pool(4) as pool:
    results = pool.map(run_backtest, param_grid)
```

## ç›¸å…³æ–‡æ¡£

- [QUICKSTART.md](../../QUICKSTART.md#åœºæ™¯4ï¼šè¿è¡Œç­–ç•¥å›žæµ‹) - å›žæµ‹æŒ‡å—
- [core/src/backtest/backtest_engine.py](../../core/src/backtest/backtest_engine.py) - å›žæµ‹å¼•æ“Ž
- [core/src/backtest/performance_analyzer.py](../../core/src/backtest/performance_analyzer.py) - ç»©æ•ˆåˆ†æž
- [core/tests/test_phase4_backtest.py](../../core/tests/test_phase4_backtest.py) - æµ‹è¯•ç”¨ä¾‹
