# 安全审计技能 (Security Audit Skill)

## 🎯 技能目标

全面检查项目的安全性，包括敏感信息泄露、SQL注入漏洞、依赖安全和代码安全问题。这是一个 **P0 级别**的重要安全任务。

## 📋 审计范围

### 1. 敏感信息泄露检查
- 硬编码密码、密钥、Token 检测
- 环境变量使用规范检查
- 配置文件安全审查

### 2. SQL 注入漏洞审计
- 检查所有数据库查询是否使用参数化
- 识别字符串拼接 SQL 的潜在风险
- 验证 Core 项目和 Backend 项目的查询安全

### 3. 依赖安全扫描
- 使用 `safety` 扫描 Python 依赖漏洞
- 识别已知的高危依赖包
- 生成依赖安全报告

### 4. 代码安全扫描
- 使用 `bandit` 静态代码安全分析
- 检测常见安全问题（pickle、random、弱哈希等）
- 评估风险等级并提供修复建议

## 🚀 使用方法

### 方式1：直接命令

```bash
/security-audit
```

### 方式2：自然语言

```
请帮我做一次完整的安全审计
检查项目是否有安全漏洞
运行安全扫描
```

## 📊 输出内容

技能执行完成后会生成：

1. **终端输出**：实时显示审计进度和发现的问题
2. **安全审计报告**：`backend/docs/security-audit-report.md`
3. **Bandit 报告**：`backend/bandit-report.json`
4. **修复建议**：针对发现问题的具体修复方案

## ✅ 验收标准 (P0)

- ✅ 无硬编码密码、密钥、Token
- ✅ 所有数据库查询使用参数化
- ✅ 依赖库无已知高危漏洞
- ✅ Bandit 扫描无高危问题

## 📝 示例输出

```
🔍 开始安全审计...

1️⃣ 敏感信息泄露审计
   ✅ 无硬编码密码
   ✅ 无硬编码密钥
   ✅ 无硬编码 Token

2️⃣ SQL 注入漏洞审计
   ⚠️  发现 2 处潜在问题
   ✅ 已修复：core/src/cli/commands/features.py
   ✅ 已加固：backend/app/repositories/base_repository.py

3️⃣ 依赖安全扫描
   ✅ 扫描 130 个包
   ✅ 无已知高危漏洞

4️⃣ 代码安全扫描
   🔴 高危: 1 (已修复)
   🟡 中危: 23 (已审查)
   🔵 低危: 19 (可接受)

📄 详细报告已生成：backend/docs/security-audit-report.md
```

## 🔧 依赖工具

技能会自动安装和使用以下工具：

```bash
pip install safety bandit
```

## 📅 建议频率

- **首次运行**：项目初始化后
- **定期审计**：每季度一次
- **重要上线前**：重大功能或版本发布前
- **发现可疑问题时**：任何时候怀疑有安全问题

## 🎓 学习要点

通过这个技能，你将了解：

1. **安全最佳实践**
   - 如何安全存储敏感信息
   - SQL 注入的原理和防护
   - 依赖管理的重要性

2. **安全工具使用**
   - Safety: Python 依赖漏洞扫描
   - Bandit: Python 代码静态安全分析
   - 参数化查询的正确写法

3. **风险评估**
   - 如何评估安全问题的严重程度
   - 哪些问题需要立即修复
   - 如何平衡安全性和开发效率

## 🔗 相关资源

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Bandit 文档](https://bandit.readthedocs.io/)
- [Safety 文档](https://pyup.io/safety/)
- [Python 安全最佳实践](https://python.readthedocs.io/en/stable/library/security_warnings.html)

## 📌 注意事项

1. **不要忽略警告**：即使是低危问题也应该了解其影响
2. **定期更新依赖**：保持依赖包的最新版本
3. **代码审查**：安全审计不能替代人工代码审查
4. **环境隔离**：开发、测试、生产环境应严格隔离

---

**技能类型**：安全 | **优先级**：⭐⭐⭐⭐⭐ | **适用场景**：项目维护、上线前检查
