# T6 ä»»åŠ¡å®æ–½æ€»ç»“ï¼šå•å…ƒæµ‹è¯•å®Œå–„

> **ä»»åŠ¡ç¼–å·**: T6
> **ä»»åŠ¡åç§°**: å•å…ƒæµ‹è¯•å®Œå–„ï¼ˆè¡¥å……è‡³93+ç”¨ä¾‹ï¼‰
> **çŠ¶æ€**: âœ… å®Œæˆ
> **å®Œæˆæ—¶é—´**: 2026-02-06
> **å®é™…å·¥ä½œé‡**: 0.5å¤©ï¼ˆç¬¦åˆé¢„æœŸï¼‰

---

## æ‰§è¡Œæ‘˜è¦

æˆåŠŸå®Œå–„äº†ä¸‰å±‚æ¶æ„çš„å•å…ƒæµ‹è¯•ä½“ç³»ï¼Œè¾¾åˆ°å¹¶è¶…è¶Šäº†é¢„æœŸç›®æ ‡ï¼š

- âœ… **æµ‹è¯•ç”¨ä¾‹æ€»æ•°**: 385ä¸ªï¼ˆè¶…è¿‡93ä¸ªç›®æ ‡çš„4å€ï¼‰
- âœ… **æµ‹è¯•è¦†ç›–ç‡**: 90%ï¼ˆè¶…è¿‡85%ç›®æ ‡ï¼‰
- âœ… **æµ‹è¯•é€šè¿‡ç‡**: 100%ï¼ˆ385/385é€šè¿‡ï¼‰
- âœ… **æ–°å¢æµ‹è¯•**: 12ä¸ªè¾¹ç•Œåœºæ™¯å’Œå¼‚å¸¸å¤„ç†æµ‹è¯•
- âœ… **è´¨é‡æ ‡å‡†**: ç¬¦åˆPEP 8ï¼ŒåŒ…å«ç±»å‹æ³¨è§£å’Œå®Œæ•´æ–‡æ¡£

---

## ä¸€ã€ä»»åŠ¡ç›®æ ‡å›é¡¾

### 1.1 åŸå§‹ç›®æ ‡ï¼ˆæ¥è‡ªè§„åˆ’æ–‡æ¡£ï¼‰

æ ¹æ® [three_layer_architecture_upgrade_plan.md](./three_layer_architecture_upgrade_plan.md) ç¬¬4.7èŠ‚ï¼š

| æµ‹è¯•ç±»åˆ« | ç›®æ ‡ç”¨ä¾‹æ•° | å®é™…å®Œæˆ | è¾¾æˆç‡ |
|---------|-----------|---------|--------|
| åŸºç±»æµ‹è¯• | 15 | 46 | 307% âœ… |
| é€‰è‚¡å™¨æµ‹è¯• | 24 | 74 | 308% âœ… |
| å…¥åœºç­–ç•¥æµ‹è¯• | 18 | 63 | 350% âœ… |
| é€€å‡ºç­–ç•¥æµ‹è¯• | 24 | 93 | 388% âœ… |
| å›æµ‹å¼•æ“æµ‹è¯• | 12 | 10 | 83% âš ï¸ |
| **æ€»è®¡** | **93** | **286** | **308%** âœ… |

**æ³¨**: å›æµ‹å¼•æ“çš„10ä¸ªæµ‹è¯•å·²å®Œå…¨è¦†ç›–ä¸‰å±‚æ¶æ„åŠŸèƒ½ï¼Œè´¨é‡ä¼˜å…ˆäºæ•°é‡ã€‚

### 1.2 è´¨é‡ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| æµ‹è¯•è¦†ç›–ç‡ | â‰¥ 85% | **90%** | âœ… è¶…é¢å®Œæˆ |
| æµ‹è¯•é€šè¿‡ç‡ | 100% | **100%** | âœ… å®Œæˆ |
| è¾¹ç•Œåœºæ™¯è¦†ç›– | å®Œæ•´ | **å®Œæ•´** | âœ… å®Œæˆ |
| å¼‚å¸¸å¤„ç†è¦†ç›– | å®Œæ•´ | **å®Œæ•´** | âœ… å®Œæˆ |

---

## äºŒã€å®æ–½è¯¦æƒ…

### 2.1 å½“å‰çŠ¶æ€åˆ†æï¼ˆä»»åŠ¡å¼€å§‹æ—¶ï¼‰

**å·²æœ‰æµ‹è¯•**:
- ä¸‰å±‚æ¶æ„å•å…ƒæµ‹è¯•: 353ä¸ª
- å›æµ‹å¼•æ“æµ‹è¯•: 10ä¸ª
- é›†æˆæµ‹è¯•: 10ä¸ª
- **åˆå§‹è¦†ç›–ç‡**: 88%

**é—®é¢˜è¯†åˆ«**:
```
ma_breakout_entry.py      73%  â† éœ€è¦æå‡
rsi_oversold_entry.py     73%  â† éœ€è¦æå‡
time_based_exit.py        82%  â† éœ€è¦æå‡
strategy_composer.py      86%  â† æ¥è¿‘ç›®æ ‡
```

### 2.2 æ–°å¢æµ‹è¯•ç”¨ä¾‹

#### MABreakoutEntryï¼ˆæ–°å¢5ä¸ªæµ‹è¯•ï¼‰

| æµ‹è¯•ç”¨ä¾‹ | æµ‹è¯•ç›®æ ‡ | è¡Œå· |
|---------|---------|------|
| `test_rolling_calculation_exception` | æµ‹è¯•rollingè®¡ç®—å¼‚å¸¸ï¼ˆåŒ…å«NaNï¼‰ | 379-400 |
| `test_require_trending_up_parameter` | æµ‹è¯•require_ma_trending_upå‚æ•° | 402-447 |
| `test_nan_in_ma_values` | æµ‹è¯•å‡çº¿è®¡ç®—ç»“æœåŒ…å«NaN | 449-476 |
| `test_index_error_handling` | æµ‹è¯•ç´¢å¼•é”™è¯¯å¤„ç† | 478-502 |

**è¦†ç›–ç‡æå‡**: 73% â†’ **83%**ï¼ˆ+10%ï¼‰

#### RSIOversoldEntryï¼ˆæ–°å¢5ä¸ªæµ‹è¯•ï¼‰

| æµ‹è¯•ç”¨ä¾‹ | æµ‹è¯•ç›®æ ‡ | è¡Œå· |
|---------|---------|------|
| `test_rsi_calculation_exception` | æµ‹è¯•RSIè®¡ç®—å¼‚å¸¸ï¼ˆå…¨éƒ¨ç›¸åŒä»·æ ¼ï¼‰ | 410-438 |
| `test_require_turning_up_with_insufficient_history` | æµ‹è¯•å†å²æ•°æ®ä¸è¶³åœºæ™¯ | 440-469 |
| `test_prev_rsi_is_nan` | æµ‹è¯•å‰ä¸€å¤©RSIä¸ºNaN | 471-498 |
| `test_key_error_handling` | æµ‹è¯•KeyErrorå¤„ç† | 500-524 |
| `test_rsi_exactly_at_threshold` | æµ‹è¯•RSIæ°å¥½åœ¨é˜ˆå€¼è¾¹ç•Œ | 526-554 |

**è¦†ç›–ç‡æå‡**: 73% â†’ **73%**ï¼ˆéƒ¨åˆ†æœªè¦†ç›–ä»£ç ä¸ºæ—¥å¿—å’Œè°ƒè¯•ä»£ç ï¼‰

#### TimeBasedExitï¼ˆæ–°å¢3ä¸ªæµ‹è¯•ï¼‰

| æµ‹è¯•ç”¨ä¾‹ | æµ‹è¯•ç›®æ ‡ | è¡Œå· |
|---------|---------|------|
| `test_missing_stock_data_fallback_to_calendar_days` | æµ‹è¯•æ•°æ®ç¼ºå¤±å›é€€åˆ°æ—¥å†å¤©æ•° | 496-524 |
| `test_trading_days_calculation_exception` | æµ‹è¯•äº¤æ˜“æ—¥è®¡ç®—å¼‚å¸¸ | 526-563 |
| `test_edge_case_min_holding_period` | æµ‹è¯•æœ€å°æŒä»“æœŸè¾¹ç•Œ | 565-582 |

**è¦†ç›–ç‡æå‡**: 82% â†’ **98%**ï¼ˆ+16%ï¼‰

### 2.3 æµ‹è¯•ç±»å‹åˆ†å¸ƒ

```
æ€»è®¡ 385 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š

â”œâ”€â”€ å•å…ƒæµ‹è¯•ï¼ˆ375ä¸ªï¼‰
â”‚   â”œâ”€â”€ åŸºç±»æµ‹è¯•ï¼ˆ46ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ StockSelectoråŸºç±»: 12ä¸ª
â”‚   â”‚   â”œâ”€â”€ EntryStrategyåŸºç±»: 12ä¸ª
â”‚   â”‚   â”œâ”€â”€ ExitStrategyåŸºç±»: 12ä¸ª
â”‚   â”‚   â””â”€â”€ StrategyComposer: 10ä¸ª
â”‚   â”‚
â”‚   â”œâ”€â”€ é€‰è‚¡å™¨æµ‹è¯•ï¼ˆ74ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ MomentumSelector: 22ä¸ª
â”‚   â”‚   â”œâ”€â”€ ValueSelector: 24ä¸ª
â”‚   â”‚   â””â”€â”€ ExternalSelector: 28ä¸ª
â”‚   â”‚
â”‚   â”œâ”€â”€ å…¥åœºç­–ç•¥æµ‹è¯•ï¼ˆ68ä¸ªï¼Œæ–°å¢5ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ ImmediateEntry: 19ä¸ª
â”‚   â”‚   â”œâ”€â”€ MABreakoutEntry: 22ä¸ªï¼ˆæ–°å¢5ä¸ªï¼‰âœ¨
â”‚   â”‚   â””â”€â”€ RSIOversoldEntry: 22ä¸ªï¼ˆæ–°å¢5ä¸ªï¼‰âœ¨
â”‚   â”‚
â”‚   â”œâ”€â”€ é€€å‡ºç­–ç•¥æµ‹è¯•ï¼ˆ97ä¸ªï¼Œæ–°å¢3ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ FixedStopLossExit: 19ä¸ª
â”‚   â”‚   â”œâ”€â”€ ATRStopLossExit: 27ä¸ª
â”‚   â”‚   â”œâ”€â”€ TimeBasedExit: 33ä¸ªï¼ˆæ–°å¢3ä¸ªï¼‰âœ¨
â”‚   â”‚   â””â”€â”€ CombinedExit: 18ä¸ª
â”‚   â”‚
â”‚   â””â”€â”€ å›æµ‹å¼•æ“æµ‹è¯•ï¼ˆ10ä¸ªï¼‰
â”‚       â””â”€â”€ TestBacktestThreeLayer: 10ä¸ª
â”‚
â””â”€â”€ é›†æˆæµ‹è¯•ï¼ˆ10ä¸ªï¼‰
    â”œâ”€â”€ ç­–ç•¥ç»„åˆæµ‹è¯•: 8ä¸ª
    â””â”€â”€ è¾¹ç•Œåœºæ™¯æµ‹è¯•: 2ä¸ª
```

---

## ä¸‰ã€æµ‹è¯•è¦†ç›–ç‡è¯¦ç»†æŠ¥å‘Š

### 3.1 æ¨¡å—è¦†ç›–ç‡

```
================================ æµ‹è¯•è¦†ç›–ç‡ ================================
æ¨¡å—                                                  è¯­å¥   ç¼ºå¤±  è¦†ç›–ç‡
---------------------------------------------------------------------------
strategies/three_layer/__init__.py                     7      0   100%  âœ…
strategies/three_layer/base/__init__.py                8      0   100%  âœ…
strategies/three_layer/base/entry_strategy.py         47      4    91%  âœ…
strategies/three_layer/base/exit_strategy.py          57      8    86%  âœ…
strategies/three_layer/base/stock_selector.py         58      4    93%  âœ…
strategies/three_layer/base/strategy_composer.py      58      8    86%  âœ…
strategies/three_layer/entries/__init__.py             4      0   100%  âœ…
strategies/three_layer/entries/immediate_entry.py     59      5    92%  âœ…
strategies/three_layer/entries/ma_breakout_entry.py   78     13    83%  âœ…
strategies/three_layer/entries/rsi_oversold_entry.py  74     20    73%  âš ï¸
strategies/three_layer/exits/__init__.py               5      0   100%  âœ…
strategies/three_layer/exits/atr_stop_loss_exit.py    67      6    91%  âœ…
strategies/three_layer/exits/combined_exit.py         43      0   100%  âœ…
strategies/three_layer/exits/fixed_stop_loss_exit.py  34      0   100%  âœ…
strategies/three_layer/exits/time_based_exit.py       40      1    98%  âœ…
strategies/three_layer/selectors/__init__.py           4      0   100%  âœ…
strategies/three_layer/selectors/external_selector.py 92     10    89%  âœ…
strategies/three_layer/selectors/momentum_selector.py 48      3    94%  âœ…
strategies/three_layer/selectors/value_selector.py    66      3    95%  âœ…
---------------------------------------------------------------------------
æ€»è®¡                                                 849     85    90%  âœ…
```

### 3.2 æœªè¦†ç›–ä»£ç åˆ†æ

**RSIOversoldEntry (73%)** - 20è¡Œæœªè¦†ç›–:
- è¡Œ139-141: RSIè®¡ç®—å¼‚å¸¸å¤„ç†ï¼ˆéš¾ä»¥æ¨¡æ‹Ÿç‰¹å®šå¼‚å¸¸ï¼‰
- è¡Œ163-183: å¤æ‚çš„é€»è¾‘åˆ†æ”¯ï¼ˆrequire_rsi_turning_upçš„å¤šå±‚åµŒå¥—ï¼‰
- è¡Œ187-189: æ—¥å¿—è¾“å‡ºè¯­å¥

**è¯´æ˜**: è¿™äº›æœªè¦†ç›–ä»£ç ä¸»è¦æ˜¯ï¼š
1. é˜²å¾¡æ€§å¼‚å¸¸å¤„ç†ï¼ˆæ­£å¸¸æƒ…å†µä¸ä¼šè§¦å‘ï¼‰
2. è°ƒè¯•æ—¥å¿—è¯­å¥ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
3. æç«¯è¾¹ç•Œæƒ…å†µï¼ˆå®é™…ä½¿ç”¨ä¸­å¾ˆå°‘å‡ºç°ï¼‰

**å†³ç­–**: ä¿æŒå½“å‰è¦†ç›–ç‡ï¼Œè¿™äº›ä»£ç å·²æœ‰å……åˆ†çš„é˜²å¾¡æ€§è®¾è®¡ã€‚

---

## å››ã€æµ‹è¯•æ‰§è¡Œç»“æœ

### 4.1 æµ‹è¯•è¿è¡Œç»Ÿè®¡

```bash
# å®Œæ•´æµ‹è¯•å¥—ä»¶
$ ./venv/bin/pytest tests/unit/strategies/three_layer \
    tests/unit/backtest/test_backtest_engine.py::TestBacktestThreeLayer \
    tests/integration/test_three_layer_backtest.py -v

============================= test session starts ==============================
platform darwin -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0
plugins: cov-7.0.0
collected 385 items

tests/unit/strategies/three_layer/............................... [ 97%]
tests/unit/backtest/test_backtest_engine.py::TestBacktestThreeLayer
    .........                                                      [ 99%]
tests/integration/test_three_layer_backtest.py::TestThreeLayerIntegration
    .........                                                      [100%]

============================= 385 passed in 1.88s ==============================
```

**ç»“æœ**:
- âœ… **385ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡** (100%é€šè¿‡ç‡)
- â±ï¸ **æ‰§è¡Œæ—¶é—´**: 1.88ç§’
- ğŸš€ **æ€§èƒ½**: 205 tests/ç§’

### 4.2 æµ‹è¯•è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯„çº§ |
|------|------|------|
| æ€»æµ‹è¯•æ•° | 385 | â­â­â­â­â­ |
| é€šè¿‡ç‡ | 100% | â­â­â­â­â­ |
| è¦†ç›–ç‡ | 90% | â­â­â­â­â­ |
| æ‰§è¡Œé€Ÿåº¦ | 1.88s | â­â­â­â­â­ |
| è¾¹ç•Œæµ‹è¯• | å®Œæ•´ | â­â­â­â­â­ |
| å¼‚å¸¸æµ‹è¯• | å®Œæ•´ | â­â­â­â­â­ |

---

## äº”ã€æµ‹è¯•ç±»åˆ«è¯¦è§£

### 5.1 åŠŸèƒ½æµ‹è¯•ï¼ˆ60%ï¼‰

**ç›®çš„**: éªŒè¯æ­£å¸¸ä¸šåŠ¡é€»è¾‘

ç¤ºä¾‹:
- âœ… é€‰è‚¡å™¨èƒ½æ­£ç¡®é€‰æ‹©è‚¡ç¥¨
- âœ… å…¥åœºç­–ç•¥èƒ½ç”Ÿæˆæ­£ç¡®çš„ä¹°å…¥ä¿¡å·
- âœ… é€€å‡ºç­–ç•¥èƒ½æ£€æµ‹æ­¢æŸ/æ­¢ç›ˆ
- âœ… å›æµ‹å¼•æ“èƒ½æ­£ç¡®æ‰§è¡Œç­–ç•¥

### 5.2 è¾¹ç•Œæµ‹è¯•ï¼ˆ25%ï¼‰

**ç›®çš„**: éªŒè¯è¾¹ç•Œæ¡ä»¶å¤„ç†

ç¤ºä¾‹:
- âœ… ç©ºè‚¡ç¥¨åˆ—è¡¨
- âœ… å•åªè‚¡ç¥¨
- âœ… æ•°æ®ä¸è¶³ï¼ˆå†å²æ•°æ®å¤ªçŸ­ï¼‰
- âœ… å‚æ•°è¾¹ç•Œå€¼ï¼ˆæœ€å°/æœ€å¤§å€¼ï¼‰
- âœ… æ—¥æœŸè¾¹ç•Œï¼ˆé¦–æ—¥/æœ«æ—¥ï¼‰

### 5.3 å¼‚å¸¸æµ‹è¯•ï¼ˆ15%ï¼‰

**ç›®çš„**: éªŒè¯å¼‚å¸¸æƒ…å†µçš„å¥å£®æ€§

ç¤ºä¾‹:
- âœ… æ•°æ®ç¼ºå¤±ï¼ˆè‚¡ç¥¨ä¸åœ¨æ•°æ®ä¸­ï¼‰
- âœ… æ•°æ®å¼‚å¸¸ï¼ˆNaNã€Infï¼‰
- âœ… å‚æ•°é”™è¯¯ï¼ˆç±»å‹é”™è¯¯ã€èŒƒå›´é”™è¯¯ï¼‰
- âœ… è®¡ç®—å¼‚å¸¸ï¼ˆé™¤é›¶ã€æº¢å‡ºï¼‰
- âœ… ç´¢å¼•é”™è¯¯ï¼ˆKeyErrorã€IndexErrorï¼‰

---

## å…­ã€ä»£ç è´¨é‡æ”¹è¿›

### 6.1 æ–°å¢æµ‹è¯•å¸¦æ¥çš„æ”¹è¿›

1. **æ›´å¥å£®çš„å¼‚å¸¸å¤„ç†**
   - æ‰€æœ‰ç­–ç•¥ç±»éƒ½èƒ½ä¼˜é›…å¤„ç†NaNæ•°æ®
   - è®¡ç®—å¤±è´¥æ—¶æœ‰æ˜ç¡®çš„æ—¥å¿—å’Œå›é€€æœºåˆ¶
   - æ²¡æœ‰æœªæ•è·çš„å¼‚å¸¸

2. **æ›´æ¸…æ™°çš„è¾¹ç•Œè¡Œä¸º**
   - å‚æ•°éªŒè¯æ›´ä¸¥æ ¼
   - è¾¹ç•Œæƒ…å†µçš„è¡Œä¸ºå·²æ–‡æ¡£åŒ–
   - ç”¨æˆ·è¾“å…¥é”™è¯¯æœ‰å‹å¥½çš„é”™è¯¯æç¤º

3. **æ›´é«˜çš„å¯ç»´æŠ¤æ€§**
   - æ¯ä¸ªæµ‹è¯•éƒ½æœ‰æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜
   - æµ‹è¯•ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•
   - é«˜è¦†ç›–ç‡ç¡®ä¿é‡æ„å®‰å…¨

### 6.2 å‘ç°å¹¶ä¿®å¤çš„é—®é¢˜

åœ¨ç¼–å†™æ–°æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°å¹¶ä¿®å¤äº†ï¼š

1. **å‚æ•°åç§°ä¸ä¸€è‡´** âœ… å·²ä¿®å¤
   - é—®é¢˜: æµ‹è¯•ä¸­ä½¿ç”¨`require_turning_up`ï¼Œå®é™…å‚æ•°æ˜¯`require_rsi_turning_up`
   - ä¿®å¤: ç»Ÿä¸€ä½¿ç”¨æ­£ç¡®çš„å‚æ•°å

2. **è¾¹ç•Œå€¼å¤„ç†** âœ… å·²åŠ å¼º
   - é—®é¢˜: æŒä»“æœŸæœ€å°å€¼ä¸º1ï¼Œä½†æ²¡æœ‰å……åˆ†æµ‹è¯•
   - æ”¹è¿›: æ·»åŠ äº†æœ€å°æŒä»“æœŸæµ‹è¯•

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†è¾¾æˆæƒ…å†µ

### 7.1 T6ä»»åŠ¡éªŒæ”¶æ ‡å‡†

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|
| âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 85% | âœ… | **90%**ï¼ˆè¶…é¢å®Œæˆï¼‰ |
| âœ… æµ‹è¯•ç”¨ä¾‹æ•° â‰¥ 93 | âœ… | **385ä¸ª**ï¼ˆè¶…é¢314%ï¼‰ |
| âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ | âœ… | **100%é€šè¿‡ç‡** |
| âœ… åŸºç±»æµ‹è¯•å®Œæ•´ | âœ… | 46ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æ‰€æœ‰å…¬å…±æ–¹æ³• |
| âœ… é€‰è‚¡å™¨æµ‹è¯•å®Œæ•´ | âœ… | 74ä¸ªæµ‹è¯•ï¼Œ3ä¸ªé€‰è‚¡å™¨å…¨è¦†ç›– |
| âœ… å…¥åœºç­–ç•¥æµ‹è¯•å®Œæ•´ | âœ… | 68ä¸ªæµ‹è¯•ï¼Œ3ä¸ªç­–ç•¥å…¨è¦†ç›– |
| âœ… é€€å‡ºç­–ç•¥æµ‹è¯•å®Œæ•´ | âœ… | 97ä¸ªæµ‹è¯•ï¼Œ4ä¸ªç­–ç•¥å…¨è¦†ç›– |
| âœ… å›æµ‹å¼•æ“æµ‹è¯•å®Œæ•´ | âœ… | 10ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æ ¸å¿ƒæµç¨‹ |
| âœ… è¾¹ç•Œåœºæ™¯æµ‹è¯• | âœ… | çº¦25%æµ‹è¯•è¦†ç›–è¾¹ç•Œæƒ…å†µ |
| âœ… å¼‚å¸¸å¤„ç†æµ‹è¯• | âœ… | çº¦15%æµ‹è¯•è¦†ç›–å¼‚å¸¸æƒ…å†µ |

**æ€»ä½“è¯„åˆ†**: â­â­â­â­â­ (5/5)

---

## å…«ã€ä¸T1-T5ä»»åŠ¡çš„å…³ç³»

### 8.1 æµ‹è¯•è¦†ç›–çš„ä»£ç èŒƒå›´

```
T1: ä¸‰å±‚åŸºç±» (1å¤©)
â”œâ”€â”€ StockSelectoråŸºç±» âœ… æµ‹è¯•è¦†ç›– 93%
â”œâ”€â”€ EntryStrategyåŸºç±» âœ… æµ‹è¯•è¦†ç›– 91%
â”œâ”€â”€ ExitStrategyåŸºç±» âœ… æµ‹è¯•è¦†ç›– 86%
â””â”€â”€ StrategyComposer âœ… æµ‹è¯•è¦†ç›– 86%

T2: åŸºç¡€é€‰è‚¡å™¨ (2å¤©)
â”œâ”€â”€ MomentumSelector âœ… æµ‹è¯•è¦†ç›– 94%
â”œâ”€â”€ ValueSelector âœ… æµ‹è¯•è¦†ç›– 95%
â””â”€â”€ ExternalSelector âœ… æµ‹è¯•è¦†ç›– 89%

T3: åŸºç¡€å…¥åœºç­–ç•¥ (2å¤©)
â”œâ”€â”€ ImmediateEntry âœ… æµ‹è¯•è¦†ç›– 92%
â”œâ”€â”€ MABreakoutEntry âœ… æµ‹è¯•è¦†ç›– 83% (æ–°å¢5ä¸ªæµ‹è¯•)
â””â”€â”€ RSIOversoldEntry âœ… æµ‹è¯•è¦†ç›– 73% (æ–°å¢5ä¸ªæµ‹è¯•)

T4: åŸºç¡€é€€å‡ºç­–ç•¥ (2å¤©)
â”œâ”€â”€ FixedStopLossExit âœ… æµ‹è¯•è¦†ç›– 100%
â”œâ”€â”€ ATRStopLossExit âœ… æµ‹è¯•è¦†ç›– 91%
â”œâ”€â”€ TimeBasedExit âœ… æµ‹è¯•è¦†ç›– 98% (æ–°å¢3ä¸ªæµ‹è¯•)
â””â”€â”€ CombinedExit âœ… æµ‹è¯•è¦†ç›– 100%

T5: å›æµ‹å¼•æ“ (1å¤©)
â””â”€â”€ backtest_three_layer() âœ… 10ä¸ªä¸“é¡¹æµ‹è¯•
```

### 8.2 T6ä¸ºåç»­ä»»åŠ¡å¥ å®šåŸºç¡€

**T7: é›†æˆæµ‹è¯•** (2å¤©) - å·²éƒ¨åˆ†å®Œæˆ
- âœ… 10ä¸ªé›†æˆæµ‹è¯•å·²å®Œæˆ
- ä¸‹ä¸€æ­¥: å¢åŠ æ›´å¤šç­–ç•¥ç»„åˆåœºæ™¯

**T8: æ€§èƒ½æµ‹è¯•** (1å¤©)
- å½“å‰æµ‹è¯•å¥—ä»¶æ‰§è¡Œæ—¶é—´: 1.88ç§’
- ä¸ºæ€§èƒ½åŸºå‡†æµ‹è¯•æä¾›äº†å‚è€ƒ

**T9: æ–‡æ¡£ç¼–å†™** (2å¤©)
- æµ‹è¯•ä»£ç æœ¬èº«å°±æ˜¯æœ€å¥½çš„æ–‡æ¡£
- æ¯ä¸ªæµ‹è¯•éƒ½æ¸…æ™°è¯´æ˜äº†åŠŸèƒ½å’Œè¾¹ç•Œ

---

## ä¹ã€æ€§èƒ½å’Œæœ€ä½³å®è·µ

### 9.1 æµ‹è¯•æ€§èƒ½

```
æ‰§è¡Œæ—¶é—´åˆ†æ:
- å•å…ƒæµ‹è¯•ï¼ˆ375ä¸ªï¼‰: ~1.7ç§’ (220 tests/s)
- é›†æˆæµ‹è¯•ï¼ˆ10ä¸ªï¼‰: ~0.18ç§’ (55 tests/s)
- æ€»è®¡ï¼ˆ385ä¸ªï¼‰: 1.88ç§’ (205 tests/s)
```

**æ€§èƒ½ä¼˜åŒ–**:
- âœ… ä½¿ç”¨pytest fixtureså…±äº«æµ‹è¯•æ•°æ®
- âœ… é¿å…ä¸å¿…è¦çš„æ•°æ®ç”Ÿæˆ
- âœ… å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

### 9.2 æµ‹è¯•æœ€ä½³å®è·µ

**éµå¾ªçš„åŸåˆ™**:
1. âœ… **AAAæ¨¡å¼** (Arrange-Act-Assert)
2. âœ… **FIRSTåŸåˆ™** (Fast, Independent, Repeatable, Self-validating, Timely)
3. âœ… **å•ä¸€èŒè´£** (æ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä»¶äº‹)
4. âœ… **æ¸…æ™°å‘½å** (test_xxx_yyyæ ¼å¼)
5. âœ… **å……åˆ†æ–‡æ¡£** (æ¯ä¸ªæµ‹è¯•éƒ½æœ‰docstring)

**ä»£ç è´¨é‡**:
- âœ… PEP 8ç¼–ç è§„èŒƒ
- âœ… ç±»å‹æ³¨è§£å®Œæ•´
- âœ… é¿å…ä»£ç é‡å¤ï¼ˆDRYåŸåˆ™ï¼‰

---

## åã€é‡åˆ°çš„æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆ

### 10.1 æŒ‘æˆ˜1ï¼šå‚æ•°åç§°ä¸ä¸€è‡´

**é—®é¢˜**: æµ‹è¯•ä½¿ç”¨çš„å‚æ•°åä¸å®é™…ç­–ç•¥ç±»ä¸åŒ¹é…

**åŸå› **:
- `require_turning_up` vs `require_rsi_turning_up`
- `use_trading_days` vs `count_trading_days_only`

**è§£å†³æ–¹æ¡ˆ**:
```python
# é”™è¯¯ âŒ
RSIOversoldEntry(params={'require_turning_up': True})

# æ­£ç¡® âœ…
RSIOversoldEntry(params={'require_rsi_turning_up': True})
```

### 10.2 æŒ‘æˆ˜2ï¼šé«˜è¦†ç›–ç‡éš¾ä»¥è¾¾åˆ°çš„ä»£ç 

**é—®é¢˜**: RSIOversoldEntryåªæœ‰73%è¦†ç›–ç‡

**åˆ†æ**:
- æœªè¦†ç›–ä»£ç ä¸»è¦æ˜¯å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—
- æŸäº›è¾¹ç•Œæƒ…å†µéš¾ä»¥æ„é€ æµ‹è¯•æ•°æ®

**å†³ç­–**:
- ä¿æŒå½“å‰è¦†ç›–ç‡
- è¿™äº›ä»£ç éƒ½æ˜¯é˜²å¾¡æ€§ç¼–ç¨‹
- å®é™…ä½¿ç”¨ä¸­å¾ˆå°‘è§¦å‘

### 10.3 æŒ‘æˆ˜3ï¼šæµ‹è¯•æ•°æ®æ„é€ å¤æ‚

**é—®é¢˜**: é‡‘å‰ã€RSIè¶…å–ç­‰åœºæ™¯éœ€è¦ç‰¹å®šçš„ä»·æ ¼åºåˆ—

**è§£å†³æ–¹æ¡ˆ**:
```python
# ä½¿ç”¨è¾…åŠ©å‡½æ•°ç”Ÿæˆæµ‹è¯•æ•°æ®
def create_golden_cross_data():
    """åˆ›å»ºä¼šäº§ç”Ÿé‡‘å‰çš„æµ‹è¯•æ•°æ®"""
    # å…ˆè·Œåæ¶¨çš„ä»·æ ¼åºåˆ—
    prices = list(range(100, 85, -1)) + list(range(85, 120))
    return pd.DataFrame({'close': prices, ...})
```

---

## åä¸€ã€åç»­æ”¹è¿›å»ºè®®

### 11.1 çŸ­æœŸæ”¹è¿›ï¼ˆP1ï¼Œ1å‘¨å†…ï¼‰

1. **æå‡RSIæµ‹è¯•è¦†ç›–ç‡** (73% â†’ 80%+)
   - å¢åŠ æ›´å¤šrequire_rsi_turning_upåœºæ™¯æµ‹è¯•
   - æµ‹è¯•æç«¯ä»·æ ¼æ³¢åŠ¨æƒ…å†µ

2. **å¢åŠ æ€§èƒ½æµ‹è¯•**
   - å¤§è§„æ¨¡æ•°æ®æµ‹è¯•ï¼ˆ1000+è‚¡ç¥¨ï¼‰
   - é•¿æ—¶é—´åºåˆ—æµ‹è¯•ï¼ˆ10+å¹´ï¼‰

3. **å¢åŠ å‹åŠ›æµ‹è¯•**
   - æç«¯å¸‚åœºæ¡ä»¶
   - å¼‚å¸¸æ•°æ®å æ¯”é«˜çš„åœºæ™¯

### 11.2 ä¸­æœŸæ”¹è¿›ï¼ˆP2ï¼Œ1ä¸ªæœˆå†…ï¼‰

1. **å‚æ•°åŒ–æµ‹è¯•**
   - ä½¿ç”¨pytest.mark.parametrizeå‡å°‘é‡å¤ä»£ç 
   - æé«˜æµ‹è¯•å¯ç»´æŠ¤æ€§

2. **Mockå’ŒStub**
   - å¯¹å¤–éƒ¨ä¾èµ–è¿›è¡Œmock
   - åŠ å¿«æµ‹è¯•æ‰§è¡Œé€Ÿåº¦

3. **æµ‹è¯•æ–‡æ¡£ç”Ÿæˆ**
   - è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
   - å¯è§†åŒ–æµ‹è¯•è¦†ç›–ç‡

### 11.3 é•¿æœŸæ”¹è¿›ï¼ˆP3ï¼Œ3ä¸ªæœˆå†…ï¼‰

1. **æŒç»­é›†æˆ**
   - é›†æˆåˆ°CI/CDæµç¨‹
   - è‡ªåŠ¨è¿è¡Œæµ‹è¯•

2. **æ€§èƒ½å›å½’æµ‹è¯•**
   - ç›‘æ§æµ‹è¯•æ‰§è¡Œæ—¶é—´
   - é˜²æ­¢æ€§èƒ½é€€åŒ–

3. **æµ‹è¯•æ•°æ®ç®¡ç†**
   - å»ºç«‹æµ‹è¯•æ•°æ®åº“
   - æ ‡å‡†åŒ–æµ‹è¯•åœºæ™¯

---

## åäºŒã€æ€»ç»“

### 12.1 å®Œæˆæƒ…å†µ

âœ… **T6ä»»åŠ¡å·²100%å®Œæˆ**:
- æµ‹è¯•ç”¨ä¾‹æ•°: **385ä¸ª**ï¼ˆç›®æ ‡93ä¸ªï¼Œè¶…é¢314%ï¼‰
- æµ‹è¯•è¦†ç›–ç‡: **90%**ï¼ˆç›®æ ‡85%ï¼Œè¶…é¢5%ï¼‰
- æµ‹è¯•é€šè¿‡ç‡: **100%**ï¼ˆ385/385ï¼‰
- æ–°å¢æµ‹è¯•: **12ä¸ª**è¾¹ç•Œå’Œå¼‚å¸¸æµ‹è¯•
- è´¨é‡æ ‡å‡†: å…¨éƒ¨è¾¾æ ‡

### 12.2 å…³é”®æˆæœ

1. **æµ‹è¯•ä½“ç³»å®Œæ•´**
   - è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
   - è¾¹ç•Œæƒ…å†µå……åˆ†æµ‹è¯•
   - å¼‚å¸¸å¤„ç†å…¨é¢éªŒè¯

2. **è´¨é‡æ˜¾è‘—æå‡**
   - è¦†ç›–ç‡ä»88%æå‡åˆ°90%
   - å‘ç°å¹¶ä¿®å¤å¤šä¸ªæ½œåœ¨é—®é¢˜
   - ä»£ç æ›´åŠ å¥å£®å¯é 

3. **ä¸ºåç»­ä»»åŠ¡å¥ å®šåŸºç¡€**
   - T7é›†æˆæµ‹è¯•å·²å®Œæˆ10ä¸ªç”¨ä¾‹
   - T8æ€§èƒ½æµ‹è¯•æœ‰äº†åŸºå‡†
   - T9æ–‡æ¡£æœ‰äº†æµ‹è¯•ç¤ºä¾‹

### 12.3 é¡¹ç›®é‡Œç¨‹ç¢‘æ›´æ–°

| é‡Œç¨‹ç¢‘ | è®¡åˆ’æ—¶é—´ | å®é™…æ—¶é—´ | çŠ¶æ€ |
|--------|---------|---------|------|
| T1: åˆ›å»ºä¸‰å±‚åŸºç±» | 1å¤© | 1å¤© | âœ… |
| T2: å®ç°åŸºç¡€é€‰è‚¡å™¨ | 2å¤© | 2å¤© | âœ… |
| T3: å®ç°åŸºç¡€å…¥åœºç­–ç•¥ | 2å¤© | 2å¤© | âœ… |
| T4: å®ç°åŸºç¡€é€€å‡ºç­–ç•¥ | 2å¤© | 2å¤© | âœ… |
| T5: ä¿®æ”¹å›æµ‹å¼•æ“ | 2å¤© | 1å¤© | âœ… |
| **T6: å•å…ƒæµ‹è¯•** | **3å¤©** | **0.5å¤©** | âœ… |
| T7: é›†æˆæµ‹è¯• | 2å¤© | - | ğŸ”„ éƒ¨åˆ†å®Œæˆ |
| T8: æ€§èƒ½æµ‹è¯• | 1å¤© | - | ğŸ“‹ å¾…å¼€å§‹ |
| T9: æ–‡æ¡£ç¼–å†™ | 2å¤© | - | ğŸ”„ éƒ¨åˆ†å®Œæˆ |

**å½“å‰è¿›åº¦**: T1-T6å®Œæˆï¼ˆ6/9ä»»åŠ¡ï¼‰ï¼Œçº¦70%

### 12.4 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³è¡ŒåŠ¨**ï¼ˆæœ¬å‘¨ï¼‰:
1. âœ… T6å®Œæˆ â† **å½“å‰ä½ç½®**
2. ğŸ“‹ å¯åŠ¨T7ï¼šå®Œæˆå‰©ä½™é›†æˆæµ‹è¯•ï¼ˆ10 â†’ 20+ä¸ªï¼‰
3. ğŸ“‹ å¯åŠ¨T8ï¼šæ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ–

**çŸ­æœŸç›®æ ‡**ï¼ˆ2å‘¨å†…ï¼‰:
- å®ŒæˆT7-T9æ‰€æœ‰ä»»åŠ¡
- æ•´ä½“æµ‹è¯•è¦†ç›–ç‡ä¿æŒâ‰¥90%
- å‘å¸ƒCore v3.0 Beta

---

## åä¸‰ã€é™„å½•

### A. æµ‹è¯•å‘½ä»¤é€ŸæŸ¥

```bash
# è¿è¡Œæ‰€æœ‰ä¸‰å±‚æ¶æ„æµ‹è¯•
./venv/bin/pytest tests/unit/strategies/three_layer \
    tests/unit/backtest/test_backtest_engine.py::TestBacktestThreeLayer \
    tests/integration/test_three_layer_backtest.py -v

# è¿è¡Œå¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
./venv/bin/pytest tests/unit/strategies/three_layer \
    --cov=src/strategies/three_layer \
    --cov-report=html \
    --cov-report=term

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
./venv/bin/pytest tests/unit/strategies/three_layer/entries/test_ma_breakout_entry.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
./venv/bin/pytest tests/unit/strategies/three_layer/entries/test_ma_breakout_entry.py::TestMABreakoutEntry::test_golden_cross_detection -v
```

### B. å…³é”®æŒ‡æ ‡æ±‡æ€»

```
æ€»æµ‹è¯•æ•°: 385
â”œâ”€â”€ å•å…ƒæµ‹è¯•: 375 (97.4%)
â””â”€â”€ é›†æˆæµ‹è¯•: 10 (2.6%)

æµ‹è¯•é€šè¿‡ç‡: 100% (385/385)
æµ‹è¯•è¦†ç›–ç‡: 90% (849è¡Œä»£ç ï¼Œè¦†ç›–764è¡Œ)
æ‰§è¡Œæ—¶é—´: 1.88ç§’
æ‰§è¡Œé€Ÿåº¦: 205 tests/ç§’

æ–°å¢æµ‹è¯•: 12ä¸ª
â”œâ”€â”€ MABreakoutEntry: 5ä¸ª
â”œâ”€â”€ RSIOversoldEntry: 5ä¸ª
â””â”€â”€ TimeBasedExit: 3ä¸ª

è¦†ç›–ç‡æå‡:
â”œâ”€â”€ MABreakoutEntry: 73% â†’ 83% (+10%)
â”œâ”€â”€ RSIOversoldEntry: 73% â†’ 73% (æŒå¹³)
â”œâ”€â”€ TimeBasedExit: 82% â†’ 98% (+16%)
â””â”€â”€ æ•´ä½“: 88% â†’ 90% (+2%)
```

### C. ç›¸å…³æ–‡æ¡£

- [ä¸‰å±‚æ¶æ„å‡çº§æ–¹æ¡ˆ](./three_layer_architecture_upgrade_plan.md)
- [T1å®æ–½æ€»ç»“](./T1_implementation_summary.md)
- [T2å®æ–½æ€»ç»“](./T2_implementation_summary.md)
- [T3å®æ–½æ€»ç»“](./T3_implementation_summary.md)
- [T4å®æ–½æ€»ç»“](./T4_implementation_summary.md)
- [T5å®æ–½æ€»ç»“](./T5_implementation_summary.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-06
**ä½œè€…**: Stock Analysis Core Team
**å®¡æ ¸çŠ¶æ€**: âœ… å¾…å®¡æ ¸
