# 技术债务追踪

**最后更新**: 2026-02-01
**负责团队**: Quant Team

---

## 概述

本文档追踪项目中的技术债务，按优先级分类管理，定期评估和清理。

---

## 优先级定义

- **🔴 P0 (Critical)**: 阻塞性问题，影响核心功能
- **🟡 P1 (High)**: 高优先级，影响用户体验
- **🟢 P2 (Medium)**: 中优先级，影响开发效率
- **🔵 P3 (Low)**: 低优先级，优化项

---

## 技术债务清单

### 🔴 P0 - Critical (0项)

目前无阻塞性技术债务。

---

### 🟡 P1 - High (1项)

#### TD-001: Sphinx API文档生成

**类别**: 文档
**影响范围**: 用户体验
**创建日期**: 2026-02-01

**问题描述**:
当前缺少自动生成的API文档，用户需要直接阅读源代码理解接口。

**影响**:
- 新用户上手难度高
- API使用不便
- 文档维护成本高

**解决方案**:
1. 安装Sphinx及插件 (sphinx-napoleon, sphinx-autodoc)
2. 配置 `conf.py` 支持Google/NumPy风格docstring
3. 生成HTML文档
4. 部署到GitHub Pages

**预计工作量**: 0.5-1天
**计划解决时间**: 2026-02-10
**负责人**: TBD

---

#### ~~TD-002: backtest_engine.py文件过大~~ ✅ 已完成

**类别**: 代码质量
**影响范围**: 开发效率
**创建日期**: 2026-02-01
**完成日期**: 2026-02-01

**问题描述**:
`src/backtest/backtest_engine.py` 文件达到 1,275行，违反单一职责原则。

**影响**:
- 代码可读性差
- 维护困难
- 测试覆盖困难

**解决方案**:
拆分为多个模块:
```
backtest/
├── backtest_engine.py      # 主引擎 (488行, -61.8%)
├── backtest_portfolio.py   # 组合管理 (300行)
├── backtest_executor.py    # 交易执行 (414行)
└── backtest_recorder.py    # 数据记录 (162行)
```

**实际工作量**: 1天
**完成时间**: 2026-02-01
**负责人**: AI Assistant
**测试结果**: 37/37 通过 (100%)
**详细报告**: [refactor_backtest_engine_report.md](refactor_backtest_engine_report.md)

---

### 🟢 P2 - Medium (3项)

#### TD-003: 分布式计算支持

**类别**: 性能优化
**影响范围**: 系统性能
**创建日期**: 2026-02-01

**问题描述**:
当前并行计算仅支持单机多核，无法利用多机集群资源。

**影响**:
- 大规模回测速度受限
- 无法处理海量数据
- 扩展性受限

**解决方案**:
集成分布式计算框架:
- **方案1**: Ray (推荐，易用性好)
- **方案2**: Dask (pandas兼容性好)
- **方案3**: Apache Spark (重量级)

**预计工作量**: 2-3周
**计划解决时间**: 2026-Q2
**负责人**: TBD

**优先级判断**:
- 如果单机性能满足需求 → 延后
- 如果数据规模快速增长 → 提前

---

#### TD-004: 特征预计算引擎

**类别**: 性能优化
**影响范围**: 特征计算性能
**创建日期**: 2026-02-01

**问题描述**:
当前特征都是实时计算，重复计算导致性能浪费。

**影响**:
- 回测速度慢 (重复计算特征)
- 内存占用高
- 资源浪费

**解决方案**:
构建特征预计算引擎:
1. 定义特征依赖关系图
2. 增量计算未变化数据的特征
3. 特征结果持久化存储 (Parquet)
4. 智能缓存管理 (LRU)

**技术方案**:
```python
class FeatureCache:
    """特征缓存管理器"""

    def get_or_compute(
        self,
        stock_code: str,
        start_date: str,
        end_date: str,
        feature_names: List[str]
    ) -> pd.DataFrame:
        """获取或计算特征"""
        # 1. 检查缓存
        cached = self._check_cache(stock_code, start_date, end_date)

        # 2. 计算缺失特征
        missing = self._compute_missing(cached, feature_names)

        # 3. 合并返回
        return self._merge_features(cached, missing)
```

**预计工作量**: 2-3周
**计划解决时间**: 2026-Q2
**负责人**: TBD

---

#### TD-005: model_trainer.py文件优化

**类别**: 代码质量
**影响范围**: 开发效率
**创建日期**: 2026-02-01

**问题描述**:
`src/models/model_trainer.py` 文件较大且职责复杂。

**影响**:
- 训练流程不够清晰
- 扩展新模型困难
- 测试覆盖不足

**解决方案**:
优化模块结构:
```
models/
├── model_trainer.py        # 主训练器
├── training_pipeline.py    # 训练流程
├── model_validator.py      # 模型验证
└── hyperparameter_tuner.py # 超参调优
```

**预计工作量**: 1-2天
**计划解决时间**: 2026-Q2
**负责人**: TBD

---

### 🔵 P3 - Low (2项)

#### TD-006: 微服务化改造

**类别**: 架构优化
**影响范围**: 系统架构
**创建日期**: 2026-02-01

**问题描述**:
当前为单体应用，随着功能增加，耦合度会上升。

**影响**:
- 部署灵活性差
- 服务隔离性差
- 扩展性受限

**解决方案**:
逐步微服务化:
```
数据服务 (Data Service)
   ↓
特征服务 (Feature Service)
   ↓
模型服务 (Model Service)
   ↓
交易服务 (Trading Service)
```

**预计工作量**: 1-2月
**计划解决时间**: 2027-H1
**负责人**: TBD

**备注**: 仅在必要时实施，避免过度设计

---

#### TD-007: Web UI界面

**类别**: 用户体验
**影响范围**: 易用性
**创建日期**: 2026-02-01

**问题描述**:
当前仅提供CLI界面，缺少可视化管理界面。

**影响**:
- 使用门槛高
- 策略管理不便
- 监控展示有限

**解决方案**:
开发Web管理界面:
- **后端**: FastAPI (已有)
- **前端**: React + TypeScript
- **图表**: ECharts/Plotly
- **UI库**: Ant Design

**功能模块**:
- 策略管理
- 回测执行
- 结果可视化
- 系统监控
- 参数配置

**预计工作量**: 1-2月
**计划解决时间**: 2026-Q4 或 2027-H1
**负责人**: TBD

**备注**: 需评估用户需求优先级

---

## 债务统计

### 按优先级

| 优先级 | 数量 | 占比 |
|--------|------|------|
| P0 (Critical) | 0 | 0% |
| P1 (High) | 1 | 17% |
| P2 (Medium) | 3 | 50% |
| P3 (Low) | 2 | 33% |
| **总计** | **6** | **100%** |

### 按类别

| 类别 | 数量 |
|------|------|
| 代码质量 | 1 |
| 性能优化 | 2 |
| 文档 | 1 |
| 架构优化 | 1 |
| 用户体验 | 1 |

### 按计划解决时间

| 时间段 | 数量 |
|--------|------|
| 2026-02 | 2 |
| 2026-Q2 | 3 |
| 2026-Q4+ | 2 |

---

## 债务清理原则

1. **优先级驱动**: P0 > P1 > P2 > P3
2. **影响范围**: 核心功能 > 用户体验 > 开发效率
3. **成本效益**: 高收益低成本优先
4. **渐进式**: 避免大规模重构
5. **测试保障**: 清理前后测试覆盖

---

## 债务评审

### 月度评审

**频率**: 每月1次
**内容**:
- 新增债务评估
- 现有债务优先级调整
- 已清理债务确认
- 下月清理计划

### 季度评审

**频率**: 每季度1次
**内容**:
- 债务趋势分析
- 清理效率评估
- 年度目标调整
- 资源分配优化

---

## 债务预防

### 代码规范

1. **文件大小**: 单文件 < 500行 (特殊情况除外)
2. **函数复杂度**: 圈复杂度 < 10
3. **代码重复率**: < 5%
4. **注释覆盖**: 公共API 100%

### 开发流程

1. **Code Review**: 强制性代码审查
2. **持续集成**: 自动化测试 + 代码质量检查
3. **定期重构**: 每季度1次重构评估
4. **文档同步**: 代码变更同步更新文档

---

## 参考资源

- [技术债务象限](https://martinfowler.com/bliki/TechnicalDebtQuadrant.html)
- [重构: 改善既有代码的设计](https://refactoring.com/)
- [Clean Code](https://www.oreilly.com/library/view/clean-code-a/9780136083238/)

---

**维护者**: Quant Team
**审查周期**: 月度
**最后审查**: 2026-02-01
**下次审查**: 2026-03-01
