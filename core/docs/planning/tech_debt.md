# 技术债务追踪

**最后更新**: 2026-02-06
**负责团队**: Quant Team

---

## 概述

本文档追踪项目中待解决的技术债务，按优先级分类管理，定期评估和清理。

---

## 优先级定义

- **🔴 P0 (Critical)**: 阻塞性问题，影响核心功能
- **🟡 P1 (High)**: 高优先级，影响用户体验
- **🟢 P2 (Medium)**: 中优先级，影响开发效率
- **🔵 P3 (Low)**: 低优先级，优化项

---

## 待办技术债务

### 🔴 P0 - Critical (0项)

目前无阻塞性技术债务。

---

### 🟡 P1 - High (0项)

目前无高优先级技术债务。

---

### 🟢 P2 - Medium (2项)

#### TD-003: 分布式计算支持

**类别**: 性能优化
**影响范围**: 系统性能
**创建日期**: 2026-02-01

**问题描述**:
当前并行计算仅支持单机多核，无法利用多机集群资源。

**影响**:
- 大规模回测速度受限
- 无法处理海量数据
- 扩展性受限

**解决方案**:
集成分布式计算框架:
- **方案1**: Ray (推荐，易用性好)
- **方案2**: Dask (pandas兼容性好)
- **方案3**: Apache Spark (重量级)

**预计工作量**: 2-3周
**计划解决时间**: 2026-Q2
**负责人**: TBD

**优先级判断**:
- 如果单机性能满足需求 → 延后
- 如果数据规模快速增长 → 提前

---

#### TD-004: 特征预计算引擎

**类别**: 性能优化
**影响范围**: 特征计算性能
**创建日期**: 2026-02-01

**问题描述**:
当前特征都是实时计算，重复计算导致性能浪费。

**影响**:
- 回测速度慢 (重复计算特征)
- 内存占用高
- 资源浪费

**解决方案**:
构建特征预计算引擎:
1. 定义特征依赖关系图
2. 增量计算未变化数据的特征
3. 特征结果持久化存储 (Parquet)
4. 智能缓存管理 (LRU)

**技术方案**:
```python
class FeatureCache:
    """特征缓存管理器"""

    def get_or_compute(
        self,
        stock_code: str,
        start_date: str,
        end_date: str,
        feature_names: List[str]
    ) -> pd.DataFrame:
        """获取或计算特征"""
        # 1. 检查缓存
        cached = self._check_cache(stock_code, start_date, end_date)

        # 2. 计算缺失特征
        missing = self._compute_missing(cached, feature_names)

        # 3. 合并返回
        return self._merge_features(cached, missing)
```

**预计工作量**: 2-3周
**计划解决时间**: 2026-Q2
**负责人**: TBD


### 🔵 P3 - Low (1项)

#### TD-006: 微服务化改造

**类别**: 架构优化
**影响范围**: 系统架构
**创建日期**: 2026-02-01

**问题描述**:
当前为单体应用，随着功能增加，耦合度会上升。

**影响**:
- 部署灵活性差
- 服务隔离性差
- 扩展性受限

**解决方案**:
逐步微服务化:
```
数据服务 (Data Service)
   ↓
特征服务 (Feature Service)
   ↓
模型服务 (Model Service)
   ↓
交易服务 (Trading Service)
```

**预计工作量**: 1-2月
**计划解决时间**: 2027-H1
**负责人**: TBD

**备注**: 仅在必要时实施，避免过度设计

---

## 债务统计

### 按优先级

| 优先级 | 待办数量 |
|--------|---------|
| P0 (Critical) | 0 |
| P1 (High) | 0 |
| P2 (Medium) | 2 |
| P3 (Low) | 1 |
| **总计** | **3** |

### 按类别

| 类别 | 待办数量 |
|------|---------|
| 性能优化 | 2 |
| 架构优化 | 1 |

### 按计划解决时间

| 时间段 | 待办数量 |
|--------|---------|
| 2026-Q2 | 2 |
| 2027-H1 | 1 |

---

## 债务清理原则

1. **优先级驱动**: P0 > P1 > P2 > P3
2. **影响范围**: 核心功能 > 用户体验 > 开发效率
3. **成本效益**: 高收益低成本优先
4. **渐进式**: 避免大规模重构
5. **测试保障**: 清理前后测试覆盖

---

## 债务评审

### 月度评审

**频率**: 每月1次
**内容**:
- 新增债务评估
- 现有债务优先级调整
- 已清理债务确认
- 下月清理计划

### 季度评审

**频率**: 每季度1次
**内容**:
- 债务趋势分析
- 清理效率评估
- 年度目标调整
- 资源分配优化

---

## 债务预防

### 代码规范

1. **文件大小**: 单文件 < 500行 (特殊情况除外)
2. **函数复杂度**: 圈复杂度 < 10
3. **代码重复率**: < 5%
4. **注释覆盖**: 公共API 100%

### 开发流程

1. **Code Review**: 强制性代码审查
2. **持续集成**: 自动化测试 + 代码质量检查
3. **定期重构**: 每季度1次重构评估
4. **文档同步**: 代码变更同步更新文档

---

## 参考资源

- [技术债务象限](https://martinfowler.com/bliki/TechnicalDebtQuadrant.html)
- [重构: 改善既有代码的设计](https://refactoring.com/)
- [Clean Code](https://www.oreilly.com/library/view/clean-code-a/9780136083238/)

---

**维护者**: Quant Team
**审查周期**: 月度
**最后审查**: 2026-02-06
**下次审查**: 2026-03-06

---

## 已完成债务

详见 [PROJECT_STATUS.md](../architecture/PROJECT_STATUS.md) - 完成的优化项目：
- ✅ Sphinx API 文档生成系统 (2026-02-01)
- ✅ backtest_engine.py 重构拆分 (2026-02-01)
- ✅ model_trainer.py 优化重构 (2026-02-01)
