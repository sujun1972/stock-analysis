# Core v3.0 ä¸‰å±‚æ¶æ„å‡çº§é¡¹ç›®

> **é‡å¤§ç‰ˆæœ¬å‡çº§**: Core v2.x â†’ v3.0ï¼ˆæ¶æ„é‡æ„ï¼‰
> **å‘å¸ƒæ—¥æœŸ**: 2026-02-06
> **é¡¹ç›®çŠ¶æ€**: ğŸ“‹ è§„åˆ’å®Œæˆï¼Œå¾…å®æ–½

---

## ğŸ“š é¡¹ç›®æ–‡æ¡£

### ä¸»è¦æ–‡æ¡£

| æ–‡æ¡£ | æè¿° | çŠ¶æ€ |
|------|------|------|
| [**ä¸‰å±‚æ¶æ„å‡çº§æ–¹æ¡ˆ**](./three_layer_architecture_upgrade_plan.md) | Core v3.0 å®Œæ•´å®æ–½æ–¹æ¡ˆ | âœ… å®Œæˆ |
| [**MLSelector å®ç°æ–¹æ¡ˆ**](./ml_selector_implementation.md) â­ | Core å†…éƒ¨å®ç° StarRanker åŠŸèƒ½ | âœ… å®Œæˆ |
| [**StarRanker å¤–éƒ¨é›†æˆæŒ‡å—**](./starranker_integration_guide.md) | å¤–éƒ¨é€‰è‚¡ç³»ç»Ÿé›†æˆè¯¦è§£ï¼ˆå¤‡ç”¨ï¼‰ | âœ… å®Œæˆ |

### å¿«é€Ÿå¯¼èˆª

#### ğŸ‘¨â€ğŸ’¼ å†³ç­–è€…è§†è§’
- [æ‰§è¡Œæ‘˜è¦](./three_layer_architecture_upgrade_plan.md#æ‰§è¡Œæ‘˜è¦)
- [å‡çº§åŠ¨æœºå’Œç›®æ ‡](./three_layer_architecture_upgrade_plan.md#ä¸€é¡¹ç›®èƒŒæ™¯)
- [å·¥ä½œé‡è¯„ä¼°](./three_layer_architecture_upgrade_plan.md#92-å®æ–½æ—¶é—´çº¿)

#### ğŸ‘¨â€ğŸ’» å¼€å‘è€…è§†è§’
- [å½“å‰æ¶æ„åˆ†æ](./three_layer_architecture_upgrade_plan.md#äºŒå½“å‰æ¶æ„åˆ†æ)
- [ä¸‰å±‚æ¶æ„è®¾è®¡](./three_layer_architecture_upgrade_plan.md#ä¸‰ä¸‰å±‚æ¶æ„è®¾è®¡)
- [è¯¦ç»†å®æ–½æ–¹æ¡ˆ](./three_layer_architecture_upgrade_plan.md#å››è¯¦ç»†å®æ–½æ–¹æ¡ˆ)
- [æµ‹è¯•ç­–ç•¥](./three_layer_architecture_upgrade_plan.md#å…­æµ‹è¯•ç­–ç•¥)

#### ğŸ—ï¸ æ¶æ„å¸ˆè§†è§’
- [æ¶æ„æ€»è§ˆ](./three_layer_architecture_upgrade_plan.md#31-æ¶æ„æ€»è§ˆ)
- [æ ¸å¿ƒç±»è®¾è®¡](./three_layer_architecture_upgrade_plan.md#32-æ ¸å¿ƒç±»è®¾è®¡)
- [ä¸ç°æœ‰æ¶æ„çš„å…³ç³»](./three_layer_architecture_upgrade_plan.md#33-ä¸ç°æœ‰æ¶æ„çš„å…³ç³»)

#### ğŸ”§ è¿ç»´è§†è§’
- [æ€§èƒ½ä¼˜åŒ–](./three_layer_architecture_upgrade_plan.md#ä¸ƒæ€§èƒ½ä¼˜åŒ–)
- [è¿ç§»æŒ‡å—](./three_layer_architecture_upgrade_plan.md#å…«è¿ç§»æŒ‡å—)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒç›®æ ‡

Core v3.0 å¼•å…¥ä¸‰å±‚åˆ†ç¦»æ¶æ„ï¼Œå®ç°ï¼š

1. **å¤–éƒ¨é€‰è‚¡é›†æˆ** (P0)
   - æ”¯æŒ StarRanker ç­‰å¤–éƒ¨é€‰è‚¡ç³»ç»Ÿ
   - çµæ´»æ¥å…¥è‡ªå®šä¹‰é€‰è‚¡ API
   - æ‰‹åŠ¨è‚¡ç¥¨æ± è¾“å…¥

2. **ç­–ç•¥æ¨¡å—åŒ–** (P0)
   - é€‰è‚¡ã€å…¥åœºã€é€€å‡ºç‹¬ç«‹é…ç½®
   - ç­–ç•¥ç»„åˆçµæ´» (3Ã—3Ã—4 = 36+ ç§ç»„åˆ)
   - æé«˜ç­–ç•¥ç ”ç©¶æ•ˆç‡

3. **å‘åå…¼å®¹** (P0)
   - ç°æœ‰ BaseStrategy ç»§ç»­å¯ç”¨
   - æ–°æ—§æ¶æ„å…±å­˜
   - å¹³æ»‘å‡çº§è·¯å¾„

### æ¶æ„å¯¹æ¯”

| ç»´åº¦ | Core v2.x (ç°æœ‰) | Core v3.0 (å‡çº§) |
|------|-----------------|-----------------|
| **æ¶æ„æ¨¡å¼** | å•ä½“ç­–ç•¥ | ä¸‰å±‚åˆ†ç¦» |
| **å¤–éƒ¨é€‰è‚¡** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **ç­–ç•¥ç»„åˆ** | éœ€ç¼–å†™å®Œæ•´ç±» | æ¨¡å—åŒ–ç»„åˆ |
| **é€‰è‚¡é¢‘ç‡** | ä¸äº¤æ˜“é¢‘ç‡ç»‘å®š | ç‹¬ç«‹é…ç½® |
| **æ­¢æŸæ­¢ç›ˆ** | å›ºå®šæŒä»“æœŸ | çµæ´»é€€å‡ºç­–ç•¥ |
| **å‘åå…¼å®¹** | - | âœ… å®Œå…¨å…¼å®¹ |

---

## ğŸ—ï¸ ä¸‰å±‚æ¶æ„ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: StockSelector (é€‰è‚¡å™¨)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èŒè´£: ä»å…¨å¸‚åœºç­›é€‰å€™é€‰è‚¡ç¥¨æ±                           â”‚
â”‚  é¢‘ç‡: å‘¨é¢‘/æœˆé¢‘                                       â”‚
â”‚  å®ç°: MomentumSelector, ExternalSelector (StarRanker)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: EntryStrategy (å…¥åœºç­–ç•¥)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èŒè´£: å†³å®šä½•æ—¶ä¹°å…¥å€™é€‰è‚¡ç¥¨                            â”‚
â”‚  é¢‘ç‡: æ—¥é¢‘                                           â”‚
â”‚  å®ç°: MABreakoutEntry, RSIOversoldEntry, ImmediateEntryâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: ExitStrategy (é€€å‡ºç­–ç•¥)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èŒè´£: ç®¡ç†æŒä»“ï¼Œå†³å®šä½•æ—¶å–å‡º                          â”‚
â”‚  é¢‘ç‡: æ—¥é¢‘/å®æ—¶                                       â”‚
â”‚  å®ç°: ATRStopLossExit, FixedStopLossExit, TimeBasedExitâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### ä»»åŠ¡åˆ†è§£

| ä»»åŠ¡ ID | ä»»åŠ¡åç§° | å·¥ä½œé‡ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|---------|---------|--------|--------|------|
| T1 | åˆ›å»ºä¸‰å±‚åŸºç±» | 1å¤© | P0 | âœ… å®Œæˆ |
| T2 | å®ç°åŸºç¡€é€‰è‚¡å™¨ï¼ˆ3ä¸ªï¼‰ | 2å¤© | P0 | âœ… å®Œæˆ |
| T3 | å®ç°åŸºç¡€å…¥åœºç­–ç•¥ï¼ˆ3ä¸ªï¼‰ | 2å¤© | P0 | âœ… å®Œæˆ |
| T4 | å®ç°åŸºç¡€é€€å‡ºç­–ç•¥ï¼ˆ4ä¸ªï¼‰ | 2å¤© | P0 | âœ… å®Œæˆ |
| T5 | ä¿®æ”¹å›æµ‹å¼•æ“ | 2å¤© | P0 | âœ… å®Œæˆ |
| T6 | å•å…ƒæµ‹è¯•ï¼ˆ385ä¸ªç”¨ä¾‹ï¼‰ | 3å¤© | P0 | âœ… å®Œæˆ |
| T7 | é›†æˆæµ‹è¯• | 2å¤© | P1 | ğŸ”„ éƒ¨åˆ†å®Œæˆ |
| T8 | æ€§èƒ½æµ‹è¯•ä¸ä¼˜åŒ– | 1å¤© | P1 | ğŸ“‹ å¾…å¼€å§‹ |
| T9 | æ–‡æ¡£ç¼–å†™ | 2å¤© | P1 | ğŸ”„ éƒ¨åˆ†å®Œæˆ |
| **åˆè®¡** | - | **17å¤©** | - | **è¿›è¡Œä¸­** |

### æ—¶é—´çº¿

```
Week 1: T1-T2 (åŸºç±» + é€‰è‚¡å™¨)         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  T1 âœ… T2 âœ…
Week 2: T3-T5 (å…¥åœº + é€€å‡º + å¼•æ“)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  T3 âœ… T4 âœ… T5 âœ…
Week 3: T6-T9 (æµ‹è¯• + æ–‡æ¡£)           â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  T6 âœ… T7/T9 éƒ¨åˆ†å®Œæˆ

æ€»è®¡: çº¦ 3 å‘¨ï¼ˆ1äººå…¨èŒï¼‰ - å½“å‰è¿›åº¦ï¼š~70%
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç°æœ‰ç”¨æˆ·ï¼ˆv2.xï¼‰

```python
# âœ… ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ï¼Œç»§ç»­å¯ç”¨
from core.src.strategies import MomentumStrategy
from core.src.backtest import BacktestEngine

strategy = MomentumStrategy(lookback_period=20)
engine = BacktestEngine()

result = engine.backtest_long_only(
    signals=strategy.generate_signals(prices),
    prices=prices,
    top_n=50
)
```

### 2. æ–°ç”¨æˆ·ï¼ˆv3.0 ä¸‰å±‚æ¶æ„ï¼‰

```python
# ğŸ†• ä½¿ç”¨ä¸‰å±‚æ¶æ„
from core.src.strategies.three_layer import (
    MomentumSelector,
    ImmediateEntry,
    FixedStopLossExit,
    StrategyComposer
)
from core.src.backtest import BacktestEngine

# ç»„åˆç­–ç•¥
composer = StrategyComposer(
    selector=MomentumSelector(params={'top_n': 50}),
    entry=ImmediateEntry(),
    exit_strategy=FixedStopLossExit(params={'stop_loss_pct': -5.0}),
    rebalance_freq='W'
)

# å›æµ‹
engine = BacktestEngine()
result = engine.backtest_three_layer(
    selector=composer.selector,
    entry=composer.entry,
    exit_strategy=composer.exit,
    prices=prices,
    start_date='2023-01-01',
    end_date='2023-12-31'
)
```

### 3. StarRanker é›†æˆ

```python
# ä½¿ç”¨ StarRanker å¤–éƒ¨é€‰è‚¡
from core.src.strategies.three_layer.selectors import ExternalSelector

selector = ExternalSelector(params={
    'source': 'starranker',
    'starranker_config': {
        'mode': 'api',
        'api_endpoint': 'http://starranker-api:8000'
    }
})

# å…¶ä½™é…ç½®ä¸ä¸Šé¢ç›¸åŒ
composer = StrategyComposer(
    selector=selector,  # ä½¿ç”¨ StarRanker é€‰è‚¡
    entry=ImmediateEntry(),
    exit_strategy=FixedStopLossExit(params={'stop_loss_pct': -5.0}),
    rebalance_freq='W'
)
```

**è¯¦ç»†è¯´æ˜**: å‚è€ƒ [StarRanker é›†æˆæŒ‡å—](./starranker_integration_guide.md)

---

## ğŸ“Š æ ¸å¿ƒæŒ‡æ ‡

### åŠŸèƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | è¯´æ˜ |
|------|------|------|
| åŸºç¡€ç­–ç•¥æ¨¡å— | 10+ | 3é€‰è‚¡ + 3å…¥åœº + 4é€€å‡º |
| ç­–ç•¥ç»„åˆæ•° | 36+ | çµæ´»ç»„åˆ |
| StarRanker é›†æˆ | âœ… | 3ç§æ¨¡å¼ï¼ˆAPI/DB/Fileï¼‰ |
| å‘åå…¼å®¹ | âœ… | ç°æœ‰ç­–ç•¥ç»§ç»­å¯ç”¨ |

### è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ |
|------|------|------|
| æµ‹è¯•è¦†ç›–ç‡ | â‰¥ 85% | **90%** âœ… |
| å•å…ƒæµ‹è¯•ç”¨ä¾‹ | 93+ | **385** âœ… |
| é›†æˆæµ‹è¯•åœºæ™¯ | 20+ | **10** ğŸ”„ |
| ä»£ç å®¡æŸ¥ | 100% | å¾…å®æ–½ |

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | åŸºå‡† |
|------|------|------|
| å›æµ‹é€Ÿåº¦ | < 30ç§’ | 100åªè‚¡ç¥¨Ã—3å¹´ |
| å†…å­˜å ç”¨ | < 2GB | 100åªè‚¡ç¥¨Ã—3å¹´ |
| ç­–ç•¥åˆ‡æ¢ | < 100ms | - |

---

## ğŸ”— ç›¸å…³é¡¹ç›®

### Backend Phase 4

Backend é¡¹ç›®ä¹Ÿåœ¨å®æ–½ä¸‰å±‚æ¶æ„ï¼Œç›¸å…³æ–‡æ¡£ï¼š

- [Backend Phase 4 æ€»è§ˆ](../../../backend/docs/planning/phase_4_implementation_index.md)
- [Backend ä¸‰å±‚æ¶æ„æ–¹æ¡ˆ](../../../backend/docs/planning/backtest_three_layer_architecture_implementation_plan.md)

### å‰ç«¯æ”¹è¿›è®¡åˆ’

- [å‰ç«¯å›æµ‹æ”¹è¿›è®¡åˆ’](../../../docs/frontend-backtest-improvement-plan.md)

---

## ğŸ“ è”ç³»æ–¹å¼

### é¡¹ç›®è´Ÿè´£äºº

- **æŠ€æœ¯è´Ÿè´£äºº**: [å¾…æŒ‡å®š]
- **äº§å“è´Ÿè´£äºº**: [å¾…æŒ‡å®š]

### ç›¸å…³èµ„æº

- é¡¹ç›®ä»“åº“: `/Volumes/MacDriver/stock-analysis/core`
- é—®é¢˜è¿½è¸ª: [å¾…é…ç½®]
- æ–‡æ¡£ç«™ç‚¹: [å¾…é…ç½®]

---

## ğŸ“ å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | æè¿° |
|------|------|------|
| v1.0 | 2026-02-06 | åˆå§‹ç‰ˆæœ¬ï¼šä¸‰å±‚æ¶æ„å‡çº§æ–¹æ¡ˆå®Œæˆ |

---

**æœ€åæ›´æ–°**: 2026-02-06
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**é¡¹ç›®çŠ¶æ€**: ğŸ“‹ è§„åˆ’å®Œæˆï¼Œå¾…å®æ–½
