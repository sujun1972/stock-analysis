# Stock-Analysis Core æ¶æ„è¯¦è§£

**æ–‡æ¡£ç‰ˆæœ¬**: v5.1.0
**æœ€åæ›´æ–°**: 2026-02-07

---

## ğŸ“‹ ç›®å½•

- [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
- [åˆ†å±‚æ¶æ„](#åˆ†å±‚æ¶æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [æ•°æ®æµå‘](#æ•°æ®æµå‘)
- [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
- [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)

---

## æ¶æ„æ€»è§ˆ

### ç³»ç»Ÿå±‚æ¬¡ç»“æ„

```
â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
â•‘              Stock-Analysis Core æ ¸å¿ƒå¼•æ“                  â•‘
â•‘                    (ç‹¬ç«‹è¿è¡Œ)                              â•‘
â””â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         1. ç­–ç•¥å±‚ (Strategy Layer)                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  1.1 å…¥åœºç­–ç•¥ (Entry Strategy)                     â”‚
    â”‚      - èŒè´£: ç”Ÿæˆä¹°å…¥/å–ç©ºä¿¡å·                     â”‚
    â”‚      - è¾“å…¥: stock_pool + market_data              â”‚
    â”‚      - è¾“å‡º: {stock: {action, weight}}             â”‚
    â”‚      - ç­–ç•¥ç±»å‹:                                   â”‚
    â”‚        Â· æŠ€æœ¯æŒ‡æ ‡ç­–ç•¥ (åŠ¨é‡/RSI/å‡çº¿çªç ´)          â”‚
    â”‚        Â· ML å…¥åœºç­–ç•¥ (é¢„æµ‹æ”¶ç›Šç‡â†’å¤šç©ºä¿¡å·)         â”‚
    â”‚                                                   â”‚
    â”‚  1.2 é€€å‡ºç­–ç•¥ (Exit Strategy)                      â”‚
    â”‚      - èŒè´£: å†³å®šä½•æ—¶å¹³ä»“æˆ–åå‘å¼€ä»“                â”‚
    â”‚      - è¾“å…¥: current_positions + market_data       â”‚
    â”‚      - è¾“å‡º: {close: [...], reverse: {...}}        â”‚
    â”‚      - ç­–ç•¥ç±»å‹:                                   â”‚
    â”‚        Â· ä¿¡å·åè½¬é€€å‡º                              â”‚
    â”‚        Â· ç›®æ ‡è¾¾æˆé€€å‡º                              â”‚
    â”‚        Â· æ—¶é—´é€€å‡º                                  â”‚
    â”‚        Â· ML é€€å‡ºç­–ç•¥                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         2. é£æ§å±‚ (Risk Management Layer)          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: æ­¢æŸç®¡ç† + é£é™©æ§åˆ¶                         â”‚
    â”‚  ä¼˜å…ˆçº§: æœ€é«˜(å¯å¼ºåˆ¶å¹³ä»“)                          â”‚
    â”‚                                                   â”‚
    â”‚  æ­¢æŸæ£€æŸ¥:                                         â”‚
    â”‚  â”œâ”€ å•ä»“ä½æ­¢æŸ (äºæŸ > 10% å¼ºåˆ¶å¹³ä»“)               â”‚
    â”‚  â”œâ”€ ç»„åˆæ­¢æŸ (æ€»äºæŸ > 20% å…¨éƒ¨å¹³ä»“)               â”‚
    â”‚  â””â”€ æ—¶é—´æ­¢æŸ (æŒä»“ > 30å¤© å¼ºåˆ¶å¹³ä»“)                â”‚
    â”‚                                                   â”‚
    â”‚  é£é™©æ§åˆ¶:                                         â”‚
    â”‚  â”œâ”€ æ æ†é™åˆ¶ (æœ€å¤§ 1 å€)                           â”‚
    â”‚  â”œâ”€ å•ä»“ä½é™åˆ¶ (æœ€å¤§ 20%)                          â”‚
    â”‚  â”œâ”€ è¡Œä¸šé›†ä¸­åº¦é™åˆ¶ (å•è¡Œä¸šæœ€å¤§ 40%)                â”‚
    â”‚  â””â”€ A è‚¡ç‰¹æœ‰çº¦æŸ (èåˆ¸é™åˆ¶ã€æ¶¨è·Œåœ)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         3. å›æµ‹å¼•æ“å±‚ (Backtest Engine Layer)       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: åè°ƒæ‰€æœ‰å±‚çš„æ‰§è¡Œ                            â”‚
    â”‚                                                   â”‚
    â”‚  æ‰§è¡Œé¡ºåº (æ¯æ—¥):                                  â”‚
    â”‚  1. æ›´æ–°æŒä»“å¸‚å€¼                                   â”‚
    â”‚  2. é£æ§æ£€æŸ¥ (æ­¢æŸ) - ä¼˜å…ˆçº§æœ€é«˜                   â”‚
    â”‚  3. é€€å‡ºç­–ç•¥ (å¹³ä»“/åå‘)                           â”‚
    â”‚  4. å…¥åœºç­–ç•¥ (æ–°ä¿¡å·)                              â”‚
    â”‚  5. é£æ§æ£€æŸ¥ (å…¥åœºé™åˆ¶)                            â”‚
    â”‚  6. æ‰§è¡Œäº¤æ˜“ (è€ƒè™‘æ»‘ç‚¹ã€æˆæœ¬)                      â”‚
    â”‚  7. æ›´æ–°æŒä»“çŠ¶æ€                                   â”‚
    â”‚                                                   â”‚
    â”‚  ç‰¹æ€§:                                             â”‚
    â”‚  â”œâ”€ æ”¯æŒå¤šç©ºäº¤æ˜“                                   â”‚
    â”‚  â”œâ”€ å®Œæ•´çš„äº¤æ˜“æˆæœ¬å»ºæ¨¡                             â”‚
    â”‚  â”œâ”€ æ»‘ç‚¹æ¨¡æ‹Ÿ                                       â”‚
    â”‚  â””â”€ æ¶¨è·Œåœé™åˆ¶                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         4. ç»„åˆç®¡ç†å±‚ (Portfolio Layer)             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: æŒä»“ç®¡ç† + ç›ˆäºè®¡ç®—                         â”‚
    â”‚                                                   â”‚
    â”‚  åŠŸèƒ½:                                             â”‚
    â”‚  â”œâ”€ æŒä»“ç®¡ç† (å¤šå¤´/ç©ºå¤´åˆ†ç¦»)                       â”‚
    â”‚  â”œâ”€ èµ„é‡‘ç®¡ç† (ç°é‡‘æµã€ä¿è¯é‡‘)                     â”‚
    â”‚  â”œâ”€ ç›ˆäºè®¡ç®— (å·²å®ç°/æœªå®ç°)                       â”‚
    â”‚  â”œâ”€ æƒé‡å½’ä¸€åŒ–                                     â”‚
    â”‚  â””â”€ ç»„åˆä»·å€¼æ›´æ–°                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         5. ç»©æ•ˆåˆ†æå±‚ (Performance Layer)           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: å›æµ‹ç»“æœåˆ†æå’Œå¯è§†åŒ–                        â”‚
    â”‚                                                   â”‚
    â”‚  ç»©æ•ˆæŒ‡æ ‡:                                         â”‚
    â”‚  â”œâ”€ æ”¶ç›ŠæŒ‡æ ‡ (æ€»æ”¶ç›Šã€å¹´åŒ–æ”¶ç›Šã€è¶…é¢æ”¶ç›Š)         â”‚
    â”‚  â”œâ”€ é£é™©æŒ‡æ ‡ (æ³¢åŠ¨ç‡ã€æœ€å¤§å›æ’¤ã€ä¸‹è¡Œé£é™©)         â”‚
    â”‚  â”œâ”€ é£é™©è°ƒæ•´æ”¶ç›Š (å¤æ™®ã€ç´¢æè¯ºã€å¡ç›)             â”‚
    â”‚  â”œâ”€ äº¤æ˜“æŒ‡æ ‡ (èƒœç‡ã€ç›ˆäºæ¯”ã€æ¢æ‰‹ç‡)               â”‚
    â”‚  â””â”€ å½’å› åˆ†æ (å› å­è´¡çŒ®ã€è¡Œä¸šè´¡çŒ®)                 â”‚
    â”‚                                                   â”‚
    â”‚  å¯è§†åŒ–:                                           â”‚
    â”‚  â”œâ”€ ç´¯è®¡æ”¶ç›Šæ›²çº¿                                   â”‚
    â”‚  â”œâ”€ å›æ’¤æ›²çº¿                                       â”‚
    â”‚  â”œâ”€ æŒä»“åˆ†å¸ƒ                                       â”‚
    â”‚  â””â”€ äº¤æ˜“æ˜ç»†                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         6. ç‰¹å¾ä¸æ¨¡å‹å±‚ (Feature & Model Layer)     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  6.1 å› å­åº“:                                       â”‚
    â”‚      - 125+ Alpha å› å­                             â”‚
    â”‚      - 60+ æŠ€æœ¯æŒ‡æ ‡                                â”‚
    â”‚      - å› å­ç¼“å­˜ + JIT åŠ é€Ÿ                         â”‚
    â”‚                                                   â”‚
    â”‚  6.2 ML å·¥å…· (è¾…åŠ©å·¥å…·,éç­–ç•¥ç»„ä»¶):                â”‚
    â”‚      MLStockRanker (ç±»ä¼¼ BigQuant StockRanker)    â”‚
    â”‚      â”œâ”€ å®šä½: è‚¡ç¥¨è¡¨ç°é¢„æµ‹å™¨                       â”‚
    â”‚      â”œâ”€ åŠŸèƒ½: é¢„æµ‹æœªæ¥è¡¨ç°,è¾“å‡ºè¯„åˆ†æ’å            â”‚
    â”‚      â”œâ”€ ç”¨é€”: è¾…åŠ©å†³ç­–,éäº¤æ˜“æ‰§è¡Œ                  â”‚
    â”‚      â””â”€ è°ƒç”¨: Backend æˆ–ç­–ç•¥å¯é€‰æ‹©æ€§ä½¿ç”¨           â”‚
    â”‚                                                   â”‚
    â”‚  6.3 æ•°æ®è®¿é—®:                                     â”‚
    â”‚      - TimescaleDB è¿æ¥                            â”‚
    â”‚      - æ•°æ®ç¼“å­˜                                    â”‚
    â”‚      - æ•°æ®è´¨é‡æ£€æŸ¥                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åˆ†å±‚æ¶æ„

### 1. èŒè´£æ¸…æ™°

| å±‚çº§ | èŒè´£ | ä¸åšä»€ä¹ˆ |
|------|------|---------|
| MLStockRanker | é¢„æµ‹è‚¡ç¥¨è¡¨ç° | ä¸ç”Ÿæˆäº¤æ˜“ä¿¡å· |
| EntryStrategy | ç”Ÿæˆå…¥åœºä¿¡å· | ä¸ç­›é€‰è‚¡ç¥¨æ±  |
| ExitStrategy | ç”Ÿæˆé€€å‡ºä¿¡å· | ä¸ç®¡ç†æ­¢æŸ |
| RiskManager | é£é™©æ§åˆ¶ | ä¸ç”Ÿæˆç­–ç•¥ä¿¡å· |
| BacktestEngine | åè°ƒæ‰§è¡Œ | ä¸åŒ…å«ç­–ç•¥é€»è¾‘ |
| Portfolio | æŒä»“ç®¡ç† | ä¸åŒ…å«é£æ§é€»è¾‘ |

### 2. æ•°æ®æµå‘

```
å¤–éƒ¨è¾“å…¥
  â””â”€> stock_pool (è‚¡ç¥¨æ± )
  â””â”€> market_data (å¸‚åœºæ•°æ®)
        â†“
  (å¯é€‰) MLStockRanker â†’ è¾…åŠ©å‚è€ƒ
        â†“
  EntryStrategy â†’ ä¿¡å·
        â†“
  RiskManager â†’ è°ƒæ•´æƒé‡
        â†“
  Portfolio â†’ æ‰§è¡Œäº¤æ˜“
        â†“
  ExitStrategy â†’ é€€å‡ºä¿¡å·
        â†“
  RiskManager â†’ æ­¢æŸæ£€æŸ¥
        â†“
  Portfolio â†’ æ›´æ–°æŒä»“
        â†“
  BacktestResult â†’ è¾“å‡ºç»“æœ
```

### 3. å¤šç©ºæ”¯æŒ

```python
# æ‰€æœ‰ä¿¡å·ç»Ÿä¸€æ ¼å¼
Signal = {
    'stock_code': str,
    'action': Literal['long', 'short'],  # åšå¤š / åšç©º
    'weight': float                       # ä»“ä½æƒé‡ 0-1
}

# æŒä»“åˆ†ç¦»ç®¡ç†
Portfolio = {
    'long_positions': {...},   # å¤šå¤´æŒä»“
    'short_positions': {...}   # ç©ºå¤´æŒä»“
}
```

---

## æ ¸å¿ƒç»„ä»¶

### ç­–ç•¥å±‚ (Strategy Layer)

#### å…¥åœºç­–ç•¥ (EntryStrategy)

**èŒè´£**: ç”Ÿæˆä¹°å…¥/å–ç©ºä¿¡å·(åŒ…å«æƒé‡ã€æ–¹å‘)

**åŸºç±»æ¥å£**:
```python
class EntryStrategy(ABC):
    @abstractmethod
    def generate_signals(
        self,
        stock_pool: List[str],
        market_data: pd.DataFrame,
        date: str
    ) -> Dict[str, Dict]:
        """
        Returns:
            {
                '600000.SH': {'action': 'long', 'weight': 0.15},
                '000001.SZ': {'action': 'short', 'weight': 0.10}
            }
        """
        pass
```

**å†…ç½®ç­–ç•¥**:
- MomentumEntry: åŠ¨é‡å…¥åœºç­–ç•¥
- RSIOversoldEntry: RSI è¶…å–/è¶…ä¹°ç­–ç•¥
- MLEntry: ML å…¥åœºç­–ç•¥

#### é€€å‡ºç­–ç•¥ (ExitStrategy)

**èŒè´£**: å†³å®šä½•æ—¶å¹³ä»“æˆ–åå‘å¼€ä»“

**åŸºç±»æ¥å£**:
```python
class ExitStrategy(ABC):
    @abstractmethod
    def generate_exit_signals(
        self,
        positions: Dict[str, Position],
        market_data: pd.DataFrame,
        date: str
    ) -> Dict[str, Any]:
        """
        Returns:
            {
                'close': ['600000.SH'],
                'reverse': {
                    '000001.SZ': {'action': 'long', 'weight': 0.10}
                }
            }
        """
        pass
```

**å†…ç½®ç­–ç•¥**:
- SignalReversalExit: ä¿¡å·åè½¬é€€å‡º
- TargetReachedExit: ç›®æ ‡è¾¾æˆé€€å‡º
- TimeBasedExit: æ—¶é—´é€€å‡º

### é£æ§å±‚ (RiskManager)

**èŒè´£**: æ­¢æŸç®¡ç† + é£é™©æ§åˆ¶(ä¼˜å…ˆçº§æœ€é«˜)

**ç‰¹ç‚¹**:
- ä¼˜å…ˆçº§æœ€é«˜,å¯å¼ºåˆ¶å¹³ä»“
- å…ˆäºé€€å‡ºç­–ç•¥æ‰§è¡Œ
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ­¢æŸé€»è¾‘

**æ ¸å¿ƒæ–¹æ³•**:
```python
class RiskManager:
    def check_stop_loss(
        self,
        positions: Dict[str, Position],
        date: str
    ) -> List[str]:
        """æ£€æŸ¥æ­¢æŸæ¡ä»¶ï¼Œè¿”å›éœ€è¦å¼ºåˆ¶å¹³ä»“çš„è‚¡ç¥¨"""
        pass

    def check_entry_limits(
        self,
        new_signals: Dict[str, Dict],
        current_positions: Dict[str, Position],
        portfolio_value: float
    ) -> Dict[str, Dict]:
        """æ£€æŸ¥å…¥åœºé™åˆ¶ï¼Œè°ƒæ•´æ–°ä¿¡å·çš„æƒé‡"""
        pass
```

### å›æµ‹å¼•æ“ (BacktestEngine)

**èŒè´£**: åè°ƒæ‰€æœ‰å±‚çš„æ‰§è¡Œ

**æ‰§è¡Œæµç¨‹**:
```python
for date in backtest_dates:
    # 1. æ›´æ–°æŒä»“å¸‚å€¼
    portfolio.update_positions_value(market_data, date)

    # 2. é£æ§æ£€æŸ¥: æ­¢æŸ(ä¼˜å…ˆçº§æœ€é«˜)
    force_close = risk_manager.check_stop_loss(portfolio.positions, date)
    if force_close:
        portfolio.close_positions(force_close, market_data, date)

    # 3. é€€å‡ºç­–ç•¥: å¹³ä»“æˆ–åå‘å¼€ä»“
    exit_signals = exit_strategy.generate_exit_signals(
        portfolio.positions, market_data, date
    )
    portfolio.close_positions(exit_signals['close'], market_data, date)

    # 4. å…¥åœºç­–ç•¥: æ–°ä¿¡å·
    entry_signals = entry_strategy.generate_signals(
        stock_pool, market_data, date
    )

    # 5. é£æ§æ£€æŸ¥å…¥åœºé™åˆ¶
    entry_signals = risk_manager.check_entry_limits(
        entry_signals, portfolio.positions, portfolio.total_value
    )

    # 6. å¼€ä»“
    portfolio.open_positions(entry_signals, market_data, date)
```

### ç»„åˆç®¡ç† (Portfolio)

**èŒè´£**: æŒä»“ç®¡ç† + ç›ˆäºè®¡ç®—

**æ ¸å¿ƒåŠŸèƒ½**:
- æŒä»“ç®¡ç† (å¤šå¤´/ç©ºå¤´åˆ†ç¦»)
- èµ„é‡‘ç®¡ç† (ç°é‡‘æµã€ä¿è¯é‡‘)
- ç›ˆäºè®¡ç®— (å·²å®ç°/æœªå®ç°)
- æƒé‡å½’ä¸€åŒ–
- ç»„åˆä»·å€¼æ›´æ–°

### ç»©æ•ˆåˆ†æ (Performance)

**èŒè´£**: å›æµ‹ç»“æœåˆ†æå’Œå¯è§†åŒ–

**æŒ‡æ ‡ç±»åˆ«**:
- æ”¶ç›ŠæŒ‡æ ‡: æ€»æ”¶ç›Šã€å¹´åŒ–æ”¶ç›Šã€è¶…é¢æ”¶ç›Š
- é£é™©æŒ‡æ ‡: æ³¢åŠ¨ç‡ã€æœ€å¤§å›æ’¤ã€ä¸‹è¡Œé£é™©
- é£é™©è°ƒæ•´æ”¶ç›Š: å¤æ™®æ¯”ç‡ã€ç´¢æè¯ºæ¯”ç‡ã€å¡ç›æ¯”ç‡
- äº¤æ˜“æŒ‡æ ‡: èƒœç‡ã€ç›ˆäºæ¯”ã€æ¢æ‰‹ç‡

---

## æ•°æ®æµå‘

### å®Œæ•´å›æµ‹æµç¨‹

```
1. æ•°æ®å‡†å¤‡
   â””â”€> stock_pool + market_data
         â†“
2. ç­–ç•¥åˆå§‹åŒ–
   â””â”€> entry_strategy + exit_strategy + risk_manager
         â†“
3. å›æµ‹æ‰§è¡Œ (æ¯æ—¥å¾ªç¯)
   â”œâ”€> æ›´æ–°æŒä»“å¸‚å€¼
   â”œâ”€> é£æ§æ­¢æŸæ£€æŸ¥
   â”œâ”€> é€€å‡ºç­–ç•¥æ‰§è¡Œ
   â”œâ”€> å…¥åœºç­–ç•¥æ‰§è¡Œ
   â”œâ”€> é£æ§å…¥åœºé™åˆ¶
   â””â”€> æ‰§è¡Œäº¤æ˜“
         â†“
4. ç»“æœåˆ†æ
   â””â”€> BacktestResult (æŒ‡æ ‡ + å›¾è¡¨)
```

### ä¿¡å·ä¼ é€’æµç¨‹

```
stock_pool â†’ EntryStrategy.generate_signals()
                    â†“
            {stock: {action, weight}}
                    â†“
        RiskManager.check_entry_limits()
                    â†“
            è°ƒæ•´åçš„ {stock: {action, weight}}
                    â†“
        Portfolio.open_positions()
                    â†“
            Position å¯¹è±¡åˆ›å»º
                    â†“
        ExitStrategy.generate_exit_signals()
                    â†“
            {close: [...], reverse: {...}}
                    â†“
        Portfolio.close_positions()
                    â†“
            æ›´æ–°æŒä»“å’Œç›ˆäº
```

---

## è®¾è®¡ç†å¿µ

### 1. å•ä¸€èŒè´£åŸåˆ™

æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½:
- ç­–ç•¥å±‚: åªç”Ÿæˆä¿¡å·
- é£æ§å±‚: åªç®¡ç†é£é™©
- å›æµ‹å¼•æ“: åªåè°ƒæ‰§è¡Œ
- ç»„åˆç®¡ç†: åªç®¡ç†æŒä»“

### 2. å¼€é—­åŸåˆ™

ç³»ç»Ÿå¯¹æ‰©å±•å¼€æ”¾,å¯¹ä¿®æ”¹å…³é—­:
- æ–°å¢ç­–ç•¥: ç»§æ‰¿ EntryStrategy/ExitStrategy
- æ–°å¢é£æ§è§„åˆ™: æ‰©å±• RiskManager
- ä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 

### 3. ä¾èµ–å€’ç½®åŸåˆ™

é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—,éƒ½ä¾èµ–æŠ½è±¡:
- BacktestEngine ä¾èµ– EntryStrategy æ¥å£
- ä¸ä¾èµ–å…·ä½“çš„ç­–ç•¥å®ç°
- ç­–ç•¥å¯è‡ªç”±æ›¿æ¢

### 4. æ¥å£éš”ç¦»åŸåˆ™

å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£:
- EntryStrategy åªæä¾› generate_signals
- ExitStrategy åªæä¾› generate_exit_signals
- æ¥å£ç®€æ´æ˜ç¡®

---

## æ–‡ä»¶ç»“æ„

```
core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”œâ”€â”€ entries/              # å…¥åœºç­–ç•¥
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ momentum_entry.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rsi_entry.py
â”‚   â”‚   â”‚   â””â”€â”€ ml_entry.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ exits/                # é€€å‡ºç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py
â”‚   â”‚       â”œâ”€â”€ signal_reversal_exit.py
â”‚   â”‚       â”œâ”€â”€ target_reached_exit.py
â”‚   â”‚       â””â”€â”€ time_based_exit.py
â”‚   â”‚
â”‚   â”œâ”€â”€ risk/                     # é£æ§å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ risk_manager.py
â”‚   â”‚
â”‚   â”œâ”€â”€ backtest/                 # å›æµ‹å¼•æ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ backtest_engine.py
â”‚   â”‚   â”œâ”€â”€ portfolio.py
â”‚   â”‚   â””â”€â”€ backtest_result.py
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                 # ç‰¹å¾å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ alpha_factors.py
â”‚   â”‚   â”œâ”€â”€ technical_indicators.py
â”‚   â”‚   â””â”€â”€ ml_ranker.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ml/                       # æœºå™¨å­¦ä¹ æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ feature_engine.py
â”‚   â”‚   â”œâ”€â”€ label_generator.py
â”‚   â”‚   â”œâ”€â”€ model_trainer.py
â”‚   â”‚   â””â”€â”€ trained_model.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ position.py
â”‚   â”‚   â””â”€â”€ signal.py
â”‚   â”‚
â”‚   â””â”€â”€ data/                     # æ•°æ®å±‚
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ database.py
â”‚       â””â”€â”€ cache.py
â”‚
â”œâ”€â”€ models/                       # è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ ml_entry_model.pkl
â”‚   â””â”€â”€ ranker.pkl
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â””â”€â”€ integration/
```

---

## æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–°ç­–ç•¥

```python
# 1. ç»§æ‰¿åŸºç±»
class MyCustomEntry(EntryStrategy):
    def generate_signals(self, stock_pool, market_data, date):
        # å®ç°è‡ªå®šä¹‰é€»è¾‘
        signals = {}
        # ...
        return signals

# 2. ç›´æ¥ä½¿ç”¨
entry_strategy = MyCustomEntry()
engine = BacktestEngine(entry_strategy, exit_strategy, risk_manager)
result = engine.run(...)
```

### æ·»åŠ æ–°é£æ§è§„åˆ™

```python
class EnhancedRiskManager(RiskManager):
    def check_stop_loss(self, positions, date):
        # è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        force_close = super().check_stop_loss(positions, date)

        # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™
        for stock, position in positions.items():
            if self._custom_risk_check(position):
                force_close.append(stock)

        return force_close
```

---

## ç›¸å…³æ–‡æ¡£

- [æœºå™¨å­¦ä¹ ç³»ç»Ÿ](../ml/README.md)
- [ç­–ç•¥ç³»ç»Ÿ](../strategies/README.md)
- [é£æ§ç³»ç»Ÿ](../risk/README.md)
- [å›æµ‹å¼•æ“](../backtest/README.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v5.1.0
**æœ€åæ›´æ–°**: 2026-02-07
