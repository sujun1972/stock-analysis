# Stock-Analysis Core æ¶æ„è¯¦è§£

**æ–‡æ¡£ç‰ˆæœ¬**: v6.0.0
**æœ€åæ›´æ–°**: 2026-02-09
**é‡å¤§æ›´æ–°**: ç­–ç•¥ç³»ç»Ÿé‡æ„å®Œæˆï¼ˆPhase 1-4ï¼‰

---

## ğŸ“‹ ç›®å½•

- [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
- [v6.0 æ–°å¢æ¶æ„](#v60-æ–°å¢æ¶æ„)
- [åˆ†å±‚æ¶æ„](#åˆ†å±‚æ¶æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [æ•°æ®æµå‘](#æ•°æ®æµå‘)
- [è®¾è®¡ç†å¿µ](#è®¾è®¡ç†å¿µ)
- [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)

---

## æ¶æ„æ€»è§ˆ

### ç³»ç»Ÿå±‚æ¬¡ç»“æ„

```
â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
â•‘            Stock-Analysis Core v6.0 æ ¸å¿ƒå¼•æ“                â•‘
â•‘                  (ç‹¬ç«‹è¿è¡Œ + ç­–ç•¥ç³»ç»Ÿé‡æ„)                   â•‘
â””â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      1. ç­–ç•¥å·¥å‚å±‚ (Strategy Factory) â­æ–°å¢        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: ç»Ÿä¸€ç­–ç•¥åˆ›å»ºæ¥å£                            â”‚
    â”‚  æ”¯æŒä¸‰ç§ç­–ç•¥ç±»å‹:                                 â”‚
    â”‚    Â· é¢„å®šä¹‰ç­–ç•¥ (Predefined)                       â”‚
    â”‚    Â· é…ç½®é©±åŠ¨ç­–ç•¥ (Configured)                     â”‚
    â”‚    Â· åŠ¨æ€ä»£ç ç­–ç•¥ (Dynamic)                        â”‚
    â”‚                                                   â”‚
    â”‚  æ ¸å¿ƒç»„ä»¶:                                         â”‚
    â”‚    - StrategyFactory.create()                     â”‚
    â”‚    - StrategyFactory.create_from_config()         â”‚
    â”‚    - StrategyFactory.create_from_code()           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      2. åŠ è½½å™¨å±‚ (Loader Layer) â­æ–°å¢              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: ä»ä¸åŒæ¥æºåŠ è½½ç­–ç•¥                          â”‚
    â”‚                                                   â”‚
    â”‚  2.1 ConfigLoader (é…ç½®åŠ è½½å™¨)                     â”‚
    â”‚      - ä»æ•°æ®åº“åŠ è½½å‚æ•°é…ç½®                        â”‚
    â”‚      - å®ä¾‹åŒ–é¢„å®šä¹‰ç­–ç•¥ç±»                          â”‚
    â”‚                                                   â”‚
    â”‚  2.2 DynamicCodeLoader (åŠ¨æ€ä»£ç åŠ è½½å™¨)            â”‚
    â”‚      - ä»æ•°æ®åº“åŠ è½½Pythonä»£ç                       â”‚
    â”‚      - å¤šå±‚å®‰å…¨éªŒè¯                                â”‚
    â”‚      - åŠ¨æ€ç¼–è¯‘å’Œæ‰§è¡Œ                              â”‚
    â”‚                                                   â”‚
    â”‚  2.3 LoaderFactory (åŠ è½½å™¨å·¥å‚)                    â”‚
    â”‚      - ç»Ÿä¸€åŠ è½½æ¥å£                                â”‚
    â”‚      - æ‰¹é‡åŠ è½½æ”¯æŒ                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       3. å®‰å…¨å±‚ (Security Layer) â­æ–°å¢             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: å¤šå±‚å®‰å…¨é˜²æŠ¤å’Œå®¡è®¡                          â”‚
    â”‚                                                   â”‚
    â”‚  3.1 CodeSanitizer (ä»£ç å‡€åŒ–å™¨)                    â”‚
    â”‚      - ASTè¯­æ³•æ ‘æ·±åº¦åˆ†æ                           â”‚
    â”‚      - å±é™©å¯¼å…¥/å‡½æ•°/å±æ€§æ£€æµ‹                      â”‚
    â”‚      - ä»£ç å“ˆå¸Œå®Œæ•´æ€§éªŒè¯                          â”‚
    â”‚      - é£é™©ç­‰çº§è¯„ä¼°                                â”‚
    â”‚                                                   â”‚
    â”‚  3.2 PermissionChecker (æƒé™æ£€æŸ¥å™¨)                â”‚
    â”‚      - æ–‡ä»¶ç³»ç»Ÿè®¿é—®æ‹¦æˆª                            â”‚
    â”‚      - ç½‘ç»œè®¿é—®æ‹¦æˆª                                â”‚
    â”‚      - ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæ‹¦æˆª                            â”‚
    â”‚                                                   â”‚
    â”‚  3.3 ResourceLimiter (èµ„æºé™åˆ¶å™¨)                  â”‚
    â”‚      - CPUæ—¶é—´é™åˆ¶ (é»˜è®¤30s)                       â”‚
    â”‚      - å†…å­˜é™åˆ¶ (é»˜è®¤512MB)                        â”‚
    â”‚      - å¢™é’Ÿæ—¶é—´é™åˆ¶ (é»˜è®¤60s)                      â”‚
    â”‚                                                   â”‚
    â”‚  3.4 AuditLogger (å®¡è®¡æ—¥å¿—)                        â”‚
    â”‚      - ç­–ç•¥åŠ è½½/æ‰§è¡Œäº‹ä»¶è®°å½•                       â”‚
    â”‚      - å®‰å…¨è¿è§„äº‹ä»¶è®°å½•                            â”‚
    â”‚      - JSONLæ ¼å¼å­˜å‚¨                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         4. ç­–ç•¥æ‰§è¡Œå±‚ (Strategy Execution)          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  4.1 BaseStrategy (ç­–ç•¥åŸºç±») - å¢å¼º                â”‚
    â”‚      - èŒè´£: ç”Ÿæˆäº¤æ˜“ä¿¡å·å’Œè‚¡ç¥¨è¯„åˆ†                â”‚
    â”‚      - æ–°å¢: get_metadata() æ–¹æ³•                   â”‚
    â”‚      - æ–°å¢: å…ƒä¿¡æ¯å±æ€§ (strategy_type, code_hash) â”‚
    â”‚                                                   â”‚
    â”‚  4.2 é¢„å®šä¹‰ç­–ç•¥ (Predefined Strategies)            â”‚
    â”‚      - MomentumStrategy (åŠ¨é‡ç­–ç•¥)                 â”‚
    â”‚      - MeanReversionStrategy (å‡å€¼å›å½’)            â”‚
    â”‚      - MultiFactorStrategy (å¤šå› å­ç­–ç•¥)            â”‚
    â”‚                                                   â”‚
    â”‚  4.3 SignalGenerator (ä¿¡å·ç”Ÿæˆå™¨)                  â”‚
    â”‚      - ç»Ÿä¸€çš„ä¿¡å·ç”Ÿæˆå·¥å…·                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         2. é£æ§å±‚ (Risk Management Layer)          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: æ­¢æŸç®¡ç† + é£é™©æ§åˆ¶                         â”‚
    â”‚  ä¼˜å…ˆçº§: æœ€é«˜(å¯å¼ºåˆ¶å¹³ä»“)                          â”‚
    â”‚                                                   â”‚
    â”‚  æ­¢æŸæ£€æŸ¥:                                         â”‚
    â”‚  â”œâ”€ å•ä»“ä½æ­¢æŸ (äºæŸ > 10% å¼ºåˆ¶å¹³ä»“)               â”‚
    â”‚  â”œâ”€ ç»„åˆæ­¢æŸ (æ€»äºæŸ > 20% å…¨éƒ¨å¹³ä»“)               â”‚
    â”‚  â””â”€ æ—¶é—´æ­¢æŸ (æŒä»“ > 30å¤© å¼ºåˆ¶å¹³ä»“)                â”‚
    â”‚                                                   â”‚
    â”‚  é£é™©æ§åˆ¶:                                         â”‚
    â”‚  â”œâ”€ æ æ†é™åˆ¶ (æœ€å¤§ 1 å€)                           â”‚
    â”‚  â”œâ”€ å•ä»“ä½é™åˆ¶ (æœ€å¤§ 20%)                          â”‚
    â”‚  â”œâ”€ è¡Œä¸šé›†ä¸­åº¦é™åˆ¶ (å•è¡Œä¸šæœ€å¤§ 40%)                â”‚
    â”‚  â””â”€ A è‚¡ç‰¹æœ‰çº¦æŸ (èåˆ¸é™åˆ¶ã€æ¶¨è·Œåœ)                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         3. å›æµ‹å¼•æ“å±‚ (Backtest Engine Layer)       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: åè°ƒæ‰€æœ‰å±‚çš„æ‰§è¡Œ                            â”‚
    â”‚                                                   â”‚
    â”‚  æ‰§è¡Œé¡ºåº (æ¯æ—¥):                                  â”‚
    â”‚  1. æ›´æ–°æŒä»“å¸‚å€¼                                   â”‚
    â”‚  2. é£æ§æ£€æŸ¥ (æ­¢æŸ) - ä¼˜å…ˆçº§æœ€é«˜                   â”‚
    â”‚  3. é€€å‡ºç­–ç•¥ (å¹³ä»“/åå‘)                           â”‚
    â”‚  4. å…¥åœºç­–ç•¥ (æ–°ä¿¡å·)                              â”‚
    â”‚  5. é£æ§æ£€æŸ¥ (å…¥åœºé™åˆ¶)                            â”‚
    â”‚  6. æ‰§è¡Œäº¤æ˜“ (è€ƒè™‘æ»‘ç‚¹ã€æˆæœ¬)                      â”‚
    â”‚  7. æ›´æ–°æŒä»“çŠ¶æ€                                   â”‚
    â”‚                                                   â”‚
    â”‚  ç‰¹æ€§:                                             â”‚
    â”‚  â”œâ”€ æ”¯æŒå¤šç©ºäº¤æ˜“                                   â”‚
    â”‚  â”œâ”€ å®Œæ•´çš„äº¤æ˜“æˆæœ¬å»ºæ¨¡                             â”‚
    â”‚  â”œâ”€ æ»‘ç‚¹æ¨¡æ‹Ÿ                                       â”‚
    â”‚  â””â”€ æ¶¨è·Œåœé™åˆ¶                                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         4. ç»„åˆç®¡ç†å±‚ (Portfolio Layer)             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: æŒä»“ç®¡ç† + ç›ˆäºè®¡ç®—                         â”‚
    â”‚                                                   â”‚
    â”‚  åŠŸèƒ½:                                             â”‚
    â”‚  â”œâ”€ æŒä»“ç®¡ç† (å¤šå¤´/ç©ºå¤´åˆ†ç¦»)                       â”‚
    â”‚  â”œâ”€ èµ„é‡‘ç®¡ç† (ç°é‡‘æµã€ä¿è¯é‡‘)                     â”‚
    â”‚  â”œâ”€ ç›ˆäºè®¡ç®— (å·²å®ç°/æœªå®ç°)                       â”‚
    â”‚  â”œâ”€ æƒé‡å½’ä¸€åŒ–                                     â”‚
    â”‚  â””â”€ ç»„åˆä»·å€¼æ›´æ–°                                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         5. ç»©æ•ˆåˆ†æå±‚ (Performance Layer)           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: å›æµ‹ç»“æœåˆ†æå’Œå¯è§†åŒ–                        â”‚
    â”‚                                                   â”‚
    â”‚  ç»©æ•ˆæŒ‡æ ‡:                                         â”‚
    â”‚  â”œâ”€ æ”¶ç›ŠæŒ‡æ ‡ (æ€»æ”¶ç›Šã€å¹´åŒ–æ”¶ç›Šã€è¶…é¢æ”¶ç›Š)         â”‚
    â”‚  â”œâ”€ é£é™©æŒ‡æ ‡ (æ³¢åŠ¨ç‡ã€æœ€å¤§å›æ’¤ã€ä¸‹è¡Œé£é™©)         â”‚
    â”‚  â”œâ”€ é£é™©è°ƒæ•´æ”¶ç›Š (å¤æ™®ã€ç´¢æè¯ºã€å¡ç›)             â”‚
    â”‚  â”œâ”€ äº¤æ˜“æŒ‡æ ‡ (èƒœç‡ã€ç›ˆäºæ¯”ã€æ¢æ‰‹ç‡)               â”‚
    â”‚  â””â”€ å½’å› åˆ†æ (å› å­è´¡çŒ®ã€è¡Œä¸šè´¡çŒ®)                 â”‚
    â”‚                                                   â”‚
    â”‚  å¯è§†åŒ–:                                           â”‚
    â”‚  â”œâ”€ ç´¯è®¡æ”¶ç›Šæ›²çº¿                                   â”‚
    â”‚  â”œâ”€ å›æ’¤æ›²çº¿                                       â”‚
    â”‚  â”œâ”€ æŒä»“åˆ†å¸ƒ                                       â”‚
    â”‚  â””â”€ äº¤æ˜“æ˜ç»†                                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      7. æ€§èƒ½ä¼˜åŒ–å±‚ (Performance Layer) â­æ–°å¢       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  èŒè´£: æå‡ç­–ç•¥åŠ è½½å’Œæ‰§è¡Œæ€§èƒ½                      â”‚
    â”‚                                                   â”‚
    â”‚  7.1 å¤šçº§ç¼“å­˜                                      â”‚
    â”‚      - å†…å­˜ç¼“å­˜ (500x æ€§èƒ½æå‡)                    â”‚
    â”‚      - Redisç¼“å­˜ (100x æ€§èƒ½æå‡)                   â”‚
    â”‚      - ç­–ç•¥ç¼“å­˜ç®¡ç†                                â”‚
    â”‚                                                   â”‚
    â”‚  7.2 æ‡’åŠ è½½æœºåˆ¶                                    â”‚
    â”‚      - LazyStrategy (å»¶è¿ŸåŠ è½½)                     â”‚
    â”‚      - StrategyPool (LRUæ·˜æ±°)                      â”‚
    â”‚      - 20x å¯åŠ¨æ—¶é—´æå‡                            â”‚
    â”‚                                                   â”‚
    â”‚  7.3 æ‰¹é‡ä¼˜åŒ–                                      â”‚
    â”‚      - QueryOptimizer (æ‰¹é‡æŸ¥è¯¢)                   â”‚
    â”‚      - 25x æ‰¹é‡åŠ è½½æå‡                            â”‚
    â”‚                                                   â”‚
    â”‚  7.4 æ€§èƒ½ç›‘æ§                                      â”‚
    â”‚      - PerformanceMonitor (æ€§èƒ½è¿½è¸ª)               â”‚
    â”‚      - MetricsCollector (æŒ‡æ ‡æ”¶é›†)                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         8. ç‰¹å¾ä¸æ¨¡å‹å±‚ (Feature & Model Layer)     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  8.1 å› å­åº“:                                       â”‚
    â”‚      - 125+ Alpha å› å­                             â”‚
    â”‚      - 60+ æŠ€æœ¯æŒ‡æ ‡                                â”‚
    â”‚      - å› å­ç¼“å­˜ + JIT åŠ é€Ÿ                         â”‚
    â”‚                                                   â”‚
    â”‚  8.2 ML å·¥å…· (è¾…åŠ©å·¥å…·,éç­–ç•¥ç»„ä»¶):                â”‚
    â”‚      MLStockRanker (ç±»ä¼¼ BigQuant StockRanker)    â”‚
    â”‚      â”œâ”€ å®šä½: è‚¡ç¥¨è¡¨ç°é¢„æµ‹å™¨                       â”‚
    â”‚      â”œâ”€ åŠŸèƒ½: é¢„æµ‹æœªæ¥è¡¨ç°,è¾“å‡ºè¯„åˆ†æ’å            â”‚
    â”‚      â”œâ”€ ç”¨é€”: è¾…åŠ©å†³ç­–,éäº¤æ˜“æ‰§è¡Œ                  â”‚
    â”‚      â””â”€ è°ƒç”¨: Backend æˆ–ç­–ç•¥å¯é€‰æ‹©æ€§ä½¿ç”¨           â”‚
    â”‚                                                   â”‚
    â”‚  8.3 æ•°æ®è®¿é—®:                                     â”‚
    â”‚      - TimescaleDB è¿æ¥                            â”‚
    â”‚      - æ•°æ®ç¼“å­˜                                    â”‚
    â”‚      - æ•°æ®è´¨é‡æ£€æŸ¥                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## v6.0 æ–°å¢æ¶æ„

### ç­–ç•¥ç³»ç»Ÿé‡æ„æ¦‚è§ˆ

v6.0 ç‰ˆæœ¬å¯¹ç­–ç•¥ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢é‡æ„ï¼Œæ–°å¢äº†ä¸‰ä¸ªæ ¸å¿ƒå±‚ï¼š

#### 1. ç­–ç•¥å·¥å‚å±‚

**ç›®çš„**: ç»Ÿä¸€ç­–ç•¥åˆ›å»ºæ¥å£ï¼Œæ”¯æŒä¸‰ç§ç­–ç•¥ç±»å‹

```python
# é¢„å®šä¹‰ç­–ç•¥
strategy = factory.create('momentum', config)

# é…ç½®é©±åŠ¨ç­–ç•¥
strategy = factory.create_from_config(config_id=123)

# åŠ¨æ€ä»£ç ç­–ç•¥
strategy = factory.create_from_code(strategy_id=456)
```

#### 2. å®‰å…¨å±‚

**ç›®çš„**: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œä¿æŠ¤åŠ¨æ€ä»£ç æ‰§è¡Œ

**é˜²å¾¡æ¶æ„**:
- ç¬¬1å±‚: BackendéªŒè¯ (å¯é€‰)
- ç¬¬2å±‚: CoreåŠ è½½éªŒè¯ (CodeSanitizer)
- ç¬¬3å±‚: è¿è¡Œæ—¶éš”ç¦» (ResourceLimiter)
- ç¬¬4å±‚: å®¡è®¡ç›‘æ§ (AuditLogger)

#### 3. æ€§èƒ½ä¼˜åŒ–å±‚

**ç›®çš„**: å¤§å¹…æå‡ç­–ç•¥åŠ è½½å’Œæ‰§è¡Œæ€§èƒ½

**æ€§èƒ½æå‡**:
- å†…å­˜ç¼“å­˜: **500x**
- Redisç¼“å­˜: **100x**
- æ‰¹é‡åŠ è½½: **25x**
- æ‡’åŠ è½½: **20x** å¯åŠ¨æ—¶é—´

è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ: [ç­–ç•¥ç³»ç»Ÿé‡æ„æ–¹æ¡ˆ](../planning/core_strategy_system_refactoring.md)

---

## åˆ†å±‚æ¶æ„

### 1. èŒè´£æ¸…æ™°

| å±‚çº§ | èŒè´£ | ä¸åšä»€ä¹ˆ |
|------|------|---------|
| MLStockRanker | é¢„æµ‹è‚¡ç¥¨è¡¨ç° | ä¸ç”Ÿæˆäº¤æ˜“ä¿¡å· |
| EntryStrategy | ç”Ÿæˆå…¥åœºä¿¡å· | ä¸ç­›é€‰è‚¡ç¥¨æ±  |
| ExitStrategy | ç”Ÿæˆé€€å‡ºä¿¡å· | ä¸ç®¡ç†æ­¢æŸ |
| RiskManager | é£é™©æ§åˆ¶ | ä¸ç”Ÿæˆç­–ç•¥ä¿¡å· |
| BacktestEngine | åè°ƒæ‰§è¡Œ | ä¸åŒ…å«ç­–ç•¥é€»è¾‘ |
| Portfolio | æŒä»“ç®¡ç† | ä¸åŒ…å«é£æ§é€»è¾‘ |

### 2. æ•°æ®æµå‘

```
å¤–éƒ¨è¾“å…¥
  â””â”€> stock_pool (è‚¡ç¥¨æ± )
  â””â”€> market_data (å¸‚åœºæ•°æ®)
        â†“
  (å¯é€‰) MLStockRanker â†’ è¾…åŠ©å‚è€ƒ
        â†“
  EntryStrategy â†’ ä¿¡å·
        â†“
  RiskManager â†’ è°ƒæ•´æƒé‡
        â†“
  Portfolio â†’ æ‰§è¡Œäº¤æ˜“
        â†“
  ExitStrategy â†’ é€€å‡ºä¿¡å·
        â†“
  RiskManager â†’ æ­¢æŸæ£€æŸ¥
        â†“
  Portfolio â†’ æ›´æ–°æŒä»“
        â†“
  BacktestResult â†’ è¾“å‡ºç»“æœ
```

### 3. å¤šç©ºæ”¯æŒ

```python
# æ‰€æœ‰ä¿¡å·ç»Ÿä¸€æ ¼å¼
Signal = {
    'stock_code': str,
    'action': Literal['long', 'short'],  # åšå¤š / åšç©º
    'weight': float                       # ä»“ä½æƒé‡ 0-1
}

# æŒä»“åˆ†ç¦»ç®¡ç†
Portfolio = {
    'long_positions': {...},   # å¤šå¤´æŒä»“
    'short_positions': {...}   # ç©ºå¤´æŒä»“
}
```

---

## æ ¸å¿ƒç»„ä»¶

### ç­–ç•¥å·¥å‚å±‚ (Strategy Factory) â­æ–°å¢

#### StrategyFactory

**èŒè´£**: ç»Ÿä¸€ç­–ç•¥åˆ›å»ºæ¥å£ï¼Œæ”¯æŒä¸‰ç§ç­–ç•¥ç±»å‹

**æ ¸å¿ƒAPI**:
```python
class StrategyFactory:
    def create(self, strategy_name: str, config: Dict) -> BaseStrategy:
        """åˆ›å»ºé¢„å®šä¹‰ç­–ç•¥"""
        pass

    def create_from_config(self, config_id: int) -> BaseStrategy:
        """åˆ›å»ºé…ç½®é©±åŠ¨ç­–ç•¥"""
        pass

    def create_from_code(
        self,
        strategy_id: int,
        strict_mode: bool = True
    ) -> BaseStrategy:
        """åˆ›å»ºåŠ¨æ€ä»£ç ç­–ç•¥"""
        pass
```

**ä¸‰ç§ç­–ç•¥ç±»å‹**:

1. **é¢„å®šä¹‰ç­–ç•¥ (Predefined)**
   - ç¡¬ç¼–ç åœ¨ä»£ç åº“ä¸­
   - æ€§èƒ½æœ€ä¼˜ï¼Œé€‚åˆæ ‡å‡†ç­–ç•¥
   - ç¤ºä¾‹: MomentumStrategy, MeanReversionStrategy

2. **é…ç½®é©±åŠ¨ç­–ç•¥ (Configured)**
   - ä»æ•°æ®åº“åŠ è½½å‚æ•°é…ç½®
   - é€‚åˆå‚æ•°è°ƒä¼˜å’ŒA/Bæµ‹è¯•
   - ä½¿ç”¨ ConfigLoader

3. **åŠ¨æ€ä»£ç ç­–ç•¥ (Dynamic)**
   - ä»æ•°æ®åº“åŠ è½½Pythonä»£ç 
   - æ”¯æŒå®Œå…¨è‡ªå®šä¹‰é€»è¾‘
   - å¤šå±‚å®‰å…¨éªŒè¯
   - Coreä¸å…³å¿ƒä»£ç æ¥æºï¼ˆAIç”Ÿæˆã€äººå·¥ç¼–å†™æˆ–å…¶ä»–ï¼‰

### åŠ è½½å™¨å±‚ (Loaders) â­æ–°å¢

#### ConfigLoader

**èŒè´£**: ä»æ•°æ®åº“åŠ è½½å‚æ•°é…ç½®å¹¶å®ä¾‹åŒ–é¢„å®šä¹‰ç­–ç•¥

**å·¥ä½œæµç¨‹**:
```python
config = db.query("SELECT * FROM strategy_configs WHERE id=?")
strategy_class = get_strategy_class(config['strategy_name'])
strategy = strategy_class(**config['parameters'])
```

#### DynamicCodeLoader

**èŒè´£**: ä»æ•°æ®åº“åŠ è½½Pythonä»£ç å¹¶å®‰å…¨ç¼–è¯‘æ‰§è¡Œ

**å·¥ä½œæµç¨‹**:
```python
code = db.query("SELECT code FROM dynamic_strategies WHERE id=?")
# 1. CodeSanitizer éªŒè¯
# 2. compile() ç¼–è¯‘
# 3. ResourceLimiter é™åˆ¶
# 4. è¿”å›ç­–ç•¥å®ä¾‹
```

**å®‰å…¨æœºåˆ¶**:
- ASTæ·±åº¦åˆ†æ
- å±é™©ä»£ç æ£€æµ‹
- èµ„æºé™åˆ¶
- å®¡è®¡æ—¥å¿—

### å®‰å…¨å±‚ (Security) â­æ–°å¢

#### CodeSanitizer

**èŒè´£**: ä»£ç å‡€åŒ–å’ŒéªŒè¯

**æ£€æµ‹é¡¹**:
- å±é™©å¯¼å…¥ (os, subprocess, socket, etc.)
- å±é™©å‡½æ•° (eval, exec, compile, etc.)
- å±é™©å±æ€§ (__import__, __builtins__, etc.)
- ä»£ç å“ˆå¸Œå®Œæ•´æ€§

#### PermissionChecker

**èŒè´£**: è¿è¡Œæ—¶æƒé™æ£€æŸ¥

**æ‹¦æˆªé¡¹**:
- æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- ç½‘ç»œè®¿é—®
- ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ

#### ResourceLimiter

**èŒè´£**: èµ„æºä½¿ç”¨é™åˆ¶

**é™åˆ¶é¡¹**:
- CPUæ—¶é—´ (é»˜è®¤30s)
- å†…å­˜ä½¿ç”¨ (é»˜è®¤512MB)
- å¢™é’Ÿæ—¶é—´ (é»˜è®¤60s)

#### AuditLogger

**èŒè´£**: å®‰å…¨å®¡è®¡å’Œæ—¥å¿—è®°å½•

**è®°å½•å†…å®¹**:
- ç­–ç•¥åŠ è½½äº‹ä»¶
- å®‰å…¨éªŒè¯ç»“æœ
- æ‰§è¡Œå¼‚å¸¸äº‹ä»¶
- JSONLæ ¼å¼å­˜å‚¨

### æ€§èƒ½ä¼˜åŒ–å±‚ (Optimization) â­æ–°å¢

#### StrategyCache

**èŒè´£**: å¤šçº§ç¼“å­˜ç®¡ç†

**ç¼“å­˜å±‚çº§**:
- å†…å­˜ç¼“å­˜ (500xæ€§èƒ½æå‡)
- Redisç¼“å­˜ (100xæ€§èƒ½æå‡)

#### LazyStrategy & StrategyPool

**èŒè´£**: æ‡’åŠ è½½å’ŒLRUæ·˜æ±°

**æ€§èƒ½æå‡**:
- å¯åŠ¨æ—¶é—´æå‡ 20x
- å†…å­˜å ç”¨ä¼˜åŒ–

#### QueryOptimizer

**èŒè´£**: æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–

**æ€§èƒ½æå‡**:
- æ‰¹é‡åŠ è½½ 25x

#### PerformanceMonitor & MetricsCollector

**èŒè´£**: æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†

**ç›‘æ§æŒ‡æ ‡**:
- ç­–ç•¥åŠ è½½æ—¶é—´
- æ‰§è¡Œæ—¶é—´
- ç¼“å­˜å‘½ä¸­ç‡
- èµ„æºä½¿ç”¨æƒ…å†µ

### ç­–ç•¥æ‰§è¡Œå±‚ (Strategy Execution)

#### BaseStrategy (å¢å¼ºç‰ˆ) â­é‡æ„

**èŒè´£**: ç”Ÿæˆäº¤æ˜“ä¿¡å·å’Œè‚¡ç¥¨è¯„åˆ†

**åŸºç±»æ¥å£**:
```python
class BaseStrategy(ABC):
    @abstractmethod
    def generate_signals(
        self,
        stock_pool: List[str],
        market_data: pd.DataFrame,
        date: str
    ) -> Dict[str, Dict]:
        """
        Returns:
            {
                '600000.SH': {'action': 'long', 'weight': 0.15},
                '000001.SZ': {'action': 'short', 'weight': 0.10}
            }
        """
        pass

    def get_metadata(self) -> Dict:
        """è¿”å›ç­–ç•¥å…ƒä¿¡æ¯ (æ–°å¢)"""
        return {
            'strategy_type': self.strategy_type,
            'strategy_id': self.strategy_id,
            'code_hash': self.code_hash,
            'version': self.version
        }
```

**å†…ç½®é¢„å®šä¹‰ç­–ç•¥**:
- MomentumStrategy: åŠ¨é‡ç­–ç•¥
- MeanReversionStrategy: å‡å€¼å›å½’ç­–ç•¥
- MultiFactorStrategy: å¤šå› å­ç­–ç•¥

#### æ—§æ¶æ„ç­–ç•¥ (å‘åå…¼å®¹)

**å…¥åœºç­–ç•¥ (EntryStrategy)** - ä¿ç•™å‘åå…¼å®¹

**èŒè´£**: ç”Ÿæˆä¹°å…¥/å–ç©ºä¿¡å·(åŒ…å«æƒé‡ã€æ–¹å‘)

**å†…ç½®ç­–ç•¥**:
- MomentumEntry: åŠ¨é‡å…¥åœºç­–ç•¥
- RSIOversoldEntry: RSI è¶…å–/è¶…ä¹°ç­–ç•¥
- MLEntry: ML å…¥åœºç­–ç•¥

**é€€å‡ºç­–ç•¥ (ExitStrategy)** - ä¿ç•™å‘åå…¼å®¹

**èŒè´£**: å†³å®šä½•æ—¶å¹³ä»“æˆ–åå‘å¼€ä»“

**å†…ç½®ç­–ç•¥**:
- SignalReversalExit: ä¿¡å·åè½¬é€€å‡º
- TargetReachedExit: ç›®æ ‡è¾¾æˆé€€å‡º
- TimeBasedExit: æ—¶é—´é€€å‡º

### é£æ§å±‚ (RiskManager)

**èŒè´£**: æ­¢æŸç®¡ç† + é£é™©æ§åˆ¶(ä¼˜å…ˆçº§æœ€é«˜)

**ç‰¹ç‚¹**:
- ä¼˜å…ˆçº§æœ€é«˜,å¯å¼ºåˆ¶å¹³ä»“
- å…ˆäºé€€å‡ºç­–ç•¥æ‰§è¡Œ
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ­¢æŸé€»è¾‘

**æ ¸å¿ƒæ–¹æ³•**:
```python
class RiskManager:
    def check_stop_loss(
        self,
        positions: Dict[str, Position],
        date: str
    ) -> List[str]:
        """æ£€æŸ¥æ­¢æŸæ¡ä»¶ï¼Œè¿”å›éœ€è¦å¼ºåˆ¶å¹³ä»“çš„è‚¡ç¥¨"""
        pass

    def check_entry_limits(
        self,
        new_signals: Dict[str, Dict],
        current_positions: Dict[str, Position],
        portfolio_value: float
    ) -> Dict[str, Dict]:
        """æ£€æŸ¥å…¥åœºé™åˆ¶ï¼Œè°ƒæ•´æ–°ä¿¡å·çš„æƒé‡"""
        pass
```

### å›æµ‹å¼•æ“ (BacktestEngine)

**èŒè´£**: åè°ƒæ‰€æœ‰å±‚çš„æ‰§è¡Œ

**æ‰§è¡Œæµç¨‹**:
```python
for date in backtest_dates:
    # 1. æ›´æ–°æŒä»“å¸‚å€¼
    portfolio.update_positions_value(market_data, date)

    # 2. é£æ§æ£€æŸ¥: æ­¢æŸ(ä¼˜å…ˆçº§æœ€é«˜)
    force_close = risk_manager.check_stop_loss(portfolio.positions, date)
    if force_close:
        portfolio.close_positions(force_close, market_data, date)

    # 3. é€€å‡ºç­–ç•¥: å¹³ä»“æˆ–åå‘å¼€ä»“
    exit_signals = exit_strategy.generate_exit_signals(
        portfolio.positions, market_data, date
    )
    portfolio.close_positions(exit_signals['close'], market_data, date)

    # 4. å…¥åœºç­–ç•¥: æ–°ä¿¡å·
    entry_signals = entry_strategy.generate_signals(
        stock_pool, market_data, date
    )

    # 5. é£æ§æ£€æŸ¥å…¥åœºé™åˆ¶
    entry_signals = risk_manager.check_entry_limits(
        entry_signals, portfolio.positions, portfolio.total_value
    )

    # 6. å¼€ä»“
    portfolio.open_positions(entry_signals, market_data, date)
```

### ç»„åˆç®¡ç† (Portfolio)

**èŒè´£**: æŒä»“ç®¡ç† + ç›ˆäºè®¡ç®—

**æ ¸å¿ƒåŠŸèƒ½**:
- æŒä»“ç®¡ç† (å¤šå¤´/ç©ºå¤´åˆ†ç¦»)
- èµ„é‡‘ç®¡ç† (ç°é‡‘æµã€ä¿è¯é‡‘)
- ç›ˆäºè®¡ç®— (å·²å®ç°/æœªå®ç°)
- æƒé‡å½’ä¸€åŒ–
- ç»„åˆä»·å€¼æ›´æ–°

### ç»©æ•ˆåˆ†æ (Performance)

**èŒè´£**: å›æµ‹ç»“æœåˆ†æå’Œå¯è§†åŒ–

**æŒ‡æ ‡ç±»åˆ«**:
- æ”¶ç›ŠæŒ‡æ ‡: æ€»æ”¶ç›Šã€å¹´åŒ–æ”¶ç›Šã€è¶…é¢æ”¶ç›Š
- é£é™©æŒ‡æ ‡: æ³¢åŠ¨ç‡ã€æœ€å¤§å›æ’¤ã€ä¸‹è¡Œé£é™©
- é£é™©è°ƒæ•´æ”¶ç›Š: å¤æ™®æ¯”ç‡ã€ç´¢æè¯ºæ¯”ç‡ã€å¡ç›æ¯”ç‡
- äº¤æ˜“æŒ‡æ ‡: èƒœç‡ã€ç›ˆäºæ¯”ã€æ¢æ‰‹ç‡

---

## æ•°æ®æµå‘

### å®Œæ•´å›æµ‹æµç¨‹

```
1. æ•°æ®å‡†å¤‡
   â””â”€> stock_pool + market_data
         â†“
2. ç­–ç•¥åˆå§‹åŒ–
   â””â”€> entry_strategy + exit_strategy + risk_manager
         â†“
3. å›æµ‹æ‰§è¡Œ (æ¯æ—¥å¾ªç¯)
   â”œâ”€> æ›´æ–°æŒä»“å¸‚å€¼
   â”œâ”€> é£æ§æ­¢æŸæ£€æŸ¥
   â”œâ”€> é€€å‡ºç­–ç•¥æ‰§è¡Œ
   â”œâ”€> å…¥åœºç­–ç•¥æ‰§è¡Œ
   â”œâ”€> é£æ§å…¥åœºé™åˆ¶
   â””â”€> æ‰§è¡Œäº¤æ˜“
         â†“
4. ç»“æœåˆ†æ
   â””â”€> BacktestResult (æŒ‡æ ‡ + å›¾è¡¨)
```

### ä¿¡å·ä¼ é€’æµç¨‹

```
stock_pool â†’ EntryStrategy.generate_signals()
                    â†“
            {stock: {action, weight}}
                    â†“
        RiskManager.check_entry_limits()
                    â†“
            è°ƒæ•´åçš„ {stock: {action, weight}}
                    â†“
        Portfolio.open_positions()
                    â†“
            Position å¯¹è±¡åˆ›å»º
                    â†“
        ExitStrategy.generate_exit_signals()
                    â†“
            {close: [...], reverse: {...}}
                    â†“
        Portfolio.close_positions()
                    â†“
            æ›´æ–°æŒä»“å’Œç›ˆäº
```

---

## è®¾è®¡ç†å¿µ

### 1. å•ä¸€èŒè´£åŸåˆ™

æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½:
- ç­–ç•¥å±‚: åªç”Ÿæˆä¿¡å·
- é£æ§å±‚: åªç®¡ç†é£é™©
- å›æµ‹å¼•æ“: åªåè°ƒæ‰§è¡Œ
- ç»„åˆç®¡ç†: åªç®¡ç†æŒä»“

### 2. å¼€é—­åŸåˆ™

ç³»ç»Ÿå¯¹æ‰©å±•å¼€æ”¾,å¯¹ä¿®æ”¹å…³é—­:
- æ–°å¢ç­–ç•¥: ç»§æ‰¿ EntryStrategy/ExitStrategy
- æ–°å¢é£æ§è§„åˆ™: æ‰©å±• RiskManager
- ä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 

### 3. ä¾èµ–å€’ç½®åŸåˆ™

é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—,éƒ½ä¾èµ–æŠ½è±¡:
- BacktestEngine ä¾èµ– EntryStrategy æ¥å£
- ä¸ä¾èµ–å…·ä½“çš„ç­–ç•¥å®ç°
- ç­–ç•¥å¯è‡ªç”±æ›¿æ¢

### 4. æ¥å£éš”ç¦»åŸåˆ™

å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£:
- EntryStrategy åªæä¾› generate_signals
- ExitStrategy åªæä¾› generate_exit_signals
- æ¥å£ç®€æ´æ˜ç¡®

---

## æ–‡ä»¶ç»“æ„

```
core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”œâ”€â”€ predefined/          # â­æ–°å¢ é¢„å®šä¹‰ç­–ç•¥ (é‡æ„)
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # BaseStrategy åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ momentum_strategy.py
â”‚   â”‚   â”‚   â”œâ”€â”€ mean_reversion_strategy.py
â”‚   â”‚   â”‚   â””â”€â”€ multi_factor_strategy.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ loaders/             # â­æ–°å¢ åŠ è½½å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config_loader.py      # é…ç½®åŠ è½½å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ dynamic_loader.py     # åŠ¨æ€ä»£ç åŠ è½½å™¨
â”‚   â”‚   â”‚   â””â”€â”€ loader_factory.py     # åŠ è½½å™¨å·¥å‚
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ security/            # â­æ–°å¢ å®‰å…¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ code_sanitizer.py     # ä»£ç å‡€åŒ–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ permission_checker.py # æƒé™æ£€æŸ¥å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ resource_limiter.py   # èµ„æºé™åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ audit_logger.py       # å®¡è®¡æ—¥å¿—
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ cache/               # â­æ–°å¢ ç¼“å­˜ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ strategy_cache.py     # ç­–ç•¥ç¼“å­˜
â”‚   â”‚   â”‚   â”œâ”€â”€ lazy_strategy.py      # æ‡’åŠ è½½ç­–ç•¥
â”‚   â”‚   â”‚   â””â”€â”€ strategy_pool.py      # ç­–ç•¥æ±  (LRU)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ optimization/        # â­æ–°å¢ æ€§èƒ½ä¼˜åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ query_optimizer.py    # æŸ¥è¯¢ä¼˜åŒ–å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ performance_monitor.py # æ€§èƒ½ç›‘æ§
â”‚   â”‚   â”‚   â””â”€â”€ metrics_collector.py   # æŒ‡æ ‡æ”¶é›†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ factory.py           # â­æ–°å¢ ç­–ç•¥å·¥å‚
â”‚   â”‚   â”œâ”€â”€ signal_generator.py  # ä¿¡å·ç”Ÿæˆå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ entries/             # å…¥åœºç­–ç•¥ (æ—§æ¶æ„,ä¿ç•™)
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”‚   â”œâ”€â”€ momentum_entry.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rsi_entry.py
â”‚   â”‚   â”‚   â””â”€â”€ ml_entry.py
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ exits/               # é€€å‡ºç­–ç•¥ (æ—§æ¶æ„,ä¿ç•™)
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py
â”‚   â”‚       â”œâ”€â”€ signal_reversal_exit.py
â”‚   â”‚       â”œâ”€â”€ target_reached_exit.py
â”‚   â”‚       â””â”€â”€ time_based_exit.py
â”‚   â”‚
â”‚   â”œâ”€â”€ risk/                    # é£æ§å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ risk_manager.py
â”‚   â”‚
â”‚   â”œâ”€â”€ backtest/                # å›æµ‹å¼•æ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ backtest_engine.py
â”‚   â”‚   â”œâ”€â”€ portfolio.py
â”‚   â”‚   â””â”€â”€ backtest_result.py
â”‚   â”‚
â”‚   â”œâ”€â”€ features/                # ç‰¹å¾å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ alpha_factors.py
â”‚   â”‚   â”œâ”€â”€ technical_indicators.py
â”‚   â”‚   â””â”€â”€ ml_ranker.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ml/                      # æœºå™¨å­¦ä¹ æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ feature_engine.py
â”‚   â”‚   â”œâ”€â”€ label_generator.py
â”‚   â”‚   â”œâ”€â”€ model_trainer.py
â”‚   â”‚   â””â”€â”€ trained_model.py
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ position.py
â”‚   â”‚   â””â”€â”€ signal.py
â”‚   â”‚
â”‚   â””â”€â”€ data/                    # æ•°æ®å±‚
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ database.py
â”‚       â””â”€â”€ cache.py
â”‚
â”œâ”€â”€ models/                      # è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ ml_entry_model.pkl
â”‚   â””â”€â”€ ranker.pkl
â”‚
â”œâ”€â”€ audit_logs/                  # â­æ–°å¢ å®¡è®¡æ—¥å¿—å­˜å‚¨
â”‚   â””â”€â”€ *.jsonl
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”‚   â”œâ”€â”€ strategies/          # â­æ–°å¢ ç­–ç•¥æµ‹è¯•
    â”‚   â”œâ”€â”€ security/            # â­æ–°å¢ å®‰å…¨æµ‹è¯•
    â”‚   â””â”€â”€ ...
    â””â”€â”€ integration/
```

---

## æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–°ç­–ç•¥

```python
# 1. ç»§æ‰¿åŸºç±»
class MyCustomEntry(EntryStrategy):
    def generate_signals(self, stock_pool, market_data, date):
        # å®ç°è‡ªå®šä¹‰é€»è¾‘
        signals = {}
        # ...
        return signals

# 2. ç›´æ¥ä½¿ç”¨
entry_strategy = MyCustomEntry()
engine = BacktestEngine(entry_strategy, exit_strategy, risk_manager)
result = engine.run(...)
```

### æ·»åŠ æ–°é£æ§è§„åˆ™

```python
class EnhancedRiskManager(RiskManager):
    def check_stop_loss(self, positions, date):
        # è°ƒç”¨çˆ¶ç±»æ–¹æ³•
        force_close = super().check_stop_loss(positions, date)

        # æ·»åŠ è‡ªå®šä¹‰è§„åˆ™
        for stock, position in positions.items():
            if self._custom_risk_check(position):
                force_close.append(stock)

        return force_close
```

---

## ç›¸å…³æ–‡æ¡£

- [æœºå™¨å­¦ä¹ ç³»ç»Ÿ](../ml/README.md)
- [ç­–ç•¥ç³»ç»Ÿ](../strategies/README.md)
- [é£æ§ç³»ç»Ÿ](../risk/README.md)
- [å›æµ‹å¼•æ“](../backtest/README.md)

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨æ¯æ¬¡æ¶æ„å˜æ›´ååŠæ—¶æ›´æ–°æœ¬æ–‡æ¡£
