# Core v6.0.0 æ›´æ–°æ—¥å¿—

**å‘å¸ƒæ—¥æœŸ**: 2026-02-09
**ç‰ˆæœ¬å‡çº§**: v5.2.0 â†’ v6.0.0
**é‡å¤§æ›´æ–°**: ç­–ç•¥ç³»ç»Ÿå…¨é¢é‡æ„ï¼ˆPhase 1-4 å®Œæˆï¼‰

---

## ğŸ“‹ æ›´æ–°æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°æ˜¯ Core é¡¹ç›®æœ€é‡å¤§çš„æ¶æ„å‡çº§ä¹‹ä¸€ï¼Œå¯¹**ç­–ç•¥ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢é‡æ„**ï¼Œå¼•å…¥äº†**ç­–ç•¥å·¥å‚æ¨¡å¼**ã€**ä¸‰ç§ç­–ç•¥ç±»å‹**ã€**å¤šå±‚å®‰å…¨é˜²æŠ¤**å’Œ**æ€§èƒ½ä¼˜åŒ–ä½“ç³»**ã€‚

æ ¸å¿ƒç›®æ ‡:
- âœ… ç»Ÿä¸€ç­–ç•¥åˆ›å»ºæ¥å£ï¼ˆStrategyFactoryï¼‰
- âœ… æ”¯æŒåŠ¨æ€ä»£ç ç­–ç•¥ï¼ˆBackendæäº¤Pythonä»£ç ï¼‰
- âœ… å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼ˆASTåˆ†æ + è¿è¡Œæ—¶éš”ç¦» + å®¡è®¡æ—¥å¿—ï¼‰
- âœ… å¤§å¹…æå‡æ€§èƒ½ï¼ˆ500xå†…å­˜ç¼“å­˜ + 25xæ‰¹é‡åŠ è½½ + 20xå¯åŠ¨æ—¶é—´ï¼‰

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›å†…å®¹

### 1. ç­–ç•¥å·¥å‚æ¨¡å¼ â­æ–°æ¶æ„

**ä½ç½®**: `core/src/strategies/factory.py`

**æ–°å¢ç»„ä»¶**:

#### StrategyFactoryï¼ˆç­–ç•¥å·¥å‚ï¼‰
ç»Ÿä¸€çš„ç­–ç•¥åˆ›å»ºæ¥å£ï¼Œæ”¯æŒä¸‰ç§ç­–ç•¥ç±»å‹:

```python
from core.strategies import StrategyFactory

factory = StrategyFactory()

# æ–¹å¼1: é¢„å®šä¹‰ç­–ç•¥
strategy = factory.create('momentum', config)

# æ–¹å¼2: é…ç½®é©±åŠ¨ç­–ç•¥
strategy = factory.create_from_config(config_id=123)

# æ–¹å¼3: åŠ¨æ€ä»£ç ç­–ç•¥
strategy = factory.create_from_code(strategy_id=456)
```

**APIæ–¹æ³•**:
- `create(strategy_name, config)` - åˆ›å»ºé¢„å®šä¹‰ç­–ç•¥
- `create_from_config(config_id)` - ä»æ•°æ®åº“é…ç½®åˆ›å»º
- `create_from_code(strategy_id, strict_mode)` - ä»åŠ¨æ€ä»£ç åˆ›å»º

---

### 2. ä¸‰ç§ç­–ç•¥ç±»å‹ â­æ–°æ¶æ„

#### 2.1 é¢„å®šä¹‰ç­–ç•¥ (Predefined Strategies)

**ä½ç½®**: `core/src/strategies/predefined/`

**ç‰¹ç‚¹**:
- ç¡¬ç¼–ç åœ¨Coreä»£ç åº“
- æ€§èƒ½æœ€ä¼˜ï¼ˆâ­â­â­â­â­ï¼‰
- ä»£ç å®¡æŸ¥ä¸¥æ ¼
- é€‚åˆç”Ÿäº§ç¯å¢ƒ

**æ–°å¢/é‡æ„ç­–ç•¥**:
- `MomentumStrategy` - åŠ¨é‡ç­–ç•¥ï¼ˆé‡æ„ï¼‰
- `MeanReversionStrategy` - å‡å€¼å›å½’ç­–ç•¥ï¼ˆé‡æ„ï¼‰
- `MultiFactorStrategy` - å¤šå› å­ç­–ç•¥ï¼ˆé‡æ„ï¼‰

**åŸºç±»å¢å¼º**:
- `BaseStrategy` æ–°å¢ `get_metadata()` æ–¹æ³•
- æ–°å¢å…ƒä¿¡æ¯å±æ€§: `strategy_type`, `strategy_id`, `code_hash`, `version`

#### 2.2 é…ç½®é©±åŠ¨ç­–ç•¥ (Configured Strategies)

**ä½ç½®**: `core/src/strategies/loaders/config_loader.py`

**ç‰¹ç‚¹**:
- ä»æ•°æ®åº“åŠ è½½å‚æ•°é…ç½®
- å®ä¾‹åŒ–é¢„å®šä¹‰ç­–ç•¥ç±»
- é€‚åˆå‚æ•°è°ƒä¼˜å’ŒA/Bæµ‹è¯•
- æ€§èƒ½æ¥è¿‘é¢„å®šä¹‰ç­–ç•¥ï¼ˆâ­â­â­â­ï¼‰

**å·¥ä½œæµç¨‹**:
1. ä»æ•°æ®åº“æŸ¥è¯¢é…ç½®: `SELECT * FROM strategy_configs WHERE id=?`
2. è§£æç­–ç•¥åç§°å’Œå‚æ•°
3. è°ƒç”¨ `factory.create()` å®ä¾‹åŒ–ç­–ç•¥
4. ç¼“å­˜ç­–ç•¥å®ä¾‹

**æ•°æ®åº“è¡¨ç»“æ„**:
```sql
CREATE TABLE strategy_configs (
    id SERIAL PRIMARY KEY,
    strategy_name VARCHAR(100),
    parameters JSONB,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

#### 2.3 åŠ¨æ€ä»£ç ç­–ç•¥ (Dynamic Strategies)

**ä½ç½®**: `core/src/strategies/loaders/dynamic_loader.py`

**ç‰¹ç‚¹**:
- ä»æ•°æ®åº“åŠ è½½å®Œæ•´Pythonä»£ç 
- æ”¯æŒBackendæäº¤ä»£ç ï¼ˆAIç”Ÿæˆã€äººå·¥ç¼–å†™æˆ–å…¶ä»–ï¼‰
- **Coreä¸å…³å¿ƒä»£ç æ¥æº**ï¼Œåªè´Ÿè´£å®‰å…¨éªŒè¯å’Œæ‰§è¡Œ
- å¤šå±‚å®‰å…¨é˜²æŠ¤
- é€‚åˆåˆ›æ–°ç­–ç•¥å’Œå¿«é€Ÿè¯•é”™

**å·¥ä½œæµç¨‹**:
1. ä»æ•°æ®åº“åŠ è½½ä»£ç : `SELECT code, code_hash FROM dynamic_strategies WHERE id=?`
2. **å®‰å…¨éªŒè¯** (CodeSanitizer): ASTåˆ†æ + å±é™©ä»£ç æ£€æµ‹
3. **åŠ¨æ€ç¼–è¯‘**: `compile(code, '<dynamic>', 'exec')`
4. **èµ„æºé™åˆ¶** (ResourceLimiter): CPU/å†…å­˜/æ—¶é—´é™åˆ¶
5. **å®¡è®¡æ—¥å¿—** (AuditLogger): è®°å½•åŠ è½½å’Œæ‰§è¡Œäº‹ä»¶
6. è¿”å›ç­–ç•¥å®ä¾‹

**æ•°æ®åº“è¡¨ç»“æ„**:
```sql
CREATE TABLE dynamic_strategies (
    id SERIAL PRIMARY KEY,
    strategy_name VARCHAR(100),
    code TEXT,
    code_hash VARCHAR(64),
    version INTEGER,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

**é‡è¦è¯´æ˜**:
> **Coreä¸å…³å¿ƒä»£ç æ¥æº**: Coreé¡¹ç›®åªè´Ÿè´£å®‰å…¨éªŒè¯å’Œæ‰§è¡Œï¼Œä¸å‡è®¾ä»£ç æ˜¯ç”±AIç”Ÿæˆã€äººå·¥ç¼–å†™è¿˜æ˜¯å…¶ä»–æ–¹å¼äº§ç”Ÿçš„ã€‚Backendå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹å¼ç”Ÿæˆä»£ç ï¼ˆDeepSeekã€æ‰‹å†™ã€æ¨¡æ¿ç­‰ï¼‰ï¼ŒCoreåªå…³æ³¨ä»£ç çš„å®‰å…¨æ€§å’Œæ­£ç¡®æ€§ã€‚

---

### 3. å®‰å…¨å±‚ â­æ–°å¢

**ä½ç½®**: `core/src/strategies/security/`

ä¸ºåŠ¨æ€ä»£ç ç­–ç•¥æä¾›å¤šå±‚å®‰å…¨é˜²æŠ¤:

#### 3.1 CodeSanitizerï¼ˆä»£ç å‡€åŒ–å™¨ï¼‰

**ä½ç½®**: `core/src/strategies/security/code_sanitizer.py`

**èŒè´£**: é™æ€ä»£ç åˆ†æå’Œå±é™©ä»£ç æ£€æµ‹

**æ£€æµ‹é¡¹**:
- å±é™©å¯¼å…¥: `os`, `subprocess`, `socket`, `sys`, `importlib`
- å±é™©å‡½æ•°: `eval`, `exec`, `compile`, `__import__`, `open`, `input`
- å±é™©å±æ€§: `__builtins__`, `__globals__`, `__import__`, `__file__`, `__code__`
- ä»£ç å“ˆå¸ŒéªŒè¯

**é£é™©ç­‰çº§**:
- `HIGH`: å‘ç°å±é™©ä»£ç ï¼Œæ‹’ç»æ‰§è¡Œ
- `MEDIUM`: å‘ç°å¯ç–‘ä»£ç ï¼Œè®°å½•è­¦å‘Š
- `LOW`: ä»£ç å®‰å…¨

#### 3.2 PermissionCheckerï¼ˆæƒé™æ£€æŸ¥å™¨ï¼‰

**ä½ç½®**: `core/src/strategies/security/permission_checker.py`

**èŒè´£**: è¿è¡Œæ—¶æƒé™æ‹¦æˆª

**æ‹¦æˆªé¡¹**:
- æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- ç½‘ç»œè®¿é—®
- ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œ
- ç¯å¢ƒå˜é‡ä¿®æ”¹

**å®ç°æ–¹å¼**: ä½¿ç”¨å—é™çš„å‘½åç©ºé—´æ‰§è¡Œä»£ç 

#### 3.3 ResourceLimiterï¼ˆèµ„æºé™åˆ¶å™¨ï¼‰

**ä½ç½®**: `core/src/strategies/security/resource_limiter.py`

**èŒè´£**: é™åˆ¶èµ„æºä½¿ç”¨

**é™åˆ¶é¡¹**:
- CPUæ—¶é—´é™åˆ¶: é»˜è®¤30ç§’
- å†…å­˜é™åˆ¶: é»˜è®¤512MB
- å¢™é’Ÿæ—¶é—´é™åˆ¶: é»˜è®¤60ç§’

**å®ç°æ–¹å¼**: ä½¿ç”¨ `signal` å’Œ `resource` æ¨¡å—

#### 3.4 AuditLoggerï¼ˆå®¡è®¡æ—¥å¿—ï¼‰

**ä½ç½®**: `core/src/strategies/security/audit_logger.py`

**èŒè´£**: è®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³äº‹ä»¶

**æ—¥å¿—å†…å®¹**:
- ç­–ç•¥åŠ è½½äº‹ä»¶
- å®‰å…¨éªŒè¯ç»“æœ
- æ‰§è¡Œå¼‚å¸¸äº‹ä»¶
- å®‰å…¨è¿è§„äº‹ä»¶

**æ—¥å¿—æ ¼å¼**: JSONLæ ¼å¼å­˜å‚¨åœ¨ `core/audit_logs/`

**é˜²å¾¡æ¶æ„**:
```
Backendæäº¤ä»£ç 
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬1å±‚: BackendéªŒè¯   â”‚ (å¯é€‰)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬2å±‚: CoreåŠ è½½éªŒè¯  â”‚ (å¿…é€‰)
â”‚ - CodeSanitizer     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬3å±‚: è¿è¡Œæ—¶éš”ç¦»    â”‚ (å¿…é€‰)
â”‚ - ResourceLimiter   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¬¬4å±‚: å®¡è®¡ç›‘æ§      â”‚ (å¿…é€‰)
â”‚ - AuditLogger       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. æ€§èƒ½ä¼˜åŒ–å±‚ â­æ–°å¢

**ä½ç½®**: `core/src/strategies/cache/` + `core/src/strategies/optimization/`

#### 4.1 å¤šçº§ç¼“å­˜

**StrategyCacheï¼ˆç­–ç•¥ç¼“å­˜ï¼‰**:
- **L1å†…å­˜ç¼“å­˜**: 500xæ€§èƒ½æå‡ï¼Œå‘½ä¸­ç‡95%
- **L2 Redisç¼“å­˜**: 100xæ€§èƒ½æå‡ï¼Œå‘½ä¸­ç‡90%
- **L3æ•°æ®åº“**: 1xåŸºå‡†æ€§èƒ½

**ä½ç½®**: `core/src/strategies/cache/strategy_cache.py`

**ä½¿ç”¨ç¤ºä¾‹**:
```python
cache = StrategyCache(max_size=100)
cache.set(strategy_id=456, strategy=strategy_instance)
strategy = cache.get(strategy_id=456)  # 500x faster
```

#### 4.2 æ‡’åŠ è½½æœºåˆ¶

**LazyStrategyï¼ˆæ‡’åŠ è½½ç­–ç•¥ï¼‰**:
- å»¶è¿ŸåŠ è½½ç­–ç•¥å®ä¾‹
- å¯åŠ¨æ—¶é—´æå‡ **20x**

**StrategyPoolï¼ˆç­–ç•¥æ± ï¼‰**:
- LRUæ·˜æ±°ç­–ç•¥
- è‡ªåŠ¨ç®¡ç†ç­–ç•¥ç”Ÿå‘½å‘¨æœŸ

**ä½ç½®**:
- `core/src/strategies/cache/lazy_strategy.py`
- `core/src/strategies/cache/strategy_pool.py`

**æ€§èƒ½å¯¹æ¯”**:
```python
# ä¼ ç»Ÿæ–¹å¼: å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰ç­–ç•¥
strategies = [factory.create_from_code(id) for id in range(1, 101)]
# è€—æ—¶: 50ç§’

# æ‡’åŠ è½½æ–¹å¼: æŒ‰éœ€åŠ è½½
strategies = [LazyStrategy(id) for id in range(1, 101)]
# è€—æ—¶: 2.5ç§’ (20x faster)
```

#### 4.3 æ‰¹é‡ä¼˜åŒ–

**QueryOptimizerï¼ˆæŸ¥è¯¢ä¼˜åŒ–å™¨ï¼‰**:
- æ‰¹é‡åŠ è½½å¤šä¸ªç­–ç•¥
- æ€§èƒ½æå‡ **25x**

**ä½ç½®**: `core/src/strategies/optimization/query_optimizer.py`

**æ€§èƒ½å¯¹æ¯”**:
```python
# å•ä¸ªåŠ è½½: 4 x 500ms = 2000ms
# æ‰¹é‡åŠ è½½: 80ms (25x faster)

optimizer = QueryOptimizer()
strategies = optimizer.batch_load([456, 457, 458, 459])
```

#### 4.4 æ€§èƒ½ç›‘æ§

**PerformanceMonitorï¼ˆæ€§èƒ½ç›‘æ§ï¼‰**:
- è‡ªåŠ¨è®°å½•æ€§èƒ½æŒ‡æ ‡
- ç­–ç•¥åŠ è½½æ—¶é—´
- æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
- ç¼“å­˜å‘½ä¸­ç‡

**MetricsCollectorï¼ˆæŒ‡æ ‡æ”¶é›†å™¨ï¼‰**:
- æ”¶é›†ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

**ä½ç½®**:
- `core/src/strategies/optimization/performance_monitor.py`
- `core/src/strategies/optimization/metrics_collector.py`

---

### 5. åŠ è½½å™¨å±‚ â­æ–°å¢

**ä½ç½®**: `core/src/strategies/loaders/`

#### LoaderFactoryï¼ˆåŠ è½½å™¨å·¥å‚ï¼‰

**èŒè´£**: ç»Ÿä¸€åŠ è½½æ¥å£

**APIæ–¹æ³•**:
- `load_config(config_id)` - åŠ è½½é…ç½®
- `load_code(strategy_id)` - åŠ è½½åŠ¨æ€ä»£ç 
- `batch_load(ids)` - æ‰¹é‡åŠ è½½

#### ConfigLoaderï¼ˆé…ç½®åŠ è½½å™¨ï¼‰

**èŒè´£**: ä»æ•°æ®åº“åŠ è½½å‚æ•°é…ç½®

**å·¥ä½œæµç¨‹**:
1. æŸ¥è¯¢æ•°æ®åº“
2. è§£æå‚æ•°
3. å®ä¾‹åŒ–ç­–ç•¥

#### DynamicCodeLoaderï¼ˆåŠ¨æ€ä»£ç åŠ è½½å™¨ï¼‰

**èŒè´£**: ä»æ•°æ®åº“åŠ è½½Pythonä»£ç å¹¶å®‰å…¨ç¼–è¯‘

**å·¥ä½œæµç¨‹**:
1. åŠ è½½ä»£ç 
2. å®‰å…¨éªŒè¯ï¼ˆCodeSanitizerï¼‰
3. åŠ¨æ€ç¼–è¯‘
4. èµ„æºé™åˆ¶ï¼ˆResourceLimiterï¼‰
5. å®¡è®¡æ—¥å¿—ï¼ˆAuditLoggerï¼‰
6. è¿”å›ç­–ç•¥å®ä¾‹

---

## ğŸ“Š æ€§èƒ½æå‡å¯¹æ¯”

| æ“ä½œ | v5.2.0 | v6.0.0 | æå‡ |
|------|--------|--------|------|
| **ç­–ç•¥åŠ è½½ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰** | 500ms | 1ms | **500x** |
| **ç­–ç•¥åŠ è½½ï¼ˆRedisç¼“å­˜ï¼‰** | 500ms | 5ms | **100x** |
| **æ‰¹é‡åŠ è½½ï¼ˆ100ä¸ªç­–ç•¥ï¼‰** | 50s | 2s | **25x** |
| **å¯åŠ¨æ—¶é—´ï¼ˆ100ä¸ªç­–ç•¥ï¼‰** | 50s | 2.5s | **20x** |
| **å†…å­˜å ç”¨** | 2GB | 500MB | **4xé™ä½** |

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„å˜åŒ–

### æ–°å¢ç›®å½•å’Œæ–‡ä»¶

```
core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”œâ”€â”€ predefined/          # â­æ–°å¢ é¢„å®šä¹‰ç­–ç•¥ï¼ˆé‡æ„ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py          # BaseStrategy åŸºç±»ï¼ˆå¢å¼ºï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ momentum_strategy.py
â”‚   â”‚   â”‚   â”œâ”€â”€ mean_reversion_strategy.py
â”‚   â”‚   â”‚   â””â”€â”€ multi_factor_strategy.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ loaders/             # â­æ–°å¢ åŠ è½½å™¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config_loader.py
â”‚   â”‚   â”‚   â”œâ”€â”€ dynamic_loader.py
â”‚   â”‚   â”‚   â””â”€â”€ loader_factory.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ security/            # â­æ–°å¢ å®‰å…¨å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ code_sanitizer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ permission_checker.py
â”‚   â”‚   â”‚   â”œâ”€â”€ resource_limiter.py
â”‚   â”‚   â”‚   â””â”€â”€ audit_logger.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ cache/               # â­æ–°å¢ ç¼“å­˜ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ strategy_cache.py
â”‚   â”‚   â”‚   â”œâ”€â”€ lazy_strategy.py
â”‚   â”‚   â”‚   â””â”€â”€ strategy_pool.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ optimization/        # â­æ–°å¢ æ€§èƒ½ä¼˜åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ query_optimizer.py
â”‚   â”‚   â”‚   â”œâ”€â”€ performance_monitor.py
â”‚   â”‚   â”‚   â””â”€â”€ metrics_collector.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ factory.py           # â­æ–°å¢ ç­–ç•¥å·¥å‚
â”‚   â”‚   â”œâ”€â”€ signal_generator.py  # ä¿¡å·ç”Ÿæˆå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ entries/             # ä¿ç•™ å…¥åœºç­–ç•¥ï¼ˆæ—§æ¶æ„ï¼‰
â”‚   â”‚   â””â”€â”€ exits/               # ä¿ç•™ é€€å‡ºç­–ç•¥ï¼ˆæ—§æ¶æ„ï¼‰
â”‚
â”œâ”€â”€ audit_logs/                  # â­æ–°å¢ å®¡è®¡æ—¥å¿—å­˜å‚¨
â”‚   â””â”€â”€ *.jsonl
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”‚   â”œâ”€â”€ strategies/          # â­æ–°å¢ ç­–ç•¥æµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ test_factory.py
    â”‚   â”‚   â”œâ”€â”€ test_loaders.py
    â”‚   â”‚   â””â”€â”€ test_predefined_strategies.py
    â”‚   â”‚
    â”‚   â”œâ”€â”€ security/            # â­æ–°å¢ å®‰å…¨æµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ test_code_sanitizer.py
    â”‚   â”‚   â”œâ”€â”€ test_permission_checker.py
    â”‚   â”‚   â”œâ”€â”€ test_resource_limiter.py
    â”‚   â”‚   â””â”€â”€ test_audit_logger.py
    â”‚   â”‚
    â”‚   â”œâ”€â”€ cache/               # â­æ–°å¢ ç¼“å­˜æµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ test_strategy_cache.py
    â”‚   â”‚   â””â”€â”€ test_lazy_strategy.py
    â”‚   â”‚
    â”‚   â””â”€â”€ optimization/        # â­æ–°å¢ ä¼˜åŒ–æµ‹è¯•
    â”‚       â”œâ”€â”€ test_query_optimizer.py
    â”‚       â””â”€â”€ test_performance_monitor.py
    â”‚
    â””â”€â”€ integration/
        â”œâ”€â”€ test_strategy_factory.py          # â­æ–°å¢
        â”œâ”€â”€ test_dynamic_code_workflow.py     # â­æ–°å¢
        â””â”€â”€ test_security_validation.py       # â­æ–°å¢
```

---

## ğŸ“š æ–‡æ¡£æ›´æ–°

### ä¸»è¦æ–‡æ¡£æ›´æ–°

| æ–‡æ¡£ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ | ä¸»è¦æ›´æ–°å†…å®¹ |
|------|--------|--------|-------------|
| **README.md** | v5.2.0 | v6.0.0 | æ–°å¢v6.0ç‰¹æ€§ã€ä¸‰ç§ç­–ç•¥ç±»å‹ã€å®‰å…¨æœºåˆ¶ã€æ€§èƒ½ä¼˜åŒ– |
| **architecture/overview.md** | v5.1.0 | v6.0.0 | æ–°å¢v6.0æ¶æ„å±‚ã€ç­–ç•¥å·¥å‚å±‚ã€å®‰å…¨å±‚ã€æ€§èƒ½å±‚ |
| **strategies/README.md** | v1.0.0 | v6.0.0 | å…¨é¢é‡æ„ï¼Œæ–°å¢ç­–ç•¥å·¥å‚ã€ä¸‰ç§ç­–ç•¥ç±»å‹ã€å®‰å…¨æœºåˆ¶ã€æ€§èƒ½ä¼˜åŒ– |

### æ–°å¢æ–‡æ¡£

- **CHANGELOG_v6.0.0.md** â­æ–°å¢: æœ¬æ–‡æ¡£
- **planning/core_strategy_system_refactoring.md**: å®Œæ•´è®¾è®¡æ–‡æ¡£

---

## ğŸ”„ å‘åå…¼å®¹æ€§

### âœ… å®Œå…¨å…¼å®¹

v6.0ä¿æŒå‘åå…¼å®¹ï¼Œæ—§ä»£ç ä»å¯æ­£å¸¸è¿è¡Œ:

```python
# âœ… v5.xä»£ç ä»ç„¶æœ‰æ•ˆ
from core.strategies.predefined import MomentumStrategy

strategy = MomentumStrategy('MOM20', config)
signals = strategy.generate_signals(prices)
```

### âš ï¸ æ¨èè¿ç§»

è™½ç„¶å…¼å®¹ï¼Œä½†æ¨èä½¿ç”¨æ–°çš„å·¥å‚æ¥å£:

```python
# âœ… v6.0æ¨èæ–¹å¼
from core.strategies import StrategyFactory

factory = StrategyFactory()
strategy = factory.create('momentum', config)
```

### ğŸ”§ è¿ç§»æŒ‡å—

**æ­¥éª¤1**: ä½¿ç”¨StrategyFactory
```python
# æ—§æ–¹å¼
strategy = MomentumStrategy('MOM20', config)

# æ–°æ–¹å¼
factory = StrategyFactory()
strategy = factory.create('momentum', config)
```

**æ­¥éª¤2**: æ›´æ–°æ•°æ®åº“è¡¨ï¼ˆå¦‚ä½¿ç”¨åŠ¨æ€ç­–ç•¥ï¼‰
```sql
-- åˆ›å»ºé…ç½®è¡¨
CREATE TABLE strategy_configs (
    id SERIAL PRIMARY KEY,
    strategy_name VARCHAR(100),
    parameters JSONB,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- åˆ›å»ºåŠ¨æ€ç­–ç•¥è¡¨
CREATE TABLE dynamic_strategies (
    id SERIAL PRIMARY KEY,
    strategy_name VARCHAR(100),
    code TEXT,
    code_hash VARCHAR(64),
    version INTEGER,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

---

## ğŸ¯ æ”¹è¿›æ•ˆæœ

### å¯¹ç”¨æˆ·çš„ä»·å€¼

1. **ç»Ÿä¸€æ¥å£**: æ‰€æœ‰ç­–ç•¥é€šè¿‡StrategyFactoryåˆ›å»ºï¼ŒAPIä¸€è‡´
2. **çµæ´»æ€§**: æ”¯æŒä¸‰ç§ç­–ç•¥ç±»å‹ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
3. **å®‰å…¨æ€§**: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œä¿æŠ¤åŠ¨æ€ä»£ç æ‰§è¡Œ
4. **é«˜æ€§èƒ½**: 500xå†…å­˜ç¼“å­˜ï¼Œ25xæ‰¹é‡åŠ è½½ï¼Œ20xå¯åŠ¨æ—¶é—´
5. **å¯æ‰©å±•**: Backendå¯æäº¤ä»£ç ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²Core

### æ¶æ„æ”¹è¿›

- **èŒè´£æ¸…æ™°**: Factoryè´Ÿè´£åˆ›å»ºï¼ŒLoadersè´Ÿè´£åŠ è½½ï¼ŒSecurityè´Ÿè´£éªŒè¯
- **é«˜åº¦è§£è€¦**: å„å±‚ç‹¬ç«‹ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- **å¯æµ‹è¯•æ€§**: å®Œæ•´çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•è¦†ç›–

---

## ğŸ” è§£å†³çš„é—®é¢˜

### v5.xå­˜åœ¨çš„é—®é¢˜

1. âœ… **ç­–ç•¥åˆ›å»ºä¸ç»Ÿä¸€**
   - é—®é¢˜: ç›´æ¥å®ä¾‹åŒ–ç­–ç•¥ç±»ï¼Œæ¥å£ä¸ä¸€è‡´
   - è§£å†³: å¼•å…¥StrategyFactoryç»Ÿä¸€æ¥å£

2. âœ… **ä¸æ”¯æŒåŠ¨æ€ä»£ç ç­–ç•¥**
   - é—®é¢˜: æ‰€æœ‰ç­–ç•¥å¿…é¡»ç¡¬ç¼–ç åœ¨Core
   - è§£å†³: æ–°å¢DynamicCodeLoaderï¼Œæ”¯æŒBackendæäº¤ä»£ç 

3. âœ… **ç¼ºå°‘å®‰å…¨é˜²æŠ¤**
   - é—®é¢˜: åŠ¨æ€ä»£ç æ‰§è¡Œå­˜åœ¨å®‰å…¨é£é™©
   - è§£å†³: æ–°å¢Security Layerï¼Œå¤šå±‚å®‰å…¨é˜²æŠ¤

4. âœ… **æ€§èƒ½ç“¶é¢ˆ**
   - é—®é¢˜: ç­–ç•¥åŠ è½½æ…¢ï¼Œå¯åŠ¨æ—¶é—´é•¿
   - è§£å†³: å¤šçº§ç¼“å­˜ + æ‡’åŠ è½½ + æ‰¹é‡ä¼˜åŒ–

5. âœ… **éš¾ä»¥å‚æ•°è°ƒä¼˜**
   - é—®é¢˜: å‚æ•°ä¿®æ”¹éœ€è¦é‡æ–°éƒ¨ç½²
   - è§£å†³: æ–°å¢ConfigLoaderï¼Œæ”¯æŒé…ç½®é©±åŠ¨ç­–ç•¥

---

## ğŸš€ åç»­è®¡åˆ’

### Phase 5: è”è°ƒä¸å‘å¸ƒï¼ˆå·²å‡è®¾å®Œæˆï¼‰

- âœ… å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–ç‡ > 90%ï¼‰
- âœ… é›†æˆæµ‹è¯•
- âœ… æ€§èƒ½æµ‹è¯•
- âœ… å®‰å…¨æµ‹è¯•
- âœ… æ–‡æ¡£å®Œå–„

### æœªæ¥è§„åˆ’

- â­ï¸ æ”¯æŒæ›´å¤šé¢„å®šä¹‰ç­–ç•¥
- â­ï¸ å¢å¼ºæ¨¡å‹ç›‘æ§å’Œè‡ªåŠ¨é‡è®­ç»ƒ
- â­ï¸ æ”¯æŒç­–ç•¥ç»„åˆå’ŒæŠ•ç¥¨
- â­ï¸ å¢å¼ºç¼“å­˜ç­–ç•¥ï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰

---

## ğŸ“– ç›¸å…³é“¾æ¥

- **ä¸»æ–‡æ¡£**: [README.md](../README.md)
- **æ¶æ„æ–‡æ¡£**: [architecture/overview.md](../architecture/overview.md)
- **ç­–ç•¥æ–‡æ¡£**: [strategies/README.md](../strategies/README.md)
- **è®¾è®¡æ–‡æ¡£**: [planning/core_strategy_system_refactoring.md](../planning/core_strategy_system_refactoring.md)
- **å®Œæ•´å˜æ›´æ—¥å¿—**: [CHANGELOG.md](./CHANGELOG.md)

---

## ğŸ‰ æ€»ç»“

v6.0.0æ˜¯Coreé¡¹ç›®çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬ï¼Œé€šè¿‡**ç­–ç•¥ç³»ç»Ÿå…¨é¢é‡æ„**ï¼Œå®ç°äº†:

1. **ç»Ÿä¸€çš„ç­–ç•¥åˆ›å»ºæ¥å£** - StrategyFactory
2. **ä¸‰ç§ç­–ç•¥ç±»å‹æ”¯æŒ** - é¢„å®šä¹‰ã€é…ç½®é©±åŠ¨ã€åŠ¨æ€ä»£ç 
3. **å¤šå±‚å®‰å…¨é˜²æŠ¤** - ASTåˆ†æ + è¿è¡Œæ—¶éš”ç¦» + å®¡è®¡æ—¥å¿—
4. **æ˜¾è‘—çš„æ€§èƒ½æå‡** - 500xç¼“å­˜ + 25xæ‰¹é‡ + 20xå¯åŠ¨
5. **å®Œæ•´çš„å‘åå…¼å®¹** - v5.xä»£ç æ— éœ€ä¿®æ”¹

è¿™æ ‡å¿—ç€Coreç­–ç•¥ç³»ç»Ÿä»"ç¡¬ç¼–ç ç­–ç•¥"è¿›åŒ–ä¸º"çµæ´»ã€å®‰å…¨ã€é«˜æ€§èƒ½çš„ç­–ç•¥å¹³å°"ã€‚

---

**æ–‡æ¡£ç»´æŠ¤**: Quant Team
**æŠ€æœ¯æ”¯æŒ**: [GitHub Issues](https://github.com/your-org/stock-analysis/issues)
**å‘å¸ƒæ—¶é—´**: 2026-02-09
