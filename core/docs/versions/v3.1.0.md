# Version 3.1.0 Release Notes

**发布日期**: 2026-02-06
**版本类型**: 功能更新 (Minor Release)

---

## 概述

v3.1.0 是 Stock-Analysis Core 的重要功能更新版本，引入了**三层策略架构**和**MLSelector机器学习选股器**，将项目生产就绪度从 95% 提升至 100%。

---

## 核心成就

### 1. 三层策略架构 ⭐

**架构创新**
- ✅ 解耦传统策略为三个独立层级：选股层、入场层、退出层
- ✅ 10个策略组件：3选股器 + 3入场策略 + 4退出策略
- ✅ 36+ 种策略组合：灵活组合不同层级的策略
- ✅ 100% 向后兼容：保留现有5种经典策略

**策略组件列表**

| 层级 | 组件 | 数量 | 说明 |
|------|------|------|------|
| **选股层** | Momentum, Reversal, MLSelector | 3 | 从全市场筛选候选股票池 |
| **入场层** | Immediate, MABreakout, RSIOversold | 3 | 决定何时买入候选股票 |
| **退出层** | FixedPeriod, StopLoss, ATRStop, TrendExit | 4 | 管理持仓，决定何时卖出 |

**测试覆盖**
- 385个单元测试用例
- 26个集成测试场景
- 100% 测试通过率

**核心优势**
- 高度解耦：三层独立开发和测试
- 灵活组合：支持任意组合策略
- 易于扩展：新增策略只需实现对应接口

---

### 2. MLSelector 机器学习选股器 ⭐

**核心特性**
- ✅ **多因子加权模式**: 支持4种归一化方法（z_score、min_max、rank、none）
- ✅ **LightGBM排序模式**: 5档智能评分系统，NDCG@10优化
- ✅ **因子库集成**: 125+ Alpha因子 + 60+ 技术指标
- ✅ **通配符特征**: 支持 `alpha:*`、`tech:rsi` 等表达式

**性能指标**
- 快速模式: <15ms (20只股票, 3个因子)
- 完整模式: <700ms (20只股票, 125+因子)
- 训练速度: <5秒 (1000+样本)
- 推理速度: <100ms (100只股票)

**测试覆盖**
- 120+ 测试用例
- 100% 测试通过率
- 覆盖4种选股模式

---

### 3. 因子库完整集成

**125+ Alpha因子**

| 类别 | 因子数量 | 主要因子 |
|------|---------|---------|
| 动量因子 | 20+ | ROC, MOM, STOCH_MOMENTUM |
| 波动率因子 | 15+ | ATR_VOL, GARCH_VOL, PARKINSON_VOL |
| 成交量因子 | 18+ | OBV, CMF, VWAP_RATIO |
| 反转因子 | 12+ | MEAN_REVERSION, RSI_DIVERGENCE |
| 价格因子 | 15+ | PRICE_POSITION, HIGH_LOW_RATIO |
| 价值因子 | 10+ | PB_ZSCORE, PE_SECTOR_RELATIVE |
| 技术因子 | 20+ | MA_CROSS, BBAND_WIDTH |
| 质量因子 | 15+ | PRICE_STABILITY, VOLUME_CONSISTENCY |

**60+ 技术指标**

| 类别 | 指标数量 | 主要指标 |
|------|---------|---------|
| 趋势指标 | 12+ | MA, EMA, MACD, ADX |
| 动量指标 | 10+ | RSI, STOCH, CCI, WR |
| 波动率指标 | 8+ | ATR, BBANDS, KELTNER |
| 成交量指标 | 10+ | OBV, CMF, VWAP, MFI |
| 形态指标 | 8+ | SAR, SUPERTREND |
| 支撑阻力 | 6+ | PIVOT_POINTS, FIBONACCI |
| 其他指标 | 6+ | TRIX, AROON, ICHIMOKU |

---

### 4. 测试体系增强

**测试用例增长**
- v3.0.0: 3,200个用例
- v3.1.0: 3,700+个用例
- 增长: +500个用例 (+15.6%)

**测试覆盖明细**
- 三层架构: 385个单元测试 + 26个集成测试
- MLSelector: 120+个专项测试
- 因子库: 完整的因子计算验证

---

## 重要提交记录

最近关键提交 (2026-02-01 ~ 2026-02-06):

- `b164cd3` - refactor(tests): 整合ML快速测试到run_tests.py统一测试框架
- `c66ed55` - feat(core): 完成 ML-4 任务 - 因子库集成（125+ 因子）
- `31ee03d` - feat(core): 完成 ML-3 任务 - LightGBM 排序模型完整实现
- `cd5fa82` - feat(core): 完成 ML-2 任务 - 多因子加权模型增强版
- `a89ecb4` - feat(core): 完成 T8 任务 - 三层架构性能测试与优化
- `e0ba407` - feat(core): 完成 T7 任务 - 三层架构集成测试 (26个场景)
- `bf653b3` - feat(core): 实现 Core v3.0 三层架构回测引擎 (T5 完成)

查看完整历史: `git log --oneline --since="2026-02-01"`

---

## 升级指南

### 向后兼容性

✅ **100% 向后兼容** - 所有现有代码无需修改即可运行

### 三层架构使用

```python
# 新的三层架构使用方式
from core.src.strategies.three_layer import (
    MLSelector,           # 机器学习选股
    ImmediateEntry,       # 立即入场
    FixedStopLossExit,    # 固定止损退出
    StrategyComposer      # 策略组合器
)
from core.src.backtest import BacktestEngine

# 组合策略
composer = StrategyComposer(
    selector=MLSelector(params={
        'mode': 'lightgbm_ranker',
        'model_path': './models/stock_ranker.pkl',
        'top_n': 50
    }),
    entry=ImmediateEntry(),
    exit_strategy=FixedStopLossExit(params={'stop_loss_pct': -5.0}),
    rebalance_freq='W'  # 周度调仓
)

# 运行回测
engine = BacktestEngine()
result = engine.backtest_three_layer(
    selector=composer.selector,
    entry=composer.entry,
    exit_strategy=composer.exit,
    prices=prices,
    start_date='2023-01-01',
    end_date='2023-12-31'
)
```

### MLSelector使用

```python
# MLSelector 4种选股模式
from core.src.strategies.three_layer.selectors import MLSelector

# 模式1: 多因子加权
selector = MLSelector(params={
    'mode': 'weighted',
    'features': ['alpha:momentum_20d', 'alpha:volatility_atr', 'tech:rsi'],
    'weights': [0.5, 0.3, 0.2],
    'normalization': 'z_score',
    'top_n': 30
})

# 模式2: LightGBM排序
selector = MLSelector(params={
    'mode': 'lightgbm_ranker',
    'model_path': './models/stock_ranker.pkl',
    'features': 'alpha:*',  # 通配符：使用所有alpha因子
    'top_n': 50
})
```

---

## 性能改进

- 三层架构回测引擎: 优化后性能与传统策略持平
- MLSelector推理速度: <100ms (100只股票)
- 因子计算: 125+因子完整计算 <700ms

---

## 已知问题

无重大已知问题。

---

## 文档更新

新增文档:
- [三层架构指南](../user_guide/examples/THREE_LAYER_ARCHITECTURE_GUIDE.md)
- [MLSelector使用指南](../user_guide/examples/ML_SELECTOR_GUIDE.md)
- [架构总览更新](../architecture/overview.md) - 包含三层架构详解
- [技术栈更新](../architecture/tech_stack.md) - 包含LightGBM Ranking说明
- [设计模式更新](../architecture/design_patterns.md) - 包含组合模式应用

---

**版本**: v3.1.0
**发布日期**: 2026-02-06
**维护团队**: Quant Team
