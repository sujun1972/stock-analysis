# Core é¡¹ç›®æµ‹è¯•å¥—ä»¶

å®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–æ‰€æœ‰é‡æ„åçš„æ¨¡å—åŒ–ç»„ä»¶ã€‚

## ğŸ“‹ æµ‹è¯•è¦†ç›–

### ç»„ä»¶çº§æµ‹è¯•

| æµ‹è¯•æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | è¦†ç›–ç»„ä»¶ | æµ‹è¯•ç”¨ä¾‹æ•° |
|---------|---------|---------|-----------|
| DataLoader | `test_data_loader.py` | æ•°æ®åŠ è½½å™¨ | 9 |
| FeatureEngineer | `test_feature_engineer.py` | ç‰¹å¾å·¥ç¨‹å™¨ | 10 |
| DataCleaner | `test_data_cleaner.py` | æ•°æ®æ¸…æ´—å™¨ | 10 |
| DataSplitter | `test_data_splitter.py` | æ•°æ®åˆ†å‰²å™¨ | 11 |
| FeatureCache | `test_feature_cache.py` | ç¼“å­˜ç®¡ç†å™¨ | 10 |
| DatabaseManager (é‡æ„) | `test_database_manager_refactored.py` | é‡æ„åçš„æ•°æ®åº“ç®¡ç†å™¨ | 10 |

**æ€»è®¡**: 60+ å•å…ƒæµ‹è¯•ç”¨ä¾‹

### æ€§èƒ½æµ‹è¯•

| æµ‹è¯•æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | è¯´æ˜ |
|---------|---------|------|
| DataFrame iterrows æ€§èƒ½ | `test_performance_iterrows.py` | DataFrameå‘é‡åŒ–æ€§èƒ½éªŒè¯ |
| æ ·æœ¬å¹³è¡¡ç®—æ³•æ€§èƒ½ | `test_performance_sample_balancing.py` | æ ·æœ¬æ˜ å°„ç®—æ³•O(nÂ²)â†’O(n log n)ä¼˜åŒ–éªŒè¯ |

### é›†æˆæµ‹è¯•

| æµ‹è¯•æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | è¯´æ˜ |
|---------|---------|------|
| DataPipeline | `test_data_pipeline.py` | å®Œæ•´æµæ°´çº¿é›†æˆæµ‹è¯• |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
cd core/tests
python3 run_all_tests.py
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ¨¡å—

```bash
# è¿è¡Œ DataLoader æµ‹è¯•
python3 run_all_tests.py --module test_data_loader

# è¿è¡Œ FeatureEngineer æµ‹è¯•
python3 run_all_tests.py --module test_feature_engineer

# è¿è¡Œ DataCleaner æµ‹è¯•
python3 run_all_tests.py --module test_data_cleaner
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶

```bash
# ç›´æ¥è¿è¡Œæµ‹è¯•æ–‡ä»¶
python3 test_data_loader.py
python3 test_feature_engineer.py
python3 test_data_cleaner.py
python3 test_data_splitter.py
python3 test_feature_cache.py
```

### è°ƒæ•´è¯¦ç»†ç¨‹åº¦

```bash
# é™é»˜æ¨¡å¼
python3 run_all_tests.py --verbosity 0

# æ­£å¸¸æ¨¡å¼
python3 run_all_tests.py --verbosity 1

# è¯¦ç»†æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
python3 run_all_tests.py --verbosity 2
```

## ğŸ“Š æµ‹è¯•å†…å®¹

### test_data_loader.py

æµ‹è¯•æ•°æ®åŠ è½½å™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼š

- âœ… åˆå§‹åŒ–å’Œé…ç½®
- âœ… æˆåŠŸåŠ è½½æ•°æ®
- âœ… æ•°æ®ä¸ºç©ºå¤„ç†
- âœ… æ•°æ®ä¸º None å¤„ç†
- âœ… ç¼ºå°‘å¿…è¦åˆ—å¼‚å¸¸
- âœ… æ—¥æœŸç´¢å¼•è½¬æ¢
- âœ… æ•°æ®æ’åº
- âœ… æ•°æ®åº“å¼‚å¸¸å¤„ç†
- âœ… æ— æ—¥æœŸç´¢å¼•å¼‚å¸¸

### test_feature_engineer.py

æµ‹è¯•ç‰¹å¾å·¥ç¨‹å™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼š

- âœ… åˆå§‹åŒ–å’Œé…ç½®
- âœ… è®¡ç®—æ‰€æœ‰ç‰¹å¾
- âœ… æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ï¼ˆMA, EMA, RSI, MACD, KDJ, BOLL, ATR, OBV, CCIï¼‰
- âœ… Alphaå› å­è®¡ç®—ï¼ˆåŠ¨é‡ã€æ³¢åŠ¨ç‡ã€æˆäº¤é‡ç­‰ï¼‰
- âœ… ç‰¹å¾è½¬æ¢ï¼ˆå¤šæ—¶é—´å°ºåº¦æ”¶ç›Šç‡ã€OHLCã€æ—¶é—´ç‰¹å¾ï¼‰
- âœ… ç‰¹å¾å»ä»·æ ¼åŒ–
- âœ… ç›®æ ‡æ ‡ç­¾åˆ›å»º
- âœ… ç‰¹å¾æ•°é‡éªŒè¯
- âœ… NaN å¤„ç†
- âœ… ä¸åŒé¢„æµ‹å‘¨æœŸ

### test_data_cleaner.py

æµ‹è¯•æ•°æ®æ¸…æ´—å™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼š

- âœ… åˆå§‹åŒ–å’Œé…ç½®
- âœ… æ¸…æ´—æ­£å¸¸æ•°æ®
- âœ… å¤„ç†æ— ç©·å€¼
- âœ… ç§»é™¤ç‰¹å¾ NaN
- âœ… ç§»é™¤ç›®æ ‡ NaN
- âœ… æˆªæ–­æç«¯å€¼
- âœ… ç»Ÿè®¡ä¿¡æ¯è¿½è¸ª
- âœ… ç©ºæ•°æ®å¤„ç†
- âœ… å…¨NaNç‰¹å¾å¤„ç†
- âœ… æ•°æ®ä¿ç•™ç‡éªŒè¯

### test_data_splitter.py

æµ‹è¯•æ•°æ®åˆ†å‰²å™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼š

- âœ… åˆå§‹åŒ–å’Œé…ç½®
- âœ… æ—¶é—´åºåˆ—åˆ†å‰²
- âœ… é²æ£’ç¼©æ”¾ (Robust Scaling)
- âœ… æ ‡å‡†ç¼©æ”¾ (Standard Scaling)
- âœ… MinMax ç¼©æ”¾
- âœ… æ¬ é‡‡æ ·å¹³è¡¡ (Undersample)
- âœ… è¿‡é‡‡æ ·å¹³è¡¡ (Oversample)
- âœ… Scaler æŒä¹…åŒ–
- âœ… è®¾ç½®å¤–éƒ¨ Scaler
- âœ… å¹³è¡¡æ•°æ®è·³è¿‡é‡é‡‡æ ·
- âœ… æ€§èƒ½ä¼˜åŒ–éªŒè¯ï¼ˆO(n) ç®—æ³•ï¼‰

### test_feature_cache.py

æµ‹è¯•ç¼“å­˜ç®¡ç†å™¨çš„æ‰€æœ‰åŠŸèƒ½ï¼š

- âœ… åˆå§‹åŒ–å’Œé…ç½®
- âœ… ç”Ÿæˆç¼“å­˜è·¯å¾„
- âœ… ä¿å­˜å’ŒåŠ è½½
- âœ… ç¼“å­˜éªŒè¯
- âœ… ç‰ˆæœ¬ä¸åŒ¹é…å¤„ç†
- âœ… æ¸…é™¤ç¼“å­˜
- âœ… è®¡ç®—ç‰¹å¾é…ç½®å“ˆå¸Œ
- âœ… æŸåç¼“å­˜å¤„ç†
- âœ… ç¼ºå°‘å…ƒæ•°æ®å¤„ç†
- âœ… ç¼“å­˜å…ƒæ•°æ®å†…å®¹éªŒè¯

## ğŸ”§ æµ‹è¯•ç¯å¢ƒ

### ä¾èµ–é¡¹

æµ‹è¯•ä¾èµ–ä»¥ä¸‹PythonåŒ…ï¼ˆå·²åœ¨ requirements.txt ä¸­ï¼‰ï¼š

```
pandas
numpy
scikit-learn
imbalanced-learn
loguru
```

### Mock æµ‹è¯•

ç»„ä»¶çº§æµ‹è¯•ä½¿ç”¨ Mock å¯¹è±¡ï¼Œæ— éœ€çœŸå®æ•°æ®åº“è¿æ¥ã€‚è¿™ä½¿å¾—æµ‹è¯•ï¼š

- âœ… å¿«é€Ÿï¼ˆç§’çº§å®Œæˆï¼‰
- âœ… ç‹¬ç«‹ï¼ˆä¸ä¾èµ–å¤–éƒ¨èµ„æºï¼‰
- âœ… å¯é ï¼ˆä¸å—æ•°æ®å˜åŒ–å½±å“ï¼‰
- âœ… éš”ç¦»ï¼ˆåªæµ‹è¯•ç›®æ ‡ç»„ä»¶ï¼‰

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹

```
================================================================================
                            Core é¡¹ç›®æµ‹è¯•å¥—ä»¶
================================================================================

================================================================================
è¿è¡Œæ¨¡å—: test_data_loader
================================================================================
...........
----------------------------------------------------------------------
Ran 9 tests in 0.123s

OK

================================================================================
è¿è¡Œæ¨¡å—: test_feature_engineer
================================================================================
..........
----------------------------------------------------------------------
Ran 10 tests in 1.234s

OK

================================================================================
                              æµ‹è¯•æ€»ç»“æŠ¥å‘Š
================================================================================

æ¨¡å—çº§åˆ«æµ‹è¯•ç»“æœ:
æ¨¡å—åç§°                           æµ‹è¯•æ•°     æˆåŠŸ     å¤±è´¥     é”™è¯¯     è·³è¿‡
--------------------------------------------------------------------------------
âœ“ test_data_loader                    9        9        0        0        0
âœ“ test_feature_engineer              10       10        0        0        0
âœ“ test_data_cleaner                  10       10        0        0        0
âœ“ test_data_splitter                 11       11        0        0        0
âœ“ test_feature_cache                 10       10        0        0        0
--------------------------------------------------------------------------------
æ€»è®¡                                  50       50        0        0        0

================================================================================
æµ‹è¯•æ€»æ•°: 50
æˆåŠŸ: 50 (100.0%)
å¤±è´¥: 0
é”™è¯¯: 0
è·³è¿‡: 0
æ€»è€—æ—¶: 2.34ç§’
================================================================================

âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡!
```

## ğŸ¯ æµ‹è¯•åŸåˆ™

### 1. ç‹¬ç«‹æ€§
æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„ç»“æœã€‚

### 2. å¯é‡å¤æ€§
æµ‹è¯•ä½¿ç”¨å›ºå®šçš„éšæœºç§å­ï¼ˆ`np.random.seed(42)`ï¼‰ï¼Œç¡®ä¿ç»“æœå¯é‡å¤ã€‚

### 3. å®Œæ•´æ€§
è¦†ç›–æ­£å¸¸æƒ…å†µã€è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸æƒ…å†µã€‚

### 4. æ¸…æ™°æ€§
æ¯ä¸ªæµ‹è¯•éƒ½æœ‰æ¸…æ™°çš„åç§°å’Œæ–‡æ¡£è¯´æ˜å…¶ç›®çš„ã€‚

### 5. å¿«é€Ÿæ€§
ä½¿ç”¨ Mock å¯¹è±¡é¿å…æ…¢é€Ÿæ“ä½œï¼ˆå¦‚æ•°æ®åº“ã€ç½‘ç»œè¯·æ±‚ï¼‰ã€‚

## ğŸ” è°ƒè¯•æµ‹è¯•

### æŸ¥çœ‹è¯¦ç»†è¾“å‡º

```bash
python3 run_all_tests.py --verbosity 2
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–¹æ³•

```bash
cd core/tests
python3 -m unittest test_data_loader.TestDataLoader.test_01_init
```

### ä½¿ç”¨ pytestï¼ˆå¯é€‰ï¼‰

```bash
pip install pytest pytest-cov

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# æŸ¥çœ‹è¦†ç›–ç‡
pytest --cov=src --cov-report=html

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest test_data_loader.py::TestDataLoader::test_01_init
```

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•

### 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶

```python
#!/usr/bin/env python3
"""
MyComponent å•å…ƒæµ‹è¯•
"""

import sys
import unittest
from pathlib import Path

project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root / 'src'))

from my_module import MyComponent


class TestMyComponent(unittest.TestCase):
    """æµ‹è¯• MyComponent ç±»"""

    def setUp(self):
        """æ¯ä¸ªæµ‹è¯•å‰çš„å‡†å¤‡"""
        self.component = MyComponent()

    def test_01_basic_function(self):
        """æµ‹è¯•1: åŸºç¡€åŠŸèƒ½"""
        result = self.component.do_something()
        self.assertEqual(result, expected_value)


if __name__ == '__main__':
    unittest.main()
```

### 2. æ·»åŠ åˆ°æµ‹è¯•è¿è¡Œå™¨

ç¼–è¾‘ `run_all_tests.py`ï¼Œåœ¨ `test_modules` åˆ—è¡¨ä¸­æ·»åŠ æ–°æ¨¡å—ï¼š

```python
test_modules = [
    'test_data_loader',
    'test_feature_engineer',
    # ... å…¶ä»–æµ‹è¯• ...
    'test_my_component',  # æ–°å¢
]
```

## ğŸ› å·²çŸ¥é—®é¢˜

### æ•°æ®åº“è¿æ¥æµ‹è¯•

`test_data_pipeline.py` ä¸­çš„é›†æˆæµ‹è¯•éœ€è¦çœŸå®çš„æ•°æ®åº“è¿æ¥ã€‚å¦‚æœæ•°æ®åº“ä¸å¯ç”¨ï¼Œè¿™äº›æµ‹è¯•ä¼šè¢«è·³è¿‡ï¼ˆskipï¼‰ã€‚

è§£å†³æ–¹æ³•ï¼š
- ä½¿ç”¨ Mock æ•°æ®åº“ï¼ˆæ¨èï¼‰
- é…ç½®æµ‹è¯•æ•°æ®åº“
- è·³è¿‡é›†æˆæµ‹è¯•ï¼Œä»…è¿è¡Œå•å…ƒæµ‹è¯•

## ğŸ“š å‚è€ƒèµ„æº

- [Python unittest æ–‡æ¡£](https://docs.python.org/3/library/unittest.html)
- [Mock å¯¹è±¡ä½¿ç”¨æŒ‡å—](https://docs.python.org/3/library/unittest.mock.html)
- [pytest æ–‡æ¡£](https://docs.pytest.org/)

## ğŸ¤ è´¡çŒ®

æ·»åŠ æ–°æµ‹è¯•æ—¶ï¼Œè¯·ç¡®ä¿ï¼š

1. âœ… æµ‹è¯•å‘½åæ¸…æ™°ï¼ˆ`test_XX_description`ï¼‰
2. âœ… åŒ…å«æ–‡æ¡£å­—ç¬¦ä¸²è¯´æ˜æµ‹è¯•ç›®çš„
3. âœ… ä½¿ç”¨ Mock å¯¹è±¡é¿å…å¤–éƒ¨ä¾èµ–
4. âœ… éªŒè¯æ­£å¸¸æƒ…å†µå’Œå¼‚å¸¸æƒ…å†µ
5. âœ… æµ‹è¯•è¿è¡Œæ—¶é—´ < 1ç§’ï¼ˆå•ä¸ªæµ‹è¯•ï¼‰
6. âœ… æ›´æ–°æ­¤ README æ–‡æ¡£
