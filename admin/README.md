# ç®¡ç†åå° (Admin)

è‚¡ç¥¨åˆ†æç³»ç»Ÿçš„ç‹¬ç«‹ç®¡ç†å‰ç«¯ï¼Œè´Ÿè´£ç³»ç»Ÿè®¾ç½®ã€æ•°æ®åŒæ­¥å’Œç³»ç»Ÿç›‘æ§ç­‰ç®¡ç†åŠŸèƒ½ã€‚

## ğŸ¯ åŠŸèƒ½æ¨¡å—

### 1. æ§åˆ¶å° (/)
- ç³»ç»ŸçŠ¶æ€ç›‘æ§
- è‚¡ç¥¨æ•°æ®ç»Ÿè®¡
- å¿«æ·æ“ä½œå…¥å£
- ç³»ç»Ÿä¿¡æ¯å±•ç¤º

### 2. ç³»ç»Ÿè®¾ç½® (/settings)
- æ•°æ®æºé…ç½® (AkShare / Tushare)
- Tushare API Token ç®¡ç†
- åˆ†æ—¶æ•°æ®æºè®¾ç½®
- å®æ—¶æ•°æ®æºè®¾ç½®

### 3. ç”¨æˆ·ç®¡ç† (/users)
- ç”¨æˆ·åˆ—è¡¨å’Œè¯¦æƒ…
- ç”¨æˆ·åˆ›å»ºå’Œç¼–è¾‘
- æƒé™å’Œè§’è‰²ç®¡ç†
- é…é¢ç®¡ç†
- ç™»å½•å†å²å’Œæ´»åŠ¨æ—¥å¿—

### 4. æ•°æ®åŒæ­¥ (/sync)
- æ•°æ®åˆå§‹åŒ– (/sync/initialize)
- æ–°è‚¡åˆ—è¡¨åŒæ­¥ (/sync/new-stocks)
- é€€å¸‚åˆ—è¡¨åŒæ­¥ (/sync/delisted-stocks)
- å®æ—¶è¡Œæƒ…åŒæ­¥ (/sync/realtime)

### 5. ç³»ç»Ÿæ—¥å¿— (/logs)
- ç”¨æˆ·æ´»åŠ¨æ—¥å¿—æŸ¥çœ‹
- ç™»å½•å†å²è¿½è¸ª
- æ“ä½œç±»å‹ç­›é€‰
- ç”¨æˆ·æœç´¢å’Œè¿‡æ»¤

### 6. æ€§èƒ½ç›‘æ§ (/monitor)
- ç³»ç»Ÿå¥åº·çŠ¶æ€æ£€æŸ¥
- æ•°æ®åº“å’ŒRedisè¿æ¥ç›‘æ§
- APIæ€§èƒ½æŒ‡æ ‡
- è‡ªåŠ¨/æ‰‹åŠ¨åˆ·æ–°æ¨¡å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¼€å‘æ¨¡å¼

```bash
# è¿›å…¥adminç›®å½•
cd admin

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (ç«¯å£: 3002)
npm run dev
```

è®¿é—®: http://localhost:3002

### ç”Ÿäº§éƒ¨ç½²

```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d admin

# æˆ–å•ç‹¬æ„å»ºadminé•œåƒ
cd admin
docker build -t stock-admin .
docker run -p 3002:3002 -e NEXT_PUBLIC_API_URL=http://backend:8000 stock-admin
```

è®¿é—®: http://localhost:3002

## ğŸ“ ç›®å½•ç»“æ„

```
admin/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ page.tsx           # æ§åˆ¶å°é¦–é¡µ
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ globals.css        # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ login/             # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ users/             # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ settings/          # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ scheduler/     # å®šæ—¶ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ sync/              # æ•°æ®åŒæ­¥
â”‚   â”‚   â”œâ”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ initialize/
â”‚   â”‚   â”œâ”€â”€ new-stocks/
â”‚   â”‚   â”œâ”€â”€ delisted-stocks/
â”‚   â”‚   â””â”€â”€ realtime/
â”‚   â”œâ”€â”€ logs/              # ç³»ç»Ÿæ—¥å¿—
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â””â”€â”€ monitor/           # æ€§èƒ½ç›‘æ§
â”‚       â””â”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                # UIç»„ä»¶åº“ (shadcn/ui)
â”‚   â”œâ”€â”€ auth/              # è®¤è¯ç»„ä»¶
â”‚   â”‚   â””â”€â”€ ProtectedRoute.tsx
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â”œâ”€â”€ AdminLayout.tsx  # ç®¡ç†åå°å¸ƒå±€
â”‚   â”‚   â””â”€â”€ Header.tsx
â”‚   â””â”€â”€ sync/              # åŒæ­¥ç›¸å…³ç»„ä»¶
â”œâ”€â”€ stores/                # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ auth-store.ts      # è®¤è¯çŠ¶æ€
â”‚   â””â”€â”€ config-store.ts    # é…ç½®ç¼“å­˜
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api-client.ts      # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils.ts           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ react-query-config.ts
â”œâ”€â”€ types/                 # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ public/                # é™æ€èµ„æº
â”œâ”€â”€ Dockerfile             # Dockeré…ç½®
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tailwind.config.ts
â””â”€â”€ next.config.mjs
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 14 (App Router)
- **è¯­è¨€**: TypeScript
- **æ ·å¼**: Tailwind CSS
- **UIç»„ä»¶**: Radix UI + shadcn/ui
- **çŠ¶æ€ç®¡ç†**: Zustand (auth-store, config-store)
- **æ•°æ®æŸ¥è¯¢**: @tanstack/react-query
- **HTTPå®¢æˆ·ç«¯**: Axios (å¸¦Tokenè‡ªåŠ¨æ³¨å…¥å’Œåˆ·æ–°)
- **å›¾æ ‡**: Lucide React

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### çŠ¶æ€ç®¡ç†

é‡‡ç”¨ Zustand è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

1. **auth-store** - è®¤è¯çŠ¶æ€ç®¡ç†
   - ç”¨æˆ·ä¿¡æ¯å’ŒTokenç®¡ç†
   - ç™»å½•/ç™»å‡º/Tokenåˆ·æ–°
   - localStorageæŒä¹…åŒ–
   - ä¼˜åŒ–ï¼šåªåœ¨é¦–æ¬¡åŠ è½½æ—¶ä»localStorageæ¢å¤ï¼Œä¸é‡å¤è°ƒç”¨API

2. **config-store** - é…ç½®ç¼“å­˜ç®¡ç†
   - æ•°æ®æºé…ç½®ç¼“å­˜ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
   - é¿å…é‡å¤APIè¯·æ±‚
   - æ”¯æŒå¼ºåˆ¶åˆ·æ–°

### è¯·æ±‚æ‹¦æˆª

- **è¯·æ±‚æ‹¦æˆªå™¨**: è‡ªåŠ¨æ³¨å…¥JWT Token
- **å“åº”æ‹¦æˆªå™¨**:
  - 401é”™è¯¯è‡ªåŠ¨åˆ·æ–°Tokenå¹¶é‡è¯•
  - Tokenåˆ·æ–°å¤±è´¥è‡ªåŠ¨ç™»å‡º
  - é¿å…åˆ·æ–°æ­»å¾ªç¯

### è·¯ç”±ä¿æŠ¤

ä½¿ç”¨ `ProtectedRoute` ç»„ä»¶ä¿æŠ¤æ‰€æœ‰ç®¡ç†é¡µé¢ï¼š
- æœªç™»å½•è‡ªåŠ¨è·³è½¬ç™»å½•é¡µ
- æƒé™æ£€æŸ¥ï¼ˆç®¡ç†å‘˜/è¶…çº§ç®¡ç†å‘˜ï¼‰
- ä¼˜åŒ–ï¼šåªåœ¨é¦–æ¬¡æŒ‚è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€

## ğŸŒ ç¯å¢ƒå˜é‡

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```env
# APIæœåŠ¡åœ°å€
NEXT_PUBLIC_API_URL=http://localhost:8000

# ç¯å¢ƒæ ‡è¯†
NODE_ENV=development
```

## ğŸ“Š ä¸ä¸»å‰ç«¯çš„åŒºåˆ«

| ç‰¹æ€§ | Frontend (ç”¨æˆ·å‰ç«¯) | Admin (ç®¡ç†åå°) |
|------|---------------------|------------------|
| **ç«¯å£** | 3000 | 3002 |
| **èŒè´£** | è‚¡ç¥¨åˆ†æã€ç­–ç•¥å›æµ‹ã€æ•°æ®å¯è§†åŒ– | ç³»ç»Ÿç®¡ç†ã€æ•°æ®åŒæ­¥ã€ç›‘æ§ |
| **ç›®æ ‡ç”¨æˆ·** | æ™®é€šç”¨æˆ·ã€åˆ†æå¸ˆ | ç³»ç»Ÿç®¡ç†å‘˜ |
| **ä¸»è¦åŠŸèƒ½** | ç­–ç•¥ä¸­å¿ƒã€å›æµ‹ç³»ç»Ÿã€AIå®éªŒèˆ± | ç³»ç»Ÿè®¾ç½®ã€æ•°æ®åŒæ­¥ã€æ—¥å¿—ç›‘æ§ |
| **å¸ƒå±€** | é¡¶éƒ¨å¯¼èˆª + å†…å®¹åŒº | ä¾§è¾¹æ å¯¼èˆª + æ§åˆ¶å°é£æ ¼ |

## ğŸ” å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

1. **è®¤è¯ç³»ç»Ÿ**
   - JWT Tokenè®¤è¯
   - è‡ªåŠ¨Tokenåˆ·æ–°
   - æƒé™æ§åˆ¶ (ç®¡ç†å‘˜/è¶…çº§ç®¡ç†å‘˜)
   - ç™»å½•çŠ¶æ€æŒä¹…åŒ–

2. **é…ç½®ç®¡ç†**
   - æ•°æ®æºé…ç½®ç¼“å­˜ (5åˆ†é’Ÿæœ‰æ•ˆæœŸ)
   - é¿å…é‡å¤APIè¯·æ±‚
   - è‡ªåŠ¨çŠ¶æ€åŒæ­¥

3. **ç”¨æˆ·ç®¡ç†**
   - ç”¨æˆ·CRUDæ“ä½œ
   - è§’è‰²å’Œæƒé™ç®¡ç†
   - é…é¢ç®¡ç†
   - ç™»å½•å†å²æŸ¥çœ‹

4. **ç³»ç»Ÿç›‘æ§**
   - å®æ—¶å¥åº·çŠ¶æ€æ£€æŸ¥
   - æ•°æ®åº“å’ŒRedisç›‘æ§
   - è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
   - æ€§èƒ½æŒ‡æ ‡å±•ç¤º

## ğŸš§ æœªæ¥æ‰©å±•

1. **é«˜çº§ç›‘æ§**
   - ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
   - å®æ—¶å‘Šè­¦é…ç½®
   - å†å²è¶‹åŠ¿å›¾è¡¨
   - PrometheusæŒ‡æ ‡é›†æˆ

2. **æ•°æ®åº“ç®¡ç†**
   - è¡¨ç»“æ„æŸ¥çœ‹
   - SQLæŸ¥è¯¢æ‰§è¡Œå™¨
   - æ•°æ®å¤‡ä»½/æ¢å¤

3. **å®šæ—¶ä»»åŠ¡å¢å¼º**
   - å¯è§†åŒ–Cronè¡¨è¾¾å¼ç¼–è¾‘å™¨
   - ä»»åŠ¡æ‰§è¡Œè¯¦ç»†æ—¥å¿—
   - å¤±è´¥é‡è¯•é…ç½®

## ğŸ“ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é¡µé¢

1. åœ¨ `app/` ä¸‹åˆ›å»ºæ–°ç›®å½•å’Œ `page.tsx`
2. ä½¿ç”¨ `AdminLayout` åŒ…è£…é¡µé¢å†…å®¹
3. æ›´æ–° `components/layouts/AdminLayout.tsx` ä¸­çš„å¯¼èˆªèœå•

```tsx
// app/new-page/page.tsx
'use client'

import AdminLayout from '@/components/layouts/AdminLayout'

export default function NewPage() {
  return (
    <AdminLayout>
      <div>
        <h1>æ–°é¡µé¢</h1>
      </div>
    </AdminLayout>
  )
}
```

### APIè°ƒç”¨

ä½¿ç”¨ `lib/api-client.ts` ä¸­çš„å®¢æˆ·ç«¯ï¼š

```tsx
import { apiClient } from '@/lib/api-client'

// è·å–æ•°æ®æºé…ç½®
const config = await apiClient.getDataSourceConfig()

// æ›´æ–°é…ç½®
await apiClient.updateDataSourceConfig({
  data_source: 'akshare',
  tushare_token: 'your_token'
})
```

## ğŸ› é—®é¢˜æ’æŸ¥

### å¯åŠ¨å¤±è´¥

```bash
# æ¸…é™¤ç¼“å­˜é‡æ–°å®‰è£…
rm -rf node_modules .next
npm install
npm run dev
```

### ç«¯å£å†²çª

ä¿®æ”¹ `package.json`:

```json
{
  "scripts": {
    "dev": "next dev -p 3003"  // æ”¹ä¸ºå…¶ä»–ç«¯å£
  }
}
```

### APIè¿æ¥å¤±è´¥

æ£€æŸ¥ç¯å¢ƒå˜é‡ `NEXT_PUBLIC_API_URL` æ˜¯å¦æ­£ç¡®æŒ‡å‘åç«¯æœåŠ¡ã€‚

## ğŸ“„ è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ç›¸åŒ

## ğŸ™‹ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åœ¨ä¸»é¡¹ç›®ä»“åº“æäº¤Issueã€‚
