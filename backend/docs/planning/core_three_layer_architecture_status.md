# Core ä¸‰å±‚æ¶æ„å®ç°ç°çŠ¶

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æ—¥æœŸ**: 2026-02-06
> **Coreç‰ˆæœ¬**: v3.1.0
> **çŠ¶æ€**: âœ… å®Œæ•´å®ç°

---

## ğŸ“‹ ç›®å½•

- [å®ç°æ¦‚è¦](#å®ç°æ¦‚è¦)
- [ç»„ä»¶æ¸…å•](#ç»„ä»¶æ¸…å•)
- [æŠ€æœ¯å®ç°](#æŠ€æœ¯å®ç°)
- [æµ‹è¯•è¦†ç›–](#æµ‹è¯•è¦†ç›–)
- [Backend é›†æˆå»ºè®®](#backend-é›†æˆå»ºè®®)

---

## å®ç°æ¦‚è¦

### æ€»ä½“çŠ¶æ€

Core é¡¹ç›®å·²äº **2026-02-06 å®Œæˆä¸‰å±‚æ¶æ„çš„å®Œæ•´å®ç°**ï¼ˆv3.1.0ï¼‰ï¼ŒåŒ…æ‹¬ï¼š

| ç±»åˆ« | æ•°é‡ | çŠ¶æ€ |
|------|------|------|
| **é€‰è‚¡å™¨** | 4ä¸ª | âœ… å®Œæˆ |
| **å…¥åœºç­–ç•¥** | 3ä¸ª | âœ… å®Œæˆ |
| **é€€å‡ºç­–ç•¥** | 4ä¸ª | âœ… å®Œæˆ |
| **ç»„åˆå™¨** | 1ä¸ª (StrategyComposer) | âœ… å®Œæˆ |
| **å›æµ‹æ”¯æŒ** | BacktestEngine.backtest_three_layer() | âœ… å®Œæˆ |
| **æµ‹è¯•ç”¨ä¾‹** | 385ä¸ª | âœ… 100%é€šè¿‡ |
| **æ–‡æ¡£** | ç”¨æˆ·æŒ‡å—+APIæ–‡æ¡£ | âœ… å®Œæˆ |

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core v3.1.0 ä¸‰å±‚æ¶æ„                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: é€‰è‚¡å™¨å±‚ (4ä¸ª) âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  - MomentumSelector    (åŠ¨é‡é€‰è‚¡)                        â”‚
â”‚  - ReversalSelector    (åè½¬é€‰è‚¡)                        â”‚
â”‚  - MLSelector          (MLé€‰è‚¡ â­ LightGBM Ranker)      â”‚
â”‚  - ExternalSelector    (å¤–éƒ¨é€‰è‚¡/StarRanker/æ‰‹åŠ¨)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
Layer 2: å…¥åœºç­–ç•¥å±‚ (3ä¸ª) âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  - ImmediateEntry      (ç«‹å³å…¥åœºï¼Œç­‰æƒé‡)                â”‚
â”‚  - MABreakoutEntry     (å‡çº¿çªç ´ï¼Œshort/long)            â”‚
â”‚  - RSIOversoldEntry    (RSIè¶…å–ï¼Œthreshold=30)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
Layer 3: é€€å‡ºç­–ç•¥å±‚ (4ä¸ª) âœ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  - FixedPeriodExit     (å›ºå®šå‘¨æœŸï¼Œholding_period)        â”‚
â”‚  - FixedStopLossExit   (å›ºå®šæ­¢æŸï¼Œstop_loss%)           â”‚
â”‚  - ATRStopLossExit     (ATRåŠ¨æ€æ­¢æŸï¼Œatr_multiplier)    â”‚
â”‚  - TrendBasedExit      (è¶‹åŠ¿é€€å‡ºï¼Œma_period)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“
             StrategyComposer âœ…
              (ç­–ç•¥ç»„åˆå™¨)
                  â†“
         BacktestEngine.backtest_three_layer() âœ…
              (å›æµ‹å¼•æ“)
```

---

## ç»„ä»¶æ¸…å•

### Layer 1: é€‰è‚¡å™¨ (StockSelector)

#### 1. MomentumSelectorï¼ˆåŠ¨é‡é€‰è‚¡å™¨ï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/selectors/momentum_selector.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'lookback_period': 20,    # åŠ¨é‡è®¡ç®—å‘¨æœŸ
    'top_n': 50,              # é€‰è‚¡æ•°é‡
    'ascending': False        # æ’åºæ–¹å‘ï¼ˆFalse=åŠ¨é‡æœ€å¤§ï¼‰
}
```

**é€»è¾‘**: é€‰æ‹©è¿‡å» N æ—¥æ¶¨å¹…æœ€å¤§çš„è‚¡ç¥¨

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 2. ReversalSelectorï¼ˆåè½¬é€‰è‚¡å™¨ï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/selectors/reversal_selector.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'lookback_period': 20,    # åè½¬è®¡ç®—å‘¨æœŸ
    'top_n': 50,              # é€‰è‚¡æ•°é‡
    'ascending': True         # æ’åºæ–¹å‘ï¼ˆTrue=è·Œå¹…æœ€å¤§ï¼‰
}
```

**é€»è¾‘**: é€‰æ‹©è¿‡å» N æ—¥è·Œå¹…æœ€å¤§çš„è‚¡ç¥¨ï¼ˆå‡å€¼å›å½’ï¼‰

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 3. MLSelectorï¼ˆæœºå™¨å­¦ä¹ é€‰è‚¡å™¨ï¼‰â­

**æ–‡ä»¶**: `core/src/strategies/three_layer/selectors/ml_selector.py`

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… æ”¯æŒä¸¤ç§æ¨¡å¼ï¼š**multi_factor_weighted** å’Œ **lightgbm_ranker**â­
- âœ… å¤šå› å­åŠ æƒï¼šæ”¯æŒ 4 ç§å½’ä¸€åŒ–æ–¹æ³•ï¼ˆz_scoreã€min_maxã€rankã€noneï¼‰
- âœ… LightGBM Rankerï¼š5 æ¡£æ™ºèƒ½è¯„åˆ†ï¼ŒNDCG@10 ä¼˜åŒ–
- âœ… å› å­åº“é›†æˆï¼š125+ Alpha å› å­ + 60+ æŠ€æœ¯æŒ‡æ ‡
- âœ… é€šé…ç¬¦ç‰¹å¾ï¼šæ”¯æŒ `alpha:*`ã€`tech:rsi` ç­‰è¡¨è¾¾å¼

**æ ¸å¿ƒå‚æ•°ï¼ˆå¤šå› å­åŠ æƒæ¨¡å¼ï¼‰**:
```python
{
    'mode': 'multi_factor_weighted',
    'features': ['alpha:momentum_1d', 'tech:rsi'],
    'weights': [0.6, 0.4],
    'normalization': 'z_score',  # z_score/min_max/rank/none
    'top_n': 50
}
```

**æ ¸å¿ƒå‚æ•°ï¼ˆLightGBM Ranker æ¨¡å¼ï¼‰**â­:
```python
{
    'mode': 'lightgbm_ranker',
    'model_path': './models/stock_ranker.pkl',
    'features': ['alpha:*', 'tech:rsi', 'tech:macd'],
    'top_n': 50
}
```

**æ€§èƒ½æŒ‡æ ‡**:
- å¿«é€Ÿæ¨¡å¼ï¼ˆ3å› å­ï¼‰: <15ms
- å®Œæ•´æ¨¡å¼ï¼ˆ125+å› å­ï¼‰: <700ms
- è®­ç»ƒé€Ÿåº¦: <5ç§’ï¼ˆ1000+æ ·æœ¬ï¼‰
- æ¨ç†é€Ÿåº¦: <100msï¼ˆ100åªè‚¡ç¥¨ï¼‰

**æµ‹è¯•**: âœ… 120+ ä¸“é¡¹æµ‹è¯•ç”¨ä¾‹

---

#### 4. ExternalSelectorï¼ˆå¤–éƒ¨é€‰è‚¡å™¨ï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/selectors/external_selector.py`

**æ ¸å¿ƒç‰¹æ€§**:
- âœ… æ”¯æŒ StarRanker API é›†æˆï¼ˆæ¡†æ¶å·²å®ç°ï¼‰
- âœ… æ”¯æŒè‡ªå®šä¹‰ APIï¼ˆRESTæ¥å£ï¼‰
- âœ… æ”¯æŒæ‰‹åŠ¨è¾“å…¥è‚¡ç¥¨æ± 

**æ ¸å¿ƒå‚æ•°ï¼ˆæ‰‹åŠ¨æ¨¡å¼ï¼‰**:
```python
{
    'source': 'manual',
    'stock_list': ['600000.SH', '000001.SZ', ...]
}
```

**æ ¸å¿ƒå‚æ•°ï¼ˆAPIæ¨¡å¼ï¼‰**:
```python
{
    'source': 'custom_api',
    'api_url': 'http://starranker.example.com/api/stocks',
    'timeout': 10
}
```

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

### Layer 2: å…¥åœºç­–ç•¥ (EntryStrategy)

#### 1. ImmediateEntryï¼ˆç«‹å³å…¥åœºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/entries/immediate_entry.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'equal_weight': True  # æ˜¯å¦ç­‰æƒé‡åˆ†é…ï¼ˆé»˜è®¤Trueï¼‰
}
```

**é€»è¾‘**: å¯¹é€‰è‚¡å™¨é€‰å‡ºçš„æ‰€æœ‰è‚¡ç¥¨ç«‹å³å…¥åœºï¼Œç­‰æƒé‡åˆ†é…ä»“ä½

**é€‚ç”¨åœºæ™¯**: æµ‹è¯•ã€è¢«åŠ¨ç­–ç•¥

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 2. MABreakoutEntryï¼ˆå‡çº¿çªç ´å…¥åœºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/entries/ma_breakout_entry.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'short_window': 5,    # çŸ­æœŸå‡çº¿çª—å£
    'long_window': 20     # é•¿æœŸå‡çº¿çª—å£
}
```

**é€»è¾‘**: å½“çŸ­æœŸå‡çº¿ä¸Šç©¿é•¿æœŸå‡çº¿æ—¶å…¥åœºï¼ˆé‡‘å‰ï¼‰

**é€‚ç”¨åœºæ™¯**: è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 3. RSIOversoldEntryï¼ˆRSIè¶…å–å…¥åœºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/entries/rsi_oversold_entry.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'rsi_period': 14,        # RSIè®¡ç®—å‘¨æœŸ
    'rsi_threshold': 30      # RSIè¶…å–é˜ˆå€¼
}
```

**é€»è¾‘**: å½“ RSI < é˜ˆå€¼æ—¶å…¥åœºï¼ˆè¶…å–åå¼¹ï¼‰

**é€‚ç”¨åœºæ™¯**: åè½¬ç­–ç•¥ã€è¶…å–æŠ„åº•

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

### Layer 3: é€€å‡ºç­–ç•¥ (ExitStrategy)

#### 1. FixedPeriodExitï¼ˆå›ºå®šå‘¨æœŸé€€å‡ºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/exits/fixed_period_exit.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'holding_period': 5  # æŒä»“å¤©æ•°ï¼ˆé»˜è®¤5å¤©ï¼‰
}
```

**é€»è¾‘**: æŒä»“è¾¾åˆ°æŒ‡å®šå¤©æ•°åè‡ªåŠ¨é€€å‡º

**é€‚ç”¨åœºæ™¯**: çŸ­æœŸè½®åŠ¨ã€æµ‹è¯•

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 2. FixedStopLossExitï¼ˆå›ºå®šæ­¢æŸé€€å‡ºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/exits/fixed_stop_loss_exit.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'stop_loss_pct': -5.0,     # æ­¢æŸç™¾åˆ†æ¯”ï¼ˆ-5%ï¼‰
    'take_profit_pct': 10.0    # æ­¢ç›ˆç™¾åˆ†æ¯”ï¼ˆ+10%ï¼Œå¯é€‰ï¼‰
}
```

**é€»è¾‘**: å½“äºæŸè¾¾åˆ°æ­¢æŸçº¿æˆ–ç›ˆåˆ©è¾¾åˆ°æ­¢ç›ˆçº¿æ—¶é€€å‡º

**é€‚ç”¨åœºæ™¯**: é£é™©æ§åˆ¶ã€è¶‹åŠ¿ç­–ç•¥

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 3. ATRStopLossExitï¼ˆATRåŠ¨æ€æ­¢æŸé€€å‡ºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/exits/atr_stop_loss_exit.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'atr_period': 14,        # ATRè®¡ç®—å‘¨æœŸ
    'atr_multiplier': 2.0    # ATRå€æ•°ï¼ˆæ­¢æŸè·ç¦» = ATR Ã— multiplierï¼‰
}
```

**é€»è¾‘**: ä½¿ç”¨ ATRï¼ˆçœŸå®æ³¢åŠ¨å¹…åº¦ï¼‰åŠ¨æ€è°ƒæ•´æ­¢æŸçº¿

**é€‚ç”¨åœºæ™¯**: è¶‹åŠ¿è·Ÿè¸ªã€æ³¢åŠ¨é€‚åº”

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

#### 4. TrendBasedExitï¼ˆè¶‹åŠ¿é€€å‡ºï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/exits/trend_based_exit.py`

**æ ¸å¿ƒå‚æ•°**:
```python
{
    'ma_period': 20  # å‡çº¿å‘¨æœŸï¼ˆé»˜è®¤20æ—¥ï¼‰
}
```

**é€»è¾‘**: å½“ä»·æ ¼è·Œç ´å‡çº¿æ—¶é€€å‡ºï¼ˆè¶‹åŠ¿åè½¬ï¼‰

**é€‚ç”¨åœºæ™¯**: è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

### StrategyComposerï¼ˆç­–ç•¥ç»„åˆå™¨ï¼‰

**æ–‡ä»¶**: `core/src/strategies/three_layer/strategy_composer.py`

**åŠŸèƒ½**: ç»„åˆä¸‰å±‚ç­–ç•¥ç»„ä»¶ï¼Œç”Ÿæˆå®Œæ•´äº¤æ˜“ç­–ç•¥

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from core.src.strategies.three_layer import (
    MLSelector,
    ImmediateEntry,
    FixedStopLossExit,
    StrategyComposer
)

# ç»„åˆç­–ç•¥
composer = StrategyComposer(
    selector=MLSelector(params={
        'mode': 'lightgbm_ranker',
        'model_path': './models/stock_ranker.pkl',
        'top_n': 50
    }),
    entry=ImmediateEntry(),
    exit_strategy=FixedStopLossExit(params={'stop_loss_pct': -5.0}),
    rebalance_freq='W'  # å‘¨åº¦è°ƒä»“
)

# è·å–å…ƒæ•°æ®
metadata = composer.get_metadata()
```

**æ”¯æŒçš„ç»„åˆæ•°é‡**: 4 Ã— 3 Ã— 4 = **48 ç§ç»„åˆ**

**æµ‹è¯•**: âœ… å®Œæ•´å•å…ƒæµ‹è¯•

---

### BacktestEngine é›†æˆ

**æ–¹æ³•**: `BacktestEngine.backtest_three_layer()`

**æ–‡ä»¶**: `core/src/backtest/backtest_engine.py`

**ä½¿ç”¨ç¤ºä¾‹**:
```python
from core.src.backtest import BacktestEngine

engine = BacktestEngine()

# æ‰§è¡Œä¸‰å±‚æ¶æ„å›æµ‹
result = engine.backtest_three_layer(
    selector=composer.selector,
    entry=composer.entry,
    exit_strategy=composer.exit,
    prices=prices,            # DataFrame: index=æ—¥æœŸ, columns=è‚¡ç¥¨ä»£ç 
    start_date='2023-01-01',
    end_date='2023-12-31',
    rebalance_freq='W',       # é€‰è‚¡é¢‘ç‡ï¼šD/W/M
    initial_capital=1000000.0
)
```

**è¿”å›ç»“æœ**:
```python
{
    'success': True,
    'data': {
        'metrics': {
            'total_return': 0.32,
            'annual_return': 0.32,
            'sharpe_ratio': 1.85,
            'max_drawdown': -0.12,
            ...
        },
        'trades': [...],           # äº¤æ˜“è®°å½•
        'daily_portfolio': [...]   # æ¯æ—¥ç»„åˆ
    }
}
```

**æµ‹è¯•**: âœ… å®Œæ•´é›†æˆæµ‹è¯•

---

## æŠ€æœ¯å®ç°

### è®¾è®¡æ¨¡å¼

| æ¨¡å¼ | åº”ç”¨ | è¯´æ˜ |
|------|------|------|
| **Strategy Pattern** | ä¸‰å±‚åŸºç±» | ç­–ç•¥ç®—æ³•å¯äº’æ¢ |
| **Composite Pattern** | StrategyComposer | ç»„åˆå¤šä¸ªç­–ç•¥ç»„ä»¶ |
| **Factory Pattern** | ç­–ç•¥æ³¨å†Œå™¨ | åŠ¨æ€åˆ›å»ºç­–ç•¥å®ä¾‹ |
| **Template Method** | åŸºç±»æŠ½è±¡æ–¹æ³• | å®šä¹‰ç­–ç•¥æ‰§è¡Œæµç¨‹ |

### Response ç»Ÿä¸€å“åº”

æ‰€æœ‰ Core æ–¹æ³•éµå¾ªç»Ÿä¸€å“åº”æ ¼å¼ï¼š

```python
from core.src.api.response import Response

# æˆåŠŸå“åº”
Response.success(data={'result': ...}, message='å›æµ‹å®Œæˆ')

# å¤±è´¥å“åº”
Response.error(error='å›æµ‹å¤±è´¥', code='BACKTEST_ERROR')
```

### å¼‚å¸¸ç³»ç»Ÿ

```python
from core.src.api.exceptions import (
    ValidationError,      # å‚æ•°éªŒè¯é”™è¯¯
    DataError,            # æ•°æ®é”™è¯¯
    StrategyError,        # ç­–ç•¥æ‰§è¡Œé”™è¯¯
    BacktestError         # å›æµ‹é”™è¯¯
)
```

---

## æµ‹è¯•è¦†ç›–

### æµ‹è¯•ç»Ÿè®¡

| æµ‹è¯•ç±»å‹ | ç”¨ä¾‹æ•° | é€šè¿‡ç‡ | æ–‡ä»¶ä½ç½® |
|---------|--------|--------|---------|
| **é€‰è‚¡å™¨æµ‹è¯•** | 120+ | 100% | `tests/unit/strategies/three_layer/selectors/` |
| **å…¥åœºç­–ç•¥æµ‹è¯•** | 90+ | 100% | `tests/unit/strategies/three_layer/entries/` |
| **é€€å‡ºç­–ç•¥æµ‹è¯•** | 100+ | 100% | `tests/unit/strategies/three_layer/exits/` |
| **ç»„åˆå™¨æµ‹è¯•** | 50+ | 100% | `tests/unit/strategies/three_layer/test_composer.py` |
| **å›æµ‹é›†æˆæµ‹è¯•** | 25+ | 100% | `tests/integration/test_three_layer_backtest.py` |
| **MLSelectorä¸“é¡¹** | 120+ | 100% | `tests/unit/strategies/three_layer/selectors/test_ml_selector.py` |
| **æ€»è®¡** | **385+** | **100%** | - |

### æµ‹è¯•è¿è¡Œ

```bash
# è¿è¡Œæ‰€æœ‰ä¸‰å±‚æ¶æ„æµ‹è¯•
pytest tests/unit/strategies/three_layer/ -v

# è¿è¡Œ MLSelector ä¸“é¡¹æµ‹è¯•
pytest tests/unit/strategies/three_layer/selectors/test_ml_selector.py -v

# è¿è¡Œé›†æˆæµ‹è¯•
pytest tests/integration/test_three_layer_backtest.py -v
```

---

## Backend é›†æˆå»ºè®®

### æ¨èæ–¹æ¡ˆï¼šCore Adapter æ¨¡å¼

**åŸåˆ™**ï¼šBackend ä¸é‡å¤å®ç°ä¸‰å±‚æ¶æ„ï¼Œè€Œæ˜¯ä½œä¸º FastAPI å°è£…å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend FastAPI Layer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - REST API ç«¯ç‚¹                                â”‚
â”‚  - å‚æ•°éªŒè¯å’Œæ ¼å¼è½¬æ¢                            â”‚
â”‚  - Redis ç¼“å­˜                                   â”‚
â”‚  - å¼‚æ­¥è°ƒç”¨                                      â”‚
â”‚  - ç›‘æ§æ—¥å¿—                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ThreeLayerAdapter (Backend)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  def get_selector_metadata() -> dict:           â”‚
â”‚      return call_core_selector_metadata()       â”‚
â”‚                                                  â”‚
â”‚  def run_backtest(params: dict) -> dict:        â”‚
â”‚      composer = create_strategy_composer(params)â”‚
â”‚      return engine.backtest_three_layer(...)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Three-Layer Architecture (v3.1.0) âœ…      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - StockSelector (4ä¸ª)                          â”‚
â”‚  - EntryStrategy (3ä¸ª)                          â”‚
â”‚  - ExitStrategy (4ä¸ª)                           â”‚
â”‚  - StrategyComposer                             â”‚
â”‚  - BacktestEngine.backtest_three_layer()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend å®ç°æ¸…å•

#### 1. ThreeLayerAdapterï¼ˆæ ¸å¿ƒé€‚é…å™¨ï¼‰

**æ–‡ä»¶**: `backend/app/adapters/three_layer_adapter.py`

**åŠŸèƒ½**:
```python
class ThreeLayerAdapter:
    """Core ä¸‰å±‚æ¶æ„é€‚é…å™¨"""

    def get_selectors(self) -> List[dict]:
        """è·å–æ‰€æœ‰é€‰è‚¡å™¨å…ƒæ•°æ®"""

    def get_entries(self) -> List[dict]:
        """è·å–æ‰€æœ‰å…¥åœºç­–ç•¥å…ƒæ•°æ®"""

    def get_exits(self) -> List[dict]:
        """è·å–æ‰€æœ‰é€€å‡ºç­–ç•¥å…ƒæ•°æ®"""

    async def run_backtest(
        self,
        selector_id: str,
        selector_params: dict,
        entry_id: str,
        entry_params: dict,
        exit_id: str,
        exit_params: dict,
        rebalance_freq: str,
        ...
    ) -> dict:
        """æ‰§è¡Œä¸‰å±‚æ¶æ„å›æµ‹"""
```

**å·¥ä½œé‡**: 3 å¤©

---

#### 2. REST API ç«¯ç‚¹

**æ–‡ä»¶**: `backend/app/api/routes/three_layer.py`

**ç«¯ç‚¹æ¸…å•**:

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | ç¼“å­˜ |
|------|------|------|------|
| `/api/v1/three-layer/selectors` | GET | æŸ¥è¯¢å¯ç”¨é€‰è‚¡å™¨ | âœ… Redis 1å¤© |
| `/api/v1/three-layer/entries` | GET | æŸ¥è¯¢å¯ç”¨å…¥åœºç­–ç•¥ | âœ… Redis 1å¤© |
| `/api/v1/three-layer/exits` | GET | æŸ¥è¯¢å¯ç”¨é€€å‡ºç­–ç•¥ | âœ… Redis 1å¤© |
| `/api/v1/three-layer/validate` | POST | éªŒè¯ç­–ç•¥ç»„åˆ | âŒ æ— ç¼“å­˜ |
| `/api/v1/three-layer/backtest` | POST | æ‰§è¡Œå›æµ‹ | âœ… Redis 1å°æ—¶ |

**å·¥ä½œé‡**: 2 å¤©

---

#### 3. ç¼“å­˜ç­–ç•¥

**å…ƒæ•°æ®ç¼“å­˜**ï¼ˆRedisï¼‰:
```python
# é€‰è‚¡å™¨/å…¥åœº/é€€å‡ºå…ƒæ•°æ®
key: "three_layer:selectors:metadata"
ttl: 86400  # 1å¤©
```

**å›æµ‹ç»“æœç¼“å­˜**ï¼ˆRedisï¼‰:
```python
# å›æµ‹ç»“æœ
key: f"three_layer:backtest:{hash(params)}"
ttl: 3600  # 1å°æ—¶
```

**å·¥ä½œé‡**: 1 å¤©

---

#### 4. ç›‘æ§æ—¥å¿—

**å…³é”®æŒ‡æ ‡**:
- API è°ƒç”¨æ¬¡æ•°ï¼ˆæŒ‰ç«¯ç‚¹ï¼‰
- å›æµ‹å¹³å‡è€—æ—¶
- ç¼“å­˜å‘½ä¸­ç‡
- é”™è¯¯ç‡ï¼ˆæŒ‰é”™è¯¯ç±»å‹ï¼‰

**å·¥ä½œé‡**: 1 å¤©

---

#### 5. é›†æˆæµ‹è¯•

**æµ‹è¯•æ¸…å•**:
- API ç«¯ç‚¹æµ‹è¯•ï¼ˆå‚æ•°éªŒè¯ã€æ ¼å¼è½¬æ¢ï¼‰
- ç¼“å­˜æœºåˆ¶æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•
- æ€§èƒ½æµ‹è¯•ï¼ˆç›®æ ‡ï¼šP95 < 300msï¼‰

**å·¥ä½œé‡**: 2 å¤©

---

### æ€»å·¥ä½œé‡ä¼°ç®—

| ä»»åŠ¡ | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|------|--------|--------|
| ThreeLayerAdapter | 3 å¤© | P0 |
| REST API ç«¯ç‚¹ | 2 å¤© | P0 |
| ç¼“å­˜æœºåˆ¶ | 1 å¤© | P1 |
| ç›‘æ§æ—¥å¿— | 1 å¤© | P1 |
| é›†æˆæµ‹è¯• | 2 å¤© | P0 |
| **æ€»è®¡** | **9 å¤©** | - |

**å¯¹æ¯”åŸè®¡åˆ’**ï¼š
- åŸè®¡åˆ’ï¼ˆé‡æ–°å®ç°ï¼‰ï¼š**30+ å¤©**
- æ–°æ–¹æ¡ˆï¼ˆAdapteræ¨¡å¼ï¼‰ï¼š**9 å¤©**
- **èŠ‚çœæ—¶é—´**ï¼š**70%**

---

## æ–‡æ¡£å‚è€ƒ

### Core æ–‡æ¡£

- ğŸ“– [Core ç”¨æˆ·æŒ‡å—](../../core/docs/user_guide/quick_start.md)
- ğŸ—ï¸ [Core æ¶æ„æ–‡æ¡£](../../core/docs/architecture/overview.md)
- ğŸ“š [Core API æ–‡æ¡£](../../core/docs/sphinx/build/html/index.html)
- â­ [ä¸‰å±‚æ¶æ„è®¾è®¡æ¨¡å¼](../../core/docs/architecture/design_patterns.md#ç»„åˆæ¨¡å¼-composite-pattern)

### ç›¸å…³æ–‡æ¡£

- ğŸ“‹ [Backend å®æ–½æ–¹æ¡ˆ](./backtest_three_layer_architecture_implementation_plan.md)
- ğŸ“Š [å‰ç«¯æ”¹è¿›è®¡åˆ’](./frontend-backtest-improvement-plan.md)

---

## æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| v1.0 | 2026-02-06 | åˆå§‹ç‰ˆæœ¬ï¼Œè®°å½• Core v3.1.0 ä¸‰å±‚æ¶æ„å®ç°ç°çŠ¶ |

---

**ğŸ“ ç»´æŠ¤è¯´æ˜**: æœ¬æ–‡æ¡£éš Core ç‰ˆæœ¬æ›´æ–°è€Œæ›´æ–°ï¼Œè¯·å…³æ³¨ Core CHANGELOGã€‚
